<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="JiangChunbo&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Spring Framework Web Servlet | ğŸ¥«ğŸ
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
    
<script src="/js/gitment.js"></script>

  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    
<script src="/js/local-search.js"></script>


<meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="ğŸ¥«ğŸ" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>ğŸ¥«ğŸ</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/categories/" class="item-link">Categories</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/categories/" class="menu-link">Categories</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off"
                    placeholder="Please enter your keyword(s) to search." spellcheck="false"
                    type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>Spring Framework Web Servlet</h2>
  <p class="post-date">2022-05-09</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="Web-on-Servlet-Stack"><a href="#Web-on-Servlet-Stack" class="headerlink" title="Web on Servlet Stack"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html">Web on Servlet Stack</a></h1><h2 id="1-Spring-Web-MVC"><a href="#1-Spring-Web-MVC" class="headerlink" title="1. Spring Web MVC"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc">1. Spring Web MVC</a></h2><p>Spring Web MVC æ˜¯åŸºäº Servlet API çš„åŸå§‹ Web æ¡†æ¶ï¼Œä»å¾ˆæ—©çš„æ—¶å€™å°±åŒ…å«åœ¨ Spring Framework ä¹‹ä¸­ã€‚æ­£å¼åç§° â€”â€” Spring Web MVCï¼Œæ¥æºäºå®ƒçš„æºæ¨¡å—åç§°ï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/tree/master/spring-webmvc">spring-webmvc</a>ï¼‰ï¼Œä½†é€šå¸¸ç§°ä¹‹ä¸º â€œSpring MVCâ€ã€‚</p>
<p>ä¸ Spring Web MVC å¹³è¡Œï¼ŒSpring Framework 5.0 å¼•å…¥äº†ä¸€ä¸ªå“åº”å¼æ ˆ web æ¡†æ¶ï¼Œå…¶åç§°ä¸º â€œSpring WebFluxâ€ï¼Œä¹Ÿæ˜¯åŸºäºå…¶æºæ¨¡å—ï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/tree/master/spring-webflux">spring-webflux</a>ï¼‰ã€‚æœ¬èŠ‚æ¶µç›– Spring Web MVCã€‚<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web-reactive.html#spring-web-reactive">ä¸‹ä¸€èŠ‚</a>æ¶µç›– Spring WebFluxã€‚</p>
<p>æœ‰å…³åŸºçº¿ä¿¡æ¯ä»¥åŠä¸ Servlet å®¹å™¨å’Œ Java EE ç‰ˆæœ¬èŒƒå›´çš„å…¼å®¹æ€§ï¼Œè¯·å‚è§ Spring Framework <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-Versions">Wiki</a>ã€‚</p>
<h3 id="1-1-DispatcherServlet"><a href="#1-1-DispatcherServlet" class="headerlink" title="1.1. DispatcherServlet"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-servlet">1.1. DispatcherServlet</a></h3><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web-reactive.html#webflux-dispatcher-handler">WebFlux</a></p>
<p>ä¸è®¸å¤šå…¶ä»– Web æ¡†æ¶ä¸€æ ·ï¼ŒSpring MVC å›´ç»•ç€å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼è®¾è®¡ï¼Œå…¶ä¸­é¦–è¦çš„ <code>Servlet</code> â€”â€” <code>DispatcherServlet</code> ä¸ºè¯·æ±‚å¤„ç†æä¾›äº†ä¸€ç»„å…±äº«çš„ç®—æ³•ï¼Œè€Œå®é™…çš„å·¥ä½œåˆ™ç”±å¯é…ç½®çš„ä»£ç†ç»„ä»¶æ‰§è¡Œã€‚è¿™ç§æ¨¡å‹çµæ´»ï¼Œå¹¶ä¸”æ”¯æŒå„ç§å·¥ä½œæµã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> ç®€å•æ¥è¯´ï¼Œ<code>DispatcherServlet</code> ä¸ºæ‰€æœ‰è¯·æ±‚æä¾›ç»Ÿä¸€çš„å¤„ç†æµç¨‹ï¼ˆ<code>doDispatch</code>ï¼‰ï¼Œä½†æ˜¯ç»†èŠ‚éƒ¨åˆ†ç”±å„ä¸ªç»„ä»¶å®ç°ï¼Œè€Œä¸”å¹¶ä¸æ˜¯æ¯ä¸ªç»„ä»¶åœ¨å¤„ç†æ¯ä¸ªè¯·æ±‚æ—¶éƒ½ä¼šå‘æŒ¥ä½œç”¨ã€‚</p>
</blockquote>
<p>æ­£å¦‚ä»»ä½• <code>Servlet</code> ä¸€æ ·ï¼Œ<code>DispatcherServlet</code> ä¹Ÿéœ€è¦æ ¹æ® Servlet è§„èŒƒè¿›è¡Œå£°æ˜ä»¥åŠæ˜ å°„ï¼ˆè·¯å¾„ï¼‰ï¼Œå¯ä»¥é€šè¿‡ Java é…ç½®æˆ–è€…åœ¨ <code>web.xml</code> ä¸­å£°æ˜ä»¥åŠæ˜ å°„ã€‚åè¿‡æ¥ï¼Œ<code>DispatcherServlet</code> ä½¿ç”¨ Spring é…ç½®ï¼Œå»å‘ç°å®ƒæ‰€éœ€è¦çš„å§”æ‰˜ç»„ä»¶ï¼Œæ¯”å¦‚ç”¨äºè¯·æ±‚æ˜ å°„ï¼Œè§†å›¾è§£æï¼Œå¼‚å¸¸å¤„ç†çš„ç»„ä»¶ï¼Œç­‰ç­‰ã€‚</p>
<p>ä¸‹é¢æ˜¯æœ‰å…³äº Java é…ç½®æ³¨å†Œä»¥åŠåˆå§‹åŒ– <code>DispatcherServlet</code> çš„ç¤ºä¾‹ï¼Œè¿™ä¼šè¢« Servlet å®¹å™¨è‡ªåŠ¨æ£€æµ‹ï¼ˆå‚è§ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-container-config">Servlet Config</a>ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebApplicationInitializer</span> <span class="keyword">implements</span> <span class="title class_">WebApplicationInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStartup</span><span class="params">(ServletContext servletContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Load Spring web application configuration</span></span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        context.register(AppConfig.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Create and register the DispatcherServlet</span></span><br><span class="line">        <span class="type">DispatcherServlet</span> <span class="variable">servlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>(context);</span><br><span class="line">        ServletRegistration.<span class="type">Dynamic</span> <span class="variable">registration</span> <span class="operator">=</span> servletContext.addServlet(<span class="string">&quot;app&quot;</span>, servlet);</span><br><span class="line">        registration.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        registration.addMapping(<span class="string">&quot;/app/*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é™¤äº†ç›´æ¥ä½¿ç”¨ ServletContext APIï¼Œä½ è¿˜å¯ä»¥ç»§æ‰¿ <code>AbstractAnnotationConfigDispatcherServletInitializer</code> å¹¶è¦†ç›–ç‰¹å®šçš„æ–¹æ³•ï¼ˆè§ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-servlet-context-hierarchy">Context Hierarchy</a> ä¸‹é¢çš„ä¾‹å­ï¼‰ã€‚</p>
</blockquote>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> ä¸å¿…å¤ªå…³å¿ƒè¿™é‡Œï¼Œåªæœ‰åŸºäºå¤–éƒ¨å®¹å™¨éƒ¨ç½²çš„æ—¶å€™æ‰ä¼šåŠ è½½ <code>WebApplicationInitializer</code></p>
</blockquote>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯ <code>web.xml</code> é…ç½®æ³¨å†Œä»¥åŠåˆå§‹åŒ– <code>DispatcherServlet</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/app-context.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>app<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span><span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>app<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/app/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Spring Boot éµå¾ªä¸€ç§ä¸åŒçš„åˆå§‹åŒ–é¡ºåºã€‚Spring Boot å¹¶ä¸æ˜¯ç›´æ¥æŒ‚è½½åˆ° Servlet å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯ä½¿ç”¨ Spring é…ç½®æ¥å¼•å¯¼è‡ªèº«ä»¥åŠå†…åµŒçš„ Servlet å®¹å™¨ã€‚<code>Filter</code> å’Œ <code>Servlet</code> çš„å£°æ˜ä»¥ Spring é…ç½®çš„æ–¹å¼è¢«æ£€æµ‹åˆ°ï¼Œå¹¶æ³¨å†Œåˆ° Servlet å®¹å™¨ã€‚</p>
</blockquote>
<h4 id="1-1-1-Context-Hierarchy"><a href="#1-1-1-Context-Hierarchy" class="headerlink" title="1.1.1. Context Hierarchy"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-container-config">1.1.1. Context Hierarchy</a></h4><p><code>DispatcherServlet</code> æœŸæœ›ä¸€ä¸ª <code>WebApplicationContext</code>ï¼ˆç»§æ‰¿äºç®€å• <code>ApplicationContext</code>ï¼‰ ç”¨äºè‡ªå·±çš„é…ç½®ã€‚<code>WebApplicationContext</code> æŒæœ‰ <code>ServletContext</code> çš„å¼•ç”¨ï¼Œå¹¶ä¸”æŒæœ‰ç›¸å…³çš„ <code>Servlet</code> çš„å¼•ç”¨ã€‚<code>WebApplicationContext</code> ä¹Ÿä¼šç»‘å®šåˆ° <code>ServletContext</code>ï¼Œä»¥ä¾¿äºåº”ç”¨ç¨‹åºåœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥é€šè¿‡ <code>RequestContextUtiles</code> çš„é™æ€æ–¹æ³•æ‰¾åˆ° <code>WebApplicationContext</code>ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> ä¸Šé¢è¿™å¥è¯ç®€å•æ¥çœ‹å°±æ˜¯ <code>WebApplicationContext</code> å’Œ <code>ServletContext</code> ç›¸äº’å¼•ç”¨ã€‚<code>ServletContext</code> ç»‘å®š <code>WebApplicationContext</code> æ–¹å¼æ˜¯è®¾ç½®ä¸ºè¯·æ±‚çš„å±æ€§ã€‚</p>
</blockquote>
<p>å¯¹äºè®¸å¤šåº”ç”¨ç¨‹åºè€Œè¨€ï¼Œå…·æœ‰å•ä¸ªçš„ <code>WebApplicationContext</code> æ˜¯ç®€æ˜“ä¸”è¶³å¤Ÿç”¨äº†ã€‚ä¹Ÿæœ‰å¯èƒ½ï¼Œæœ‰ä¸€ç§ä¸Šä¸‹æ–‡ç»“æ„ï¼Œå…¶ä¸­ï¼Œæ ¹ <code>WebApplicationContext</code> è¢«å¤šä¸ª <code>DispatcherServlet</code> å®ä¾‹å…±äº«ï¼ˆæˆ–è€…å…¶ä»– <code>Servlet</code>ï¼‰ï¼Œæ¯ä¸ª <code>Servlet</code> åˆæœ‰è‡ªå·±çš„å­ <code>WebApplicationContext</code> é…ç½®ã€‚æœ‰å…³ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/core.html#context-introduction"> Additional Capabilities of the <code>ApplicationContext</code></a></p>
<p>root <code>WebApplicationContext</code> é€šå¸¸åŒ…å«åŸºäºæ¶æ„ Beanï¼Œä¾‹å¦‚æ•°æ®ä»“åº“å’Œä¸šåŠ¡æœåŠ¡ï¼Œå®ƒä»¬éœ€è¦åœ¨å¤šä¸ª <code>Servlet</code> å®ä¾‹ä¸Šå…±äº«ã€‚è¿™äº› Bean è¢«æœ‰æ•ˆç»§æ‰¿ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç‰¹å®šäº Servlet çš„å­ <code>WebApplicationContext</code> ä¸­è¦†ç›–ï¼Œè¿™é€šå¸¸åŒ…å«ç»™å®šçš„æœ¬åœ° <code>Servlet</code> Beanã€‚ä¸‹å›¾å±•ç¤ºäº†è¿™ç§å…³ç³»ï¼š</p>
<img src="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/images/mvc-context-hierarchy.png">

<p>ä¸‹é¢çš„ç¤ºä¾‹é…ç½®äº†ä¸€ä¸ª <code>WebApplicationContext</code> å±‚æ¬¡ç»“æ„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123; RootConfig.class &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123; App1Config.class &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;/app1/*&quot;</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœä¸éœ€è¦åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å±‚æ¬¡ç»“æ„ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ <code>getRootConfigClasses()</code> è¿”å›æ‰€æœ‰çš„é…ç½®ï¼Œå¹¶ä¸”åœ¨ <code>getServletConfigClasses()</code> è¿”å› <code>null</code>ã€‚</p>
</blockquote>
<p>ä¸‹é¢ç¤ºä¾‹å±•ç¤ºäº† <code>web.xml</code> çš„ç­‰ä»·ç‰©ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/root-context.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>app1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/app1-context.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>app1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/app1/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœåº”ç”¨ç¨‹åºä¸éœ€è¦ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„ï¼Œåˆ™å¯ä»¥ä»…ä»…é…ç½® â€œrootâ€ ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¿æŒ <code>contextConfigLocation</code> Servlet å‚æ•°ä¸ºç©ºã€‚</p>
</blockquote>
<h4 id="1-1-2-Special-Bean-Types"><a href="#1-1-2-Special-Bean-Types" class="headerlink" title="1.1.2. Special Bean Types"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-servlet-special-bean-types">1.1.2. Special Bean Types</a></h4><p><code>DispatcherServlet</code> å§”æ‰˜ç‰¹æ®Šçš„ bean æ¥å¤„ç†è¯·æ±‚å¹¶ç»™äºˆåˆé€‚çš„å“åº”ã€‚å…·ä½“è§å®˜ç½‘åˆ—è¡¨ã€‚</p>
<p>ä¸‹é¢çš„è¡¨æ ¼åˆ—å‡ºäº†ç”± <code>DispatcherServlet</code> æ£€æµ‹çš„ç‰¹æ®Š beanï¼š</p>
<table>
<thead>
<tr>
<th align="left">Bean Type</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>HandlerMapping</code></td>
<td align="left">å°†è¯·æ±‚æ˜ å°„åˆ° handlerï¼Œä»¥åŠå‰ç½®å¤„ç†æ‹¦æˆªå™¨å’Œåç½®å¤„ç†æ‹¦æˆªå™¨çš„åˆ—è¡¨ã€‚è¯¥æ˜ å°„åŸºäºæŸäº›è§„åˆ™ï¼Œå…¶ä¸­çš„ç»†èŠ‚éšç€ <code>HandlerMapping</code> çš„å®ç°æœ‰æ‰€ä¸åŒã€‚<br><br>ä¸¤ä¸ªä¸»è¦çš„ <code>HandlerMapping</code> çš„å®ç°ç±»ï¼š<br>(1) <code>RequestMappingHandlerMapping </code>ï¼Œå®ƒæ”¯æŒ <code>@RequestMapping</code> æ³¨è§£æ–¹æ³•<br>(2) <code>SimpleUrlHandlerMapping</code>ï¼Œå®ƒç»´æŠ¤ URI è·¯å¾„æ¨¡å¼åˆ° handler çš„æ˜¾å¼æ³¨å†Œ</td>
</tr>
<tr>
<td align="left"><code>HandlerAdapter</code></td>
<td align="left">å¸®åŠ© <code>DispatcherServlet</code> è°ƒç”¨æ˜ å°„åˆ°è¯·æ±‚çš„ handlerï¼Œä¸ç®¡ handler å®é™…æ˜¯å¦‚ä½•è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨æ³¨è§£å¼æ§åˆ¶å™¨éœ€è¦è§£ææ³¨è§£ã€‚<code>HandlerAdapter</code> çš„ä¸»è¦ç›®çš„æ˜¯é˜²æ­¢ <code>DispatcherServlet</code> å—æ­¤ç±»ç»†èŠ‚çš„å½±å“</td>
</tr>
<tr>
<td align="left"><code>HandlerExceptionResolver</code></td>
<td align="left">è§£æå¼‚å¸¸çš„ç­–ç•¥ï¼Œå¯èƒ½ä¼šå°†å®ƒä»¬æ˜ å°„åˆ° handlerï¼Œhtml é”™è¯¯è§†å›¾ï¼Œæˆ–è€…å…¶ä»–ç›®æ ‡</td>
</tr>
<tr>
<td align="left"><code>ViewResolver</code></td>
<td align="left">ä» handler è¿”å›çš„åŸºäºå­—ç¬¦ä¸²çš„é€»è¾‘è§†å›¾åç§°è§£æä¸ºè¦å‘ˆç°ç»™å“åº”çš„å®é™…è§†å›¾</td>
</tr>
<tr>
<td align="left"><code>LocaleResolver</code>,<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-timezone">LocaleContextResolver</a></td>
<td align="left">è§£æå®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨çš„ <code>Locale</code> ä»¥åŠå¯èƒ½çš„æ—¶åŒºï¼Œä»¥ä¾¿èƒ½æä¾›å›½é™…åŒ–çš„è§†å›¾ã€‚å‚è§ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-localeresolver">Locale</a></td>
</tr>
<tr>
<td align="left"><code>ThemeResolver</code></td>
<td align="left">è§£æä½ çš„ Web åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„ä¸»é¢˜</td>
</tr>
<tr>
<td align="left"><code>MultipartResolver</code></td>
<td align="left">åœ¨æŸäº› multipart è§£æåº“çš„å¸®åŠ©ä¸‹ï¼Œç”¨äºè§£æ multi-part è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œæµè§ˆå™¨è¡¨å•æ–‡ä»¶ä¸Šä¼ ï¼‰ã€‚è¯·å‚é˜… <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-multipart">Multipart Resolver</a></td>
</tr>
<tr>
<td align="left"><code>FlashMapManager</code></td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="1-1-3-Web-MVC-Config"><a href="#1-1-3-Web-MVC-Config" class="headerlink" title="1.1.3. Web MVC Config"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-servlet-config">1.1.3. Web MVC Config</a></h4><p>åº”ç”¨ç¨‹åºå¯ä»¥å£°æ˜ä¸€äº›åœ¨ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-servlet-special-bean-types">Special Bean Types</a> åˆ—å‡ºçš„åŸºç¡€æ¶æ„çš„ Beanï¼Œéœ€è¦è¿™äº› Bean æ¥å¤„ç†è¯·æ±‚ã€‚<code>DispatcherServlet</code> ä¼šä¸ºæ¯ä¸ªç‰¹æ®Š Bean æ£€æŸ¥ <code>WebApplicationContext</code>ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„ Bean ç±»å‹ï¼Œåˆ™ä¼šå›é€€åˆ°ä½¿ç”¨ <code>DispatcherServlet.properties</code> åˆ—å‡ºçš„é»˜è®¤ beanã€‚</p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒMVC Config æ˜¯æœ€ä½³å‡ºå‘ç‚¹ã€‚å®ƒä»¥ Java æˆ–è€… XML çš„æ–¹å¼å£°æ˜äº†éœ€è¦çš„ beanï¼Œå¹¶ä¸”æä¾›äº†æ›´é«˜çº§é…ç½®å›è°ƒ API ç”¨äºè‡ªå®šä¹‰ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> MVC Config æ˜¯å®˜æ–¹æœ¯è¯­ï¼Œä»£è¡¨ Spring MVC æä¾›çš„é»˜è®¤é…ç½®ï¼Œå¯ä»¥æ˜¯æ³¨è§£å¼å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ XML æ–¹å¼å¯ç”¨ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ <code>@EnableWebMvc</code> å’Œ <code>&lt;mvc:annotation-driven/&gt;</code></p>
</blockquote>
<blockquote>
<p>Spring Boot ä¾èµ–äº MVC Java Config é…ç½® Spring MVCï¼Œä»¥åŠæä¾›äº†è®¸å¤šé¢å¤–çš„ä¾¿åˆ©é€‰é¡¹</p>
</blockquote>
<h4 id="1-1-4-Servlet-Config"><a href="#1-1-4-Servlet-Config" class="headerlink" title="1.1.4. Servlet Config"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-container-config">1.1.4. Servlet Config</a></h4><blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å¯¹äº Spring Boot æ¥è¯´ï¼Œ<code>DispatcherServlet</code> æ˜¯è‡ªåŠ¨é…ç½®çš„ï¼Œè€Œä¸” Servlet å®¹å™¨ä¹Ÿæ˜¯åœ¨ <code>ApplicationContext</code> è¿›è¡Œ <code>refresh</code> çš„è¿‡ç¨‹ä¸­å†…åµŒå¯åŠ¨çš„ï¼Œæ‰€ä»¥è¿™ä¸€èŠ‚å¯ä»¥ç®€å•äº†è§£</p>
</blockquote>
<p>åœ¨ Servlet 3.0+ ç¯å¢ƒä¸‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ç¼–ç¨‹æ–¹å¼ä½œä¸ºä¸€ç§æ›¿ä»£æ–¹æ¡ˆè¿›è¡Œ Servlet å®¹å™¨é…ç½®ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ä¸ <code>web.xml</code> æ–¹å¼ç»„åˆä½¿ç”¨ã€‚å¦‚ä¸‹æ˜¯æ³¨å†Œä¸€ä¸ª <code>DispatcherServlet</code> çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.WebApplicationInitializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebApplicationInitializer</span> <span class="keyword">implements</span> <span class="title class_">WebApplicationInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStartup</span><span class="params">(ServletContext container)</span> &#123;</span><br><span class="line">        <span class="type">XmlWebApplicationContext</span> <span class="variable">appContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlWebApplicationContext</span>();</span><br><span class="line">        appContext.setConfigLocation(<span class="string">&quot;/WEB-INF/spring/dispatcher-config.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ServletRegistration.<span class="type">Dynamic</span> <span class="variable">registration</span> <span class="operator">=</span> container.addServlet(<span class="string">&quot;dispatcher&quot;</span>, <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>(appContext));</span><br><span class="line">        registration.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        registration.addMapping(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>WebApplicationInitializer</code> æ˜¯ç”± Spring MVC æä¾›çš„æ¥å£ï¼Œå¯ä»¥ç¡®ä¿æ£€æµ‹åˆ°ä½ çš„å®ç°ç±»å¹¶ç”¨äºåˆå§‹åŒ–ä»»ä½• Servlet 3 å®¹å™¨ã€‚<code>WebApplicationInitializer</code> çš„ä¸€ä¸ªå®ç°ç±»ï¼ˆæŠ½è±¡åŸºç±»ï¼‰æ˜¯ <code>AbstractDispatcherServletInitializer</code>ï¼Œä½ å¯ä»¥é€šè¿‡è¦†ç›–çˆ¶ç±»æ–¹æ³•æŒ‡å®š Servlet æ˜ å°„ä»¥åŠ <code>DispatcherServlet</code> é…ç½®çš„è·¯å¾„ä½¿å¾—æ³¨å†Œ <code>DispatcherServlet</code> æ›´åŠ å®¹æ˜“ã€‚</p>
<p>åº”ç”¨ç¨‹åºä½¿ç”¨åŸºäº Java çš„ Spring é…ç½®å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼Œè¿™ä¹Ÿæ˜¯å®˜æ–¹å»ºè®®çš„æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123; MyWebConfig.class &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;/&quot;</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨åŸºäº XML çš„ Spring é…ç½®ï¼Œåˆ™åº”è¯¥ç›´æ¥ä» <code>AbstractDispatcherServletInitializer</code> ç»§æ‰¿ä¸‹æ¥ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createServletApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">XmlWebApplicationContext</span> <span class="variable">cxt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlWebApplicationContext</span>();</span><br><span class="line">        cxt.setConfigLocation(<span class="string">&quot;/WEB-INF/spring/dispatcher-config.xml&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cxt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;/&quot;</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AbstractDispatcherServletInitializer</code> è¿˜æä¾›äº†ä¸€ç§æ·»åŠ  <code>Filter</code> å®ä¾‹ï¼Œå¹¶å°†å…¶è‡ªåŠ¨æ˜ å°„åˆ° <code>DispatcherServlet</code> çš„ç®€ä¾¿æ–¹æ³•ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[] &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>(), <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>() &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ çš„æ¯ä¸ªè¿‡æ»¤å™¨éƒ½ä¼šåŸºäºå…¶å…·ä½“ç±»å‹æœ‰ä¸€ä¸ªé»˜è®¤åå­—ï¼Œå¹¶è‡ªåŠ¨æ˜ å°„åˆ° <code>DispatcherServlet</code>ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å°† <code>Filter</code> æ˜ å°„åˆ° <code>DispatcherServlet</code> çš„æ–¹å¼æ˜¯é€šè¿‡ Servlet API <code>javax.servlet.FilterRegistration#addMappingForServletNames</code> å®ç°çš„</p>
</blockquote>
<p><code>AbstractDispatcherServletInitializer</code> çš„ protected æ–¹æ³• <code>isAsyncSupported</code> æä¾›äº†ä¸€ä¸ªåœ°æ–¹å¯ä»¥åœ¨ <code>DispatcherServlet</code> ä¸Šå¯ç”¨å¼‚æ­¥æ”¯æŒï¼Œå¹¶ä¸”æ‰€æœ‰è¿‡æ»¤å™¨éƒ½ä¼šæ˜ å°„åˆ°å®ƒä¸Šé¢ã€‚é»˜è®¤åœ°ï¼Œè¿™ä¸ªæ ‡å¿—ä½æ˜¯ <code>true</code></p>
<p>æœ€åï¼Œå¦‚æœä½ éœ€è¦è¿›ä¸€æ­¥è‡ªå®šä¹‰ <code>DispatcherServlet</code> æœ¬èº«ï¼Œä½ å¯ä»¥ç›´æ¥è¦†ç›– <code>createDispatcherServlet</code> æ–¹æ³•ã€‚</p>
<h4 id="1-1-5-Processing"><a href="#1-1-5-Processing" class="headerlink" title="1.1.5. Processing"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-servlet-sequence">1.1.5. Processing</a></h4><p><code>DispatcherServlet</code> å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>æœç´¢ <code>WebApplicationContext</code> å¹¶å°†å…¶ç»‘å®šåˆ° Request çš„å±æ€§ä¸Šï¼Œå¤„ç†è¿‡ç¨‹ä¸­æ§åˆ¶å™¨å’Œå…¶ä»–å…ƒç´ å¯èƒ½ä¼šä½¿ç”¨åˆ°ã€‚é»˜è®¤ç»‘å®šåˆ° <code>DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key ä¸Šã€‚</p>
</li>
<li><p>å°† locale resolver ç»‘å®šåˆ° Request çš„å±æ€§ä¸Šï¼Œä»¥ä¾¿äºå½“å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­è®©å…¶ä»–å…ƒç´ è§£ææœ¬åœ°åŒ–ä½¿ç”¨ã€‚å¦‚æœä½ ä¸éœ€è¦æœ¬åœ°åŒ–è§£æï¼Œä½ å°±ä¸å¿…ä½¿ç”¨ locale resolverã€‚</p>
</li>
<li><p>å°†ä¸»é¢˜è§£æå™¨ç»‘å®šåˆ°è¯·æ±‚ï¼Œä»¥ä½¿è§†å›¾ä¹‹ç±»çš„å…ƒç´ ç¡®å®šç”¨ä½•ç§ä¸»é¢˜ã€‚å¦‚æœä½ ä¸ä½¿ç”¨ä¸»é¢˜ï¼Œå¯ä»¥å¿½ç•¥å®ƒã€‚</p>
</li>
<li><p>å¦‚æœä½ æŒ‡å®šäº†ä¸€ä¸ª multipart æ–‡ä»¶è§£æå™¨ï¼Œå°†ä¼šæ£€æŸ¥è¯·æ±‚çš„ multipartsã€‚å¦‚æœæ‰¾åˆ°äº† multipartsï¼Œè¯·æ±‚ä¼šè¢«åŒ…è£…æˆ <code>MultipartHttpServletRequest</code>ï¼Œç”¨äºè¿‡ç¨‹åæœŸå…¶ä»–å…ƒç´ çš„å¤„ç†ã€‚</p>
</li>
<li><p>æœç´¢åˆé€‚çš„ handlerã€‚å¦‚æœæ‰¾åˆ°äº†ä¸€ä¸ª handlerï¼Œä¸è¯¥ handler æœ‰å…³çš„æ‰§è¡Œé“¾ï¼ˆå‰ç½®å¤„ç†å™¨ã€åç½®å¤„ç†å™¨ã€æ§åˆ¶å™¨ï¼‰å°†ä¼šè¿è¡Œï¼Œç”¨äºå‡†å¤‡ model çš„æ¸²æŸ“ã€‚æˆ–è€…ï¼Œå¯¹äºæ³¨è§£å¼æ§åˆ¶å™¨ï¼Œå“åº”å¯ä»¥ç›´æ¥æ¸²æŸ“ï¼ˆåœ¨ <code>HandlerAdapter</code>ï¼‰è€Œä¸æ˜¯è¿”å›ä¸€ä¸ªè§†å›¾ã€‚</p>
</li>
<li><p>å¦‚æœè¿”å›çš„æ˜¯ modelï¼Œè§†å›¾å°±ä¼šè¢«æ¸²æŸ“ã€‚å¦‚æœæ²¡æœ‰è¿”å› modelï¼ˆå¯èƒ½ç”±äºå‰ç½®å¤„ç†å™¨æˆ–è€…åç½®å¤„ç†å™¨æ‹¦æˆªäº†è¯·æ±‚ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®‰å…¨é—®é¢˜ï¼‰ï¼Œå°±ä¸ä¼šæ¸²æŸ“è§†å›¾ï¼Œå› ä¸ºè¯·æ±‚å·²ç»å®Œæˆäº†ã€‚</p>
</li>
</ul>
<p>å£°æ˜åœ¨ <code>WebApplicationContext</code> çš„ <code>HandlerExceptionResolver</code> bean ç”¨äºè§£æè¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚å…è®¸è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨çš„é€»è¾‘ç”¨äºå¤„ç†å¼‚å¸¸ã€‚</p>
<p><code>DispatcherServlet</code> è¿˜æ”¯æŒè¿”å› <code>last-modification-date</code>ï¼Œæ­£å¦‚ Servlet API æŒ‡å®šçš„ã€‚ç¡®å®šç‰¹å®šè¯·æ±‚çš„æœ€åä¸€æ¬¡ä¿®æ”¹æ—¥æœŸå¾ˆç®€å•ï¼š<code>DispatcherServlet</code> å¯»æ‰¾åˆé€‚çš„ handler mappingï¼Œå¹¶æ£€æµ‹è¢«æ‰¾åˆ°çš„ handler æ˜¯å¦å®ç°äº† <code>LastModified</code> æ¥å£ã€‚å¦‚æœæ˜¯ï¼Œæ¥å£ <code>LastModified</code> çš„æ–¹æ³• <code>long getLastModified(request)</code> çš„å€¼å°±ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> æ³¨è§£å¼ Controller æƒ³è¦å®ç°æœ€åä¸€æ¬¡ä¿®æ”¹æ—¥æœŸéœ€è¦åšä¸€äº›ç‰¹æ®Šæ“ä½œï¼Œå› ä¸º <code>RequestMappingHandlerAdapter</code> çš„ <code>getLastModified</code> æ€»æ˜¯è¿”å› -1ï¼Œä½†æºç æ–¹æ³•æ³¨è§£ä¹Ÿç»™äº†æˆ‘ä»¬æŒ‡å¼•ï¼Œéœ€è¦åœ¨ handler ä¸­è°ƒç”¨ <code>WebRequest#checkNotModified(long)</code>ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ trueï¼Œåˆ™è¿”å› <code>null</code></p>
</blockquote>
<p>ä½ å¯ä»¥é€šè¿‡åœ¨ <code>web.xml</code> æ–‡ä»¶ä¸­æ·»åŠ  Servlet åˆå§‹åŒ–å‚æ•°åˆ° Servlet å£°æ˜ä¸­æ¥è‡ªå®šä¹‰ä¸€ä¸ªè‡ªå·± <code>DispatcherServlet</code>ã€‚ä»¥ä¸‹åˆ—è¡¨åˆ—å‡ºäº†æ”¯æŒçš„å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>contextClass</code></td>
<td align="left">å®ç°äº† <code>ConfigurableWebApplicationContext</code> çš„ç±»ï¼Œå°†ç”±æ­¤ Servlet è¿›è¡Œå®ä¾‹åŒ–ä¸æœ¬åœ°é…ç½®ã€‚é»˜è®¤åœ°ï¼Œä½¿ç”¨ <code>XmlWebApplicationContext</code>ã€‚</td>
</tr>
<tr>
<td align="left"><code>contextConfigLocation</code></td>
<td align="left">ä¼ é€’ç»™ä¸Šä¸‹æ–‡å®ä¾‹çš„å­—ç¬¦ä¸²ï¼Œæ ‡è¯†ä»å“ªé‡Œå¯»æ‰¾ä¸Šä¸‹æ–‡ã€‚</td>
</tr>
<tr>
<td align="left"><code>namespace</code></td>
<td align="left"><code>WebApplicationContext</code>çš„å‘½åç©ºé—´ã€‚é»˜è®¤æ˜¯ <code>[servlet-name]-servlet</code></td>
</tr>
<tr>
<td align="left"><code>throwExceptionIfNoHandlerFound</code></td>
<td align="left">å½“æ‰¾ä¸åˆ°è¯·æ±‚çš„ handler æ—¶ï¼Œæ˜¯å¦æŠ›å‡ºå¼‚å¸¸</td>
</tr>
</tbody></table>
<h4 id="1-1-6-Interception"><a href="#1-1-6-Interception" class="headerlink" title="1.1.6. Interception"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-handlermapping-interceptor">1.1.6. Interception</a></h4><p>æ‰€æœ‰çš„ <code>HandlerMapping</code> å®ç°ç±»éƒ½æ”¯æŒ handler æ‹¦æˆªå™¨ï¼Œè¿™å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ä½ å¸Œæœ›å°†æŸäº›ç‰¹å®šçš„åŠŸèƒ½åº”ç”¨äºæŸäº›è¯·æ±‚ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ£€æŸ¥ principalã€‚</p>
<p>æ‹¦æˆªå™¨å¿…é¡»å®ç° <code>org.springframework.web.servlet.HandlerInterceptor</code> æ¥å£ï¼Œå®ƒæä¾›äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œåº”è¯¥å¯ä»¥è¶³å¤Ÿçµæ´»åœ°æ‰§è¡Œå„ç§å‰ç½®å¤„ç†ä»¥åŠåç½®å¤„ç†æ“ä½œã€‚</p>
<ul>
<li><code>preHandle(..)</code>: åœ¨å®é™…çš„ handler è¿è¡Œä¹‹å‰</li>
<li><code>postHandle(..)</code>: åœ¨å®é™…çš„ handler è¿è¡Œä¹‹å</li>
<li><code>afterCompletion(..)</code>: åœ¨å®Œæ•´çš„è¯·æ±‚ç»“æŸä¹‹å</li>
</ul>
<p><code>preHandle(..)</code> æ–¹æ³•è¿”å›ä¸€ä¸ª boolean å€¼ã€‚ä½ å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³• break æˆ–è€… continue æ‰§è¡Œé“¾çš„æ‰§è¡Œã€‚å½“æ–¹æ³•è¿”å› <code>true</code>ï¼Œhandler æ‰§è¡Œé“¾å°±ä¼šç»§ç»­ï¼›å½“æ–¹æ³•è¿”å› <code>false</code>ï¼Œ<code>DispatcherServlet</code> ä¼šè®¤ä¸ºæ‹¦æˆªå™¨æœ¬èº«å·²ç»å¤„ç†äº†è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œæ¸²æŸ“äº†æ°å½“çš„è§†å›¾ï¼‰ï¼Œå¹¶ä¸”ä¸ä¼šç»§ç»­æ‰§è¡Œå…¶ä»–æ‹¦æˆªå™¨ä»¥åŠå®é™…çš„ handlerã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå½“å…·æœ‰ <code>@ResponseBody</code> ä»¥åŠ <code>ResponseEntity</code> çš„æ—¶å€™ï¼Œ<code>postHandle</code> æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºåœ¨ <code>postHandle</code> ä¹‹å‰å“åº”å°±ä¼šåœ¨ <code>HandlerAdapter</code> ä¸­å†™å…¥å¹¶æäº¤äº†ã€‚è¿™æ„å‘³ç€ï¼Œå¯¹å“åº”è¿›è¡Œä»»ä½•æ›´æ”¹ä¸ºæ—¶å·²æ™šï¼Œä¾‹å¦‚æ·»åŠ é¢å¤–çš„ header éƒ½æ˜¯æ— ç”¨çš„ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥å®ç° <code>ResponseBodyAdvice</code>ï¼Œå¹¶å°†å®ƒå£°æ˜ä¸ºä¸€ä¸ª <code>Controller Advice</code> beanï¼Œæˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ <code>RequestMappingHandlerAdapter</code> ä¸Šç›´æ¥é…ç½®ã€‚</p>
<h4 id="1-1-7-Exceptions"><a href="#1-1-7-Exceptions" class="headerlink" title="1.1.7. Exceptions"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers">1.1.7. Exceptions</a></h4><p>å¦‚æœè¯·æ±‚ mapping æœŸé—´æˆ–è€…è¯·æ±‚ handlerï¼ˆå¦‚ @Controllerï¼‰æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ DispatcherServlet å°†å§”æ‰˜ç»™ HandlerExceptionResolver é“¾è§£æå¼‚å¸¸ï¼Œå¹¶æä¾›å¯æ›¿ä»£çš„å¤„ç†ï¼Œè¿™æ˜¯å…¸å‹çš„é”™è¯¯å“åº”ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å…¶å®å°±æ˜¯ try catch æ¨¡å¼ï¼Œcatch ä¸­å¤„ç†å¼‚å¸¸</p>
</blockquote>
<p>ä»¥ä¸‹è¡¨æ ¼åˆ—å‡ºäº†å¯ç”¨çš„ <code>HandlerExceptionResolver</code> å®ç°ç±»ï¼š</p>
<table>
<thead>
<tr>
<th align="left"><code>HandlerExceptionResolver</code></th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>SimpleMappingExceptionResolver</code></td>
<td align="left">å¼‚å¸¸ç±»åäºé”™è¯¯è§†å›¾åä¹‹é—´çš„æ˜ å°„ã€‚</td>
</tr>
<tr>
<td align="left"><code>DefaultHandlerExceptionResolver</code></td>
<td align="left">è§£æ Spring MVC çš„å¼‚å¸¸ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ° HTTP çŠ¶æ€ç </td>
</tr>
<tr>
<td align="left"><code>ResponseStatusExceptionResolver</code></td>
<td align="left">ç”¨ <code>@ResponseStatus</code> æ³¨è§£è§£æå¼‚å¸¸ï¼Œå¹¶æ ¹æ®æ³¨è§£ä¸­çš„å€¼å°†å…¶æ˜ å°„åˆ° HTTP çŠ¶æ€ç </td>
</tr>
<tr>
<td align="left"><code>ExceptionHandlerExceptionResolver</code></td>
<td align="left">é€šè¿‡è°ƒç”¨ <code>@Controller</code> æˆ–è€… <code>@ControllerAdvice</code> ä¸­çš„ <code>@ExceptionHandler</code> æ–¹æ³•è§£æå¼‚å¸¸</td>
</tr>
</tbody></table>
<p><code>HandlerExceptionResolver</code> çš„çº¦å®šè§„å®šå®ƒå¯ä»¥è¿”å›ï¼š</p>
<ul>
<li>ä¸€ä¸ªæŒ‡å‘é”™è¯¯è§†å›¾çš„ <code>ModelAndView</code></li>
<li>å¦‚æœåœ¨è§£æå™¨å¤„ç†äº†å¼‚å¸¸ï¼Œåˆ™æ˜¯ä¸€ä¸ªç©ºçš„ <code>ModelAndView</code></li>
<li>å¦‚æœå¼‚å¸¸ä»ç„¶æœªè§£æï¼Œåˆ™è¿”å› nullï¼Œåé¢çš„è§£æå™¨ç»§ç»­å°è¯•ï¼Œå¦‚æœæœ€åä»ç„¶æœªè§£æï¼Œå¯ä»¥å†’æ³¡åˆ° Servlet å®¹å™¨</li>
</ul>
<p>MVC Config è‡ªåŠ¨åœ°ä¸ºé»˜è®¤çš„ Spring MVC å¼‚å¸¸ï¼Œ<code>@ResponseStatus</code> æ³¨è§£å¼‚å¸¸ï¼Œä»¥åŠ <code>@ExceptionHandler</code> æ–¹æ³•çš„æ”¯æŒå£°æ˜äº†å†…ç½®çš„è§£æå™¨ã€‚ä½ å¯ä»¥è‡ªå®šä¹‰æˆ–è€…æ›¿æ¢å®ƒä»¬ã€‚</p>
<h5 id="Chain-of-Resolvers"><a href="#Chain-of-Resolvers" class="headerlink" title="Chain of Resolvers"></a>Chain of Resolvers</h5><p>å¯ä»¥é€šè¿‡ HandlerExceptionResolver åœ¨ Spring é…ç½®ä¸­å£°æ˜å¤šä¸ª bean å¹¶æ ¹æ®éœ€è¦è®¾ç½®ä»–ä»¬çš„ order å±æ€§ã€‚order è¶Šé«˜ï¼Œå¼‚å¸¸å¤„ç†å™¨ä½ç½®è¶Šé åï¼ˆè¶Šæ™šå¤„ç†ï¼‰ã€‚</p>
<p>HandlerExceptionResolver çº¦å®šå¯ä»¥è¿”å›å¦‚ä¸‹ï¼š</p>
<ul>
<li>ModelAndView è·³è½¬åˆ°é”™è¯¯é¡µé¢</li>
<li>å¦‚æœåœ¨è§£æå™¨é‡Œå¤„ç†äº†å¼‚å¸¸ï¼Œåˆ™å¯ä»¥è¿”å›ä¸€ä¸ªç©ºçš„ ModelAndView </li>
<li>å¦‚æœå¼‚å¸¸ä»æœªå¤„ç†ï¼Œåˆ™è¿”å› nullï¼Œä¾›åç»­è§£æå™¨ç»§ç»­å°è¯•ï¼Œå¦‚æœå¼‚å¸¸ä¸€ç›´å­˜åœ¨ï¼Œå…è®¸å†’æ³¡åˆ° Servlet å®¹å™¨ã€‚</li>
</ul>
<h5 id="Container-Error-Page"><a href="#Container-Error-Page" class="headerlink" title="Container Error Page"></a>Container Error Page</h5><p>å¦‚æœæ²¡æœ‰ä»»ä½• <code>HandlerExceptionResolver</code> å¤„ç†å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šä¼ æ’­å‡ºå»ï¼Œæˆ–è€…å¦‚æœå“åº”çŠ¶æ€ä¸ºé”™è¯¯çŠ¶æ€ï¼ˆå³ 4xx, 5xxï¼‰ï¼Œé‚£ä¹ˆ Servlet å®¹å™¨ä¼šåœ¨ HTML ä¸­æ¸²æŸ“é»˜è®¤çš„é”™è¯¯é¡µé¢ã€‚è¦è‡ªå®šä¹‰å®¹å™¨çš„é»˜è®¤é”™è¯¯é¡µé¢ï¼Œå¯ä»¥åœ¨ <code>web.xml</code> å£°æ˜ä¸€ä¸ªé”™è¯¯é¡µé¢æ˜ å°„ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»™å®šä¹‹å‰çš„ä¾‹å­ï¼Œå½“å¼‚å¸¸å‘ä¸Šå†’æ³¡æˆ–è€…å“åº”å…·æœ‰ä¸€ä¸ªé”™è¯¯çŠ¶æ€ï¼ŒServlet å®¹å™¨ä¼šå°†é”™è¯¯æ´¾å‘åˆ°é…ç½®çš„ URLï¼ˆä¾‹å¦‚ï¼Œ<code>/error</code>ï¼‰ã€‚æ¥ç€ï¼Œç”± <code>DispatcherServlet</code> å¤„ç†ï¼Œå¯èƒ½å°†å…¶æ˜ å°„åˆ°ä¸€ä¸ª <code>@Controller</code>ï¼Œå…¶å®ç°å¯ä»¥è¿”å›ä¸€ä¸ªå¸¦æœ‰ model çš„é”™è¯¯è§†å›¾åï¼Œæˆ–è€…è¿”å›ä¸€ä¸ª JSON å“åº”ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/error&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">handle</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;status&quot;</span>, request.getAttribute(<span class="string">&quot;javax.servlet.error.status_code&quot;</span>));</span><br><span class="line">        map.put(<span class="string">&quot;reason&quot;</span>, request.getAttribute(<span class="string">&quot;javax.servlet.error.message&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-1-11-Multipart-Resolver"><a href="#1-1-11-Multipart-Resolver" class="headerlink" title="1.1.11. Multipart Resolver"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-multipart">1.1.11. Multipart Resolver</a></h4><p><code>org.springframework.web.multipart.MultipartResolver</code> æ˜¯è§£æåŒ…å«æ–‡ä»¶ä¸Šä¼ çš„ multipart è¯·æ±‚çš„ç­–ç•¥æ¥å£ã€‚</p>
<ul>
<li>å…¶ä¸­ä¸€ä¸ªå®ç°æ˜¯åŸºäº Commons FileUpload æ¡†æ¶</li>
<li>å¦ä¸€ä¸ªæ˜¯åŸºäº Servlet 3.0 multipart è¯·æ±‚è§£æ</li>
</ul>
<h5 id="Apache-Commons-FileUpload"><a href="#Apache-Commons-FileUpload" class="headerlink" title="Apache Commons FileUpload"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-multipart-resolver-commons">Apache Commons FileUpload</a></h5><p>ä¸ºäº†ä½¿ç”¨ Apache çš„ Commons FileUploadï¼š</p>
<ul>
<li>é…ç½®ä¸€ä¸ª <code>CommonsMultipartResolver</code>ï¼Œåç§°ä»»æ„ï¼Œå¦‚ï¼š<code>multipartResolver</code></li>
<li>æ·»åŠ  <code>commons-fileupload</code> ä¾èµ–</li>
</ul>
<h5 id="Servlet-3-0"><a href="#Servlet-3-0" class="headerlink" title="Servlet 3.0"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-multipart-resolver-standard">Servlet 3.0</a></h5><h3 id="1-2-Filters"><a href="#1-2-Filters" class="headerlink" title="1.2. Filters"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#filters">1.2. Filters</a></h3><h4 id="1-2-1-Form-Data"><a href="#1-2-1-Form-Data" class="headerlink" title="1.2.1. Form Data"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#filters-http-put">1.2.1. Form Data</a></h4><p>æµè§ˆå™¨åªèƒ½é€šè¿‡ HTTP GET æˆ–è€… HTTP POST æäº¤è¡¨å•æ•°æ®ï¼Œä½†æ˜¯ï¼Œéæµè§ˆå™¨çš„å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ Postmanï¼‰è¿˜å¯ä»¥ä½¿ç”¨ HTTP PUT, PATCH, DELETE ç­‰ã€‚Servlet API è§„å®šï¼š<code>ServletRequest.getParameter*()</code> ç³»åˆ—æ–¹æ³•ä»…ä»…æ”¯æŒè®¿é—® HTTP POST çš„è¡¨å•å­—æ®µã€‚</p>
<p><code>spring-web</code> æ¨¡å—æä¾›äº† <code>FormContentFilter</code>ï¼Œæ‹¦æˆª Content Type ä¸º <code>application/x-www-form-urlencoded</code> çš„ HTTP PUT, PATCH, DELETE è¯·æ±‚ï¼Œè¯»å–è¯·æ±‚ä½“çš„è¡¨å•æ•°æ®ï¼Œç„¶åå°† <code>ServletRequest</code> è¿›è¡Œä¸€å±‚åŒ…è£…ï¼Œæ¥ç€å°±å¯ä»¥é€šè¿‡ <code>ServletRequest.getParameter*()</code> ç³»åˆ—æ–¹æ³•ç›´æ¥è®¿é—®è¡¨å•æ•°æ®äº†ã€‚</p>
<h4 id="1-2-2-Forwarded-Headers"><a href="#1-2-2-Forwarded-Headers" class="headerlink" title="1.2.2. Forwarded Headers"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#filters-forwarded-headers">1.2.2. Forwarded Headers</a></h4><p>å½“è¯·æ±‚é€šè¿‡ä»£ç†ï¼ˆä¾‹å¦‚ï¼Œè´Ÿè½½å‡è¡¡å™¨ï¼‰æ—¶ï¼Œä¸»æœºï¼Œç«¯å£å·ï¼Œä»¥åŠ schema å¯èƒ½ä¼šæ›´æ”¹ï¼Œè¿™ä½¿å¾—å½¢æˆä¸€ä¸ªæŒ‡å‘ç”¨æˆ·æ­£ç¡®çš„ä¸»æœºï¼Œç«¯å£å’Œ schema çš„è¿æ¥æ¯”è¾ƒå›°éš¾ã€‚</p>
<p>RFC 7239 å®šä¹‰äº† <code>Forwarded</code> HTTP å¤´éƒ¨ï¼Œä»£ç†å¯ä»¥ç”¨å®ƒæ¥æä¾›å…³äºåŸå§‹è¯·æ±‚çš„ä¿¡æ¯ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„éæ ‡å‡†å¤´éƒ¨ï¼ŒåŒ…æ‹¬ <code>X-Forwarded-Host</code>, <code>X-Forwarded-Port</code>, <code>X-Forwarded-Proto</code>, <code>X-Forwared-Ssl</code>, ä»¥åŠ <code>X-Forwarded-Prefix</code>ã€‚</p>
<p><code>ForwardedHeaderFilter</code> æ˜¯ä¸€ä¸ª Servlet è¿‡æ»¤å™¨ï¼Œå®ƒå¯ä»¥ä¿®æ”¹è¯·æ±‚ï¼ša) åŸºäº<code>Forwarded</code> å¤´éƒ¨çš„ä¸»æœºï¼Œç«¯å£å·ï¼Œä»¥åŠ schemaï¼›b) åˆ é™¤è¿™äº›å¤´éƒ¨ï¼Œé˜²æ­¢å½±å“åæœŸã€‚è¯¥è¿‡æ»¤å™¨ä¾èµ–äºåŒ…è£…è¯·æ±‚ï¼Œå› æ­¤ï¼Œå¿…é¡»æ’åœ¨å…¶ä»–è¿‡æ»¤å™¨ï¼ˆå¦‚ <code>RequestContextFilter</code>ï¼‰ä¹‹å‰ï¼Œå®ƒåº”è¯¥ä¸ä¿®æ”¹åçš„ï¼Œè€Œä¸æ˜¯åŸå§‹è¯·æ±‚ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>ç”±äºåº”ç”¨ç¨‹åºå¹¶ä¸çŸ¥é“ header æ˜¯å¦ç”±ä»£ç†ï¼ˆè¿™æ˜¯é¢„æœŸçš„ï¼‰ï¼Œè¿˜æ˜¯ç”±æ¶æ„å®¢æˆ·ç«¯æ·»åŠ çš„ï¼Œå› æ­¤æœ‰å¿…è¦å¯¹äº <code>Forwared</code> å¤´éƒ¨åšä¸€äº›å®‰å…¨è€ƒè™‘ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¿¡ä»»è¾¹ç•Œä¸Šï¼ˆæœ€å¤–å±‚ï¼‰çš„ä»£ç†åº”è¯¥åšä¸€å±‚é…ç½®ï¼Œå»åˆ é™¤é‚£äº›ä»å¤–éƒ¨ä¼ æ¥çš„ä¸ä¿¡ä»»çš„ <code>Forwarded</code> å¤´éƒ¨ã€‚ä½ è¿˜å¯ä»¥ç»™ <code>ForwardedHeaderFilter</code> é…ç½® <code>removeOnly=true</code>ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šåˆ é™¤ä¸ä½¿ç”¨è¿™äº›å¤´éƒ¨ã€‚</p>
<h4 id="1-2-4-CORS"><a href="#1-2-4-CORS" class="headerlink" title="1.2.4. CORS"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#filters-cors">1.2.4. CORS</a></h4><p>Spring MVC é€šè¿‡æ§åˆ¶å™¨çš„æ³¨è§£ï¼Œä¸º CORS é…ç½®æä¾›äº†ç»†ç²’åº¦çš„æ”¯æŒã€‚ä½†æ˜¯ï¼Œå½“ä½ å’Œ Spring Security ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå»ºè®®ä¾èµ–äºå†…ç½®çš„ <code>CorsFilter</code>ï¼Œå®ƒå¿…é¡»æ’åœ¨ Spring Security çš„è¿‡æ»¤å™¨é“¾ä¹‹å‰ã€‚</p>
<h3 id="1-3-Annotated-Controllers"><a href="#1-3-Annotated-Controllers" class="headerlink" title="1.3. Annotated Controllers"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-controller">1.3. Annotated Controllers</a></h3><p>Spring MVC æä¾›äº†ä¸€ä¸ªåŸºäºæ³¨è§£çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå…¶ä¸­ <code>@Controller</code> å’Œ <code>@RestController</code> ç»„ä»¶ç”¨æ³¨è§£æ¥è¡¨ç¤ºè¯·æ±‚çš„æ˜ å°„ã€è¯·æ±‚çš„è¾“å…¥ã€å¼‚å¸¸çš„å¤„ç†ç­‰ã€‚</p>
<p>è¢«æ³¨è§£çš„æ§åˆ¶å™¨å…·æœ‰çµæ´»çš„æ–¹æ³•ç­¾åï¼ˆå³æ–¹æ³•åã€å‚æ•°ä¸ªæ€§åŒ–å®šåˆ¶ï¼‰ï¼Œä¸å¿…æ‰©å±•åŸºç±»ä¹Ÿä¸å¿…å®ç°ç‰¹å®šæ¥å£ã€‚</p>
<p>ä»¥ä¸‹ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªç”±æ³¨è§£å®šä¹‰çš„æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¯¥æ–¹æ³•æ¥å— <code>Model</code> å¹¶å°†è§†å›¾åç§°ä»¥ <code>String</code> å½¢å¼è¿”å›ã€‚</p>
<h4 id="1-3-1-Declaration"><a href="#1-3-1-Declaration" class="headerlink" title="1.3.1. Declaration"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-controller">1.3.1. Declaration</a></h4><p>ä½ å¯ä»¥åœ¨ Servlet çš„ <code>WebApplicationContext</code> ä¸­ä½¿ç”¨æ ‡å‡†çš„ Spring Bean definition æ¥å®šä¹‰æ§åˆ¶å™¨ beanã€‚<code>@Controller</code> æ³¨è§£å…è®¸è‡ªåŠ¨æ£€æµ‹ï¼Œè¿™ä¸ Spring é€šç”¨æ”¯æŒæ£€æµ‹ç±»è·¯å¾„ä¸­çš„ <code>@Component</code> ç±»å¹¶è‡ªåŠ¨æ³¨å†Œ bean definition æ˜¯ä¸€è‡´çš„ã€‚<code>@Controller</code> è¿˜å……å½“æ³¨è§£ç±»çš„åˆ»æ¿å°è±¡ï¼Œè¡¨ç¤ºå…¶ä½œä¸º Web ç»„ä»¶ã€‚</p>
<blockquote>
<p>åˆ»æ¿å°è±¡æ˜¯è¯‘è¯ï¼Œè¡¨ç¤ºè¯¥æ³¨è§£å…·æœ‰ç‰¹å®šè¯­ä¹‰ã€‚</p>
</blockquote>
<h4 id="1-3-2-Request-Mapping"><a href="#1-3-2-Request-Mapping" class="headerlink" title="1.3.2. Request Mapping"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping">1.3.2. Request Mapping</a></h4><p>ä½ å¯ä»¥ä½¿ç”¨ <code>@RequestMapping</code> æ³¨è§£å°†è¯·æ±‚æ˜ å°„åˆ°æ§åˆ¶å™¨æ–¹æ³•ã€‚è¯¥æ³¨è§£æœ‰å„ç§å±æ€§å»æ˜ å°„ï¼Œå¦‚ï¼šURLã€HTTP æ–¹æ³•ã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚å¤´ã€åª’ä½“ç±»å‹ã€‚ä½ å¯ä»¥åœ¨ç±»çº§åˆ«ä½¿ç”¨å®ƒæ¥è¡¨ç¤ºå…±äº«æ˜ å°„æˆ–è€…åœ¨ç‰¹å®šæ–¹æ³•çº§åˆ«ä¸Šä½¿ç”¨æ¥ç¼©å°åˆ°ç‰¹å®šçš„ç«¯ç‚¹æ˜ å°„ã€‚</p>
<p>è¿˜æœ‰ä¸€äº› <code>@RequestMapping</code> çš„ç‰¹å®šå¿«æ·å˜ä½“ï¼š</p>
<ul>
<li><code>@GetMapping</code></li>
<li><code>@PostMapping</code></li>
<li><code>@PutMapping</code></li>
<li><code>@DeleteMapping</code></li>
<li><code>@PatchMapping</code></li>
</ul>
<p>å¿«æ·å˜ä½“æ˜¯è‡ªå®šä¹‰æ³¨è§£ï¼Œå› ä¸ºï¼Œå¤§å¤šæ•°æ§åˆ¶å™¨æ–¹æ³•åº”è¯¥æ˜ å°„åˆ°ç‰¹å®šçš„ HTTP æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>@RequestMapping</code>ã€‚åœ¨ç±»çº§åˆ«ï¼Œä»ç„¶éœ€è¦ <code>@RequestMapping</code> æ¥è¡¨ç¤ºå…±äº«æ˜ å°„ã€‚</p>
<blockquote>
<p>é»˜è®¤åœ°ï¼Œ<code>@RequestMapping</code> ä¸æ‰€æœ‰ HTTP æ–¹æ³•é€‚é…ã€‚</p>
</blockquote>
<h5 id="URI-patterns"><a href="#URI-patterns" class="headerlink" title="URI patterns"></a>URI patterns</h5><table>
<thead>
<tr>
<th><div style="width: 120px">Pattern</div></th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td><code>?</code></td>
<td>åŒ¹é…ä¸€ä¸ªå­—ç¬¦</td>
<td><code>&quot;/pages/t?st.html&quot;</code><br>åŒ¹é… <code>&quot;/pages/test.html&quot;</code> <br> <code>&quot;/pages/t3st.html&quot;</code></td>
</tr>
<tr>
<td><code>*</code></td>
<td>åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td>
<td><code>&quot;/resources/*.png&quot;</code><br>åŒ¹é… <code>&quot;/resources/file.png&quot;</code><br><br><code>&quot;/projects/*/versions&quot;</code><br>åŒ¹é… <code>&quot;/projects/spring/versions&quot;</code>ï¼Œ<br>ä½†ä¸åŒ¹é… <code>&quot;/projects/spring/boot/versions&quot;</code></td>
</tr>
<tr>
<td><code>**</code></td>
<td>åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªè·¯å¾„æ®µï¼Œç›´åˆ°è·¯å¾„ç»“æŸ</td>
<td><code>&quot;/resources/**&quot;</code><br>åŒ¹é… <code>&quot;/resources&quot;</code> <br> <code>&quot;/resources/file.png&quot;</code> <br> <code>&quot;/resources/images/file.png&quot;</code></td>
</tr>
<tr>
<td><code>&#123;name&#125;</code></td>
<td>åŒ¹é…ä¸€æ¡è·¯å¾„æ®µï¼Œå¹¶å°†å…¶æ•è·ä¸ºåä¸º â€œnameâ€ çš„å˜é‡</td>
<td><code>&quot;/projects/&#123;project&#125;/versions&quot;</code><br>åŒ¹é… <code>&quot;/projects/spring/versions&quot;</code>ï¼Œå¹¶æ•è· <code>project=spring</code></td>
</tr>
<tr>
<td><code>&#123;name:[a-z]+&#125;</code></td>
<td>åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ <code>&quot;[a-z]+&quot;</code> ä½œä¸ºåä¸º â€œnameâ€ çš„è·¯å¾„å˜é‡</td>
<td><code>&quot;/projects/&#123;project:[a-z]+&#125;/versions&quot;</code><br>åŒ¹é… <code>&quot;/projects/spring/versions&quot;</code>ï¼Œ<br>ä½†ä¸åŒ¹é… <code>&quot;/projects/spring1/versions&quot;</code></td>
</tr>
</tbody></table>
<h4 id="1-3-3-Handler-Methods"><a href="#1-3-3-Handler-Methods" class="headerlink" title="1.3.3. Handler Methods"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-methods">1.3.3. Handler Methods</a></h4><p><code>@RequestMapping</code> å¤„ç†å™¨æ–¹æ³•å…·æœ‰çµæ´»çš„ç­¾åï¼Œå¯ä»¥ä»ä¸€ç³»åˆ—æ”¯æŒçš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼ä¸­è¿›è¡Œé€‰æ‹©ã€‚</p>
<h5 id="Method-Arguments"><a href="#Method-Arguments" class="headerlink" title="Method Arguments"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-arguments">Method Arguments</a></h5><table>
<thead>
<tr>
<th>Controller method argument</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>WebRequest</code>,<code>NativeWebRequest</code></td>
<td>æ— éœ€ç›´æ¥ä½¿ç”¨ Servlet APIï¼Œå¯¹è¯·æ±‚å‚æ•°ã€è¯·æ±‚å±æ€§ã€ä¼šè¯å±æ€§çš„é€šç”¨è®¿é—®</td>
</tr>
<tr>
<td><code>javax.servlet.ServletRequest</code>, <code>javax.servlet.ServletResponse</code></td>
<td>é€‰æ‹©ä»»ä½•ç‰¹å®šçš„è¯·æ±‚æˆ–ç›¸åº”ç±»å‹ï¼Œä¾‹å¦‚ï¼Œ<code>ServletRequest</code>, <code>HttpServletRequest</code>, æˆ–è€… Spring çš„ <code>MultipartRequest</code>, <code>MultipartHttpServletRequest</code></td>
</tr>
<tr>
<td><code>javax.servlet.http.HttpSession</code></td>
<td>å¼ºåˆ¶ Session å¿…é¡»å­˜åœ¨ã€‚å› æ­¤ï¼Œè¯¥å‚æ•°ä¸å¯èƒ½æ˜¯ nullã€‚æ³¨æ„ï¼ŒSession è®¿é—®ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœå…è®¸å¤šä¸ªè¯·æ±‚å¯ä»¥åŒæ—¶è®¿é—®ä¼šè¯ï¼Œè€ƒè™‘è®¾ç½® <code>RequestMappingHandlerAdapter</code> å®ä¾‹çš„ <code>synchronizeOnSession</code> æ ‡å¿—ä½ä¸º tue</td>
</tr>
<tr>
<td><code>javax.servlet.http.PushBuilder</code></td>
<td></td>
</tr>
<tr>
<td><code>java.security.Principal</code></td>
<td></td>
</tr>
<tr>
<td><code>HttpMethod</code></td>
<td>è¯·æ±‚çš„ HTTP æ–¹æ³•</td>
</tr>
<tr>
<td><code>java.util.Locale</code></td>
<td>å½“å‰è¯·æ±‚çš„è¯­è¨€ç¯å¢ƒï¼Œç”±å¯ç”¨çš„æœ€å‡†ç¡®çš„ <code>LocaleResolver</code> å†³å®šï¼ˆé…ç½®çš„ <code>LocaleResolver</code> æˆ–è€… <code>LocaleContextResolver</code></td>
</tr>
<tr>
<td><code>java.util.TimeZone</code> + <code>java.time.ZoneId</code></td>
<td></td>
</tr>
<tr>
<td><code>java.io.InputStream</code>,<code>java.io.Reader</code></td>
<td>é€šè¿‡ Servlet API è®¿é—®æš´éœ²çš„åŸå§‹è¯·æ±‚ä½“</td>
</tr>
<tr>
<td><code>java.io.OutputStream</code>,<code>java.io.Writer</code></td>
<td>é€šè¿‡ Servlet API è®¿é—®æš´éœ²çš„åŸå§‹å“åº”ä½“</td>
</tr>
<tr>
<td><code>@PathVariable</code></td>
<td>ç”¨äºè®¿é—® URI æ¨¡æ¿å˜é‡</td>
</tr>
<tr>
<td><code>@MatrixVariable</code></td>
<td></td>
</tr>
<tr>
<td><code>@RequestParam</code></td>
<td>ç”¨äºè®¿é—® Servlet è¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬ multipart æ–‡ä»¶</td>
</tr>
<tr>
<td><code>@RequestHeader</code></td>
<td>ç”¨äºè®¿é—®è¯·æ±‚å¤´</td>
</tr>
<tr>
<td><code>@CookieValue</code></td>
<td>ç”¨äºè®¿é—® cookie</td>
</tr>
<tr>
<td><code>@RequestBody</code></td>
<td>ç”¨äºè®¿é—® HTTP è¯·æ±‚ä½“</td>
</tr>
<tr>
<td><code>HttpEntity&lt;B&gt;</code></td>
<td></td>
</tr>
<tr>
<td><code>@RequestPart</code></td>
<td>ç”¨äºè®¿é—® <code>multipart/form-data</code> è¯·æ±‚ä¸­çš„ part</td>
</tr>
<tr>
<td><code>java.util.Map</code>, <code>org.springframework.ui.Model</code>, <code>org.springframework.ui.ModelMap</code></td>
<td></td>
</tr>
<tr>
<td><code>RedirectAttributes</code></td>
<td></td>
</tr>
<tr>
<td><code>@ModelAttribute</code></td>
<td></td>
</tr>
<tr>
<td><code>Errors</code>,<code>BindingResult</code></td>
<td></td>
</tr>
<tr>
<td><code>SessionStatus</code> + class-level <code>@SessionAttributes</code></td>
<td></td>
</tr>
<tr>
<td><code>UriComponentsBuilder</code></td>
<td></td>
</tr>
<tr>
<td><code>@SessionAttribute</code></td>
<td></td>
</tr>
<tr>
<td><code>@RequestAttribute</code></td>
<td></td>
</tr>
<tr>
<td>Any other argument</td>
<td></td>
</tr>
</tbody></table>
<h5 id="Return-Values"><a href="#Return-Values" class="headerlink" title="Return Values"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-return-types">Return Values</a></h5><table>
<thead>
<tr>
<th>Controller method return value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>@ResponseBody</code></td>
<td>è¿”å›å€¼é€šè¿‡ <code>HttpMessageConverter</code> å®ç°ç±»è¿›è¡Œè½¬æ¢ï¼Œå¹¶å†™å…¥å“åº”ä¸­</td>
</tr>
<tr>
<td><code>HttpEntity&lt;B&gt;</code>,<code>ResponseEntity&lt;B&gt;</code></td>
<td>æŒ‡å®šå®Œæ•´çš„å“åº”ï¼ˆåŒ…æ‹¬ HTTP å“åº”å¤´ä»¥åŠå“åº”ä½“ï¼‰ï¼Œå°†é€šè¿‡ <code>HttpMessageConverter</code> å®ç°ç±»è½¬æ¢ï¼Œå¹¶å†™å…¥å“åº”</td>
</tr>
<tr>
<td><code>HttpHeaders</code></td>
<td>ç”¨äºè¿”å›ä¸€ä¸ªåªæœ‰å“åº”å¤´ï¼Œæ²¡æœ‰å“åº”ä½“çš„ response</td>
</tr>
<tr>
<td><code>String</code></td>
<td>è§†å›¾åâ€¦</td>
</tr>
<tr>
<td><code>View</code></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Type-Conversion"><a href="#Type-Conversion" class="headerlink" title="Type Conversion"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-typeconversion">Type Conversion</a></h5><p>å¦‚æœ Controller æ–¹æ³•å‚æ•°å£°æ˜ä¸º String ä»¥å¤–çš„å…¶ä»–ç±»å‹ï¼Œåˆ™æŸäº›å¸¦æœ‰ <code>@RequestParam</code>ã€<code>@RequestHeader</code>ã€<code>@PathVariable</code> ç­‰æ³¨è§£çš„å‚æ•°å¯èƒ½éœ€è¦ç±»å‹è½¬æ¢ã€‚</p>
<p>å¯¹äºä¸Šè¿°æƒ…å†µï¼Œå°†æ ¹æ®é…ç½®çš„è½¬æ¢å™¨è‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ã€‚é»˜è®¤åœ°ï¼Œæ”¯æŒä¸€äº›ç®€å•çš„ç±»å‹ï¼Œå¦‚ <code>int</code>, <code>long</code>, <code>Date</code> ç­‰ã€‚ä¹Ÿå¯ç”±é€šè¿‡ <code>WebDataBinder</code> æˆ–è€…é€šè¿‡ä½¿ç”¨ <code>FormattingConversionService</code> æ³¨å†Œ <code>Formatters</code> æ¥è‡ªå®šä¹‰ç±»å‹è½¬æ¢ã€‚</p>
<h5 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-modelattrib-method-args">@ModelAttribute</a></h5><p>åœ¨æ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨ @ModelAttribute æ³¨è§£æ¥è®¿é—® model ä¸­çš„å±æ€§ã€‚model å±æ€§è¿˜æ¶µç›–æ¥è‡ª HTTP Servlet è¯·æ±‚å‚æ•°çš„å€¼ï¼Œå…¶åç§°ä¸å­—æ®µåç§°åŒ¹é…ï¼Œè¿™ç§°ä¸ºæ•°æ®ç»‘å®šï¼Œè®©ä½ ä¸å¿…å¤„ç†è§£æå’Œè½¬åŒ–å•ä¸ª query å‚æ•°ä»¥åŠ form å­—æ®µã€‚ä»¥ä¸‹ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åšï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;/edit&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">processSubmit</span><span class="params">(<span class="meta">@ModelAttribute</span> Pet pet)</span> &#123;</span><br><span class="line">    <span class="comment">// method logic...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>å®˜æ–¹æç¤º</strong> <code>@ModelAttribute</code> æ˜¯å¯é€‰çš„ã€‚é»˜è®¤åœ°ï¼Œä»»ä½•éç®€å•ç±»å‹ï¼ˆç”± <code>BeanUtils#isSimpleProperty</code> å†³å®šï¼‰ï¼Œä¸”æœªè¢«ä»»ä½•å…¶ä»–å‚æ•°è§£æå™¨è§£æçš„å‚æ•°ï¼Œéƒ½ä¼šè¢«å½“ä½œä½¿ç”¨äº† <code>@ModelAttribute</code> æ³¨è§£è¿›è¡Œè§£æã€‚<br><br> è¿™æ˜¯å› ä¸º <code>HandlerMethodArgumentResolverComposite#argumentResolvers</code>ï¼ˆè¿™æ˜¯ä¸€ä¸ª Listï¼‰ åŒ…å«äº†ä¸¤ä¸ª <code>ServletModelAttributeMethodProcessor</code>ï¼Œä¸€ä¸ªåœ¨ä¸­é—´ï¼Œä¸€ä¸ªåœ¨æœ€åï¼Œä¸åŒç‚¹åœ¨äºå±æ€§ <code>annotationNotRequired</code>ï¼Œä½äºä¸­é—´çš„ <code>annotationNotRequired=false</code>ï¼Œå³å¿…é¡»æœ‰ <code>@ModelAttribute</code> æ³¨è§£ï¼›ä½äºæœ€åçš„ <code>annotationNotRequired=true</code>ï¼Œå³æ²¡æœ‰è¢« <code>@ModelAttribute</code> æ³¨è§£ï¼Œæ‰€ä»¥ï¼Œåœ¨æœç´¢ Processor è¿›è¡Œå¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰å‚æ•°è§£æå™¨å¯ä»¥è§£æï¼Œå°±ä¼šä½¿ç”¨æœ€åçš„ <code>ServletModelAttributeMethodProcessor</code> è¿›è¡Œè§£æã€‚</p>
</blockquote>
<p><strong>æ³¨æ„ç‚¹ï¼š</strong><br>(1) å¯¹ç®€å•å‚æ•°ä¸è¿›è¡Œä»»ä½•æ³¨è§£ï¼Œå¯ä»¥è®¤ä¸ºä¸ <code>@RequestParam(required = false)</code> ç­‰æ•ˆï¼Œè€Œä¸”å¦‚æœåªæ˜¯æ·»åŠ äº† <code>@RequestParam</code> æ³¨è§£ï¼Œç¼ºä¹è¯¥å‚æ•°åè€Œä¼šæŠ¥é”™ã€‚</p>
<p>(2) @ModelAttribute å¯ä»¥æ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œå…ˆäº Controller æ–¹æ³•æ‰§è¡Œã€‚</p>
<h5 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-sessionattributes">@SessionAttributes</a></h5><p><code>@SessionAttributes</code> ç”¨äºåœ¨è¯·æ±‚ä¹‹é—´çš„ HTTP Servlet ä¼šè¯ä¸­å­˜å‚¨ model å±æ€§ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªç±»çº§åˆ«æ³¨è§£ï¼Œè¯¥æ³¨è§£å£°æ˜æŒ‡å®šæ§åˆ¶å™¨ä½¿ç”¨çš„ä¼šè¯å±æ€§ã€‚</p>
<p>é€šå¸¸åˆ—å‡ºäº†åº”è¯¥é€æ˜åœ°å­˜å‚¨äº session ä¸­çš„ model å±æ€§çš„åç§°æˆ–è€… mode å±æ€§çš„ç±»å‹ï¼Œä»¥ä¾›åç»­è¯·æ±‚è®¿é—®ã€‚ã€</p>
<p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ <code>@SessionAttributes</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;pet&quot;)</span>   </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EditPetForm</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸­ï¼Œå½“å…·æœ‰åç§° <code>pet</code> çš„ model å±æ€§æ·»åŠ åˆ° Model æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å‡çº§å¹¶ä¿å­˜åˆ° HTTP Servlet Session ä¸­ã€‚å®ƒä¼šä¸€ç›´å­˜å‚¨åœ¨é‚£é‡Œï¼Œç›´åˆ°å¦ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä½¿ç”¨ <code>SessionStatus</code> æ–¹æ³•å‚æ•°å»æ¸…é™¤å­˜å‚¨ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@SessionAttributes(&quot;pet&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EditPetForm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/pets/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">(Pet pet, BindingResult errors, SessionStatus status)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (errors.hasErrors) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        status.setComplete(); </span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="SessionAttribute"><a href="#SessionAttribute" class="headerlink" title="@SessionAttribute"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-sessionattribute">@SessionAttribute</a></h5><p>å¦‚æœä½ éœ€è¦è®¿é—®å…¨å±€ç®¡ç†çš„é¢„å…ˆå­˜åœ¨çš„ session å±æ€§ï¼ˆå³ï¼Œæ§åˆ¶å™¨ä¹‹å¤–ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡è¿‡æ»¤å™¨äº§ç”Ÿï¼‰ï¼Œå¯èƒ½å­˜åœ¨ä¹Ÿå¯èƒ½ä¸å­˜åœ¨ï¼Œä½ å¯ä»¥åœ¨æ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨ <code>@SessionAttribute</code> æ³¨è§£ï¼Œæ­£å¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">(<span class="meta">@SessionAttribute</span> User user)</span> &#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºéœ€è¦æ·»åŠ æˆ–è€…åˆ é™¤ä¼šè¯å±æ€§çš„æ¡ˆä¾‹ï¼Œè¯·è€ƒè™‘æ³¨å…¥ <code>org.springframework.web.context.request.WebRequest</code> æˆ–è€… <code>javax.servlet.http.HttpSession</code> åˆ°æ§åˆ¶å™¨æ–¹æ³•ã€‚</p>
<p>å¯¹äºè¦ä½œä¸ºæ§åˆ¶å™¨å·¥ä½œæµç¨‹çš„ä¸€éƒ¨åˆ†åœ¨ä¼šè¯ä¸­ä¸´æ—¶å­˜å‚¨ model å±æ€§ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ <code>@SessionAttributes</code>ã€‚</p>
<h5 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-requestattrib">@RequestAttribute</a></h5><p>ç±»ä¼¼äº <code>@SessionAttribute</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>@RequestAttribute</code> æ³¨è§£å»è®¿é—®äº‹å…ˆå·²ç»å­˜åœ¨çš„ Request å±æ€§ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ <code>Filter</code> æˆ–è€… <code>HandlerInterceptor</code> æ³¨å…¥çš„å±æ€§ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">(<span class="meta">@RequestAttribute</span> Client client)</span> &#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Multipart"><a href="#Multipart" class="headerlink" title="Multipart"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-multipart-forms">Multipart</a></h5><p>å¯ç”¨äº† <code>MultipartResolver</code> ä¹‹åï¼Œä½¿ç”¨ <code>multipart/form-data</code> çš„ POST è¯·æ±‚å†…å®¹ä¼šè¢«è§£æå¹¶ä¸”å¯ä»¥ä½œä¸ºä¸€èˆ¬çš„è¯·æ±‚å‚æ•°è®¿é—®ã€‚</p>
<blockquote>
<p>Spring Boot ä¼šé€šè¿‡ <code>MultipartAutoConfiguration</code> è‡ªåŠ¨æ³¨å…¥ <code>MultipartResolver</code></p>
</blockquote>
<p>ä¸‹é¢çš„ç¤ºä¾‹è®¿é—®äº†ä¸€ä¸ªä¸€èˆ¬çš„è¡¨å•å­—æ®µä»¥åŠä¸€ä¸ªä¸Šä¼ çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/form&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleFormUpload</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = file.getBytes();</span><br><span class="line">            <span class="comment">// store the bytes somewhere</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:uploadSuccess&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:uploadFailure&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†å‚æ•°ç±»å‹å£°æ˜ä¸º <code>List&lt;MultipartFile&gt;</code> å…è®¸è§£æç›¸åŒå‚æ•°åçš„å¤šä¸ªæ–‡ä»¶ã€‚</p>
<p>å½“ <code>@RequestParam</code> æ²¡æœ‰æŒ‡å®šæ³¨è§£å‚æ•°åï¼Œä¸”è¢«å£°æ˜ä¸º <code>Map&lt;String, MultipartFile&gt;</code> æˆ–è€… <code>MultiValueMap&lt;String, MultipartFile&gt;</code>ï¼Œï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªç»™å®šå‚æ•°åçš„ multipart æ–‡ä»¶éƒ½ä¼šå¡«å……åˆ° map ä¸­ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> è¿™ç§ç”¨æ³•è¯·å‹¿è®¾ç½®å‚æ•°åï¼Œå¦åˆ™ä¼šå‘ç”Ÿè½¬åŒ–é”™è¯¯ï¼›è€Œä¸”è¿™ç§ç”¨æ³•æ— æ³•æ”¶é›†å¤šä¸ªç›¸åŒå‚æ•°åçš„ multipart æ–‡ä»¶ã€‚</p>
</blockquote>
<blockquote>
<p><strong>å®˜æ–¹</strong> å¦‚æœä½¿ç”¨äº† Servlet 3.0 multipart è§£æï¼Œä½ è¿˜å¯ä»¥å£°æ˜ <code>javax.servlet.http.Part</code> ä½œä¸ºæ–¹æ³•å‚æ•°æˆ–è€…é›†åˆçš„ Value ç±»å‹ï¼Œä»¥å–ä»£ Spring çš„ <code>MultipartFile</code></p>
</blockquote>
<p>ä½ è¿˜å¯ä»¥å°† multipart å†…å®¹ä½œä¸ºç»‘å®šåˆ°å‘½ä»¤å¯¹è±¡çš„æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå‰é¢ç¤ºä¾‹ä¸­çš„è¡¨å•å­—æ®µå’Œæ–‡ä»¶å¯ä»¥æ˜¯è¡¨å•å¯¹è±¡ä¸Šçš„å­—æ®µï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å‘½ä»¤å¯¹è±¡ï¼šcommand objectï¼Œå¯ä»¥ç†è§£ä¸ºå¤åˆå¯¹è±¡</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyForm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MultipartFile file;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/form&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleFormUpload</span><span class="params">(MyForm form, BindingResult errors)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!form.getFile().isEmpty()) &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = form.getFile().getBytes();</span><br><span class="line">            <span class="comment">// store the bytes somewhere</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;redirect:uploadSuccess&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:uploadFailure&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ RESTful æœåŠ¡æ–¹æ¡ˆä¸­ï¼Œä¹Ÿå¯ä»¥ä»éæµè§ˆå™¨çš„å®¢æˆ·ç«¯æäº¤ multipart è¯·æ±‚ã€‚å¦‚ä¸‹ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªå¸¦æœ‰ JSON çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /someUrl</span><br><span class="line">Content-Type: multipart/mixed</span><br><span class="line"></span><br><span class="line">--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp</span><br><span class="line">Content-Disposition: form-data; name=&quot;meta-data&quot;</span><br><span class="line">Content-Type: application/json; charset=UTF-8</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;value&quot;</span><br><span class="line">&#125;</span><br><span class="line">--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp</span><br><span class="line">Content-Disposition: form-data; name=&quot;file-data&quot;; filename=&quot;file.properties&quot;</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">... File Data ...</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥ç”¨ <code>@RequestParam</code> ä»¥ <code>String</code>  çš„æ–¹å¼è®¿é—® â€œmeta-dataâ€ éƒ¨åˆ†ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä½ æƒ³å°†ä»–ä» JSON ååºåˆ—åŒ–ï¼ˆç±»ä¼¼äº <code>@RequestBody</code>ï¼‰ã€‚ä½¿ç”¨ <code>@RequestPart</code> æ³¨è§£å¯ä»¥è®¿é—®è¢« <code>HttpMessageConverter</code> è½¬æ¢ä¹‹åçš„ multipartï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">handle</span><span class="params">(<span class="meta">@RequestPart(&quot;meta-data&quot;)</span> MetaData metadata,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestPart(&quot;file-data&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> è¿™ç§æƒ…å†µä¸‹éœ€è¦ç‰¹æ®Šè®¾ç½®æŸä¸ªæ–‡ä»¶çš„ Content-Type ä¸º application&#x2F;json</p>
</blockquote>
<h4 id="1-3-4-Model"><a href="#1-3-4-Model" class="headerlink" title="1.3.4. Model"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-modelattrib-methods">1.3.4. Model</a></h4><p>ä½ å¯ä»¥ä½¿ç”¨ <code>@ModelAttribute</code> æ³¨è§£ï¼š</p>
<ul>
<li><p><code>@RequestMapping</code> æ–¹æ³•ä¸Šçš„ä¸€ä¸ªæ–¹æ³•å‚æ•°ä¸Šï¼Œç”¨äºåˆ›å»ºæˆ–è€…è®¿é—®ä¸€ä¸ªæ¥è‡ª model çš„ <code>Object</code>ï¼Œå¹¶é€šè¿‡ <code>WebDataBinder</code> å°†å®ƒç»‘å®šåˆ°è¯·æ±‚</p>
</li>
<li><p>ä½œä¸º <code>@Controller</code> æˆ–è€… <code>@ControllerAdvice</code> ç±»ä¸­æ–¹æ³•çº§æ³¨è§£ï¼Œå¸®åŠ©åœ¨ä»»ä½• <code>@RequestMapping</code> æ–¹æ³•è°ƒç”¨ä¹‹å‰åˆå§‹åŒ– model</p>
</li>
<li><p>ç”¨äº <code>@RequestMapping</code> æ–¹æ³•ï¼Œæ ‡è®°å…¶è¿”å›å€¼æ˜¯ model å±æ€§</p>
</li>
</ul>
<p>æœ¬èŠ‚è®¨è®º <code>@ModelAttribute</code> æ–¹æ³•ï¼Œå‰é¢åˆ—è¡¨ä¸­çš„ç¬¬ 2 é¡¹ã€‚ä¸€ä¸ªæ§åˆ¶å™¨å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„ <code>@ModelAttribute</code> æ–¹æ³•ã€‚åœ¨åŒä¸€ä¸ªæ§åˆ¶å™¨çš„ <code>@RequestMapping</code> æ–¹æ³•ä¹‹å‰ï¼Œæ‰€æœ‰æ­¤ç±»çš„æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ã€‚<code>@ModelAttribute</code> æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡ <code>@ControllerAdvice</code> åœ¨æ§åˆ¶å™¨ä¹‹é—´å…±äº«ã€‚è¯¦è§â€¦</p>
<p><code>@ModelAttribute</code> å…·æœ‰çµæ´»çš„æ–¹æ³•ç­¾åã€‚ä»–ä»¬æ”¯æŒè®¸å¤šä¸ <code>@RequestMapping</code> æ–¹æ³•ç›¸åŒçš„å‚æ•°ï¼Œé™¤äº† <code>@ModelAttribute</code> æœ¬èº«ï¼Œæˆ–è€…ä¸è¯·æ±‚ä½“ç›¸å…³çš„ä»»ä½•å†…å®¹ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº† <code>@ModelAttribute</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">populateModel</span><span class="params">(<span class="meta">@RequestParam</span> String number, Model model)</span> &#123;</span><br><span class="line">    model.addAttribute(accountRepository.findAccount(number));</span><br><span class="line">    <span class="comment">// add more ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹ç¤ºä¾‹æ·»åŠ äº†ä»…ä»… 1 ä¸ªå±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="keyword">public</span> Account <span class="title function_">addAccount</span><span class="params">(<span class="meta">@RequestParam</span> String number)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> accountRepository.findAccount(number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ çœ‹ä¹Ÿå¯ä»¥åœ¨ <code>@RequestMapping</code> æ–¹æ³•ä¸Šä½¿ç”¨ <code>@ModelAttribute</code> ä½œä¸ºæ–¹æ³•çº§æ³¨è§£ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>@RequestMapping</code> æ–¹æ³•çš„è¿”å›å€¼ä¼šè¢«è§£é‡Šä¸º model å±æ€§ã€‚è¿™é€šå¸¸ä¸éœ€è¦ï¼Œå› ä¸ºè¿™æ˜¯ HTML æ§åˆ¶å™¨çš„é»˜è®¤è¡Œä¸ºï¼Œé™¤éè¿”å›å€¼æ˜¯ <code>String</code>ï¼Œä¼šè¢«è§£é‡Šæˆè§†å›¾åå­—ã€‚<code>@ModelAttribute</code> ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ model å±æ€§åï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/accounts/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ModelAttribute(&quot;myAccount&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Account <span class="title function_">handle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> account;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-5-DataBinder"><a href="#1-3-5-DataBinder" class="headerlink" title="1.3.5. DataBinder"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-initbinder">1.3.5. DataBinder</a></h4><p><code>@Controller</code> å’Œ <code>@ControllerAdvice</code> ç±»å¯ä»¥å…·æœ‰ä¸€äº› <code>@InitBinder</code> æ–¹æ³•ï¼Œç”¨æ¥åˆå§‹åŒ– <code>WebDataBinder</code> å®ä¾‹ï¼Œè€Œè¿™äº›æ–¹æ³•åˆå¯ä»¥ï¼š</p>
<ul>
<li>ç»‘å®šè¯·æ±‚å‚æ•°ï¼ˆå³ï¼Œè¡¨å•æˆ–è€…æŸ¥è¯¢æ•°æ®ï¼‰åˆ° model å¯¹è±¡</li>
<li>å°†åŸºäºå­—ç¬¦ä¸²çš„è¯·æ±‚å€¼ï¼ˆä¾‹å¦‚è¯·æ±‚å‚æ•°ï¼Œè·¯å¾„å˜é‡ï¼Œå¤´ï¼Œcookieç­‰ï¼‰è½¬æ¢ä¸ºæ§åˆ¶å™¨æ–¹æ³•å‚æ•°çš„ç›®æ ‡ç±»å‹</li>
<li>å½“æ¸²æŸ“ HTML å½¢å¼æ—¶ï¼Œå°† model å¯¹è±¡å€¼ä»¥ <code>String</code> å€¼æ ¼å¼åŒ–</li>
</ul>
<p><code>@InitBinder</code> æ–¹æ³•å¯ä»¥æ³¨å†Œç‰¹å®šäºæ§åˆ¶å™¨çš„ <code>java.bean.PropertyEditor</code> æˆ–è€… Spring <code>Converter</code> ä»¥åŠ <code>Formatter</code> ç»„ä»¶ã€‚æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ MVC Config åœ¨å…¨å±€å…±äº«çš„ <code>FormattingConversionService</code> æ³¨å†Œ <code>Converter</code> ä»¥åŠ <code>Formatter</code>ã€‚</p>
<p><code>@InitBinder</code> æ–¹æ³•æ”¯æŒè®¸å¤šè·Ÿ <code>@RequestMapping</code> ä¸€æ ·æ”¯æŒçš„å‚æ•°ï¼Œé™¤äº† <code>@ModelAttribute</code> ï¼ˆcommand objectï¼‰å‚æ•°ã€‚é€šå¸¸ï¼Œè¿™äº›æ–¹æ³•ä»¥ä¸€ä¸ª <code>WebDataBinder</code> å‚æ•°ï¼ˆç”¨äºæ³¨å†Œï¼‰å£°æ˜ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>void</code>ã€‚ä¸‹é¢å±•ç¤ºäº†ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FormController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InitBinder</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initBinder</span><span class="params">(WebDataBinder binder)</span> &#123;</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        dateFormat.setLenient(<span class="literal">false</span>);</span><br><span class="line">        binder.registerCustomEditor(Date.class, <span class="keyword">new</span> <span class="title class_">CustomDateEditor</span>(dateFormat, <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œå½“ä½ é€šè¿‡å…±äº«çš„ <code>FormattingConversionService</code> ä½¿ç”¨åŸºäº <code>Formatter</code> çš„è®¾ç½®æ—¶ï¼Œä½ å¯ä»¥å†ä½¿ç”¨ç›¸åŒçš„æ–¹å¼æ³¨å†Œç‰¹å®šäºæ§åˆ¶å™¨çš„ <code>Formatter</code> å®ç°ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FormController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InitBinder</span> </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initBinder</span><span class="params">(WebDataBinder binder)</span> &#123;</span><br><span class="line">        binder.addCustomFormatter(<span class="keyword">new</span> <span class="title class_">DateFormatter</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-6-Exceptions"><a href="#1-3-6-Exceptions" class="headerlink" title="1.3.6. Exceptions"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-exceptionhandler">1.3.6. Exceptions</a></h4><p><code>@Controller</code> å’Œ <code>@ControllerAdvice</code> ç±»å¯ä»¥æ‹¥æœ‰ <code>@ExceptionHandler</code> æ–¹æ³•æ¥å¤„ç†æ¥è‡ªæ§åˆ¶å™¨æ–¹æ³•çš„å¼‚å¸¸ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">handle</span><span class="params">(IOException ex)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¼‚å¸¸å¯èƒ½ä¸é¡¶çº§å¼‚å¸¸ï¼ˆtop-levelï¼‰ç›¸åŒ¹é…ï¼ˆå³ï¼Œç›´æ¥æŠ›å‡ºçš„ <code>IOException</code>ï¼‰ï¼Œæˆ–è€…ä¸åœ¨é¡¶çº§åŒ…è£…å™¨å¼‚å¸¸çš„ç›´æ¥ cause ç›¸åŒ¹é…ï¼ˆä¾‹å¦‚ï¼Œ<code>IOException</code> è¢«åŒ…è£¹åœ¨ <code>IllegalStateException</code>ï¼‰ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> é¡¶çº§å¼‚å¸¸ï¼ˆtop-levelï¼‰å¯ä»¥ç†è§£ä¸ºæœ€å¤–å±‚å¼‚å¸¸ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ¨¡ç³Šå¼‚å¸¸ï¼Œå¹¶ä¸å…·ä½“ï¼Œå¦å¤–å¼‚å¸¸æœ‰ä¸€ä¸ª causeï¼Œé€šå¸¸è¡¨ç¤ºå…·ä½“å¼‚å¸¸ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥åŒ¹é…åˆ°è¿›è¡Œå¤„ç†ã€‚</p>
</blockquote>
<p>å¯¹äºåŒ¹é…çš„å¼‚å¸¸ç±»å‹ï¼Œæœ€å¥½å°†ç›®æ ‡å¼‚å¸¸å£°æ˜ä¸ºæ–¹æ³•å‚æ•°ï¼Œå¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚å½“å¤šä¸ªå¼‚å¸¸æ–¹æ³•åŒ¹é…æ—¶ï¼Œæ ¹å¼‚å¸¸åŒ¹é…é€šå¸¸æ¯” cause å¼‚å¸¸åŒ¹é…ä¼˜å…ˆçº§æ›´é«˜ã€‚æ›´å…·ä½“åœ°ï¼Œä½¿ç”¨ <code>ExceptionDepthComparator</code> åŸºäºå¼‚å¸¸ç±»å‹çš„æ·±åº¦æ¥å¯¹å¼‚å¸¸è¿›è¡Œæ’åºã€‚</p>
<p>å¦å¤–ï¼Œæ³¨è§£å£°æ˜å¯èƒ½ä¼šç¼©å°åŒ¹é…çš„å¼‚å¸¸ç±»å‹èŒƒå›´ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(&#123;FileSystemException.class, RemoteException.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">handle</span><span class="params">(IOException ex)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„å¼‚å¸¸ç±»å‹æ•°ç»„ï¼Œä»¥åŠä¸€ä¸ªéå¸¸é€šç”¨çš„å‚æ•°ç­¾åï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(&#123;FileSystemException.class, RemoteException.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">handle</span><span class="params">(Exception ex)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ ¹å¼‚å¸¸åŒ¹é…å’Œ cause å¼‚å¸¸åŒ¹é…å¯èƒ½ä»¤äººè§‰å¾—å¾ˆæƒŠè®¶ã€‚<br>åœ¨å‰é¢å±•ç¤ºçš„ <code>IOException</code> å˜é‡ä¸­ï¼Œè¯¥æ–¹æ³•é€šå¸¸ä»¥å®é™…çš„ <code>FileSystemException</code> æˆ–è€… <code>RemoteException</code> å®ä¾‹ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºå®ƒä»¬ä¸¤ä¸ªéƒ½ä» <code>IOException</code> ç»§æ‰¿ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨åŒ…è£…å™¨å¼‚å¸¸ä¸­çš„ä»»ä½•è¿™æ ·çš„ç›¸åŒ¹é…çš„å¼‚å¸¸è¢«ä¼ æ’­å‡ºæ¥ï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª <code>IOException</code>ï¼Œåˆ™ä¼ é€’çš„å¼‚å¸¸å®ä¾‹æ˜¯åŒ…è£…å™¨å¼‚å¸¸ã€‚<br><strong>ä½œè€…çš„è¯</strong> ä¹Ÿå°±æ˜¯éœ€è¦é€šè¿‡ <code>ex.getCause()</code> æ‰èƒ½æ‹¿åˆ°å…·ä½“å¼‚å¸¸<br>è¿™ç§è¡Œä¸ºåœ¨ <code>handle(Exception)</code> å˜é‡ä¸­æ›´ç®€å•ã€‚åœ¨åŒ…è£…æ–¹æ¡ˆä¸‹ï¼Œæ€»æ˜¯ä»¥åŒ…è£…å™¨å¼‚å¸¸è°ƒç”¨å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡ <code>ex.getCause()</code> æ‰¾åˆ°å®é™…åŒ¹é…çš„å¼‚å¸¸ã€‚ä»…å½“ä½œä¸ºé¡¶çº§å¼‚å¸¸æŠ›å‡ºçš„æ—¶å€™ï¼Œä¼ é€’çš„å¼‚å¸¸æ‰æ˜¯å®é™…çš„ <code>FileSystemException</code> æˆ–è€… <code>RemoteException</code>ã€‚<br><strong>ä½œè€…çš„è¯</strong> ä¸è¿‡ï¼Œä½ è°ƒç”¨ <code>ex.getCause()</code> æ‹¿åˆ°çš„ä¹Ÿæ˜¯å…·ä½“å¼‚å¸¸ï¼Œå› ä¸º <code>this.cause=this</code></p>
</blockquote>
<p>æˆ‘ä»¬é€šå¸¸å»ºè®®ä½ åœ¨å‚æ•°ç­¾åä¸­å°½å¯èƒ½å…·ä½“ï¼Œå¯ä»¥é™ä½ root å¼‚å¸¸ç±»å‹å’Œ cause å¼‚å¸¸ç±»å‹ä¹‹é—´ä¸åŒ¹é…çš„å¯èƒ½æ€§ã€‚è€ƒè™‘å°†å¤šåŒ¹é…æ–¹æ³•åˆ†è§£ä¸ºå•ä¸ª <code>@ExceptionHandler</code> æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½é€šè¿‡å…¶ç­¾ååŒ¹é…å•ä¸ªç‰¹å®šå¼‚å¸¸ç±»å‹ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å®˜æ–¹å°±æ˜¯å»ºè®®ä½ å°†æ¯ä¸ªå…·ä½“çš„å¼‚å¸¸éƒ½å†™ä¸€ä¸ª <code>@ExceptionHandler</code></p>
</blockquote>
<p>åœ¨å¤šä¸ª <code>@ControllerAdvice</code> å®‰æ’ä¸‹ï¼Œå»ºè®®ä½ åœ¨ <code>@ControllerAdvice</code> ä¸Šå£°æ˜ä½ çš„ä¸»è¦ root å¼‚å¸¸æ˜ å°„ï¼Œè¯¥æ˜ å°„ä½¿ç”¨ç›¸å…³çš„ order ä¼˜å…ˆä½¿ç”¨ã€‚è™½ç„¶ root å¼‚å¸¸åŒ¹é…ä¼˜å…ˆäº causeï¼Œä½†æ˜¯è¿™æ˜¯åœ¨ç»™å®šçš„ <code>@Controller</code> æˆ–è€… <code>@ControllerAdvice</code> ç±»æ–¹æ³•ä¸­å®šä¹‰ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨è¾ƒé«˜ä¼˜å…ˆçº§ <code>@ControllerAdvice</code> bean ä¸Šçš„ cause åŒ¹é…ä¼˜å…ˆäºä»»ä½•è¾ƒä½çº§çš„ <code>@ControllerAdvice</code> beanã€‚</p>
<h5 id="Method-Arguments-1"><a href="#Method-Arguments-1" class="headerlink" title="Method Arguments"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-exceptionhandler-args">Method Arguments</a></h5><p><code>@ExceptionHandler</code> æ–¹æ³•æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•å‚æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h5 id="Return-Values-1"><a href="#Return-Values-1" class="headerlink" title="Return Values"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-exceptionhandler-return-values">Return Values</a></h5><h4 id="1-3-7-Controller-Advice"><a href="#1-3-7-Controller-Advice" class="headerlink" title="1.3.7. Controller Advice"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-controller-advice">1.3.7. Controller Advice</a></h4><p>é€šå¸¸ï¼Œ<code>@ExceptionHandler</code>ï¼Œ<code>@InitBinder</code>ï¼Œä»¥åŠ <code>@ModelAttribute</code> æ–¹æ³•åº”ç”¨äº <code>@Controller</code> ç±»ï¼ˆæˆ–è€…ç±»ç»§æ‰¿å±‚æ¬¡ï¼‰ï¼Œå°†è¿™äº›æ³¨è§£å£°æ˜åœ¨é‡Œé¢ã€‚å¦‚æœä½ å¸Œæœ›è¿™æ ·çš„æ–¹æ³•åœ¨å…¨å±€èŒƒå›´å†…æ›´å¤šåœ°åº”ç”¨ï¼ˆè·¨æ§åˆ¶å™¨ï¼‰ï¼Œåˆ™å¯ä»¥åœ¨ <code>@ControllerAdvice</code> æˆ–è€… <code>@RestControllerAdvice</code> æ³¨è§£ç±»ä¸­å£°æ˜å®ƒä»¬ã€‚</p>
<p><code>@ControllerAdvice</code> ä½¿ç”¨ <code>@Component</code> æ³¨è§£ï¼Œè¿™æ„å‘³ç€è¿™æ ·çš„ç±»å¯ä»¥é€šè¿‡ç»„ä»¶æ‰«æï¼ˆcomponent scanningï¼‰æ³¨å†Œä¸º Spring beanã€‚<code>@RestControllerAdvice</code> æ˜¯ä¸€ä¸ªç”± <code>@ControllerAdvice</code> å’Œ <code>@ResponseBody</code> æ³¨è§£çš„ç»„åˆæ³¨è§£ï¼Œæœ¬è´¨ä¸Šæ„å‘³ç€ï¼Œ<code>@ExceptionHandler</code> æ–¹æ³•æ˜¯é€šè¿‡æ¶ˆæ¯è½¬æ¢ï¼ˆä»¥åŠè§†å›¾è§£ææˆ–è€…æ¨¡æ¿è§£æï¼‰æ¸²æŸ“åˆ°å“åº”ä½“çš„ã€‚</p>
<p>åœ¨å¯åŠ¨æ—¶ï¼Œç”¨äº <code>@RequestMapping</code> å’Œ <code>@ExceptionHandler</code> æ–¹æ³•çš„åŸºç¡€è®¾æ–½ç±»ä¼šæ£€æµ‹æ³¨è§£æœ‰ <code>@ControllerAdvice</code> çš„ Spring beanï¼Œç„¶ååœ¨è¿è¡Œæ—¶åº”ç”¨å®ƒä»¬çš„æ–¹æ³•ã€‚ å…¨å±€çš„ <code>@ExceptionHandler</code> æ–¹æ³•ï¼ˆæ¥è‡ª <code>@ControllerAdvice</code>ï¼‰åº”ç”¨äºæœ¬åœ°æ–¹æ³•ä¹‹åï¼ˆæ¥è‡ª <code>@Controller</code>ï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå…¨å±€çš„ <code>@ModelAttribute</code> å’Œ <code>@InitBinder</code> æ–¹æ³•åº”ç”¨äºæœ¬åœ°æ–¹æ³•ä¹‹å‰ã€‚</p>
<p>é»˜è®¤åœ°ï¼Œ<code>ControllerAdvice</code> æ–¹æ³•åº”ç”¨äºæ¯ä¸ªè¯·æ±‚ï¼ˆå³ï¼Œæ‰€æœ‰æ§åˆ¶å™¨ï¼‰ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡æ³¨è§£ä¸Šçš„å±æ€§ï¼Œå°†å…¶ç¼©å°åˆ°æ§åˆ¶å™¨çš„å­é›†ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Target all Controllers annotated with @RestController</span></span><br><span class="line"><span class="meta">@ControllerAdvice(annotations = RestController.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleAdvice1</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Target all Controllers within specific packages</span></span><br><span class="line"><span class="meta">@ControllerAdvice(&quot;org.example.controllers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleAdvice2</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Target all Controllers assignable to specific classes</span></span><br><span class="line"><span class="meta">@ControllerAdvice(assignableTypes = &#123;ControllerInterface.class, AbstractController.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleAdvice3</span> &#123;&#125;</span><br></pre></td></tr></table></figure>


<p>å…¨å±€å¼‚å¸¸å¤„ç† @RestControllerAdvice</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">	<span class="meta">@ExceptionHandler(value = AuthenticationException.class)</span></span><br><span class="line">	<span class="keyword">public</span> ResponseDTO <span class="title function_">AuthenticationExceptionHandler</span><span class="params">(AuthenticationException e)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> ResponseDTO.failure(e.getMessage());	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>*** ControllerAdvice å¤„ç† Filter æŠ›å‡ºçš„å¼‚å¸¸</p>
<p>ç±»æ¯”ï¼ŒSturts æ‹¦æˆªå™¨ç»„ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ exception æ‹¦æˆªå™¨ã€‚æœ¬è´¨ä¸Šæ˜¯å€ŸåŠ©è¿‡æ»¤å™¨æ ˆï¼Œå°†å¼‚å¸¸å¤„ç†çš„è¿‡æ»¤å™¨æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®ã€‚</p>
<p>å®šä¹‰ ExceptionFilterï¼Œå°†æ•æ‰çš„å¼‚å¸¸äº¤ç»™å¼‚å¸¸å¤„ç†çš„ Controllerã€‚å…¶ä»–çš„è¿‡æ»¤å™¨ä¸ç”¨å¤„ç†å¼‚å¸¸ï¼Œç›´æ¥ throw å³å¯ã€‚<br>è¯·åŠ¡å¿…è°ƒç”¨ setOrder æ–¹æ³•ï¼Œä¿æŒ order å€¼æœ€å¤§ï¼Œè¿™æ ·è¿‡æ»¤å°±èƒ½æ’åœ¨ç¬¬ä¸€ä¸ªã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(Integer.MIN_VALUE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionFilter</span> <span class="keyword">extends</span> <span class="title class_">HttpFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;ioException&quot;</span>, e);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/error&quot;</span>).forward(request, response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ServletException e) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;servletException&quot;</span>, e);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/error&quot;</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰æŠ›å‡ºå¼‚å¸¸çš„ Mapping</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/error&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseVO <span class="title function_">throwException</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">throw</span> (Exception) request.getAttribute(<span class="string">&quot;exception&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-4-Functional-Endpoints"><a href="#1-4-Functional-Endpoints" class="headerlink" title="1.4. Functional Endpoints"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn">1.4. Functional Endpoints</a></h3><h4 id="1-4-1-Overview"><a href="#1-4-1-Overview" class="headerlink" title="1.4.1. Overview"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-overview">1.4.1. Overview</a></h4><p>åœ¨ WebMvc.fn ä¸­ï¼Œä½¿ç”¨ <code>HandlerFunction</code> å¤„ç† HTTP è¯·æ±‚ï¼šè¿™æ˜¯ä¸€ä¸ªæ¥å— <code>ServerRequest</code> å¹¶è¿”å› <code>ServerResponse</code> çš„å‡½æ•°ã€‚è¯·æ±‚å’Œå“åº”éƒ½æœ‰å›ºå®šçš„çº¦å®šï¼Œæä¾›äº† JDK8 å‹å¥½çš„ HTTP è¯·æ±‚å’Œå“åº”è®¿é—®ã€‚<code>HandlerFunction</code> ç­‰ä»·äºåŸºäºæ³¨è§£çš„ç¼–ç¨‹æ¨¡å‹ä¸­çš„ <code>@RequestMapping</code> æ–¹æ³•ä½“ã€‚</p>
<p>ä¼ å…¥çš„è¯·æ±‚ä¼šä½¿ç”¨ <code>RouterFunction</code> è·¯ç”±åˆ°ä¸€ä¸ª handler functionï¼šè¿™æ˜¯ä¸€ä¸ªæ¥æ”¶ <code>ServerRequest</code> å¹¶è¿”å› ä¸€ä¸ª Optional åŒ…è£¹çš„ <code>HandlerFunction</code>ï¼ˆ<code>Optional&lt;HandlerFunction&gt;</code>ï¼‰ çš„å‡½æ•°ã€‚å½“è·¯ç”±å™¨å‡½æ•°åŒ¹é…åˆ°æ—¶ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ª handler functionï¼›å¦åˆ™æ˜¯ä¸€ä¸ªç©ºçš„ Optionalã€‚<code>RouterFunction</code> ç­‰ä»·äº <code>@RequestMapping</code> æ³¨è§£ï¼Œä½†æœ‰ä¸€ä¸ªä¸»è¦çš„åŒºåˆ«ï¼Œè·¯ç”±å‡½æ•°ä¸ä»…ä»…æä¾›æ•°æ®ï¼Œè¿˜æä¾›è¡Œä¸ºã€‚</p>
<p><code>RouterFunctions.route()</code> æä¾›äº†ä¸€ä¸ªè·¯ç”±å™¨æ„å»ºå™¨ï¼Œå¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°åˆ›å»ºè·¯ç”±å™¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.http.MediaType.APPLICATION_JSON;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.servlet.function.RequestPredicates.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.servlet.function.RouterFunctions.route;</span><br><span class="line"></span><br><span class="line"><span class="type">PersonRepository</span> <span class="variable">repository</span> <span class="operator">=</span> ...</span><br><span class="line"><span class="type">PersonHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PersonHandler</span>(repository);</span><br><span class="line"></span><br><span class="line">RouterFunction&lt;ServerResponse&gt; route = route()</span><br><span class="line">    .GET(<span class="string">&quot;/person/&#123;id&#125;&quot;</span>, accept(APPLICATION_JSON), handler::getPerson)</span><br><span class="line">    .GET(<span class="string">&quot;/person&quot;</span>, accept(APPLICATION_JSON), handler::listPeople)</span><br><span class="line">    .POST(<span class="string">&quot;/person&quot;</span>, handler::createPerson)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">listPeople</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">createPerson</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">getPerson</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> ä¸Šè¿°ä»£ç ä¸ç¬¦åˆ Java è¯­æ³•è§„èŒƒï¼Œåªæ˜¯ä½œä¸ºä¸€ç§ç¤ºä¾‹å‚è€ƒï¼Œå…·ä½“æ³¨å…¥è·¯ç”±å™¨éœ€è¦ä½¿ç”¨ bean æ³¨å…¥</p>
</blockquote>
<p>å¦‚æœå°† <code>RouterFunction</code> æ³¨å†Œä¸º beanï¼Œä¾‹å¦‚åœ¨ <code>@Configuration</code> ç±»ä¸­æš´éœ²å®ƒï¼Œå®ƒä¼šè¢« servlet è‡ªåŠ¨æ£€æµ‹ï¼Œå¦‚ Running a Server æ‰€è¿°ã€‚</p>
<h4 id="1-4-2-HandlerFunction"><a href="#1-4-2-HandlerFunction" class="headerlink" title="1.4.2. HandlerFunction"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-handler-functions">1.4.2. HandlerFunction</a></h4><p><code>ServerRequest</code> å’Œ <code>ServerResponse</code> æ˜¯ä¸å¯å˜æ¥å£ï¼Œå¯æä¾› JDK8 å‹å¥½è®¿é—® HTTP è¯·æ±‚å’Œå“åº”ï¼ŒåŒ…æ‹¬ headersï¼Œbodyï¼Œmethodï¼Œstatus codeã€‚</p>
<h5 id="ServerRequest"><a href="#ServerRequest" class="headerlink" title="ServerRequest"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-request">ServerRequest</a></h5><p><code>ServerRequest</code> æä¾›äº†å¯¹ HTTP methodï¼ŒURIï¼ŒHeadersï¼ŒQuery Parametersï¼Œè€Œé€šè¿‡ <code>body</code> æ–¹æ³•è®¿é—® Bodyã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†è¯·æ±‚ä½“æå–ä¸ºä¸€ä¸ª <code>String</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> request.body(String.class);</span><br></pre></td></tr></table></figure>


<p>ä»¥ä¸‹ç¤ºä¾‹å°† Body æå–ä¸ºä¸€ä¸ª <code>List&lt;Person&gt;</code>ï¼Œå…¶ä¸­ <code>Person</code> å¯¹è±¡æ˜¯ä» JSON æˆ–è€… XML æ­¤ç±»çš„åºåˆ—åŒ–å½¢å¼è§£å—å¾—åˆ°çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; people = request.body(<span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;Person&gt;&gt;() &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•è®¿é—®å‚æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MultiValueMap&lt;String, String&gt; params = request.params();</span><br></pre></td></tr></table></figure>

<h5 id="ServerResponse"><a href="#ServerResponse" class="headerlink" title="ServerResponse"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-response">ServerResponse</a></h5><p><code>ServerResponse</code> æä¾›äº†å¯¹ HTTP response çš„è®¿é—®ï¼Œå¹¶ä¸”ç”±äºå®ƒæ˜¯ä¸å˜çš„ï¼Œå› æ­¤ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>build</code> æ–¹æ³•æ¥åˆ›å»ºå®ƒã€‚ä½ å¯ä»¥é€šè¿‡æ„å»ºå™¨è®¾ç½®å“åº”çŠ¶æ€ï¼Œæ·»åŠ å“åº”å¤´ï¼Œæˆ–è€…æä¾›å“åº”ä½“ã€‚ä»¥ä¸‹ç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ JSON å†…å®¹çš„ 200ï¼ˆOKï¼‰å“åº”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> ...</span><br><span class="line">ServerResponse.ok().contentType(MediaType.APPLICATION_JSON).body(person);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>Location</code> å¤´ä»¥åŠæ— å“åº”ä½“æ„å»ºä¸€ä¸ª 201ï¼ˆCREATEDï¼‰å“åº”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URI</span> <span class="variable">location</span> <span class="operator">=</span> ...</span><br><span class="line">ServerResponse.created(location).build();</span><br></pre></td></tr></table></figure>

<h5 id="Handler-Classes"><a href="#Handler-Classes" class="headerlink" title="Handler Classes"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-handler-classes">Handler Classes</a></h5><p>æˆ‘å¯ä»¥ç”¨ lambda æ–¹å¼ä¹¦å†™ä¸€ä¸ª handler å‡½æ•°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HandlerFunction&lt;ServerResponse&gt; helloWorld =</span><br><span class="line">  request -&gt; ServerResponse.ok().body(<span class="string">&quot;Hello World&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­æˆ‘ä»¬éœ€è¦å¤šä¸ªå‡½æ•°ï¼Œå¹¶ä¸”å¤šä¸ªå†…è”çš„ lambda å¯èƒ½å˜å¾—æ··ä¹±ã€‚å› æ­¤ ï¼Œå°†ç›¸å…³çš„ handler å‡½æ•°ä¸€èµ·åˆ†ç»„åˆ°ä¸€ä¸ª handler ç±»æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œè¿™ä¸åŸºäºæ³¨è§£çš„åº”ç”¨ä¸­ï¼Œå…·æœ‰è·Ÿ <code>@Controller</code> ç›¸ä¼¼çš„è§’è‰²ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ç±»æš´éœ²äº†å“åº”å¼ <code>Person</code> ä»“åº“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.http.MediaType.APPLICATION_JSON;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.reactive.function.server.ServerResponse.ok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PersonRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PersonHandler</span><span class="params">(PersonRepository repository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.repository = repository;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">listPeople</span><span class="params">(ServerRequest request)</span> &#123; </span><br><span class="line">        List&lt;Person&gt; people = repository.allPeople();</span><br><span class="line">        <span class="keyword">return</span> ok().contentType(APPLICATION_JSON).body(people);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">createPerson</span><span class="params">(ServerRequest request)</span> <span class="keyword">throws</span> Exception &#123; </span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> request.body(Person.class);</span><br><span class="line">        repository.savePerson(person);</span><br><span class="line">        <span class="keyword">return</span> ok().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ServerResponse <span class="title function_">getPerson</span><span class="params">(ServerRequest request)</span> &#123; </span><br><span class="line">        <span class="type">int</span> <span class="variable">personId</span> <span class="operator">=</span> Integer.parseInt(request.pathVariable(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> repository.getPerson(personId);</span><br><span class="line">        <span class="keyword">if</span> (person != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ok().contentType(APPLICATION_JSON).body(person);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ServerResponse.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-RouterFunction"><a href="#1-4-3-RouterFunction" class="headerlink" title="1.4.3. RouterFunction"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-router-functions">1.4.3. RouterFunction</a></h4><p>è·¯ç”±å™¨å‡½æ•°ç”¨äºå°†è¯·æ±‚è·¯ç”±åˆ°ç›¸å…³çš„ <code>HandlerFunction</code>ã€‚é€šå¸¸ä½ ä¸ç”¨è‡ªå·±ç¼–å†™è·¯ç”±å™¨å‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>RouterFunctions</code> å·¥å…·ç±»ä¸Šçš„ä¸€ä¸ªæ–¹æ³•åˆ›å»ºå®ƒã€‚<code>RouterFunctions.route()</code> ï¼ˆæ— å‚ï¼‰ä¸ºä½ æä¾›äº†ä¸€ä¸ªæµåˆ©çš„æ„å»ºå™¨ç”¨äºåˆ›å»ºè·¯ç”±å™¨å‡½æ•°ï¼Œè€Œ <code>RouterFunctions.route(RequestPredicate, HandlerFunction)</code> æä¾›äº†ä¸€ä¸ªç›´æ¥åˆ›å»ºè·¯ç”±å™¨çš„æ–¹æ³•ã€‚</p>
<h4 id="1-4-4-Running-a-Server"><a href="#1-4-4-Running-a-Server" class="headerlink" title="1.4.4. Running a Server"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-running">1.4.4. Running a Server</a></h4><p>é€šå¸¸ï¼Œä½ å¯ä»¥é€šè¿‡ MVC Config åœ¨åŸºäº <code>DispatcherHandler</code> çš„è®¾ç½®ä¸­è¿è¡Œè·¯ç”±å‡½æ•°ï¼Œè¿™ç§è®¾ç½®ä½¿ç”¨ Spring Configuration å£°æ˜å¤„ç†è¯·æ±‚æ‰€éœ€çš„ç»„ä»¶ã€‚MVC Java é…ç½®å£°æ˜äº†ä»¥ä¸‹çš„ä¸€äº›åŸºç¡€è®¾æ–½ç»„ä»¶ç”¨ä»¥æ”¯æŒåŠŸèƒ½æ€§ç«¯ç‚¹ï¼š</p>
<ul>
<li>RouterFunctionMapping</li>
<li>HandlerFunctionAdapter</li>
</ul>
<p>å‰é¢çš„ç»„ä»¶ä½¿åŠŸèƒ½æ€§ç«¯ç‚¹å…¼å®¹åˆ° <code>DispatcherServlet</code> è¯·æ±‚å¤„ç†ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œå¹¶ä¸”ï¼ˆå¯èƒ½ï¼‰ä¸æ³¨è§£æ§åˆ¶å™¨å¹¶è¡Œï¼Œå¦‚æœæœ‰ä»»ä½•å£°æ˜ã€‚è¿™ä¹Ÿæ˜¯ Spring Boot Web starter å¯ç”¨åŠŸèƒ½æ€§ç«¯ç‚¹çš„æ–¹å¼ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº† WebFlux Java é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;?&gt; routerFunctionA() &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;?&gt; routerFunctionB() &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="comment">// configure message conversion...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// configure CORS...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// configure view resolution for HTML rendering...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-5-Filtering-Handler-Functions"><a href="#1-4-5-Filtering-Handler-Functions" class="headerlink" title="1.4.5. Filtering Handler Functions"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#webmvc-fn-handler-filter-function">1.4.5. Filtering Handler Functions</a></h4><p>ä½ å¯ä»¥åœ¨è·¯ç”±å‡½æ•°æ„å»ºå™¨ä½¿ç”¨ <code>before</code>ï¼Œ<code>after</code> æˆ–è€… <code>filter</code> æ–¹æ³•æ¥è¿‡æ»¤ handler å‡½æ•°ã€‚ä½¿ç”¨æ³¨è§£ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@ControllerAdvice</code>ï¼Œ<code>ServletFilter</code> æˆ–è€…ä¸¤è€…éƒ½ç”¨ï¼Œå®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚è¿‡æ»¤å°†ä¼šåº”ç”¨åˆ°æ„å»ºå™¨æ„å»ºçš„è·¯ç”±ä¸­ã€‚è¿™æ„å‘³ç€åœ¨åµŒå¥—è·¯ç”±ä¸­å®šä¹‰çš„è¿‡æ»¤å…¶ä¸é€‚ç”¨äºé¡¶çº§è·¯ç”±ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦‚ä¸‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">RouterFunction&lt;ServerResponse&gt; route = route()</span><br><span class="line">    .path(<span class="string">&quot;/person&quot;</span>, b1 -&gt; b1</span><br><span class="line">        .nest(accept(APPLICATION_JSON), b2 -&gt; b2</span><br><span class="line">            .GET(<span class="string">&quot;/&#123;id&#125;&quot;</span>, handler::getPerson)</span><br><span class="line">            .GET(<span class="string">&quot;&quot;</span>, handler::listPeople)</span><br><span class="line">            .before(request -&gt; ServerRequest.from(request) </span><br><span class="line">                .header(<span class="string">&quot;X-RequestHeader&quot;</span>, <span class="string">&quot;Value&quot;</span>)</span><br><span class="line">                .build()))</span><br><span class="line">        .POST(<span class="string">&quot;/person&quot;</span>, handler::createPerson))</span><br><span class="line">    .after((request, response) -&gt; logResponse(response)) </span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<h3 id="1-5-URI-Links"><a href="#1-5-URI-Links" class="headerlink" title="1.5. URI Links"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-uri-building">1.5. URI Links</a></h3><h4 id="1-5-1-UriComponents"><a href="#1-5-1-UriComponents" class="headerlink" title="1.5.1. UriComponents"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#web-uricomponents">1.5.1. UriComponents</a></h4><p><code>UriComponentBuilder</code> æœ‰åŠ©äºä»å¸¦æœ‰å˜é‡çš„ URI æ¨¡æ¿ä¸­æ„å»º URIã€‚å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UriComponents</span> <span class="variable">uriComponents</span> <span class="operator">=</span> UriComponentsBuilder</span><br><span class="line">        .fromUriString(<span class="string">&quot;https://example.com/hotels/&#123;hotel&#125;&quot;</span>)  </span><br><span class="line">        .queryParam(<span class="string">&quot;q&quot;</span>, <span class="string">&quot;&#123;q&#125;&quot;</span>)  </span><br><span class="line">        .encode() </span><br><span class="line">        .build(); </span><br><span class="line"></span><br><span class="line"><span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> uriComponents.expand(<span class="string">&quot;Westin&quot;</span>, <span class="string">&quot;123&quot;</span>).toUri();  </span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‰é¢çš„ç¤ºä¾‹å¯ä»¥åˆå¹¶åˆ°ä¸€ä¸ªé“¾ä¸­ï¼Œå¹¶ä½¿ç”¨ <code>buildAndExpand</code> ç¼©çŸ­ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> UriComponentsBuilder</span><br><span class="line">        .fromUriString(<span class="string">&quot;https://example.com/hotels/&#123;hotel&#125;&quot;</span>)</span><br><span class="line">        .queryParam(<span class="string">&quot;q&quot;</span>, <span class="string">&quot;&#123;q&#125;&quot;</span>)</span><br><span class="line">        .encode()</span><br><span class="line">        .buildAndExpand(<span class="string">&quot;Westin&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br><span class="line">        .toUri();</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥ç›´æ¥è¿›å…¥ URIï¼ˆè¡¨ç¤ºç¼–ç ï¼‰è¿›ä¸€æ­¥ç¼©çŸ­ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> UriComponentsBuilder</span><br><span class="line">        .fromUriString(<span class="string">&quot;https://example.com/hotels/&#123;hotel&#125;&quot;</span>)</span><br><span class="line">        .queryParam(<span class="string">&quot;q&quot;</span>, <span class="string">&quot;&#123;q&#125;&quot;</span>)</span><br><span class="line">        .build(<span class="string">&quot;Westin&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥ä½¿ç”¨å®Œæ•´çš„ URI æ¨¡æ¿è¿›ä¸€æ­¥ç¼©çŸ­ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> UriComponentsBuilder</span><br><span class="line">        .fromUriString(<span class="string">&quot;https://example.com/hotels/&#123;hotel&#125;?q=&#123;q&#125;&quot;</span>)</span><br><span class="line">        .build(<span class="string">&quot;Westin&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="1-5-2-UriBuilder"><a href="#1-5-2-UriBuilder" class="headerlink" title="1.5.2. UriBuilder"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#web-uribuilder">1.5.2. UriBuilder</a></h4><h3 id="1-6-Asynchronous-Requests"><a href="#1-6-Asynchronous-Requests" class="headerlink" title="1.6. Asynchronous Requests"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-async">1.6. Asynchronous Requests</a></h3><p>Spring MVC é›†æˆäº† Servlet 3.0 å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼š</p>
<ul>
<li>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­ï¼Œ<code>DeferredResult</code> å’Œ <code>Callable</code> è¿”å›å€¼ï¼Œå¹¶ä¸ºå•ä¸ªå¼‚æ­¥è¿”å›å€¼æä¾›äº†åŸºæœ¬æ”¯æŒã€‚</li>
<li>æ§åˆ¶å™¨å¯ä»¥æµä¼ è¾“å¤šä¸ªå€¼ï¼ŒåŒ…æ‹¬ SSE å’Œ åŸå§‹æ•°æ®</li>
<li>æ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨ reactive å®¢æˆ·ç«¯ï¼Œå¹¶ä¸ºå“åº”å¤„ç†è¿”å› reactive types</li>
</ul>
<h4 id="1-6-1-DeferredResult"><a href="#1-6-1-DeferredResult" class="headerlink" title="1.6.1. DeferredResult"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-async-deferredresult">1.6.1. DeferredResult</a></h4><p>ä¸€æ—¦åœ¨ Servlet å®¹å™¨ä¸­å¯ç”¨äº†å¼‚æ­¥å¤„ç†åŠŸèƒ½ï¼Œæ§åˆ¶å™¨æ–¹æ³•å°±å¯ä»¥ç”¨ <code>DeferredResult</code> åŒ…è£…ä»»ä½•æ”¯æŒçš„æ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/quotes&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> DeferredResult&lt;String&gt; <span class="title function_">quotes</span><span class="params">()</span> &#123;</span><br><span class="line">    DeferredResult&lt;String&gt; deferredResult = <span class="keyword">new</span> <span class="title class_">DeferredResult</span>&lt;String&gt;();</span><br><span class="line">    <span class="comment">// Save the deferredResult somewhere..</span></span><br><span class="line">    <span class="keyword">return</span> deferredResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// From some other thread...</span></span><br><span class="line">deferredResult.setResult(result);</span><br></pre></td></tr></table></figure>


<h4 id="1-6-3-Processing"><a href="#1-6-3-Processing" class="headerlink" title="1.6.3. Processing"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-ann-async-processing">1.6.3. Processing</a></h4><p>è¿™æ˜¯ Servlet å¼‚æ­¥è¯·æ±‚å¤„ç†éå¸¸ç®€æ´çš„æ¦‚è¿°ï¼š</p>
<ul>
<li><p>é€šè¿‡è°ƒç”¨ <code>request.startAsync()</code>ï¼Œ<code>ServletRequest</code> å¯ä»¥æ”¾åˆ°å¼‚æ­¥æ¨¡å‹ä¸­ã€‚è¿™æ ·åšçš„ä¸»è¦å½±å“å°±æ˜¯ï¼ŒServletï¼ˆä»¥åŠä»»ä½•è¿‡æ»¤å™¨ï¼‰å¯ä»¥é€€å‡ºï¼Œä½†æ˜¯å“åº”ä¼šä¸€ç›´æ‰“å¼€ç”¨äºåé¢å¤„ç†å®Œæˆã€‚</p>
</li>
<li><p>è°ƒç”¨ <code>request.startAsync()</code> ä¼šè¿”å› <code>AsyncContext</code>ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥å¯¹å¼‚æ­¥å¤„ç†åšè¿›ä¸€æ­¥æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå®ƒæä¾›äº† <code>dispatch</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç±»ä¼¼äº Servlet API çš„ forwardï¼Œé™¤äº†å®ƒå¯ä»¥è®©åº”ç”¨ç¨‹åºåœ¨ Servlet å®¹å™¨çº¿ç¨‹ä¸Šæ¢å¤è¯·æ±‚å¤„ç†ã€‚</p>
</li>
<li><p><code>ServletRequest</code> æä¾›äº†å¯¹å½“å‰ <code>DispatcherType</code> çš„è®¿é—®ï¼Œä½ å¯ä»¥ç”¨å®ƒåŒºåˆ«å¤„ç†åˆå§‹åŒ–è¯·æ±‚ï¼Œå¼‚æ­¥è°ƒåº¦ï¼Œforwardï¼Œä»¥åŠå…¶ä»–è°ƒåº¦ç±»å‹ã€‚</p>
</li>
</ul>
<p><code>DeferredResult</code> å¤„ç†å·¥ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li><p>æ§åˆ¶å™¨è¿”å›ä¸€ä¸ª <code>DeferredResult</code>ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°ä¸€äº›å†…å­˜ä¸­çš„å¯è®¿é—®çš„é˜Ÿåˆ—æˆ–è€…åˆ—è¡¨ä¸­ã€‚</p>
</li>
<li><p>Spring MVC è°ƒç”¨ <code>request.startAsync()</code></p>
</li>
<li><p>åŒæ—¶ï¼Œ<code>DispatcherServlet</code> ä»¥åŠæ‰€æœ‰é…ç½®çš„è¿‡æ»¤å™¨éƒ½é€€å‡ºè¯·æ±‚å¤„ç†çº¿ç¨‹ï¼Œä½† response ä»ç„¶ä¿æŒæ‰“å¼€</p>
</li>
<li><p>åº”ç”¨ç¨‹åºä»æŸä¸ªçº¿ç¨‹è®¾ç½® <code>DeferredResult</code>ï¼Œç„¶å Spring MVC å°†è¯·æ±‚è°ƒåº¦å› Servlet å®¹å™¨ã€‚</p>
</li>
<li><p>å†æ¬¡è°ƒç”¨ <code>DispatcherServlet</code>ï¼Œå¹¶ä»¥å¼‚æ­¥äº§ç”Ÿçš„è¿”å›å€¼è¿›è¡Œå¤„ç†ã€‚</p>
</li>
</ul>
<h3 id="1-7-CORS"><a href="#1-7-CORS" class="headerlink" title="1.7. CORS"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-cors">1.7. CORS</a></h3><p>å‚è€ƒé“¾æ¥ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS</a></p>
<h4 id="1-7-1-Introduction"><a href="#1-7-1-Introduction" class="headerlink" title="1.7.1. Introduction"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-cors-intro">1.7.1. Introduction</a></h4><p>å‡ºäºå®‰å…¨åŸå› ï¼Œæµè§ˆå™¨ç¦æ­¢ AJAX è°ƒç”¨å½“å‰æºä¹‹å¤–çš„èµ„æºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥å°†ä½ çš„é“¶è¡Œè´¦æˆ·æ”¾åœ¨ä¸€ä¸ªæ ‡ç­¾ä¸­ï¼Œè€Œ evil.com åœ¨å¦ä¸€ä¸ªæ ‡ç­¾ä¸­ã€‚æ¥è‡ª evil.com çš„è„šæœ¬ä¸åº”é€šè¿‡ä½ çš„å‡­æ®å‘ä½ çš„é“¶è¡Œ API å‘å‡º AJAX è¯·æ±‚ï¼Œä¾‹å¦‚ä»ä½ çš„è´¦æˆ·æå–èµ„é‡‘ã€‚</p>
<p>è·¨åŸŸèµ„æºå…±äº«æ˜¯ W3C çš„è§„èŒƒï¼Œå¤§å¤šæ•°æµè§ˆå™¨éƒ½å®ç°äº†è¿™ç§è§„èŒƒï¼Œå¯ä»¥è®©ä½ æŒ‡å®šå“ªç§ç±»å‹çš„è·¨åŸŸè¯·æ±‚å·²è·å¾—æˆæƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨åŸºäº IFRAME æˆ–è€… JSONP çš„ä¸å¤ªå®‰å…¨ä¸”ä¸å¤ªå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="1-7-2-Processing"><a href="#1-7-2-Processing" class="headerlink" title="1.7.2. Processing"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-cors-processing">1.7.2. Processing</a></h4><p>CORS è§„èŒƒåŒºåˆ†é¢„è¯·æ±‚ã€ç®€å•è¯·æ±‚ã€å®é™…è¯·æ±‚ã€‚æƒ³è¦å­¦ä¹ æ›´å¤š CORSï¼Œå‚è€ƒ<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">è¿™ç¯‡æ–‡ç« </a></p>
<p>Spring MVC <code>HandlerMapping</code> å®ç°ç±»æä¾›äº†å†…ç½®çš„å¯¹ CORS çš„æ”¯æŒã€‚åœ¨æˆåŠŸå°†è¯·æ±‚æ˜ å°„åˆ°ä¸€ä¸ª handler ä¹‹åï¼Œ<code>HandlerMapping</code> å®ç°ç±»å°±ä¼šæ£€æŸ¥ç»™å®šè¯·æ±‚ä»¥åŠ handler çš„ CORS é…ç½®ï¼Œç„¶åé‡‡å–æ›´è¿›ä¸€æ­¥çš„æªæ–½ã€‚é¢„è¯·æ±‚ç›´æ¥å¤„ç†ï¼Œä½†æ˜¯ï¼Œç®€å•è¯·æ±‚å’Œå®é™…çš„ CORS è¯·æ±‚ä¼šè¢«æ‹¦æˆªï¼Œæ ¡éªŒï¼Œå¹¶è®¾ç½®éœ€è¦çš„ CORS å“åº”å¤´ã€‚</p>
<p>ä¸ºäº†å¯ç”¨è·¨åŸŸè¯·æ±‚ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ªæ˜¾å¼çš„ CORS é…ç½®ã€‚å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„ CORS é…ç½®ï¼Œå°±ä¼šæ‹’ç»é¢„è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰æ·»åŠ  CORS å¤´éƒ¨åˆ°ç®€å•è¯·æ±‚ã€å®é™… CORS è¯·æ±‚å“åº”ä¸­ï¼Œé‚£ä¹ˆï¼Œæµè§ˆå™¨å°±ä¼šæ‹’ç»å®ƒä»¬ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å¯èƒ½æœ‰äººä¼šè®¤ä¸ºè·¨åŸŸæ˜¯æµè§ˆå™¨æ— æ³•å‘èµ·è¯·æ±‚ï¼Œå…¶å®ä¸æ˜¯ï¼Œåªæ˜¯æ‹’ç»æ¥æ”¶ responseã€‚</p>
</blockquote>
<p>æ¯ä¸ª <code>HandlerMapping</code> éƒ½å¯ä»¥å•ç‹¬åœ°é…ç½®åŸºäºæ¨¡å¼çš„ URL <code>CorsConfiguration</code> æ˜ å°„ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”ç”¨ä½¿ç”¨ MVC Java é…ç½®æˆ–è€… XML å‘½åç©ºé—´å»å£°æ˜æ˜ å°„ï¼Œä¸è¿‡è¿™ä¼šå¯¼è‡´ä¸€ä¸ªä¼ é€’ç»™æ‰€æœ‰ <code>HandlerMapping</code> å®ä¾‹çš„å…¨å±€æ˜ å°„ã€‚</p>
<p>ä½ å¯ä»¥å°†ä½äº <code>HandlerMapping</code> çº§åˆ«çš„å…¨å±€ CORS é…ç½®ä¸æ›´åŠ ç»†ç²’åº¦çš„ handler çº§åˆ«çš„ CORS é…ç½®ç›¸ç»“åˆã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ³¨è§£å¼ Controller å¯ä»¥ä½¿ç”¨ç±»çº§åˆ«æˆ–è€…æ–¹æ³•çº§åˆ«çš„ <code>@CrossOrigin</code> æ³¨è§£ï¼ˆå…¶ä»– handler å¯ä»¥å®ç° <code>CorsConfigurationSource</code>ï¼‰</p>
<h4 id="1-7-3-CrossOrigin"><a href="#1-7-3-CrossOrigin" class="headerlink" title="1.7.3. @CrossOrigin"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-cors-controller">1.7.3. @CrossOrigin</a></h4><p><code>@CrossOrigin</code> æ³¨è§£åœ¨æ³¨è§£å¼æ§åˆ¶å™¨çš„æ–¹æ³•ä¸Šï¼Œå¯ä»¥å¯ç”¨è·¨åŸŸè¯·æ±‚ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CrossOrigin</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">retrieve</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤åœ°ï¼Œ@CrossOrigin å…è®¸ï¼š</p>
<ul>
<li>æ‰€æœ‰ origin</li>
<li>æ‰€æœ‰ header</li>
<li>æ‰€æœ‰ HTTP æ–¹æ³•</li>
</ul>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>allowedCredentials</code> ä¸å¯ç”¨ï¼Œå› ä¸ºé‚£ä¼šå»ºç«‹ä¸€ä¸ªä¿¡ä»»çº§åˆ«ï¼Œä¼šæš´éœ²æ•æ„Ÿçš„ç”¨æˆ·ç‰¹å®šçš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ cookie å’Œ CSRF ä»¤ç‰Œï¼‰ï¼Œåº”è¯¥åªèƒ½åœ¨é€‚å½“çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p>
<p>@CrossOrigin å¯ä»¥ç”¨äºï¼š</p>
<ul>
<li>Controller çš„æ–¹æ³•ï¼Œå¼€å¯ Controller æ–¹æ³•çº§åˆ«çš„è·¨åŸŸè¯·æ±‚</li>
<li>Controller ç±»ï¼Œç”±æ‰€æœ‰æ–¹æ³•ç»§æ‰¿</li>
</ul>
<p>maxAge é»˜è®¤ 30 åˆ†é’Ÿ</p>
<p><code>@CrossOrigin</code> ä¹Ÿæ”¯æŒç±»çº§åˆ«ï¼Œè¿™ä¼šè¢«æ‰€æœ‰æ–¹æ³•ç»§æ‰¿ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin(origins = &quot;https://domain2.com&quot;, maxAge = 3600)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">retrieve</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥åœ¨ç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«ä¸ŠåŒæ—¶ä½¿ç”¨ <code>@CrossOrigin</code>ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin(maxAge = 3600)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CrossOrigin(&quot;https://domain2.com&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">retrieve</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="1-7-4-Global-Configuration"><a href="#1-7-4-Global-Configuration" class="headerlink" title="1.7.4. Global Configuration"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-cors-global">1.7.4. Global Configuration</a></h4><p>é™¤äº†ç»†ç²’åº¦çš„æ§åˆ¶å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ç° <code>WebMvcConfigurer.addCorsMappings</code> å®šä¹‰å…¨å±€ CORS é…ç½®ï¼Œå‚è€ƒä»£ç è§å®˜ç½‘ã€‚</p>
<p>å…·ä½“åŸç†å¯è§ <code>DefaultCorsProcessor</code>ã€‚</p>
<h4 id="1-7-5-CORS-Filter"><a href="#1-7-5-CORS-Filter" class="headerlink" title="1.7.5. CORS Filter"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-cors-filter">1.7.5. CORS Filter</a></h4><p>å¯ä»¥é€šè¿‡å†…ç½®çš„ CorsFilter å¢åŠ  CORS æ”¯æŒã€‚</p>
<h3 id="1-8-Web-Security"><a href="#1-8-Web-Security" class="headerlink" title="1.8. Web Security"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-web-security">1.8. Web Security</a></h3><p>Spring Security å·¥ç¨‹ä¸ºä¿æŠ¤ web åº”ç”¨å…å—æ¶æ„æ¼æ´æä¾›äº†æ”¯æŒã€‚æ¸…å‚é˜… Spring Security å‚è€ƒæ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#mvc">Spring MVC Security</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#test-mockmvc">Spring MVC Test Support</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#csrf">CSRF protection</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#headers">Security Response Headers</a></li>
</ul>
<h3 id="1-9-HTTP-Caching"><a href="#1-9-HTTP-Caching" class="headerlink" title="1.9. HTTP Caching"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-caching">1.9. HTTP Caching</a></h3><h3 id="1-11-MVC-Config"><a href="#1-11-MVC-Config" class="headerlink" title="1.11. MVC Config"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config">1.11. MVC Config</a></h3><p>MVC Java é…ç½®å’Œ MVC XML å‘½åç©ºé—´é…ç½®æä¾›äº†é»˜è®¤çš„é…ç½®ï¼Œè¿™é€‚åˆå¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œå¦‚æœä½ è§‰å¾—ä¸å¤Ÿï¼Œä¹Ÿæä¾›äº†é…ç½® API ä¾›ä½ è‡ªå®šä¹‰ã€‚</p>
<h4 id="1-11-1-Enable-MVC-Configuration"><a href="#1-11-1-Enable-MVC-Configuration" class="headerlink" title="1.11.1. Enable MVC Configuration"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-enable">1.11.1. Enable MVC Configuration</a></h4><p>åœ¨ Java é…ç½®ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>@EnableMvc</code> æ³¨è§£æ¥å¯ç”¨ MVC é…ç½®ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> Spring Boot æ— éœ€ä¸”å°½é‡ä¸è¦ä½¿ç”¨ <code>@EnableWebMvc</code>ï¼Œè¿™ä¼šè¦†ç›– Spring Boot çš„é»˜è®¤é…ç½®ã€‚</p>
</blockquote>
<p>åœ¨ XML é…ç½®ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>&lt;mvc:annotation-driven&gt;</code> å…ƒç´ ï¼Œä»¥å¯ç”¨ MVC é…ç½®ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ç¤ºä¾‹ä¼šæ³¨å†Œè®¸å¤š Spring MVC çš„åŸºç¡€ beanï¼Œå¹¶ä¸”é€‚é…ç±»è·¯å¾„ä¸Šçš„å¯ç”¨ä¾èµ–ï¼ˆä¾‹å¦‚ï¼Œè½½ä½“è½¬æ¢å™¨ï¼ŒJSONï¼ŒXMLï¼Œä»¥åŠå…¶ä»–ä»€ä¹ˆï¼‰</p>
<h4 id="1-11-2-MVC-Config-API"><a href="#1-11-2-MVC-Config-API" class="headerlink" title="1.11.2. MVC Config API"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-customize">1.11.2. MVC Config API</a></h4><p>åœ¨ Java é…ç½®ä¸­ï¼Œä½ å¯ä»¥å®ç° <code>WebMvcConfigurer</code> ç¤ºä¾‹ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Implement configuration methods...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ XML ä¸‹ï¼Œä½ å¯ä»¥æ£€æŸ¥å±æ€§ï¼Œä»¥åŠ <code>&lt;mvc:annotation-driven/&gt;</code> çš„å­å…ƒç´ ã€‚ä½ å¯ä»¥æµè§ˆ <a target="_blank" rel="noopener" href="https://schema.spring.io/mvc/spring-mvc.xsd">Spring MVC XML schema</a> æˆ–è€…ä½¿ç”¨ IDE çš„ä»£ç ç¼–è¯‘åŠŸèƒ½ï¼Œæ‰¾åˆ°é‚£äº›å¯ç”¨çš„å±æ€§ä»¥åŠå­å…ƒç´ ã€‚</p>
<h4 id="1-11-3-Type-Conversion"><a href="#1-11-3-Type-Conversion" class="headerlink" title="1.11.3. Type Conversion"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-conversion">1.11.3. Type Conversion</a></h4><p>é»˜è®¤åœ°ï¼ŒSpring MVC å®‰è£…äº†å„ç§æ•°å­—å’Œæ—¥æœŸçš„æ ¼å¼åŒ–å™¨ï¼ˆformatterï¼‰ï¼Œå¹¶ä¸”æ”¯æŒ <code>@NumberFormat</code> å’Œ <code>@DateTimeFormat</code> å¯¹å­—æ®µè¿›è¡Œè‡ªå®šä¹‰ã€‚</p>
<p>å¦‚æœè¦åœ¨ Java é…ç½®ä¸­æ³¨å†Œè‡ªå®šä¹‰çš„æ ¼å¼åŒ–å™¨å’Œè½¬æ¢å™¨ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å…¶å®å°±æ˜¯å®ç° <code>WebMvcConfigurer</code> çš„ <code>addFormatters</code> æ–¹æ³•</p>
</blockquote>
<h4 id="1-11-4-Validation"><a href="#1-11-4-Validation" class="headerlink" title="1.11.4. Validation"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-validation">1.11.4. Validation</a></h4><p>é»˜è®¤åœ°ï¼Œå¦‚æœ Bean Validation å­˜åœ¨äºç±»è·¯å¾„ï¼ˆä¾‹å¦‚ï¼ŒHibernate Validatorï¼‰ï¼Œå°±ä¼šæ³¨å†Œä¸€ä¸ª <code>LocalValidatorFactoryBean</code> ä½œä¸ºå…¨å±€çš„ Validatorï¼Œä¾›æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ä¸Šçš„ <code>@Valid</code> ä»¥åŠ <code>Validated</code> ä½¿ç”¨</p>
<blockquote>
<p> <strong>ä½œè€…çš„è¯</strong> åˆ¤æ–­æ˜¯å¦å­˜åœ¨ Bean Validation æ¡†æ¶çš„æ–¹æ³•æ˜¯æ³¨è§£æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ <code>javax.validation.Validator</code></p>
</blockquote>
<p>åœ¨ Java é…ç½®ä¸­ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰å…¨å±€ <code>Validator</code> ç¤ºä¾‹ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Validator <span class="title function_">getValidator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-11-5-Interceptors"><a href="#1-11-5-Interceptors" class="headerlink" title="1.11.5. Interceptors"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-interceptors">1.11.5. Interceptors</a></h4><p>åœ¨ Java é…ç½®ä¸­ï¼Œä½ å¯ä»¥æ³¨å†Œæ‹¦æˆªå™¨ï¼Œä»¥åº”ç”¨äºæ”¶åˆ°çš„è¯·æ±‚ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LocaleChangeInterceptor</span>());</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">ThemeChangeInterceptor</span>()).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/admin/**&quot;</span>);</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SecurityInterceptor</span>()).addPathPatterns(<span class="string">&quot;/secure/*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="1-11-6-Content-Types"><a href="#1-11-6-Content-Types" class="headerlink" title="1.11.6. Content Types"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-content-negotiation">1.11.6. Content Types</a></h4><h4 id="1-11-7-Message-Converters"><a href="#1-11-7-Message-Converters" class="headerlink" title="1.11.7. Message Converters"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-message-converters">1.11.7. Message Converters</a></h4><p>ä½ å¯ä»¥é€šè¿‡è¦†ç›– <code>configureMessageConverters()</code>ï¼Œä»¥ Java é…ç½®çš„æ–¹å¼è‡ªå®šä¹‰ <code>HttpMessageConverter</code>ï¼ˆè¿™ä¼šå–ä»£ Spring MVC åˆ›å»ºçš„é»˜è®¤è½¬æ¢å™¨ï¼‰ï¼Œæˆ–è€…é€šè¿‡è¦†ç›– <code>extendMessageConverters()</code>ï¼ˆè¿™å¯ä»¥è‡ªå®šä¹‰é»˜è®¤çš„è½¬æ¢å™¨æˆ–è€…æ·»åŠ é¢å¤–çš„è½¬æ¢å™¨ï¼‰</p>
<p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨è‡ªå®šä¹‰çš„ <code>ObjectMapper</code> æ·»åŠ äº† XML å’Œ Jackson JSON è½¬æ¢å™¨ï¼Œå–ä»£é»˜è®¤çš„è½¬æ¢å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="type">Jackson2ObjectMapperBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2ObjectMapperBuilder</span>()</span><br><span class="line">                .indentOutput(<span class="literal">true</span>)</span><br><span class="line">                .dateFormat(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>))</span><br><span class="line">                .modulesToInstall(<span class="keyword">new</span> <span class="title class_">ParameterNamesModule</span>());</span><br><span class="line">        converters.add(<span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>(builder.build()));</span><br><span class="line">        converters.add(<span class="keyword">new</span> <span class="title class_">MappingJackson2XmlHttpMessageConverter</span>(builder.createXmlMapper(<span class="literal">true</span>).build()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="1-11-10-Static-Resources"><a href="#1-11-10-Static-Resources" class="headerlink" title="1.11.10. Static Resources"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-static-resources">1.11.10. Static Resources</a></h4><p>è¿™é‡Œæä¾›äº†ä¸€ç§ç®€ä¾¿çš„æ–¹æ³•ç”¨äºæä¾›é™æ€èµ„æºæœåŠ¡ï¼Œæ˜¯åŸºäº <code>Resource</code> çš„ä½ç½®åˆ—è¡¨çš„ã€‚</p>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œç»™å®šä¸€ä¸ªä»¥ <code>/resources</code> å¼€å¤´çš„è¯·æ±‚ï¼Œç›¸å¯¹è·¯å¾„ç”¨äºæŸ¥æ‰¾å’Œæä¾›ä½äº web åº”ç”¨çš„æ ¹ç›®å½•ä¸‹çš„ <code>/public</code> æˆ–è€…ç±»è·¯å¾„ <code>/static</code> ä¸‹çš„é™æ€èµ„æº</p>
<p>å¦‚æœéœ€è¦ä»¥ &#x2F;resources ä¸ºå‰ç¼€ï¼Œæ ¹æ®å…¶åçš„ç›¸å¯¹è·¯å¾„å¯»æ‰¾ Web åº”ç”¨ç¨‹åºæ ¹ç›®å½•ä¸‹çš„ &#x2F;public èµ„æºæˆ– ç±»è·¯å¾„ &#x2F;static ä¸‹çš„é™æ€èµ„æºï¼Œèµ„æºè®¾ç½®ä¸€å¹´åˆ°æœŸï¼Œè¿˜ä¼šè¯„ä¼° Last-Modified å¤´éƒ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¿”å› 304ï¼Œåˆ™å¯ä»¥æŒ‰å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/resources/**&quot;</span>)</span><br><span class="line">            .addResourceLocations(<span class="string">&quot;/public&quot;</span>, <span class="string">&quot;classpath:/static/&quot;</span>)</span><br><span class="line">            .setCachePeriod(<span class="number">31556926</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong><br>(1) é…ç½®ç±»è·¯å¾„é™æ€èµ„æºæ—¶ï¼Œæœ«å°¾å¿…é¡»æœ‰ &#x2F;ï¼Œä¸å¯ç¼ºçœï¼Œå¦åˆ™ 404</p>
<h4 id="1-11-11-Default-Servlet"><a href="#1-11-11-Default-Servlet" class="headerlink" title="1.11.11. Default Servlet"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-default-servlet-handler">1.11.11. Default Servlet</a></h4><p>Spring MVC å…è®¸å°† DispatcherServlet æ˜ å°„åˆ° <code>/</code>ï¼ˆå› æ­¤ï¼Œè¿™è¦†ç›–äº†å®¹å™¨é»˜è®¤çš„ Servlet æ˜ å°„ï¼‰ï¼Œä½†æ˜¯ï¼ŒSpring MVC ä»ç„¶å…è®¸å®¹å™¨é»˜è®¤çš„ Servlet å¤„ç†é™æ€èµ„æºè¯·æ±‚ã€‚Spring MVC é…ç½®æœ‰ä¸€ä¸ª <code>DefaultServletHttpRequestHandler</code>ï¼Œä½¿ç”¨ <code>/**</code> çš„ URL æ˜ å°„ï¼Œç›¸å¯¹äºå…¶ä»– URL æ˜ å°„çš„å…·æœ‰æœ€ä½ä¼˜å…ˆçº§ï¼ˆInteger.MAX_VALUEï¼‰ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> åœ¨ Spring Boot ä¸­ï¼Œä½ ä¸å¯ç”¨ï¼Œæ˜¯ä¸ä¼šå°†æ­¤ <code>HandlerMapping</code> æ·»åŠ çš„ã€‚å¹¶ä¸”ï¼Œå¯ç”¨äº†ä¹Ÿä¸ä¼šå‘ç”Ÿä½œç”¨ï¼Œå› ä¸ºè¯·æ±‚ä¼šè¢« <code>SimpleUrlHandlerMapping</code> ä¸­çš„ <code>/**</code> åŒ¹é…åˆ°ã€‚</p>
</blockquote>
<p>è¯¥ handler å°†æ‰€æœ‰è¯·æ±‚è½¬å‘åˆ°é»˜è®¤çš„ Servletã€‚å› æ­¤ï¼Œå®ƒå¿…é¡»ä¿æŒåœ¨æ‰€æœ‰å…¶ä»– URL <code>HandlerMapping</code> çš„æœ€åã€‚å¦‚æœä½ ä½¿ç”¨ <code>mvc:annotation-driven</code>ï¼Œå°±æ˜¯è¿™ç§æƒ…å†µã€‚å¦å¤–ï¼Œå¦‚æœä½ è®¾ç½®äº†è‡ªå®šä¹‰çš„ <code>HandlerMapping</code> å®ä¾‹ï¼Œè¯·ç¡®ä¿å°†å…¶ <code>order</code> å±æ€§è®¾ç½®ä½äº <code>DefaultServletHttpRequestHandler</code>ï¼ˆInteger.MAX_VALUEï¼‰</p>
<p>å¦‚ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•é€šè¿‡ä½¿ç”¨é»˜è®¤è®¾ç½®å¯ç”¨è¯¥åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="1-11-12-Path-Matching"><a href="#1-11-12-Path-Matching" class="headerlink" title="1.11.12. Path Matching"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/web.html#mvc-config-path-matching">1.11.12. Path Matching</a></h4><p>ä½ å¯ä»¥è‡ªå®šä¹‰ä¸ URL çš„è·¯å¾„åŒ¹é…å’Œå¤„ç†æœ‰å…³çš„å¯é€‰é¡¹ã€‚æœ‰å…³å„ä¸ªé€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œå‚è§ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/PathMatchConfigurer.html"><code>PathMatchConfigurer</code></a> javadocã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•åœ¨ Java é…ç½®ä¸­è‡ªå®šä¹‰è·¯å¾„åŒ¹é…ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer</span><br><span class="line">            .setUseTrailingSlashMatch(<span class="literal">false</span>)</span><br><span class="line">            .setUseRegisteredSuffixPatternMatch(<span class="literal">true</span>)</span><br><span class="line">            .setPathMatcher(antPathMatcher())</span><br><span class="line">            .setUrlPathHelper(urlPathHelper())</span><br><span class="line">            .addPathPrefix(<span class="string">&quot;/api&quot;</span>, HandlerTypePredicate.forAnnotation(RestController.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UrlPathHelper <span class="title function_">urlPathHelper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PathMatcher <span class="title function_">antPathMatcher</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Spring Framework" >
    <span class="tag-code">Spring Framework</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2022/05/09/Spring-Core/Spring-Framework-Core/">
        <span class="nav-arrow">â† </span>
        
          Spring Framework Core
        
      </a>
    
    
      <a class="nav-right" href="/2022/05/24/%E5%90%84%E7%B1%BB%E5%9C%BA%E6%99%AF%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0/">
        
          å„ç±»åœºæ™¯è¯·æ±‚å‚æ•°
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
      <div class="money-like">
        <div class="reward-btn">
          èµ
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨æ”¯ä»˜å®æ‰“èµ</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨å¾®ä¿¡æ‰“èµ</b>
            </span>
          </span>
        </div>
        <p class="notice">è‹¥ä½ è§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¯¹æˆ‘æ‰“èµ</p>
      </div>
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">æ‰«æäºŒç»´ç ï¼Œåˆ†äº«æ­¤æ–‡ç« </p>
      </div>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Web-on-Servlet-Stack"><span class="toc-nav-text">Web on Servlet Stack</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-Spring-Web-MVC"><span class="toc-nav-text">1. Spring Web MVC</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-1-DispatcherServlet"><span class="toc-nav-text">1.1. DispatcherServlet</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-1-Context-Hierarchy"><span class="toc-nav-text">1.1.1. Context Hierarchy</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-2-Special-Bean-Types"><span class="toc-nav-text">1.1.2. Special Bean Types</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-3-Web-MVC-Config"><span class="toc-nav-text">1.1.3. Web MVC Config</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-4-Servlet-Config"><span class="toc-nav-text">1.1.4. Servlet Config</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-5-Processing"><span class="toc-nav-text">1.1.5. Processing</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-6-Interception"><span class="toc-nav-text">1.1.6. Interception</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-7-Exceptions"><span class="toc-nav-text">1.1.7. Exceptions</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Chain-of-Resolvers"><span class="toc-nav-text">Chain of Resolvers</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Container-Error-Page"><span class="toc-nav-text">Container Error Page</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-1-11-Multipart-Resolver"><span class="toc-nav-text">1.1.11. Multipart Resolver</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Apache-Commons-FileUpload"><span class="toc-nav-text">Apache Commons FileUpload</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Servlet-3-0"><span class="toc-nav-text">Servlet 3.0</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-2-Filters"><span class="toc-nav-text">1.2. Filters</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-2-1-Form-Data"><span class="toc-nav-text">1.2.1. Form Data</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-2-2-Forwarded-Headers"><span class="toc-nav-text">1.2.2. Forwarded Headers</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-2-4-CORS"><span class="toc-nav-text">1.2.4. CORS</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-3-Annotated-Controllers"><span class="toc-nav-text">1.3. Annotated Controllers</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-3-1-Declaration"><span class="toc-nav-text">1.3.1. Declaration</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-3-2-Request-Mapping"><span class="toc-nav-text">1.3.2. Request Mapping</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#URI-patterns"><span class="toc-nav-text">URI patterns</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-3-3-Handler-Methods"><span class="toc-nav-text">1.3.3. Handler Methods</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Method-Arguments"><span class="toc-nav-text">Method Arguments</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Return-Values"><span class="toc-nav-text">Return Values</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Type-Conversion"><span class="toc-nav-text">Type Conversion</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#ModelAttribute"><span class="toc-nav-text">@ModelAttribute</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#SessionAttributes"><span class="toc-nav-text">@SessionAttributes</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#SessionAttribute"><span class="toc-nav-text">@SessionAttribute</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#RequestAttribute"><span class="toc-nav-text">@RequestAttribute</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Multipart"><span class="toc-nav-text">Multipart</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-3-4-Model"><span class="toc-nav-text">1.3.4. Model</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-3-5-DataBinder"><span class="toc-nav-text">1.3.5. DataBinder</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-3-6-Exceptions"><span class="toc-nav-text">1.3.6. Exceptions</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Method-Arguments-1"><span class="toc-nav-text">Method Arguments</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Return-Values-1"><span class="toc-nav-text">Return Values</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-3-7-Controller-Advice"><span class="toc-nav-text">1.3.7. Controller Advice</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-4-Functional-Endpoints"><span class="toc-nav-text">1.4. Functional Endpoints</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-4-1-Overview"><span class="toc-nav-text">1.4.1. Overview</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-4-2-HandlerFunction"><span class="toc-nav-text">1.4.2. HandlerFunction</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#ServerRequest"><span class="toc-nav-text">ServerRequest</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#ServerResponse"><span class="toc-nav-text">ServerResponse</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Handler-Classes"><span class="toc-nav-text">Handler Classes</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-4-3-RouterFunction"><span class="toc-nav-text">1.4.3. RouterFunction</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-4-4-Running-a-Server"><span class="toc-nav-text">1.4.4. Running a Server</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-4-5-Filtering-Handler-Functions"><span class="toc-nav-text">1.4.5. Filtering Handler Functions</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-5-URI-Links"><span class="toc-nav-text">1.5. URI Links</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-5-1-UriComponents"><span class="toc-nav-text">1.5.1. UriComponents</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-5-2-UriBuilder"><span class="toc-nav-text">1.5.2. UriBuilder</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-6-Asynchronous-Requests"><span class="toc-nav-text">1.6. Asynchronous Requests</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-6-1-DeferredResult"><span class="toc-nav-text">1.6.1. DeferredResult</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-6-3-Processing"><span class="toc-nav-text">1.6.3. Processing</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-7-CORS"><span class="toc-nav-text">1.7. CORS</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-7-1-Introduction"><span class="toc-nav-text">1.7.1. Introduction</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-7-2-Processing"><span class="toc-nav-text">1.7.2. Processing</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-7-3-CrossOrigin"><span class="toc-nav-text">1.7.3. @CrossOrigin</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-7-4-Global-Configuration"><span class="toc-nav-text">1.7.4. Global Configuration</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-7-5-CORS-Filter"><span class="toc-nav-text">1.7.5. CORS Filter</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-8-Web-Security"><span class="toc-nav-text">1.8. Web Security</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-9-HTTP-Caching"><span class="toc-nav-text">1.9. HTTP Caching</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-11-MVC-Config"><span class="toc-nav-text">1.11. MVC Config</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-1-Enable-MVC-Configuration"><span class="toc-nav-text">1.11.1. Enable MVC Configuration</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-2-MVC-Config-API"><span class="toc-nav-text">1.11.2. MVC Config API</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-3-Type-Conversion"><span class="toc-nav-text">1.11.3. Type Conversion</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-4-Validation"><span class="toc-nav-text">1.11.4. Validation</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-5-Interceptors"><span class="toc-nav-text">1.11.5. Interceptors</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-6-Content-Types"><span class="toc-nav-text">1.11.6. Content Types</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-7-Message-Converters"><span class="toc-nav-text">1.11.7. Message Converters</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-10-Static-Resources"><span class="toc-nav-text">1.11.10. Static Resources</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-11-Default-Servlet"><span class="toc-nav-text">1.11.11. Default Servlet</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-11-12-Path-Matching"><span class="toc-nav-text">1.11.12. Path Matching</span></a></li></ol></li></ol></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://example.com/2022/05/09/Spring-Web-Servlet/Spring-Framework-Web-Servlet/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>



  <script>
    var gitmentConfig = "jiangchunbo";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "Spring Framework Web Servlet",
        owner: "jiangchunbo",
        repo: "jiangchunbo.github.io",
        oauth: {
          client_id: "8ff18c626ce6de443832",
          client_secret: "ccbfc51ce15c59b57e0fe4a4dea81060976bbde3"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  </script>




    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a target="_blank" rel="noopener" href="https://github.com/yanm1ng">yanm1ng</a>
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


  </body>
</html>