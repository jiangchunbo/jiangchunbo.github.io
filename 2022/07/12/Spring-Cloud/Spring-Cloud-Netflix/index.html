<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="JiangChunbo&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Spring Cloud Netflix | ğŸ¥«ğŸ
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
    
<script src="/js/gitment.js"></script>

  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    
<script src="/js/local-search.js"></script>


<meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="ğŸ¥«ğŸ" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>ğŸ¥«ğŸ</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/categories/" class="item-link">Categories</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/categories/" class="menu-link">Categories</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off"
                    placeholder="Please enter your keyword(s) to search." spellcheck="false"
                    type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>Spring Cloud Netflix</h2>
  <p class="post-date">2022-07-12</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="Spring-Cloud-Netflix"><a href="#Spring-Cloud-Netflix" class="headerlink" title="Spring Cloud Netflix"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/">Spring Cloud Netflix</a></h1><h2 id="1-Service-Discovery-Eureka-Clients"><a href="#1-Service-Discovery-Eureka-Clients" class="headerlink" title="1. Service Discovery: Eureka Clients"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#service-discovery-eureka-clients">1. Service Discovery: Eureka Clients</a></h2><p>æœåŠ¡å‘ç°æ˜¯å¾®æœåŠ¡æ¶æ„çš„å…³é”®åŸåˆ™ä¹‹ä¸€ã€‚æ‰‹å·¥é…ç½®æ¯ä¸ªå®¢æˆ·ç«¯æˆ–åŸºäºæŸç§çº¦å®šæ˜¯éå¸¸è„†å¼±çš„ã€‚Eureka æ˜¯ Netflix æœåŠ¡å‘ç°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚æœåŠ¡å¯ä»¥è¢«é…ç½®å’Œéƒ¨ç½²ï¼Œå˜å¾—é«˜å¯ç”¨ï¼Œæ¯ä¸ªæœåŠ¡éƒ½ä¼šå¤åˆ¶å…¶ä»–å·²ç»æ³¨å†ŒæœåŠ¡çš„çŠ¶æ€ã€‚</p>
<h3 id="1-1-How-to-Include-Eureka-Client"><a href="#1-1-How-to-Include-Eureka-Client" class="headerlink" title="1.1. How to Include Eureka Client"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-eureka-client-starter">1.1. How to Include Eureka Client</a></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-Registering-with-Eureka"><a href="#1-2-Registering-with-Eureka" class="headerlink" title="1.2. Registering with Eureka"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#registering-with-eureka">1.2. Registering with Eureka</a></h3><p>å½“ Eureka Client æ³¨å†Œ Eureka Server æ—¶ï¼Œå®ƒä¼šæä¾›è‡ªå·±çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ï¼šä¸»æœºï¼Œç«¯å£ï¼Œå¥åº·æŒ‡ç¤ºå™¨ URLï¼Œä¸»é¡µç­‰è¯¦ç»†ä¿¡æ¯ã€‚Eureka Server æ¥æ”¶å±äºæŸä¸ªæœåŠ¡çš„æ¯ä¸ªå®ä¾‹çš„å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœå¿ƒè·³åœ¨å¯é…ç½®çš„æ—¶é—´è¡¨ä¸Šå¤±è´¥ï¼Œåˆ™é€šå¸¸ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤å®ä¾‹ã€‚</p>
<p>ä»¥ä¸‹å®ä¾‹å±•ç¤ºäº†æœ€å°çš„ Eureka Client åº”ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(Application.class).web(<span class="literal">true</span>).run(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¯·æ³¨æ„ï¼Œå‰é¢çš„ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªæ™®é€šçš„ Spring Boot åº”ç”¨ã€‚é€šè¿‡åŒ…å« <code>spring-cloud-starter-netflix-eureka-client</code> äºç±»è·¯å¾„ï¼Œä½ çš„åº”ç”¨ä¼šè‡ªåŠ¨æ³¨å†Œåˆ° Eureka Serverã€‚éœ€è¦é…ç½®çš„å°±æ˜¯å®šä½ Eureka Serverï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">serviceUrl:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>defaultZone</code> æ˜¯ä¸€ä¸ªé­”æœ¯å­—ç¬¦ä¸²å¤‡ç”¨å€¼ï¼Œå®ƒä¸ºä»»ä½•æ²¡æœ‰è¡¨ç¤ºé¦–é€‰é¡¹çš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ URLï¼ˆæ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„é»˜è®¤å€¼ï¼‰ã€‚</p>
<blockquote>
<p><code>defaultZone</code> å±æ€§æ˜¯å¤§å°å†™æ•æ„Ÿï¼Œå¹¶ä¸”éœ€è¦é©¼å³°æ ¼å¼ï¼Œå› ä¸º <code>serviceUrl</code> å±æ€§æ˜¯ä¸€ä¸ª <code>Map&lt;String, String&gt;</code>ã€‚å› æ­¤ï¼Œ<code>defaultZone</code> å±æ€§ä¸éµå¾ªé€šå¸¸çš„ Spring Boot è›‡å½¢çº¦å®š <code>default-zone</code>ã€‚</p>
</blockquote>
<p>é»˜è®¤çš„åº”ç”¨åï¼ˆå³ï¼ŒæœåŠ¡ IDï¼‰ï¼Œè™šæ‹Ÿæœºä¸»æœºåï¼Œä»¥åŠéå®‰å…¨ç«¯å£ï¼ˆä» <code>Environment</code> ä¸­è·å–ï¼‰åˆ†åˆ«æ˜¯ <code>$&#123;spring.application.name&#125;</code>ï¼Œ<code>$&#123;spring.application.name&#125;</code>ï¼Œä»¥åŠ <code>$&#123;server.port&#125;</code>ã€‚</p>
<h3 id="1-3-Authenticating-with-the-Eureka-Server"><a href="#1-3-Authenticating-with-the-Eureka-Server" class="headerlink" title="1.3. Authenticating with the Eureka Server"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#authenticating-with-the-eureka-server">1.3. Authenticating with the Eureka Server</a></h3><p>å¦‚æœ eureka.client.serviceUrl.defaultZone ä¹‹ä¸€æœ‰å‡­è¯åµŒå…¥å…¶ä¸­ï¼Œåˆ™ä¼šè‡ªåŠ¨æŠŠ HTTP basic è®¤è¯æ·»åŠ åˆ° eureka å®¢æˆ·ç«¯ã€‚</p>
<p><strong>æ³¨æ„</strong> è¿™é‡Œå¹¶ä¸æ˜¯ç»™ URL æ·»åŠ å‡­è¯ï¼Œåªæ˜¯æ¿€æ´» HTTP basic ç”¨äºè¯·æ±‚çš„è®¤è¯ã€‚</p>
<h3 id="1-4-Status-Page-and-Health-Indicator"><a href="#1-4-Status-Page-and-Health-Indicator" class="headerlink" title="1.4. Status Page and Health Indicator"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#status-page-and-health-indicator">1.4. Status Page and Health Indicator</a></h3><h3 id="1-5-Registering-a-Secure-Application"><a href="#1-5-Registering-a-Secure-Application" class="headerlink" title="1.5. Registering a Secure Application"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#registering-a-secure-application">1.5. Registering a Secure Application</a></h3><p>å¦‚æœä½ çš„åº”ç”¨å¸Œæœ›é€šè¿‡ HTTPS è¿æ¥ï¼Œä½ å¯ä»¥åœ¨ <code>EurekaInstanceConfig</code> è®¾ç½®ä¸¤ä¸ªæ ‡è®°ï¼š</p>
<ul>
<li><code>eureka.instance.[nonSecurePortEnabled]=[false]</code></li>
<li><code>eureka.instance.[securePortEnabled]=[true]</code></li>
</ul>
<h3 id="1-6-Eurekaâ€™s-Health-Checks"><a href="#1-6-Eurekaâ€™s-Health-Checks" class="headerlink" title="1.6. Eurekaâ€™s Health Checks"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#eurekas-health-checks">1.6. Eurekaâ€™s Health Checks</a></h3><h3 id="1-7-Eureka-Metadata-for-Instances-and-Clients"><a href="#1-7-Eureka-Metadata-for-Instances-and-Clients" class="headerlink" title="1.7. Eureka Metadata for Instances and Clients"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#eureka-metadata-for-instances-and-clients">1.7. Eureka Metadata for Instances and Clients</a></h3><h4 id="1-7-1-Using-Eureka-on-Cloud-Foundry"><a href="#1-7-1-Using-Eureka-on-Cloud-Foundry" class="headerlink" title="1.7.1. Using Eureka on Cloud Foundry"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-eureka-on-cloud-foundry">1.7.1. Using Eureka on Cloud Foundry</a></h4><h4 id="1-7-2-Using-Eureka-on-AWS"><a href="#1-7-2-Using-Eureka-on-AWS" class="headerlink" title="1.7.2. Using Eureka on AWS"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-eureka-on-aws">1.7.2. Using Eureka on AWS</a></h4><p>å¦‚æœä½ è®¡åˆ’å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° AWS äº‘ä¸Šï¼Œåˆ™å¿…é¡»å°† Eureka å®ä¾‹é…ç½®ä¸º AWS-awareã€‚ä½ å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ <code>EurekaInstanceConfigBean</code> æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&quot;!default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> EurekaInstanceConfigBean <span class="title function_">eurekaInstanceConfig</span><span class="params">(InetUtils inetUtils)</span> &#123;</span><br><span class="line">  <span class="type">EurekaInstanceConfigBean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EurekaInstanceConfigBean</span>(inetUtils);</span><br><span class="line">  <span class="type">AmazonInfo</span> <span class="variable">info</span> <span class="operator">=</span> AmazonInfo.Builder.newBuilder().autoBuild(<span class="string">&quot;eureka&quot;</span>);</span><br><span class="line">  b.setDataCenterInfo(info);</span><br><span class="line">  <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-7-3-Changing-the-Eureka-Instance-ID"><a href="#1-7-3-Changing-the-Eureka-Instance-ID" class="headerlink" title="1.7.3. Changing the Eureka Instance ID"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#changing-the-eureka-instance-id">1.7.3. Changing the Eureka Instance ID</a></h3><p>ä¸€èˆ¬åœ°ï¼ŒNetFlix Eureka å®ä¾‹ä»¥ host name æ³¨å†Œä¸ºå…¶ä¸»æœºåã€‚Spring Cloud Eureka æä¾›äº†ä¸€ä¸ªæ˜ç¡®çš„é»˜è®¤å€¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;spring.cloud.client.hostname&#125;:$&#123;spring.application.name&#125;:$&#123;spring.application.instance_id:$&#123;server.port&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼š<code>myhost:myappname:8080</code></p>
<p>åœ¨ Spring Cloud ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡æä¾›å”¯ä¸€æ ‡è¯†ç¬¦ <code>eureka.instance.instanceId</code> æ¥è¦†ç›–è¯¥å€¼ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instanceId:</span> <span class="string">$&#123;spring.application.name&#125;:$&#123;vcap.application.instance_id:$&#123;spring.application.instance_id:$&#123;random.value&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-8-Using-the-EurekaClient"><a href="#1-8-Using-the-EurekaClient" class="headerlink" title="1.8. Using the EurekaClient"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-the-eurekaclient">1.8. Using the EurekaClient</a></h3><p>ä¸€æ—¦ä½ æ‹¥æœ‰ä¸€ä¸ªå‘ç°å®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä» Eureka Server å‘ç°æœåŠ¡å®ä¾‹ã€‚è¿™æ ·åšçš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æœ¬åœ° <code>com.netflix.discovery.EurekaClient</code></p>
<h2 id="1-9-Alternatives-to-the-Native-Netflix-EurekaClient"><a href="#1-9-Alternatives-to-the-Native-Netflix-EurekaClient" class="headerlink" title="1.9. Alternatives to the Native Netflix EurekaClient"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#alternatives-to-the-native-netflix-eurekaclient">1.9. Alternatives to the Native Netflix EurekaClient</a></h2><p>ä½ æ— éœ€ä½¿ç”¨åŸç”Ÿçš„ NetFlix çš„ <code>EurekaClient</code>ã€‚è€Œä¸”ï¼Œåœ¨æŸç§å½¢å¼çš„åŒ…è£…ä¹‹åé€šå¸¸ä¼šæ›´å®¹æ˜“ä½¿ç”¨å®ƒã€‚é€šè¿‡é€»è¾‘ eureka æœåŠ¡æ ‡è¯†ç¬¦ï¼ˆVIPsï¼‰è€Œä¸æ˜¯ç‰©ç† URLï¼ŒSpring Cloud æ”¯æŒ Feignï¼ˆä¸€ä¸ª REST å®¢æˆ·ç«¯æ„å»ºå™¨ï¼‰ä»¥åŠ Spring RestTemplateã€‚</p>
<h2 id="1-10-Why-Is-It-so-Slow-to-Register-a-Service"><a href="#1-10-Why-Is-It-so-Slow-to-Register-a-Service" class="headerlink" title="1.10. Why Is It so Slow to Register a Service?"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#why-is-it-so-slow-to-register-a-service">1.10. Why Is It so Slow to Register a Service?</a></h2><p>ä½œä¸ºä¸€ä¸ªå®ä¾‹ï¼Œè¿˜æ¶‰åŠåˆ°å‘æ³¨å†Œä¸­å¿ƒï¼ˆé€šè¿‡ client çš„ serviceUrlï¼‰çš„å®šæœŸå¿ƒè·³ï¼Œé»˜è®¤æ—¶é—´ä¸º 30 ç§’ã€‚ä¸€ä¸ªæœåŠ¡ï¼Œç›´åˆ°è¯¥å®ä¾‹ï¼Œæ³¨å†Œä¸­å¿ƒï¼Œå®¢æˆ·ç«¯ç¼“å­˜ä¸­éƒ½æœ‰ç›¸åŒçš„å…ƒæ•°æ®ï¼ˆå› æ­¤éœ€è¦ 3 ä¸ªå¿ƒè·³ï¼‰ï¼Œå®¢æˆ·ç«¯æ‰èƒ½å‘ç°å…¶ä¸å¯ç”¨ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>eureka.instance.leaseRenewalIntervalInSeconds</code> æ¥æ›´æ”¹å‘¨æœŸã€‚å°†å…¶è®¾ç½®ä¸ºå°äº 30 çš„å€¼ï¼Œå¯ä»¥åŠ å¿«å®¢æˆ·ç«¯è¿æ¥åˆ°å…¶ä»–æœåŠ¡çš„è¿›ç¨‹ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œç”±äºæ³¨å†Œä¸­å¿ƒçš„å†…éƒ¨è®¡ç®—å¯¹ç§Ÿèµç»­æœŸåšäº†å‡è®¾ï¼Œå› æ­¤æœ€å¥½åšæŒä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
<h1 id="2-Service-Discovery-Eureka-Server"><a href="#2-Service-Discovery-Eureka-Server" class="headerlink" title="2. Service Discovery: Eureka Server"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server">2. Service Discovery: Eureka Server</a></h1><p><a target="_blank" rel="noopener" href="https://gitee.com/jiang_chun_bo/cannedbread-parent/tree/master/cannedbread-eureka-server">å‚è€ƒé…ç½®</a></p>
<h2 id="2-1-How-to-Include-Eureka-Server"><a href="#2-1-How-to-Include-Eureka-Server" class="headerlink" title="2.1. How to Include Eureka Server"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-eureka-server-starter">2.1. How to Include Eureka Server</a></h2><p>è¦åœ¨ä½ çš„é¡¹ç›®ä¸­åŒ…å« Eureka Serverï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code> ä»¥åŠ artifact ID ä¸º <code>spring-cloud-starter-netflix-eureka-server</code> çš„ starterã€‚å‚è§ <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a></p>
<h2 id="2-2-How-to-Run-a-Eureka-Server"><a href="#2-2-How-to-Run-a-Eureka-Server" class="headerlink" title="2.2. How to Run a Eureka Server"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-running-eureka-server">2.2. How to Run a Eureka Server</a></h2><p>æœåŠ¡ç«¯æœ‰ä¸€ä¸ªä¸»é¡µå’Œ HTTP API ï¼ˆåœ¨ &#x2F;eureka&#x2F;* ä¸‹ï¼‰ã€‚</p>
<p>&amp;nbsp;</p>
<h2 id="2-3-High-Availability-Zones-and-Regions"><a href="#2-3-High-Availability-Zones-and-Regions" class="headerlink" title="2.3. High Availability, Zones and Regions"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-zones-and-regions">2.3. High Availability, Zones and Regions</a></h2><p>Eureka æœåŠ¡ç«¯å¹¶æ²¡æœ‰åç«¯å­˜å‚¨ï¼Œä½†æ˜¯æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡å®ä¾‹éƒ½å¿…é¡»å‘é€å¿ƒè·³ï¼Œæ¥ä¿æŒå®ƒä»¬çš„æ³¨å†Œæœ€æ–°ï¼ˆè¿™å¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆï¼‰ã€‚å®¢æˆ·ç«¯è¿˜æœ‰ä¸€ä¸ªå†…å­˜ä¸­çš„ Eureka æ³¨å†Œç¼“å­˜ï¼Œå› æ­¤å¯¹äºæ¯ä¸ªæœåŠ¡çš„è¯·æ±‚ï¼Œä¸å¿…è·³è½¬åˆ°æ³¨å†Œè¡¨ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Eureka æœåŠ¡ç«¯ä¹Ÿæ˜¯ Eureka å®¢æˆ·ç«¯ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªæœåŠ¡ URL æ¥å®šä½å¯¹ç­‰ä½“ã€‚å¦‚æœæ²¡æœ‰æä¾›æœåŠ¡ URLï¼ŒæœåŠ¡è·‘èµ·æ¥å¹¶å¼€å§‹å·¥ä½œï¼Œå°±ä¼šå¡«å……å¤§é‡çš„å™ªéŸ³åˆ°æ—¥å¿—ä¸­ï¼ˆæ— æ³•ä¸å¯¹ç­‰ä½“æ³¨å†Œçš„å¼‚å¸¸ï¼‰ã€‚</p>
<p>&amp;nbsp;</p>
<h2 id="2-4-Standalone-Mode"><a href="#2-4-Standalone-Mode" class="headerlink" title="2.4. Standalone Mode"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-standalone-mode">2.4. Standalone Mode</a></h2><p>åŒç¼“å­˜å’Œå¿ƒè·³æœºåˆ¶ï¼Œä¸¤è€…ç»„åˆå¯ä»¥è®©ç‹¬ç«‹ Eureka Server å¯¹äºå¤±è´¥å…·æœ‰ç›¸å½“çš„å¼¹æ€§ï¼Œåªè¦æœ‰æŸç§ç›‘è§†å™¨æˆ–è€…å¼¹æ€§çš„è¿è¡Œæ—¶é—´ä¿æŒå­˜æ´»ã€‚åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½æ›´å¸Œæœ›å…³é—­å®¢æˆ·ç«¯è¡Œä¸ºï¼Œé¿å…ä¸æ–­å°è¯•å¹¶æ— æ³•è¾¾åˆ°å¯¹ç­‰ä½“çš„é”™è¯¯ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">registerWithEureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">serviceUrl:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong> serviceUrl éœ€è¦æŒ‡å‘æœ¬åœ°å®ä¾‹ç›¸åŒçš„ä¸»æœºã€‚</p>
<h2 id="2-5-Peer-Awareness"><a href="#2-5-Peer-Awareness" class="headerlink" title="2.5. Peer Awareness"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-peer-awareness">2.5. Peer Awareness</a></h2><p>é€šè¿‡è¿è¡Œå¤šä¸ªå®ä¾‹ï¼Œå¹¶è®©ä»–ä»¬äº’ç›¸æ³¨å†Œï¼Œeureka å¯ä»¥å˜å¾—æ›´å…·æœ‰å¼¹æ€§å’Œå¯ç”¨æ€§ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯é»˜è®¤çš„è¡Œä¸ºï¼Œæ‰€ä»¥ä½ åªéœ€è¦å‘å¯¹ç­‰ä½“æ·»åŠ æœ‰æ•ˆçš„ serviceUrl å³å¯ã€‚</p>
<p>ä¸ºäº†åœ¨å•ä¸ªä¸»æœºä¸Šä½“éªŒå¯¹ç­‰æ„ŸçŸ¥ï¼Œå¯ä»¥æ“ä½œ <code>/etc/hosts</code> æ–‡ä»¶æ¥è§£æä¸»æœºåã€‚å®é™…ä¸Šï¼Œå¦‚æœè¿è¡Œåœ¨ä¸€å°å·²çŸ¥ä¸»æœºåçš„æœºå™¨ä¸Šæ—¶ï¼Œæ²¡æœ‰å¿…è¦é…ç½® <code>eureka.instance.hostname</code>ã€‚é»˜è®¤åœ°ï¼Œä¼šä½¿ç”¨ <code>java.net.InetAddress</code> å¯»æ‰¾ã€‚</p>
<p>ä½ å¯ä»¥å‘ä¸€ä¸ªç³»ç»Ÿæ·»åŠ å¤šä¸ªå¯¹ç­‰ä½“ï¼Œåªè¦å®ƒä»¬é€šè¿‡è‡³å°‘è¾¹ç¼˜å½¼æ­¤è¿æ¥ï¼Œå®ƒä»¬ä¹‹é—´å°±ä¼šåŒæ­¥æ³¨å†Œä¿¡æ¯ã€‚å¦‚æœå¯¹ç­‰ä½“ç‰©ç†åˆ†ç¦»ï¼Œé‚£ä¹ˆç³»ç»ŸåŸåˆ™ä¸Šå­˜åœ¨è„‘è£‚çš„é—®é¢˜ã€‚</p>
<h2 id="2-6-When-to-Prefer-IP-Address"><a href="#2-6-When-to-Prefer-IP-Address" class="headerlink" title="2.6. When to Prefer IP Address"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-prefer-ip-address">2.6. When to Prefer IP Address</a></h2><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œeureka æ›´åå‘äºå»ºè®®ä½¿ç”¨æœåŠ¡çš„ IP è€Œä¸æ˜¯ä¸»æœºåã€‚è®¾ç½® <code>eureka.instance.preferIpAddress</code> ä¸º trueï¼Œé‚£ä¹ˆå½“åº”ç”¨æ³¨å†Œåˆ° eureka æ—¶ï¼Œå°†ä¼šä½¿ç”¨ IP åœ°å€è€Œä¸æ˜¯ä¸»æœºåã€‚</p>
<blockquote>
<p>å¦‚æœ Java æ— æ³•ç¡®å®š hostnameï¼Œé‚£ä¹ˆå°±ä¼šå‘é€ IP åœ°å€ç»™ eurekaã€‚</p>
</blockquote>
<h2 id="2-8-Disabling-Ribbon-with-Eureka-Server-and-Client-starters"><a href="#2-8-Disabling-Ribbon-with-Eureka-Server-and-Client-starters" class="headerlink" title="2.8. Disabling Ribbon with Eureka Server and Client starters"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#disabling-ribbon-with-eureka-server-and-client-starters">2.8. Disabling Ribbon with Eureka Server and Client starters</a></h2><p><code>spring-cloud-starter-netflix-eureka-server</code> å’Œ <code>spring-cloud-starter-netflix-eureka-client</code> yä¸ <code>spring-cloud-starter-netflix-ribbon</code> ä¸€èµ·å‡ºç°ã€‚ç”±äº Ribbon è´Ÿè½½å‡è¡¡å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®åˆ‡æ¢ä½¿ç”¨ Spring Cloud LoadBalancerï¼Œä¹ŸåŒ…å«åœ¨ Eureka starter ä¸­ã€‚</p>
<p>ä¸ºæ­¤ï¼Œä½ å¯ä»¥å°† <code>spring.cloud.loadbalancer.ribbon.enabled</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ã€‚</p>
<p>ç„¶åï¼Œä½ è¿˜å¯ä»¥ä»æ„å»ºæ–‡ä»¶ä¸­åœ° Eureka starter ä¸­æ’é™¤ ribbon ç›¸å…³çš„ä¾èµ–ï¼Œåƒè¿™æ ·ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.netflix.ribbon<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ribbon-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-Circuit-Breaker-Spring-Cloud-Circuit-Breaker-With-Hystrix"><a href="#3-Circuit-Breaker-Spring-Cloud-Circuit-Breaker-With-Hystrix" class="headerlink" title="3. Circuit Breaker: Spring Cloud Circuit Breaker With Hystrix"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#circuit-breaker-spring-cloud-circuit-breaker-with-hystrix">3. Circuit Breaker: Spring Cloud Circuit Breaker With Hystrix</a></h2><h3 id="3-1-Disabling-Spring-Cloud-Circuit-Breaker-Hystrix"><a href="#3-1-Disabling-Spring-Cloud-Circuit-Breaker-Hystrix" class="headerlink" title="3.1. Disabling Spring Cloud Circuit Breaker Hystrix"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#disabling-spring-cloud-circuit-breaker-hystrix">3.1. Disabling Spring Cloud Circuit Breaker Hystrix</a></h3><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cloud.circuitbreaker.hystrix.enabled</code> ä¸º <code>false</code> æ¥ç¦ç”¨è‡ªåŠ¨é…ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.circuitbreaker.hystrix.enabled=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-Configuring-Hystrix-Circuit-Breakers"><a href="#3-2-Configuring-Hystrix-Circuit-Breakers" class="headerlink" title="3.2. Configuring Hystrix Circuit Breakers"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#configuring-hystrix-circuit-breakers">3.2. Configuring Hystrix Circuit Breakers</a></h3><h4 id="3-2-1-Default-Configuration"><a href="#3-2-1-Default-Configuration" class="headerlink" title="3.2.1. Default Configuration"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#default-configuration">3.2.1. Default Configuration</a></h4><p>ä¸ºäº†ç»™æ‚¨æ‰€æœ‰çš„æ–­è·¯å™¨æä¾›é»˜è®¤é…ç½®ï¼Œè¯·åˆ›å»ºä¼ é€’ä¸€ä¸ª <code>HystrixCircuitBreakerFactory</code> æˆ–è€… <code>ReactiveHystrixCircuitBreakerFactory</code> çš„ <code>Customize</code> Beanã€‚<code>configureDefault</code> æ–¹æ³•å¯ç”¨äºæä¾›é»˜è®¤é…ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;HystrixCircuitBreakerFactory&gt; <span class="title function_">defaultConfig</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; HystrixCommand.Setter</span><br><span class="line">            .withGroupKey(HystrixCommandGroupKey.Factory.asKey(id))</span><br><span class="line">            .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()</span><br><span class="line">            .withExecutionTimeoutInMilliseconds(<span class="number">4000</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Reactive-Example"><a href="#Reactive-Example" class="headerlink" title="Reactive Example"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#reactive-example">Reactive Example</a></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;ReactiveHystrixCircuitBreakerFactory&gt; <span class="title function_">defaultConfig</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; HystrixObservableCommand.Setter</span><br><span class="line">            .withGroupKey(HystrixCommandGroupKey.Factory.asKey(id))</span><br><span class="line">            .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()</span><br><span class="line">                    .withExecutionTimeoutInMilliseconds(<span class="number">4000</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-Specific-Circuit-Breaker-Configuration"><a href="#3-2-2-Specific-Circuit-Breaker-Configuration" class="headerlink" title="3.2.2. Specific Circuit Breaker Configuration"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#specific-circuit-breaker-configuration">3.2.2. Specific Circuit Breaker Configuration</a></h4><p>ç±»ä¼¼äºæä¾›é»˜è®¤é…ç½®ï¼Œæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ª <code>HystrixCircuitBreakerFactory</code> åˆ›å»ºä¸€ä¸ª <code>Customize</code> Beanã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;HystrixCircuitBreakerFactory&gt; <span class="title function_">customizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.commandProperties(</span><br><span class="line">                    HystrixCommandProperties.Setter().withExecutionTimeoutInMilliseconds(<span class="number">2000</span>)), <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Reactive-Example-1"><a href="#Reactive-Example-1" class="headerlink" title="Reactive Example"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#reactive-example-2">Reactive Example</a></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;ReactiveHystrixCircuitBreakerFactory&gt; <span class="title function_">customizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.commandProperties(</span><br><span class="line">                    HystrixCommandProperties.Setter().withExecutionTimeoutInMilliseconds(<span class="number">2000</span>)), <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-Circuit-Breaker-Hystrix-Clients"><a href="#4-Circuit-Breaker-Hystrix-Clients" class="headerlink" title="4. Circuit Breaker: Hystrix Clients"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#circuit-breaker-hystrix-clients">4. Circuit Breaker: Hystrix Clients</a></h2><p>Netflix å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º Hystrix çš„åº“ï¼Œè¯¥åº“å®ç°äº† <a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/CircuitBreaker.html">circuit breaker pattern</a>ï¼ˆç†”æ–­å™¨æ¨¡å¼ï¼‰ã€‚åœ¨å¾®æœåŠ¡ä½“ç³»ç»“æ„ä¸­ï¼Œé€šå¸¸å…·æœ‰å¤šå±‚æœåŠ¡è°ƒç”¨ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-netflix/main/docs/src/main/asciidoc/images/Hystrix.png">

<p><strong>Figure 1. Microservice Graph</strong></p>
<p>è¾ƒä½çº§åˆ«çš„æœåŠ¡å¤±è´¥å¯èƒ½å¯¼è‡´çº§è”å¤±è´¥ï¼Œç›´è‡³ç”¨æˆ·ã€‚å½“å¯¹ç‰¹å®šæœåŠ¡è°ƒç”¨è¶…è¿‡ <code>circuitBreaker.requestVolumeThreshold</code>ï¼ˆé»˜è®¤æ˜¯ 20 æ¬¡è¯·æ±‚ï¼‰ï¼Œå¹¶ä¸”ï¼Œåœ¨ä¸€ä¸ªç”± <code>metrics.rollingStats.timeInMilliseconds</code> å®šä¹‰æ»‘åŠ¨çª—å£ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰å†…ï¼Œå¤±è´¥ç™¾åˆ†æ¯”å¤§äº <code>circuitBreaker.errorThresholdPercentage</code>ï¼ˆé»˜è®¤ &gt;50%ï¼‰ï¼Œ ç†”æ–­å™¨ä¼šæ‰“å¼€ï¼Œå¹¶ä¸”ä¸è¿›è¡Œè°ƒç”¨ã€‚åœ¨å‡ºé”™å¹¶ä¸”ç†”æ–­å™¨æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯ä»¥æä¾›ä¸€ä¸ª fallbackã€‚</p>
<img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-netflix/main/docs/src/main/asciidoc/images/HystrixFallback.png">

<p><strong>Figure 2. Hystrix fallback prevents cascading failures</strong></p>
<h2 id="4-1-How-to-Include-Hystrix"><a href="#4-1-How-to-Include-Hystrix" class="headerlink" title="4.1. How to Include Hystrix"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#how-to-include-hystrix">4.1. How to Include Hystrix</a></h2><p>è‹¥è¦åœ¨ä½ çš„é¡¹ç›®ä¸­åŒ…å« Hystrixï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code>ï¼Œartifact ID ä¸º <code>spring-cloud-starter-netflix-hystrix</code> çš„ starterã€‚</p>
<p>ä¸‹é¢ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªæç®€çš„å¸¦æœ‰ Hystrix ç†”æ–­å™¨çš„ Eureka æœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(Application.class).web(<span class="literal">true</span>).run(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StoreIntegration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;defaultStores&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getStores</span><span class="params">(Map&lt;String, Object&gt; parameters)</span> &#123;</span><br><span class="line">        <span class="comment">//do stuff that might fail</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">defaultStores</span><span class="params">(Map&lt;String, Object&gt; parameters)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">/* something useful */</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><code>@HystrixCommand</code> ç”±åä¸º <a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica">â€œjavanicaâ€</a> çš„ Netflix contrib åº“æä¾›ã€‚Spring Cloud ä»¥ä»£ç†çš„æ–¹å¼åŒ…è£…å…·æœ‰è¯¥æ³¨è§£çš„ Spring Beanï¼Œç”¨äºè¿æ¥åˆ° Hystrix ç†”æ–­å™¨ã€‚ç†”æ–­å™¨è®¡ç®—ä½•æ—¶æ‰“å¼€å’Œå…³é—­å›è·¯ï¼Œä»¥åŠåœ¨å¤±è´¥çš„æƒ…å†µä¸‹åšä»€ä¹ˆã€‚</p>
<p>è¦é…ç½® <code>@HystrixCommand</code>ï¼Œä½ å¯ä»¥ä»¥ <code>@HystrixProperty</code> æ³¨è§£åˆ—è¡¨çš„å½¢å¼ä½¿ç”¨ <code>commandProperties</code> å±æ€§ã€‚æœ‰å…³æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica#configuration">æ­¤å¤„</a>ã€‚æœ‰å…³å¯ç”¨å±æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œå‚è§ <a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix/wiki/Configuration">Hystrix wiki</a></p>
<h2 id="4-2-Propagating-the-Security-Context-or-Using-Spring-Scopes"><a href="#4-2-Propagating-the-Security-Context-or-Using-Spring-Scopes" class="headerlink" title="4.2. Propagating the Security Context or Using Spring Scopes"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-hystrix-starter">4.2. Propagating the Security Context or Using Spring Scopes</a></h2><p>å¦‚æœä½ å¸Œæœ›ä¸€äº›çº¿ç¨‹çš„æœ¬åœ°ä¸Šä¸‹æ–‡ä¼ æ’­åˆ° <code>@HystrixCommand</code>ï¼Œé»˜è®¤å£°æ˜å¹¶ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œå‘½ä»¤ï¼ˆåœ¨è¶…æ—¶æƒ…å†µä¸‹ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡é…ç½®æˆ–è€…ç›´æ¥åœ¨æ³¨è§£ä¸Šï¼Œè¯·æ±‚ Hystrix ä½¿ç”¨ä¸åŒçš„ â€œIsolation Strategyâ€ï¼Œåˆ‡æ¢ Hystrix ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹ä½œä¸ºè°ƒç”¨è€…ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†åœ¨æ³¨è§£ä¸­è®¾ç½®çº¿ç¨‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;stubMyService&quot;,</span></span><br><span class="line"><span class="meta">    commandProperties = &#123;</span></span><br><span class="line"><span class="meta">      @HystrixProperty(name=&quot;execution.isolation.strategy&quot;, value=&quot;SEMAPHORE&quot;)</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Health-Indicator"><a href="#4-3-Health-Indicator" class="headerlink" title="4.3. Health Indicator"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#health-indicator">4.3. Health Indicator</a></h3><p>è¿æ¥ç†”æ–­å™¨çš„çŠ¶æ€ä¹Ÿå¯ä»¥æš´éœ²åœ¨è°ƒç”¨åº”ç”¨çš„ <code>/health</code> ç«¯ç‚¹ä¸Šï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hystrix&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;openCircuitBreakers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;StoreIntegration::getStoresByLocationLink&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CIRCUIT_OPEN&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UP&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-Hystrix-Metrics-Stream"><a href="#4-4-Hystrix-Metrics-Stream" class="headerlink" title="4.4. Hystrix Metrics Stream"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#hystrix-metrics-stream">4.4. Hystrix Metrics Stream</a></h3><p>è‹¥è¦å¯åŠ¨ Hystrix metrics streamï¼Œè¯·åŒ…å«å…³äº <code>spring-boot-starter-actuator</code> çš„ä¾èµ–ï¼Œå¹¶è®¾ç½® <code>management.endpoints.web.exposure.include=hystrix.stream</code>ã€‚è¿™æ ·åšä¼šæš´éœ² <code>/actuator/hystrix.stream</code> ä½œä¸ºç®¡ç†ç«¯ç‚¹ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-Circuit-Breaker-Hystrix-Dashboard"><a href="#5-Circuit-Breaker-Hystrix-Dashboard" class="headerlink" title="5. Circuit Breaker: Hystrix Dashboard"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#circuit-breaker-hystrix-dashboard">5. Circuit Breaker: Hystrix Dashboard</a></h2><p>åªéœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®ç±»æ·»åŠ ä»¥ä¸‹æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br></pre></td></tr></table></figure>


<h2 id="6-Hystrix-Timeouts-And-Ribbon-Clients"><a href="#6-Hystrix-Timeouts-And-Ribbon-Clients" class="headerlink" title="6. Hystrix Timeouts And Ribbon Clients"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#hystrix-timeouts-and-ribbon-clients">6. Hystrix Timeouts And Ribbon Clients</a></h2><p>å½“ä½¿ç”¨ Hystrix command åŒ…è£…ä½ å¸Œæœ›çš„ Ribbon å®¢æˆ·ç«¯æ—¶ï¼Œç¡®ä¿ä½ çš„ Hystrix é…ç½®çš„ timeout æ¯” Ribbon é…ç½®çš„ timeout æ›´é•¿ï¼ŒåŒ…æ‹¬ä»»ä½•å¯èƒ½çš„é‡è¯•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ Ribbon è¿æ¥ timeout æ˜¯ 1 ç§’ï¼Œå¹¶ä¸” Ribbon å®¢æˆ·ç«¯å¯èƒ½é‡è¯•è¯·æ±‚ 3 æ¬¡ï¼Œé‚£ä¹ˆä½ çš„ Hystrix è¶…æ—¶æ—¶é—´åº”è¯¥ç•¥é«˜äº 3 ç§’ã€‚</p>
<blockquote>
<p><strong>ä½œè€…çš„è¯</strong> å¦‚æœä¸Šè¿°ç¤ºä¾‹é…ç½®ä½äº 3 ç§’ï¼Œé‚£ä¹ˆ Ribbon å¯èƒ½è¿˜æœªå®Œæˆ 3 æ¬¡é‡è¯•å°±å·²ç»ç»“æŸï¼Œå¹¶ä¸æ»¡è¶³é…ç½®é¢„æœŸã€‚</p>
</blockquote>
<h3 id="6-1-How-to-Include-the-Hystrix-Dashboard"><a href="#6-1-How-to-Include-the-Hystrix-Dashboard" class="headerlink" title="6.1. How to Include the Hystrix Dashboard"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#netflix-hystrix-dashboard-starter">6.1. How to Include the Hystrix Dashboard</a></h3><p>è‹¥è¦åœ¨ä½ çš„é¡¹ç›®åŒ…å« Hystrix Dashboardï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code>ï¼Œartifact ID ä¸º <code>spring-cloud-starter-netflix-hystrix-dashboard</code> çš„ starterã€‚</p>
<p>è‹¥è¦è¿è¡Œ Hystrix Dashboardï¼Œè¯·ä½¿ç”¨ <code>@EnableHystrixDashboard</code> æ³¨è§£ä½ çš„ Spring Boot ä¸»ç±»ã€‚ç„¶åè®¿é—® <code>/hystrix</code>ï¼Œå¹¶å°† dashboard æŒ‡å‘ä¸€ä¸ªå®ä¾‹åœ¨ Hystrix å®¢æˆ·ç«¯åº”ç”¨ä¸­çš„ <code>/hystrix.stream</code> ç«¯ç‚¹ã€‚</p>
<h2 id="7-Client-Side-Load-Balancer-Ribbon"><a href="#7-Client-Side-Load-Balancer-Ribbon" class="headerlink" title="7. Client Side Load Balancer: Ribbon"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-ribbon">7. Client Side Load Balancer: Ribbon</a></h2><p>Ribbon æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥å¯¹ HTTP å’Œ TCP å®¢æˆ·ç«¯è¡Œä¸ºè¿›è¡Œå¤§é‡æ§åˆ¶ã€‚Feign å·²ç»ä½¿ç”¨äº† Ribbonï¼Œå› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>@FeignClient</code>ï¼Œè¿™éƒ¨åˆ†ä¹Ÿä¼šä½¿ç”¨ã€‚</p>
<blockquote>
<p>Ribbon æ˜¯ä¸€ä¸ªè¿›ç¨‹å†… LB</p>
</blockquote>
<p>Ribbon çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯æœ‰åå®¢æˆ·ç«¯ã€‚æ¯ä¸ªè´Ÿè½½å‡è¡¡å™¨éƒ½æ˜¯ç»„ä»¶é›†åˆçš„ä¸€éƒ¨åˆ†ï¼Œç»„ä»¶ä»¬åœ¨ä¸€èµ·å·¥ä½œï¼ŒæŒ‰éœ€è¦è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ•´ä½“æœ‰ä¸€ä¸ªåå­—ï¼Œè¿™æ˜¯ä½ ä½œä¸ºå¼€å‘è€…èµ‹äºˆçš„åå­—ã€‚æ ¹æ®éœ€è¦ï¼ŒSpring Cloud é€šè¿‡ä½¿ç”¨ <code>RibbonClientConfiguration</code> ä»¥ <code>ApplicationContext</code> ä¸ºæ¯ä¸ªæœ‰åå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•´ä½“ã€‚è¿™åŒ…å«ä¸€ä¸ª <code>ILoadBalancer</code>ï¼Œä¸€ä¸ª <code>RestClient</code>ï¼Œä»¥åŠä¸€ä¸ª <code>ServerListFiter</code>ã€‚</p>
<h3 id="7-1-How-to-Include-Ribbon"><a href="#7-1-How-to-Include-Ribbon" class="headerlink" title="7.1. How to Include Ribbon"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-ribbon-starter">7.1. How to Include Ribbon</a></h3><p>è¦åœ¨ä½ çš„é¡¹ç›®ä½¿ç”¨ ribbonï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code>ï¼Œartifact ID ä¸º <code>spring-cloud-starter-netflix-ribbon</code> çš„ starterã€‚æœ‰å…³ä½¿ç”¨å½“å‰ Spring Cloud Release Train è®¾ç½®ä½ çš„æ„å»ºç³»ç»Ÿè¯¦æƒ…è§ <a target="_blank" rel="noopener" href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a></p>
<blockquote>
<p>å¦‚æœä½ ä¾èµ–äº† eurekaï¼Œåˆ™ ribbon ä¹Ÿä¼šåŒæ—¶å¼•å…¥ï¼Œæ— éœ€æ˜¾å¼å¼•å…¥</p>
</blockquote>
<h3 id="7-2-Customizing-the-Ribbon-Client"><a href="#7-2-Customizing-the-Ribbon-Client" class="headerlink" title="7.2. Customizing the Ribbon Client"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#customizing-the-ribbon-client">7.2. Customizing the Ribbon Client</a></h3><p>ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>&lt;client&gt;.ribbon.*</code> ä¹‹ä¸­çš„å¤–éƒ¨å±æ€§é…ç½® Ribbon å®¢æˆ·ç«¯çš„ä¸€äº›éƒ¨åˆ†ï¼Œè¿™ç±»ä¼¼äºä½¿ç”¨åŸç”Ÿçš„ Netflix APIï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ Spring Boot é…ç½®æ–‡ä»¶ã€‚åŸç”Ÿé€‰é¡¹å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/Netflix/ribbon/blob/master/ribbon-core/src/main/java/com/netflix/client/config/CommonClientConfigKey.java"><code>CommonClientConfigKey</code></a>  ï¼ˆribbon-core çš„ä¸€éƒ¨åˆ†ï¼‰ä»¥é™æ€å­—æ®µæŸ¥çœ‹ã€‚</p>
<p>Spring Cloud è¿˜è®©ä½ é€šè¿‡ä½¿ç”¨ <code>@RibbonClient</code> å£°æ˜é¢å¤–é…ç½®ï¼ˆé™¤äº† <code>RibbonClientConfiguration</code>ï¼‰æ¥å®Œå…¨æ§åˆ¶å®¢æˆ·ç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;custom&quot;, configuration = CustomConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯ç”±å·²ç»å­˜åœ¨äº <code>RibbonClientConfiguration</code> çš„ç»„ä»¶ï¼Œä»¥åŠåœ¨ <code>CustomConfiguration</code> ï¼ˆåè€…é€šå¸¸è¦†ç›–å‰è€…ï¼‰ä¸­çš„ä¸€äº›ç»„æˆã€‚</p>
<blockquote>
<p><code>CustomConfiguration</code> ç±»å¿…é¡»æ˜¯ <code>@Configuration</code> ç±»ï¼Œä½†æ˜¯æ³¨æ„ï¼Œä¸è¦æ”¾åœ¨ä¸»åº”ç”¨ä¸Šä¸‹æ–‡çš„ <code>@ComponentScan</code> ä¸­ã€‚å¦åˆ™ï¼Œå®ƒå°†è¢«æ‰€æœ‰çš„ <code>@RibbonClients</code> å…±äº«ã€‚å¦‚æœä½ ä½¿ç”¨ <code>@ComponentScan</code>ï¼ˆæˆ–è€… <code>@SpringBootApplication</code>ï¼‰ï¼Œä½ éœ€è¦é‡‡å–ä¸€äº›æ–¹æ³•ä»¥é¿å…å°†å…¶åŒ…æ‹¬åœ¨å†…ï¼ˆä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†å…¶æ”¾å…¥åˆ†å¼€çš„ï¼Œä¸é‡å çš„åŒ…ä¸­ï¼Œæˆ–è€…åœ¨ <code>@ComponentScan</code> ä¸­æŒ‡å®šè¦æ˜ç¡®æ‰«æçš„åŒ…ï¼‰ã€‚</p>
</blockquote>
<h3 id="7-3-Customizing-the-Default-for-All-Ribbon-Clients"><a href="#7-3-Customizing-the-Default-for-All-Ribbon-Clients" class="headerlink" title="7.3. Customizing the Default for All Ribbon Clients"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#customizing-the-default-for-all-ribbon-clients">7.3. Customizing the Default for All Ribbon Clients</a></h3><p>å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@RibbonClients</code> æ³¨è§£ï¼Œæ³¨å†Œä¸€ä¸ªé»˜è®¤çš„é…ç½®ï¼Œä¸ºæ‰€æœ‰çš„ Ribbon å®¢æˆ·ç«¯æä¾›é»˜è®¤é…ç½®ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RibbonClients(defaultConfiguration = DefaultRibbonConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RibbonClientDefaultConfigurationTestsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BazServiceList</span> <span class="keyword">extends</span> <span class="title class_">ConfigurationBasedServerList</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">BazServiceList</span><span class="params">(IClientConfig config)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.initWithNiwsConfig(config);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultRibbonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">ribbonRule</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BestAvailableRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IPing <span class="title function_">ribbonPing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PingUrl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerList&lt;Server&gt; <span class="title function_">ribbonServerList</span><span class="params">(IClientConfig config)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RibbonClientDefaultConfigurationTestsConfig</span>.BazServiceList(config);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerListSubsetFilter <span class="title function_">serverListFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServerListSubsetFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerListSubsetFilter</span>();</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-Customizing-the-Ribbon-Client-by-Setting-Properties"><a href="#7-4-Customizing-the-Ribbon-Client-by-Setting-Properties" class="headerlink" title="7.4. Customizing the Ribbon Client by Setting Properties"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#customizing-the-ribbon-client-by-setting-properties">7.4. Customizing the Ribbon Client by Setting Properties</a></h3><p>ä» 1.2.0 å¼€å§‹ï¼ŒSpring Cloud Netflix ç°åœ¨æ”¯æŒé€šè¿‡è®¾ç½®å…¼å®¹ <a target="_blank" rel="noopener" href="https://github.com/Netflix/ribbon/wiki/Working-with-load-balancers#components-of-load-balancer">Ribbon documentation</a> å±æ€§æ¥å®šåˆ¶åŒ– Ribbon å®¢æˆ·ç«¯ã€‚</p>
<p>è¿™ä½¿ä½ å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­æ›´æ”¹å¯åŠ¨æ—¶è¡Œä¸ºã€‚</p>
<p>ä¸‹é¢çš„åˆ—è¡¨å±•ç¤ºäº†æ”¯æŒçš„å±æ€§ï¼š</p>
<ul>
<li><code>&lt;clientName&gt;.ribbon.NFLoadBalancerClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>ILoadBalancer</code></li>
<li><code>&lt;clientName&gt;.ribbon.NFLoadBalancerRuleClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>IRule</code></li>
<li><code>&lt;clientName&gt;.ribbon.NFLoadBalancerPingClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>IPing</code></li>
<li><code>&lt;clientName&gt;.ribbon.NIWSServerListClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>ServerList</code></li>
<li><code>&lt;clientName&gt;.ribbon.NIWSServerListFilterClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>ServerListFilter</code></li>
</ul>
<blockquote>
<p>è¿™äº›å±æ€§ä¸­å®šä¹‰çš„ç±»ï¼Œç›¸è¾ƒäºä½¿ç”¨ <code>@RibbonClient(configuration=MyRibbonConfig.class)</code> å®šä¹‰çš„ Beanï¼Œä»¥åŠç”± Spring Cloud Netflix æä¾›çš„é»˜è®¤å€¼ï¼Œå…·æœ‰æ›´é«˜ä¼˜å…ˆçº§</p>
</blockquote>
<p>è¦è®¾ç½®åä¸º <code>users</code> çš„æœåŠ¡åçš„ <code>IRule</code></p>
<h3 id="7-6-Example-How-to-Use-Ribbon-Without-Eureka"><a href="#7-6-Example-How-to-Use-Ribbon-Without-Eureka" class="headerlink" title="7.6. Example: How to Use Ribbon Without Eureka"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-ribbon-without-eureka">7.6. Example: How to Use Ribbon Without Eureka</a></h3><p>Eureka æ˜¯ä¸€ç§ä¾¿æ·çš„æ–¹å¼ï¼Œå®ƒæŠ½è±¡åŒ–è¿œç¨‹æœåŠ¡çš„å‘ç°ï¼Œå› æ­¤ä½ ä¸å¿…åœ¨å®¢æˆ·ç«¯ä¸­è¿›è¡Œç¡¬ç¼–ç ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨ Eurekaï¼ŒRibbon å’Œ Feign ä¹Ÿå¯ä»¥å·¥ä½œã€‚å‡è®¾ä½ å·²ç»å£°æ˜äº† â€œstoresâ€ çš„ <code>@RibbonClient</code>ï¼Œå¹¶ä¸” Eureka æ²¡æœ‰ä½¿ç”¨ï¼ˆç”šè‡³ä¸åœ¨ç±»è·¯å¾„ï¼‰ã€‚Ribbon å®¢æˆ·ç«¯é»˜è®¤åˆ°é…ç½®å¥½çš„æœåŠ¡åˆ—è¡¨ã€‚ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æä¾›é…ç½®ï¼š</p>
<p><strong>application.yml</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stores:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">listOfServers:</span> <span class="string">example.com,google.com</span></span><br></pre></td></tr></table></figure>

<h3 id="7-7-Example-Disable-Eureka-Use-in-Ribbon"><a href="#7-7-Example-Disable-Eureka-Use-in-Ribbon" class="headerlink" title="7.7. Example: Disable Eureka Use in Ribbon"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#example-disable-eureka-use-in-ribbon">7.7. Example: Disable Eureka Use in Ribbon</a></h3><p>å°† <code>ribbon.eureka.enabled</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ï¼Œæ˜¾å¼åœ°ç¦ç”¨ Ribbon ä¸­ Eureka çš„ä½¿ç”¨ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<p><strong>application.yml</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eureka:</span></span><br><span class="line">   <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>


<h3 id="7-8-Using-the-Ribbon-API-Directly"><a href="#7-8-Using-the-Ribbon-API-Directly" class="headerlink" title="7.8. Using the Ribbon API Directly"></a><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-the-ribbon-api-directly">7.8. Using the Ribbon API Directly</a></h3><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>LoadBalanceClient</code>ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancerClient loadBalancer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doStuff</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> loadBalancer.choose(<span class="string">&quot;stores&quot;</span>);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">storesUri</span> <span class="operator">=</span> URI.create(String.format(<span class="string">&quot;https://%s:%s&quot;</span>, instance.getHost(), instance.getPort()));</span><br><span class="line">        <span class="comment">// ... do something with the URI</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Spring Cloud" >
    <span class="tag-code">Spring Cloud</span>
  </a>

  <a href="/tags#Netflix" >
    <span class="tag-code">Netflix</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2022/07/12/Nginx-%E5%AE%98%E6%96%B9%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        <span class="nav-arrow">â† </span>
        
          Nginx å®˜æ–¹å­¦ä¹ ç¬”è®°
        
      </a>
    
    
      <a class="nav-right" href="/2022/07/12/Eureka-%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/">
        
          Eureka é…ç½®å®è·µ
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
      <div class="money-like">
        <div class="reward-btn">
          èµ
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨æ”¯ä»˜å®æ‰“èµ</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨å¾®ä¿¡æ‰“èµ</b>
            </span>
          </span>
        </div>
        <p class="notice">è‹¥ä½ è§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¯¹æˆ‘æ‰“èµ</p>
      </div>
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">æ‰«æäºŒç»´ç ï¼Œåˆ†äº«æ­¤æ–‡ç« </p>
      </div>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Spring-Cloud-Netflix"><span class="toc-nav-text">Spring Cloud Netflix</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-Service-Discovery-Eureka-Clients"><span class="toc-nav-text">1. Service Discovery: Eureka Clients</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-1-How-to-Include-Eureka-Client"><span class="toc-nav-text">1.1. How to Include Eureka Client</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-2-Registering-with-Eureka"><span class="toc-nav-text">1.2. Registering with Eureka</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-3-Authenticating-with-the-Eureka-Server"><span class="toc-nav-text">1.3. Authenticating with the Eureka Server</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-4-Status-Page-and-Health-Indicator"><span class="toc-nav-text">1.4. Status Page and Health Indicator</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-5-Registering-a-Secure-Application"><span class="toc-nav-text">1.5. Registering a Secure Application</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-6-Eureka%E2%80%99s-Health-Checks"><span class="toc-nav-text">1.6. Eurekaâ€™s Health Checks</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-7-Eureka-Metadata-for-Instances-and-Clients"><span class="toc-nav-text">1.7. Eureka Metadata for Instances and Clients</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-7-1-Using-Eureka-on-Cloud-Foundry"><span class="toc-nav-text">1.7.1. Using Eureka on Cloud Foundry</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-7-2-Using-Eureka-on-AWS"><span class="toc-nav-text">1.7.2. Using Eureka on AWS</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-7-3-Changing-the-Eureka-Instance-ID"><span class="toc-nav-text">1.7.3. Changing the Eureka Instance ID</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-8-Using-the-EurekaClient"><span class="toc-nav-text">1.8. Using the EurekaClient</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-9-Alternatives-to-the-Native-Netflix-EurekaClient"><span class="toc-nav-text">1.9. Alternatives to the Native Netflix EurekaClient</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-10-Why-Is-It-so-Slow-to-Register-a-Service"><span class="toc-nav-text">1.10. Why Is It so Slow to Register a Service?</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#2-Service-Discovery-Eureka-Server"><span class="toc-nav-text">2. Service Discovery: Eureka Server</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-1-How-to-Include-Eureka-Server"><span class="toc-nav-text">2.1. How to Include Eureka Server</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-2-How-to-Run-a-Eureka-Server"><span class="toc-nav-text">2.2. How to Run a Eureka Server</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-3-High-Availability-Zones-and-Regions"><span class="toc-nav-text">2.3. High Availability, Zones and Regions</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-4-Standalone-Mode"><span class="toc-nav-text">2.4. Standalone Mode</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-5-Peer-Awareness"><span class="toc-nav-text">2.5. Peer Awareness</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-6-When-to-Prefer-IP-Address"><span class="toc-nav-text">2.6. When to Prefer IP Address</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-8-Disabling-Ribbon-with-Eureka-Server-and-Client-starters"><span class="toc-nav-text">2.8. Disabling Ribbon with Eureka Server and Client starters</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3-Circuit-Breaker-Spring-Cloud-Circuit-Breaker-With-Hystrix"><span class="toc-nav-text">3. Circuit Breaker: Spring Cloud Circuit Breaker With Hystrix</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-1-Disabling-Spring-Cloud-Circuit-Breaker-Hystrix"><span class="toc-nav-text">3.1. Disabling Spring Cloud Circuit Breaker Hystrix</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-2-Configuring-Hystrix-Circuit-Breakers"><span class="toc-nav-text">3.2. Configuring Hystrix Circuit Breakers</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-2-1-Default-Configuration"><span class="toc-nav-text">3.2.1. Default Configuration</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Reactive-Example"><span class="toc-nav-text">Reactive Example</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-2-2-Specific-Circuit-Breaker-Configuration"><span class="toc-nav-text">3.2.2. Specific Circuit Breaker Configuration</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Reactive-Example-1"><span class="toc-nav-text">Reactive Example</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#4-Circuit-Breaker-Hystrix-Clients"><span class="toc-nav-text">4. Circuit Breaker: Hystrix Clients</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#4-1-How-to-Include-Hystrix"><span class="toc-nav-text">4.1. How to Include Hystrix</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#4-2-Propagating-the-Security-Context-or-Using-Spring-Scopes"><span class="toc-nav-text">4.2. Propagating the Security Context or Using Spring Scopes</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-3-Health-Indicator"><span class="toc-nav-text">4.3. Health Indicator</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-4-Hystrix-Metrics-Stream"><span class="toc-nav-text">4.4. Hystrix Metrics Stream</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#5-Circuit-Breaker-Hystrix-Dashboard"><span class="toc-nav-text">5. Circuit Breaker: Hystrix Dashboard</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#6-Hystrix-Timeouts-And-Ribbon-Clients"><span class="toc-nav-text">6. Hystrix Timeouts And Ribbon Clients</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6-1-How-to-Include-the-Hystrix-Dashboard"><span class="toc-nav-text">6.1. How to Include the Hystrix Dashboard</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#7-Client-Side-Load-Balancer-Ribbon"><span class="toc-nav-text">7. Client Side Load Balancer: Ribbon</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-1-How-to-Include-Ribbon"><span class="toc-nav-text">7.1. How to Include Ribbon</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-2-Customizing-the-Ribbon-Client"><span class="toc-nav-text">7.2. Customizing the Ribbon Client</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-3-Customizing-the-Default-for-All-Ribbon-Clients"><span class="toc-nav-text">7.3. Customizing the Default for All Ribbon Clients</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-4-Customizing-the-Ribbon-Client-by-Setting-Properties"><span class="toc-nav-text">7.4. Customizing the Ribbon Client by Setting Properties</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-6-Example-How-to-Use-Ribbon-Without-Eureka"><span class="toc-nav-text">7.6. Example: How to Use Ribbon Without Eureka</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-7-Example-Disable-Eureka-Use-in-Ribbon"><span class="toc-nav-text">7.7. Example: Disable Eureka Use in Ribbon</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-8-Using-the-Ribbon-API-Directly"><span class="toc-nav-text">7.8. Using the Ribbon API Directly</span></a></li></ol></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://example.com/2022/07/12/Spring-Cloud/Spring-Cloud-Netflix/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>



  <script>
    var gitmentConfig = "jiangchunbo";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "Spring Cloud Netflix",
        owner: "jiangchunbo",
        repo: "jiangchunbo.github.io",
        oauth: {
          client_id: "8ff18c626ce6de443832",
          client_secret: "ccbfc51ce15c59b57e0fe4a4dea81060976bbde3"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  </script>




    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a target="_blank" rel="noopener" href="https://github.com/yanm1ng">yanm1ng</a>
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


  </body>
</html>