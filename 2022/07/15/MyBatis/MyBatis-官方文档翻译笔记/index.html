<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="JiangChunbo&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      MyBatis å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ç¬”è®° | ğŸ¥«ğŸ
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    
<script src="/js/local-search.js"></script>


<meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="ğŸ¥«ğŸ" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>ğŸ¥«ğŸ</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/categories/" class="item-link">Categories</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/categories/" class="menu-link">Categories</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off"
                    placeholder="Please enter your keyword(s) to search." spellcheck="false"
                    type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>MyBatis å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ç¬”è®°</h2>
  <p class="post-date">2022-07-15</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/">MyBatis</a></h1><hr>
<h2 id="1-Getting-started"><a href="#1-Getting-started" class="headerlink" title="1. Getting started"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html#Getting_started">1. Getting started</a></h2><h3 id="1-1-Installation"><a href="#1-1-Installation" class="headerlink" title="1.1. Installation"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html#Installation">1.1. Installation</a></h3><p>è¿›è¡Œæœ€åŸºæœ¬çš„ MyBatis åº”ç”¨å¼€å‘éœ€è¦å¯¼å…¥çš„ä¾èµ–ï¼Œæœ€æ–°ç‰ˆæœ¬å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">github</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="1-2-Building-SqlSessionFactory-from-XML"><a href="#1-2-Building-SqlSessionFactory-from-XML" class="headerlink" title="1.2. Building SqlSessionFactory from XML"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html#Building_SqlSessionFactory_from_XML">1.2. Building SqlSessionFactory from XML</a></h3><p>ä» XML æ„å»º SqlSessionFactoryã€‚æ‰€æœ‰ mybatis åº”ç”¨ç¨‹åºå›´ç»• <code>SqlSessionFactory</code> å®ä¾‹ã€‚å¯ä»¥é€šè¿‡ <code>SqlSessionFactoryBuilder</code> è·å–åˆ° <code>SqlSessionFactory</code> å®ä¾‹ã€‚<code>SqlSessionFactoryBuilder</code> å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ¥æºè¿›è¡Œæ„å»ºï¼š</p>
<ul>
<li>Mybatis configuration xml</li>
<li>Configuration object</li>
</ul>
<p>ä» XML æ–‡ä»¶æ„å»º <code>SqlSessionFactory</code> å®ä¾‹ï¼Œå»ºè®®ä½¿ç”¨<strong>ç±»è·¯å¾„èµ„æº</strong>ï¼Œä½†å®é™…ä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨ InputStreamã€‚</p>
<p><strong>mybatis-config.xml</strong> å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html">å®˜ç½‘</a></p>
<h3 id="1-3-Building-SqlSessionFactory-without-XML"><a href="#1-3-Building-SqlSessionFactory-without-XML" class="headerlink" title="1.3. Building SqlSessionFactory without XML"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html#Building_SqlSessionFactory_without_XML">1.3. Building SqlSessionFactory without XML</a></h3><p>å¯ä»¥å‚è€ƒå®˜ç½‘çš„æ¡ˆä¾‹ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ”¯æŒè¿™ç§åšæ³•ï¼Œå› ä¸ºé«˜çº§æ˜ å°„ä»ç„¶éœ€è¦ XML çš„æ”¯æŒã€‚</p>
<h3 id="1-4-Acquiring-a-SqlSession-from-SqlSessionFactory"><a href="#1-4-Acquiring-a-SqlSession-from-SqlSessionFactory" class="headerlink" title="1.4. Acquiring a SqlSession from SqlSessionFactory"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html#Acquiring_a_SqlSession_from_SqlSessionFactory">1.4. Acquiring a SqlSession from SqlSessionFactory</a></h3><p>é€šè¿‡ä»¥ä¸‹ä»£ç å¯ä»¥åˆ›å»ºä¸€ä¸ª Sessionï¼ˆæ³¨æ„å…³é—­ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br></pre></td></tr></table></figure>


<h3 id="1-5-Exploring-Mapped-SQL-Statements"><a href="#1-5-Exploring-Mapped-SQL-Statements" class="headerlink" title="1.5. Exploring Mapped SQL Statements"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html#Exploring_Mapped_SQL_Statements">1.5. Exploring Mapped SQL Statements</a></h3><p>è¯­å¥å¯ä»¥ç”± XML æˆ–è€… Annotation å®šä¹‰ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä¾‹å­ï¼Œåœ¨å‘½åç©ºé—´ <code>org.mybatis.example.BlogMapper</code> ä¸­ï¼Œå®šä¹‰äº†åä¸º <code>selectBlog</code> çš„æ˜ å°„è¯­å¥ï¼Œå…è®¸ä½ é€šè¿‡å®Œå…¨é™å®šåç§° <code>org.mybatis.example.BlogMapper.selectBlog</code> æ¥è°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;org.mybatis.example.BlogMapper.selectBlog&quot;</span>, <span class="number">101</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸åœ¨å®Œå…¨é™å®šçš„ Java ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œè¿™ä¹Ÿæ˜¯å¦‚æ­¤è®¾è®¡çš„åŸå› ã€‚ä½¿ç”¨ä¸æ˜ å°„çš„ select è¯­å¥åœ¨åç§°ï¼Œå‚æ•°ï¼Œè¿”å›ç±»å‹ç›¸åŒ¹é…çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ˜ å°„åˆ°ä¸å‘½åç©ºé—´åç§°ç›¸åŒçš„ Mapper ç±»ã€‚è¿™å…è®¸ä½ ç®€å•åœ°å°†æ–¹æ³•è°ƒç”¨åœ¨æ˜ å°„å™¨æ¥å£ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(BlogMapper.class);</span><br><span class="line"><span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> mapper.selectBlog(<span class="number">101</span>);</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹æ³•æœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚é¦–å…ˆï¼Œå®ƒä¸ä¾èµ–å­—ç¬¦ä¸²ï¼Œæ›´å®‰å…¨ã€‚å…¶æ¬¡ï¼Œå¦‚æœä½ çš„ IDE ç”±ä»£ç è¡¥å…¨ï¼Œå¯ä»¥åˆ©ç”¨å®ƒè·³è½¬åˆ°ä½ æ˜ å°„çš„ SQL è¯­å¥ã€‚</p>
<p><strong>Namespaces</strong><br>ä»¥å‰ç‰ˆæœ¬çš„ MyBatis å‘½åç©ºé—´æ˜¯å¯é€‰çš„ï¼Œç°åœ¨å¼ºåˆ¶éœ€è¦å‘½åç©ºé—´ï¼Œå…·æœ‰éš”ç¦»è¯­å¥çš„ç›®çš„ã€‚</p>
<p>å‘½åç©ºé—´è®©æ¥å£è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”ï¼Œå³ä½¿ä½ ç°åœ¨å¹¶ä¸è®¤ä¸ºä½ ä¼šä½¿ç”¨ï¼Œä½ ä¹Ÿåº”è¯¥éµå¾ªè¿™ç§å®è·µï¼Œé˜²æ­¢ä½ æ”¹å˜æƒ³æ³•ã€‚ä¸€æ—¦ä½¿ç”¨å‘½åç©ºé—´ï¼ŒæŠŠå®ƒæ”¾åˆ°æ­£ç¡®çš„ Java åŒ…å‘½åç©ºé—´ä¸‹èƒ½æ¸…ç†ä½ çš„ä»£ç ï¼Œå¹¶ä¸”é•¿æœŸå†…æé«˜ MyBatis çš„å¯ç”¨æ€§</p>
<p>å¯¹äºç®€å•çš„è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">  <span class="meta">@Select(&quot;SELECT * FROM blog WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">  Blog <span class="title function_">selectBlog</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸è¿‡ï¼Œå¯¹äºå¤æ‚çš„è¯­å¥ï¼Œå»ºè®®ä½¿ç”¨ XML æ–¹å¼å®šä¹‰ï¼Œå¦åˆ™æ˜¾å¾—æ··ä¹±ã€‚</p>
</blockquote>
<h2 id="2-Configuration-XML"><a href="#2-Configuration-XML" class="headerlink" title="2. Configuration XML"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html">2. Configuration XML</a></h2><h3 id="2-1-properties"><a href="#2-1-properties" class="headerlink" title="2.1. properties"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#properties">2.1. properties</a></h3><p><code>&lt;properties&gt;</code> é™¤äº†æ”¯æŒåµŒå…¥å†…ç½®å±æ€§ï¼Œè¿˜æ”¯æŒå¼•å…¥å¤–éƒ¨ Java å±æ€§æ–‡ä»¶ï¼Œåªéœ€é€šè¿‡ resource æˆ–è€… url å±æ€§è®¾ç½®å³å¯ã€‚resource æ˜¯ä»¥ç±»è·¯å¾„ä¸ºåŸºç¡€è·¯å¾„çš„ç›¸å¯¹è·¯å¾„ï¼Œurl ä¸ºæ ‡å‡†çš„è·¯å¾„ä½ç½®ï¼Œå¦‚ file:&#x2F;&#x2F;&#x2F;ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/config.properties&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dev_user&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;F2Fa3!33TYyg&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ç‚¹</strong> </p>
<ul>
<li>resource å’Œ url ä¸å¯ä»¥åŒæ—¶è®¾ç½®ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>å¦‚æœé…ç½®äº†ç›¸åŒçš„å±æ€§ï¼Œåˆ™åé¢çš„ä¼šè¦†ç›–å‰é¢çš„ï¼›å¦‚æœæ˜¯åˆ†æ•£åœ¨å±æ€§æ–‡ä»¶å’Œå­å…ƒç´ å±æ€§ä¸­ï¼Œé‚£ä¹ˆç”±äºå±æ€§æ–‡ä»¶ååŠ è½½ï¼Œå› æ­¤å±æ€§æ–‡ä»¶ä¼šè¦†ç›–å­å…ƒç´ å±æ€§ã€‚</li>
<li><code>&lt;properties&gt;</code> æ ‡ç­¾å¿…éœ€ä½äº <code>configuration</code> å­å…ƒç´ ç¬¬ä¸€ä¸ª</li>
</ul>
<p>å±æ€§é…ç½®å®Œï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å±æ€§ï¼Œä»¥æ›¿ä»£éœ€è¦åŠ¨æ€é…ç½®çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å±æ€§çš„æ¥æºä¹Ÿå¯ä»¥æ˜¯ç”±ç¨‹åºä¼ é€’ç»™ SqlSessionFactoryBuilder.build() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(reader, props);</span><br><span class="line"><span class="comment">// ... or ...</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>.build(reader, environment, props);</span><br></pre></td></tr></table></figure>



<h3 id="2-2-settings"><a href="#2-2-settings" class="headerlink" title="2.2. settings"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#settings">2.2. settings</a></h3><table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">æè¿°</th>
<th align="left">æœ‰æ•ˆå€¼</th>
<th align="left">é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody><tr>
<td align="left">cacheEnabled</td>
<td align="left">å…¨å±€å¯ç”¨æˆ–ç¦ç”¨æ­¤é…ç½®ä¸‹ä»»ä½•æ˜ å°„å™¨ä¸­çš„ä»»ä½•ç¼“å­˜</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">lazyLoadingEnabled</td>
<td align="left">å…¨å±€æ‡’åŠ è½½ã€‚è¯¥å€¼å¯ä»¥è¢« <code>fetchType</code> å–ä»£ã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">aggressiveLazyLoading</td>
<td align="left">å¯ç”¨åï¼Œä»»ä½•æ–¹æ³•è°ƒç”¨éƒ½ä¼šåŠ è½½å¯¹è±¡çš„å»¶è¿Ÿå±æ€§ã€‚å¦åˆ™ï¼Œæ¯ä¸ªå±æ€§æŒ‰éœ€åŠ è½½ã€‚å…·ä½“è§ <code>lazyLoadTriggerMethods</code></td>
<td align="left"></td>
<td align="left">false (true in â‰¤3.4.1)</td>
</tr>
<tr>
<td align="left">useColumnLabel</td>
<td align="left">ä½¿ç”¨åˆ—æ ‡ç­¾è€Œä¸æ˜¯åˆ—åã€‚ä¸åŒçš„é©±åŠ¨è¡¨ç°ä¸åŒã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">mapUnderscoreToCamelCase</td>
<td align="left">ä¸‹åˆ’çº¿åˆ°é©¼å³°è½¬æ¢</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">autoMappingBehavior</td>
<td align="left">æ˜¯å¦è‡ªåŠ¨æ˜ å°„ï¼ŒSpring MyBatis é»˜è®¤ä¸º PARTIALï¼Œæ³¨æ„ã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">defaultExecutorType</td>
<td align="left">é…ç½®é»˜è®¤çš„æ‰§è¡Œå™¨ã€‚SIMPLE REUSE BATCH</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">localCacheScope</td>
<td align="left">æœ¬åœ°ç¼“å­˜çš„ä½œç”¨åŸŸ</td>
<td align="left">SESSION | STATEMENT</td>
<td align="left">SESSION</td>
</tr>
<tr>
<td align="left">logImpl</td>
<td align="left">æŒ‡å®š MyBatis åº”è¯¥ä½¿ç”¨çš„æ—¥å¿—å®ç°ã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™è‡ªåŠ¨å‘ç°ã€‚</td>
<td align="left">SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td>
<td align="left">Not set</td>
</tr>
</tbody></table>
<h3 id="2-3-typeAliases"><a href="#2-3-typeAliases" class="headerlink" title="2.3. typeAliases"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeAliases">2.3. typeAliases</a></h3><p>åˆ«åæ˜¯ Java ç±»å‹çš„çŸ­åç§°ï¼Œå¯ä»¥ç®€å•åœ°å‡å°‘å®Œå…¨é™å®šç±»åçš„å†—ä½™è¾“å…¥ã€‚æ”¯æŒ <code>&lt;typeAlias&gt;</code> å’Œ <code>&lt;package&gt;</code> é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æŒ‡å®š MyBatis æœç´¢ bean çš„åŒ…ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨åŒ…ä¸­çš„<strong>æ‰€æœ‰ bean</strong>ï¼Œéƒ½ä¼šä½¿ç”¨ bean çš„å°å†™éé™å®šç±»åä½œä¸ºåˆ«åã€‚å…¶ä¸­ï¼Œ<code>domain.blog.Author</code> å°†è¢«æ³¨å†Œä¸º <code>author</code>ã€‚ç‰¹æ®Šåœ°ï¼Œå¦‚æœå‘ç° @Alias æ³¨è§£ï¼Œåˆ™å…¶å€¼å°†ç”¨ä½œåˆ«åï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰è®¸å¤šå†…ç½®çš„ Java ç±»å‹çš„åˆ«åã€‚å®ƒä»¬éƒ½æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ã€‚å…·ä½“å‚è§ç±» <code>TypeAliasRegistry</code></p>
<h3 id="2-4-typeHandlers"><a href="#2-4-typeHandlers" class="headerlink" title="2.4. typeHandlers"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeHandlers">2.4. typeHandlers</a></h3><p>typeHandler ç”¨äºä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<ul>
<li>å½“ MyBatis åœ¨ PreparedStatement è®¾ç½®å‚æ•°æ—¶ã€‚å‚è§ <code>DefaultParameterHandler</code></li>
<li>ä» ResultSet æ£€ç´¢å€¼ã€‚å‚è§ <code>DefaultResultSetHandler</code></li>
</ul>
<blockquote>
<p>è‡ªä»  3.4.5, MyBatis é»˜è®¤æ”¯æŒ JSR-310 (Date and Time API)</p>
</blockquote>
<p>åœ¨ MyBatis ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ª <code>TypeHandlerRegistry</code> ç»„ä»¶ï¼Œå…¶ç»´æŠ¤äº†ä¸€ä¸ª Map ç»“æ„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Type, Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt;&gt; typeHandlerMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>è¯¥ Map çš„ key æ˜¯ <code>java.lang.reflect.Type</code> ç±»å‹å¯¹è±¡ï¼Œvalue åˆæ˜¯ä¸€ä¸ª Mapï¼ˆç§°ä¸º sub mapï¼‰ï¼Œé€šå¸¸ç”¨äºä¼ å…¥ä¸€ä¸ª Class å¯¹è±¡ï¼Œå¾—åˆ° Jdbc ç±»å‹æ”¯æŒçš„ç±»å‹å¤„ç†å™¨ï¼Œsub map é€šå¸¸è¿˜ä¼šå­˜å‚¨ä¸€ä¸ª key ä¸º null çš„é”®å€¼å¯¹ï¼Œç”¨äºåŒ¹é…é»˜è®¤çš„å¤„ç†å™¨ã€‚</p>
<blockquote>
<p>typeHandlers å‡ ä¹å¾ˆå°‘è‡ªå·±å®šä¹‰æ‰©å±•ï¼Œä½†å°‘éƒ¨åˆ†æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„ï¼Œä¾‹å¦‚ï¼šä¸æ¶‰åŠæŸ¥è¯¢çš„ä¸€å¯¹å¤šå…³ç³»ã€setString çš„ä¹±ç é—®é¢˜ã€‚</p>
</blockquote>
<h3 id="2-5-Handling-Enums"><a href="#2-5-Handling-Enums" class="headerlink" title="2.5. Handling Enums"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#Handling_Enums">2.5. Handling Enums</a></h3><h3 id="2-6-objectFactory"><a href="#2-6-objectFactory" class="headerlink" title="2.6. objectFactory"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#objectFactory">2.6. objectFactory</a></h3><p>ä½¿ç”¨ ObjectFactory è¿›è¡Œåˆ›å»ºç»“æœå¯¹è±¡çš„æ–°å®ä¾‹ã€‚ä¸ä»…æ”¯æŒæ— å‚æ„é€ å™¨çš„åˆ›å»ºï¼Œä¹Ÿæ”¯æŒæœ‰å‚æ„é€ å™¨åˆ›å»ºã€‚</p>
<h3 id="2-7-plugins"><a href="#2-7-plugins" class="headerlink" title="2.7. plugins"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#plugins">2.7. plugins</a></h3><h3 id="2-8-environments"><a href="#2-8-environments" class="headerlink" title="2.8. environments"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#environments">2.8. environments</a></h3><p>MyBatis å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒã€‚è¿™æœ‰åŠ©äºä½ ä»¥ä»»ä½•åŸå› å°† SQL æ˜ å°„åˆ°ä¸åŒçš„æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¯¹äºå¼€å‘ï¼Œæµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒç”±ä¸åŒçš„é…ç½®ã€‚æˆ–è€…ï¼Œä½ å¯èƒ½æœ‰å¤šä¸ªè¡¨ç»“æ„ç›¸åŒçš„ç”Ÿäº§æ•°æ®åº“ï¼Œå¹¶ä¸”ä½ å¸Œæœ›ä¸ºä¸¤è€…ä½¿ç”¨ç›¸åŒçš„ SQL æ˜ å°„ã€‚</p>
<p><strong>æ³¨æ„</strong> å°½ç®¡ä½ å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ˜¯ä½ åªå¯ä»¥ä¸ºæ¯ä¸ª SqlSessionFactory é€‰æ‹©ä¸€ä¸ªã€‚å› æ­¤ï¼Œå¦‚æœè¦è¿æ¥åˆ°å¤šä¸ªæ•°æ®åº“ï¼Œåˆ™éœ€è¦ä¸ºæ¯ä¸ªæ•°æ®åº“åˆ›å»ºä¸€ä¸ª SqlSessionFactoryã€‚</p>
<ul>
<li><strong>æ¯ä¸ªæ•°æ®åº“ä¸€ä¸ª SqlSessionFactory å®ä¾‹</strong></li>
</ul>
<p>ä¼ é€’ç»™ build() æ–¹æ³•å‚æ•° environment å¯ä»¥æŒ‡å®šç¯å¢ƒï¼Œå¦åˆ™ä½¿ç”¨ default ç¯å¢ƒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader, environment);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader, environment, properties);</span><br></pre></td></tr></table></figure>


<p><strong>transactionManager</strong></p>
<p>MyBatis åŒ…å«äº†ä¸¤ç§äº‹åŠ¡ç®¡ç†å™¨ï¼ŒJDBC | MANAGED</p>
<p><strong>dataSource</strong></p>
<p>dataSource å…ƒç´ ä½¿ç”¨æ ‡å‡† JDBC DataSource æ¥å£é…ç½® JDBC Connection å¯¹è±¡ã€‚</p>
<p>å¤§å¤šæ•° MyBatis åº”ç”¨ç¨‹åºå°†æ ¹æ®ç¤ºä¾‹ä¸­é…ç½® dataSourceã€‚ä½†æ˜¯ï¼Œå®ƒä¸æ˜¯å¿…éœ€çš„ã€‚ä½†æ˜¯ï¼Œè¦ä¿ƒè¿›æ‡’åŠ è½½ï¼Œæ•°æ®æºæ˜¯éœ€è¦çš„ã€‚</p>
<p>æœ‰ä¸‰ç§å†…ç½®çš„æ•°æ®æºç±»å‹ï¼ŒUNPOOLED | POOLED | JNDI</p>
<p><strong>UNPOOLED</strong> æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œæ•°æ®æºéƒ½æ˜¯ç®€å•åœ°æ‰“å¼€å’Œå…³é—­ä¸€ä¸ªé“¾æ¥ã€‚è™½ç„¶å®ƒæœ‰ç‚¹æ…¢ï¼Œä½†æ˜¯å¯¹äºä¸éœ€è¦ç«‹å³å¯ç”¨è¿æ¥åœ°ç®€å•åº”ç”¨æ¥è¯´ï¼Œæ˜¯ä¸ªä¸é”™åœ°é€‰æ‹©ã€‚ä¸åŒçš„æ•°æ®åº“ä¹Ÿä¸åŒï¼Œå› æ­¤å¯¹äºä¸€äº›æ± åŒ–ä¸å¤ªé‡è¦çš„æ•°æ®åº“ï¼Œè¯¥é…ç½®ä¼šæ˜¯æ¯”è¾ƒç†æƒ³çš„ã€‚UNPOOLED æ•°æ®æºå…·æœ‰ä»¥ä¸‹å±æ€§éœ€è¦é…ç½®ï¼š</p>
<ul>
<li><code>driver</code> </li>
<li><code>url</code></li>
<li><code>username</code></li>
<li><code>password</code></li>
<li><code>defaultTransactionIsolationLevel</code> è¿æ¥çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«</li>
<li><code>defaultNetworkTimeout</code> é»˜è®¤ç½‘ç»œè¶…æ—¶å€¼ï¼Œä»¥ç­‰å¾…æ•°æ®åº“æ“ä½œå®Œæˆï¼Œå•ä½æ¯«ç§’</li>
</ul>
<p><strong>POOLED</strong> DataSource æ± åŒ– JDBC Connection å¯¹è±¡ï¼Œä»¥é¿å…åˆ›å»ºæ–°è¿æ¥å®ä¾‹æ‰€éœ€è¦çš„åˆå§‹åŒ–å’Œè®¤è¯æ—¶é—´ã€‚è¿™æ˜¯ä¸€ç§å½“å‰ web åº”ç”¨ä¸­æµè¡Œçš„æ–¹å¼ï¼Œå¯ä»¥è·å¾—æœ€å¿«çš„å“åº”ã€‚</p>
<p>é™¤äº†ä¸Šé¢çš„ï¼ˆUNPOOLEDï¼‰å±æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šå±æ€§å¯ç”¨äºé…ç½® POOLED æ•°æ®æºï¼š</p>
<ul>
<li><code>poolMaximumActiveConnections</code></li>
<li><code>poolMaximumIdleConnections</code></li>
<li><code>poolMaximumCheckoutTime</code></li>
<li><code>poolTimeToWait</code></li>
<li><code>poolMaximumLocalBadConnectionTolerance</code></li>
<li><code>poolPingQuery</code> ping æŸ¥è¯¢è¢«å‘é€åˆ°æ•°æ®åº“ä»¥éªŒè¯è¿æ¥å¤„äºè‰¯å¥½çš„å·¥ä½œçŠ¶æ€ï¼Œå¹¶ä¸”å·²å‡†å¤‡å¥½æ¥å—è¯·æ±‚ã€‚é»˜è®¤å€¼ï¼šâ€NO PING QUERY SETâ€ï¼Œè¿™å›å¼•èµ·å¤§å¤šæ•°æ•°æ®åº“é©±åŠ¨ä»¥é”™è¯¯ä¿¡æ¯äº§ç”Ÿå¤±è´¥ã€‚</li>
<li><code>poolPingEnabled</code> å¼€å¯æˆ–ç¦ç”¨ ping æŸ¥è¯¢ã€‚å¦‚æœå¼€å¯ï¼Œä½ å¿…é¡»ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ SQL è¯­å¥ï¼ˆæœ€å¥½å¾ˆå¿«ï¼‰è®¾ç½® <code>poolPingQuery</code> å±æ€§ã€‚é»˜è®¤ï¼šfalse</li>
<li><code>poolPingConnectionsNotUsedFor</code></li>
</ul>
<p><strong>JNDI</strong> æ­¤ DataSource çš„å®ç°æ—¨åœ¨ä¸å®¹å™¨ï¼ˆå¦‚ EJB æˆ–è€…åº”ç”¨æœåŠ¡å™¨ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œè¯¥æ•°æ®æºå¯ä»¥é…ç½®å†…éƒ¨æˆ–å¤–éƒ¨æ•°æ®æºï¼Œå¹¶ä¸”åœ¨ JNDI ä¸Šä¸‹æ–‡ä¸­å¯¹å…¶è¿›è¡Œå¼•ç”¨ã€‚è¯¥æ•°æ®æºé…ç½®åªéœ€è¦ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li>initial_context</li>
<li>data_source</li>
</ul>
<h3 id="2-9-databaseIdProvider"><a href="#2-9-databaseIdProvider" class="headerlink" title="2.9. databaseIdProvider"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#databaseIdProvider">2.9. databaseIdProvider</a></h3><h3 id="2-10-mappers"><a href="#2-10-mappers" class="headerlink" title="2.10. mappers"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#mappers">2.10. mappers</a></h3><p>å®šä¹‰æ˜ å°„çš„ SQL è¯­å¥ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ MyBatis åœ¨å“ªé‡Œæ‰¾åˆ°ä»–ä»¬ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li>ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨</li>
<li>å®Œå…¨é™å®š url å¼•ç”¨ï¼ŒåŒ…æ‹¬ <code>file:///</code></li>
<li>ç±»å</li>
<li>åŒ…å</li>
</ul>
<h4 id="æ–¹å¼1-ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨"><a href="#æ–¹å¼1-ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨" class="headerlink" title="æ–¹å¼1 ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨"></a>æ–¹å¼1 ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="æ–¹å¼2-å®Œå…¨é™å®š-url-å¼•ç”¨"><a href="#æ–¹å¼2-å®Œå…¨é™å®š-url-å¼•ç”¨" class="headerlink" title="æ–¹å¼2 å®Œå…¨é™å®š url å¼•ç”¨"></a>æ–¹å¼2 å®Œå…¨é™å®š url å¼•ç”¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="æ–¹å¼3-ç±»å"><a href="#æ–¹å¼3-ç±»å" class="headerlink" title="æ–¹å¼3 ç±»å"></a>æ–¹å¼3 ç±»å</h4><p>æ³¨å†Œçš„é…ç½®ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨å†Œæºç åˆ†æ</strong></p>
<p>ä¾é ç»„ä»¶ <code>MapperRegistry</code> è¿›è¡Œæ³¨å†Œã€‚ä¸éœ€è¦å°è¯•é…ç½®ä¸¤ä¸ªä¸€æ ·çš„ç±»ï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°å¼‚å¸¸ã€‚</p>
<p>ä¾é  <code>MapperAnnotationBuilder</code> è§£ææ³¨è§£ã€‚æ³¨è§£è§£æéƒ¨åˆ†ï¼Œé€šè¿‡åå°„ Class.getMethod() è·å–åˆ°æ¥å£æ‰€æœ‰çš„æ–¹æ³•ã€‚</p>
<p>MapperAnnotationBuilder ä¼šå§”æ´¾å†…éƒ¨çš„ MapperBuilderAssistant è¿›è¡Œè¯­å¥æ·»åŠ ï¼Œè¿˜ä¼šç¼“å­˜åˆ° MapperBuilderAssistant  ä¸­</p>
<h4 id="æ–¹å¼4-åŒ…å"><a href="#æ–¹å¼4-åŒ…å" class="headerlink" title="æ–¹å¼4 åŒ…å"></a>æ–¹å¼4 åŒ…å</h4><p>æ³¨å†Œè¯¥åŒ…ä¸‹æ‰€æœ‰æ¥å£ä¸º mapper</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½ åœ¨æŒ‡å®šé package çš„é…ç½®æ—¶ï¼Œåªèƒ½é…ç½® urlï¼Œnameï¼Œresource ä¹‹ä¸€çš„å±æ€§ï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°å¼‚å¸¸ã€‚</p>
<h2 id="3-Mapper-XML-Files"><a href="#3-Mapper-XML-Files" class="headerlink" title="3. Mapper XML Files"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#">3. Mapper XML Files</a></h2><h3 id="3-1-select"><a href="#3-1-select" class="headerlink" title="3.1. select"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#select">3.1. select</a></h3><p>å¯¹äºå½¢å¦‚ <code>#&#123;id&#125;</code> è¿™æ ·çš„æ ‡è®°ï¼Œè¿™å‘Šè¯‰ MyBatis éœ€è¦åˆ›å»ºä¸€ä¸ª PreparedStatement çš„å‚æ•°ã€‚ä½¿ç”¨ JDBCï¼Œè¿™æ ·çš„å‚æ•°ä¼šåœ¨ SQL ä¸­è¯†åˆ«ä¸º â€œ?â€ï¼Œä¼ é€’ç»™ PreparedStatementã€‚</p>
<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">åœ¨è¯¥ namesapce ä¸‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯ä»¥ç”¨äºå¼•ç”¨è¯¥è¯­å¥ï¼Œå³ Statement IDã€‚</td>
</tr>
<tr>
<td align="left">parameterType</td>
<td align="left">å°†ä¼ é€’åˆ°æ­¤è¯­å¥çš„å‚æ•°çš„å®Œå…¨é™å®šç±»åæˆ–åˆ«åã€‚å¯é€‰ï¼Œå› ä¸º MyBatis å¯ä»¥é€šè¿‡ä¼ é€’ç»™è¯­å¥çš„å®é™…å‚æ•°å¾—åˆ° <code>TypeHandler</code></td>
</tr>
<tr>
<td align="left">resultType</td>
<td align="left">ä»æ­¤è¯­å¥è¿”å›çš„é¢„æœŸç±»å‹çš„å®Œå…¨é™å®šç±»åæˆ–åˆ«åã€‚åœ¨é›†åˆçš„æƒ…å†µä¸‹ï¼Œè¿™åº”è¯¥æ˜¯é›†åˆåŒ…å«çš„ç±»å‹ï¼Œè€Œä¸æ˜¯é›†åˆç±»å‹ã€‚ä½¿ç”¨ <code>resultType</code> æˆ–è€… <code>resultMap</code>ï¼Œä¸å¯ä»¥éƒ½ç”¨ã€‚</td>
</tr>
<tr>
<td align="left">resultMap</td>
<td align="left">å¤–éƒ¨ <code>resultMap</code> çš„å¼•ç”¨ã€‚ä½¿ç”¨ <code>resultMap</code> æˆ–è€… <code>resultType</code>ï¼Œä¸å¯ä»¥éƒ½ç”¨ã€‚</td>
</tr>
<tr>
<td align="left">flushCache</td>
<td align="left">è®¾ç½®ä¸º true å°†å¯¼è‡´å½“è°ƒç”¨æ­¤è¯­å¥æ—¶ä¼šåˆ·æ–° Local å’Œ 2 çº§ç¼“å­˜ã€‚å¯¹äº select é»˜è®¤æ˜¯ false</td>
</tr>
<tr>
<td align="left">useCache</td>
<td align="left">è®¾ç½®ä¸º true å°†å¯¼è‡´è¯¥è¯­å¥çš„ç»“æœç¼“å­˜åœ¨ 2 çº§ç¼“å­˜ã€‚å¯¹äº select è¯­å¥é»˜è®¤ä¸º: <code>true</code></td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">é©±åŠ¨ç­‰å¾…æ•°æ®åº“è¿”å›æ•°æ®ï¼Œåœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ <code>unset</code>ï¼ˆé©±åŠ¨å†³å®šï¼‰</td>
</tr>
<tr>
<td align="left">fetchSize</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">statementType</td>
<td align="left">å¯é€‰å€¼ï¼šSTATEMENT, PREPARED, CALLABLEã€‚é»˜è®¤å€¼ï¼šPREPARED</td>
</tr>
<tr>
<td align="left">resultSetType</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">databaseId</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">resultOrdered</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">resultSets</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="3-2-insert-update-and-delete"><a href="#3-2-insert-update-and-delete" class="headerlink" title="3.2. insert, update and delete"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#insert.2C_update_and_delete">3.2. insert, update and delete</a></h3><p>MyBatis åŠ è½½ Mapper çš„æ—¶å€™ä¼šå°†è¯»å–åˆ°çš„è¯­å¥ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Configuration çš„å±æ€§ <code>mappedStatements</code> ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, MappedStatement&gt; mappedStatements;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>MappedStatement</code> åˆèƒ½å¤Ÿè·å– <code>BoundSql</code></p>
<h3 id="ä¸€å¯¹å¤šå…³è”"><a href="#ä¸€å¯¹å¤šå…³è”" class="headerlink" title="ä¸€å¯¹å¤šå…³è”"></a>ä¸€å¯¹å¤šå…³è”</h3><ul>
<li>collection</li>
</ul>
<p>æ”¯æŒåˆ†æ­¥æŸ¥è¯¢å’Œå…³è”æŸ¥è¯¢</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.cannedbread.dictionary.pojo.domain.DictionaryTypeDO&quot;</span> <span class="attr">id</span>=<span class="string">&quot;doctionaryType&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;t_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;type&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;t_description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;dictionaryTypeList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.cannedbread.dictionary.pojo.domain.DictionaryValueDO&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;v_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;v_label&quot;</span> <span class="attr">property</span>=<span class="string">&quot;label&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;v_value&quot;</span> <span class="attr">property</span>=<span class="string">&quot;value&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-3-Parameters"><a href="#3-3-Parameters" class="headerlink" title="3.3. Parameters"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Parameters">3.3. Parameters</a></h3><p>å‚æ•°ï¼ŒæŒ‡ä¼ é€’ç»™è¯­å¥çš„å‚æ•°ã€‚å‚æ•°å¯ä»¥è®¤ä¸ºæœ‰ 2 ç§ï¼š</p>
<ul>
<li><p>ç®€æ˜“ï¼ˆåŸå§‹ï¼‰æ•°æ®ç±»å‹ã€‚ Integerã€String ç­‰æ²¡æœ‰å±æ€§çš„å€¼ã€‚</p>
</li>
<li><p>å¤åˆæ•°æ®ç±»å‹ã€‚å¯ä»¥ç†è§£ä¸ºæ˜¯ç”±ç®€æ˜“æ•°æ®ç±»å‹ç»„åˆè€Œæˆçš„ç±»ã€‚</p>
</li>
</ul>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>#&#123;id&#125;</code> è¿™ç§æ–¹å¼å¼•ç”¨å‚æ•°ã€‚ä½†æ˜¯ï¼Œå‚æ•°å¯ä»¥æ›´å…·ä½“åœ°å¼•ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;property,javaType=<span class="type">int</span>,jdbcType:NUMBERIC&#125;</span><br></pre></td></tr></table></figure>
<p><code>javaType</code> åŸºæœ¬å¯ä»¥æ€»æ˜¯ä»å‚æ•°å¯¹è±¡ä¸­ç¡®å®šï¼Œé™¤éè¯¥å¯¹è±¡æ˜¯ <code>HashMap</code>ï¼Œé‚£ä¹ˆéœ€è¦æ˜¾å¼æŒ‡å®š <code>javaType</code> ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ TypeHandlerã€‚</p>
<ul>
<li>ä¼ å…¥ List</li>
</ul>
<p>å¼•ç”¨åç§°å¿…é¡»ä¸º <code>list</code>ï¼Œè·å–é•¿åº¦ï¼š<code>list.size</code>ï¼Œè·å–ç¬¬ n ä¸ªå…ƒç´ ï¼šlist[n]</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;list != null and list.size != 0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä¼ å…¥å¤šä¸ªå€¼</li>
</ul>
<p>å¤šä¸ªå‚æ•°ä¼šå°è£…æˆ Mapï¼Œkey ä¸º param1, param2, â€¦</p>
<p>å¼•ç”¨æ–¹å¼ï¼š<code>#&#123;param1&#125;</code>ã€<code>#&#123;param2.password&#125;</code></p>
<ul>
<li>ä¼ å…¥ Map</li>
</ul>
<p>å¯¹ XML ä¸­æ˜ å°„çš„è¯­å¥è¿›è¡Œè§£æä¹‹åï¼Œèƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ª <code>List&lt;ParameterMapping&gt;</code>ï¼Œå…¶ä¸­æ”¶é›†æ‰€æœ‰ <code>#&#123;&#125;</code> å ä½ç¬¦ã€‚</p>
<p>è¿™äº›ç»“æ„ä¹‹åä¼šä¼ é€’ç»™ <code>StatementHandler</code>ï¼Œé€šå¸¸æ˜¯ <code>PreparedStatementHandler</code>ï¼Œä¹‹åé€šè¿‡ handler è¿›è¡Œå‚æ•°è®¾ç½®ã€‚</p>
<h3 id="3-4-Result-Maps"><a href="#3-4-Result-Maps" class="headerlink" title="3.4. Result Maps"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Result_Maps">3.4. Result Maps</a></h3><p>å¯¹äºå¦‚ä¸‹æ˜ å°„è¯­å¥ä¾‹å­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id, username, hashedPassword</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ® <code>resultType</code> å±æ€§æ‰€æŒ‡å®šçš„ï¼Œè¿™æ ·çš„è¯­å¥ä¼šç®€å•åœ°å°†æ‰€æœ‰åœ°åˆ—è‡ªåŠ¨æ˜ å°„åˆ° <code>HashMap</code> çš„ key ä¸Šã€‚ä½†æ˜¯ï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œ<code>HashMap</code>å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é¢†åŸŸæ¨¡å‹ã€‚åº”ç”¨ç¨‹åºæ›´æœ‰å¯èƒ½ä½¿ç”¨ Java Bean æˆ–è€… POJOã€‚è€ƒè™‘å¦‚ä¸‹çš„ Java Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String hashedPassword;</span><br><span class="line">  <span class="comment">// Getter Setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºäº Java Bean è§„èŒƒï¼Œä¸Šé¢çš„ç±»æœ‰ 3 ä¸ªå±æ€§ï¼šid, username, hashedPasswordã€‚è¿™äº›ä¸ SELECT è¯­å¥ä¸­çš„åˆ—å<strong>å®Œå…¨åŒ¹é…</strong>ã€‚è¿™æ ·ï¼ŒJava Bean å¯ä»¥åƒ HashMap ä¸€æ ·ï¼Œç®€å•åœ°æ˜ å°„åˆ° ResultSetã€‚</p>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒMyBatis è‡ªåŠ¨åœ¨å¹•ååˆ›å»º ResultMap ä»¥å°†åˆ—ååŸºäºåç§°åœ°è‡ªåŠ¨æ˜ å°„åˆ° Java Bean çš„å±æ€§ã€‚</p>
<p><strong>åˆ—åä¸å±æ€§åä¸åŒ¹é…çš„æƒ…å†µå¦‚ä½•å¤„ç† ?</strong></p>
<ul>
<li>æ ‡å‡† SQL è¯­æ³•ï¼ŒSELECT è¯­å¥åˆ«å</li>
<li>ä½¿ç”¨è‡ªå®šä¹‰ <code>&lt;Result Map&gt;</code></li>
</ul>
<h4 id="3-4-1-Advanced-Result-Maps"><a href="#3-4-1-Advanced-Result-Maps" class="headerlink" title="3.4.1. Advanced Result Maps"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Advanced_Result_Maps">3.4.1. Advanced Result Maps</a></h4><p>Result Map æ˜¯ MyBatis å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥è‡ªç”±æ˜ å°„ç»“æœã€‚</p>
<h4 id="3-4-2-resultMap"><a href="#3-4-2-resultMap" class="headerlink" title="3.4.2. resultMap"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#resultMap">3.4.2. resultMap</a></h4><p><code>&lt;resultMap&gt;</code> å…ƒç´ çš„æ¦‚è§ˆï¼š</p>
<ul>
<li><code>&lt;constructor&gt;</code> ç”¨äºåœ¨å®ä¾‹åŒ–æ—¶å°†ç»“æœæ³¨å…¥ç±»çš„æ„é€ å‡½æ•°<ul>
<li><code>idArg</code> ID å‚æ•°ï¼Œæ ‡è¯† ID å°†æœ‰åŠ©äºæå‡æ•´ä½“æ€§èƒ½</li>
<li><code>arg</code> æ™®é€šç»“æœå‚æ•°æ³¨å…¥</li>
</ul>
</li>
<li><code>&lt;id&gt;</code> ä¸€ä¸ª ID ç»“æœï¼Œæ ‡è¯† ID å°†ä¼šæé«˜æ•´ä½“æ€§èƒ½</li>
<li><code>&lt;result&gt;</code> æ™®é€šç»“æœå‚æ•°</li>
<li><code>&lt;association&gt;</code> å¤åˆç±»å‹å…³è”ï¼Œè®¸å¤šç»“æœä¼šæ±‡æ€»åˆ°è¯¥ç±»å‹<ul>
<li>åµŒå¥—ç»“æœæ˜ å°„ - association æœ¬èº«å°±æ˜¯ <code>resultMap</code>ï¼Œæˆ–è€…å¯ä»¥å¼•ç”¨å…¶ä»–çš„ <code>resultMap</code></li>
</ul>
</li>
<li><code>&lt;collection&gt;</code> å¤åˆç±»å‹çš„é›†åˆ<ul>
<li>åµŒå¥—ç»“æœæ˜ å°„ - collection æœ¬èº«å°±æ˜¯ <code>resultMap</code>ï¼Œæˆ–è€…å¯ä»¥å¼•ç”¨å…¶ä»–çš„ <code>resultMap</code></li>
</ul>
</li>
<li><code>&lt;discriminator&gt;</code> ä½¿ç”¨ç»“æœçš„å€¼æ¥ç¡®å®šè¦ä½¿ç”¨çš„ <code>resultMap</code></li>
</ul>
<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">å½“å‰å‘½åç©ºé—´ä¸‹å¼•ç”¨æ­¤ result map çš„å”¯ä¸€æ ‡è¯†ç¬¦</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">Java çš„å®Œå…¨é™å®šåï¼Œæˆ–è€…åˆ«å</td>
</tr>
<tr>
<td align="left">autoMapping</td>
<td align="left">å¦‚æœå­˜åœ¨è¯¥å±æ€§ï¼ŒMyBatis ä¼šä¸ºè¯¥ result map å¯ç”¨æˆ–ç¦ç”¨è‡ªåŠ¨æ˜ å°„</td>
</tr>
</tbody></table>
<h4 id="3-4-3-id-amp-result"><a href="#3-4-3-id-amp-result" class="headerlink" title="3.4.3. id &amp; result"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#id_.26_result">3.4.3. id &amp; result</a></h4><p>id å’Œ result éƒ½å¯ä»¥æ˜ å°„ä¸€ä¸ªåˆ—çš„å€¼åˆ°ä¸€ä¸ªç®€å•æ•°æ®ç±»å‹çš„å­—æ®µï¼ˆString,int,double,Date,â€¦ï¼‰</p>
<h4 id="association"><a href="#association" class="headerlink" title="association"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#association">association</a></h4><p>association å…ƒç´ å¤„ç† â€œhas-oneâ€ ç±»å‹å…³ç³»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåšå®¢æœ‰ä¸€ä¸ªä½œè€…ã€‚<code>&lt;association&gt;</code> æ˜ å°„åƒå…¶ä»– <code>&lt;result&gt;</code> ä¸€æ ·å·¥ä½œã€‚ä½ å¯ä»¥æŒ‡å®š <code>property</code>, <code>javaType</code>, <code>jdbcType</code>, <code>typeHandler</code>ã€‚</p>
<p>association ä¸åŒä¹‹å¤„åœ¨äºï¼Œä½ éœ€è¦å‘Šè¯‰ MyBatis å¦‚ä½•åŠ è½½å…³è”æ•°æ®ï¼Œæ”¯æŒ 2 ç§æ–¹å¼ï¼š</p>
<ul>
<li>Nested Selectï¼šåµŒå¥—æŸ¥è¯¢ï¼Œæˆ–è€…åµŒå¥—å­æŸ¥è¯¢ã€‚é€šè¿‡æ‰§è¡Œå¦ä¸€ä¸ªæ˜ å°„ SQL è¯­å¥è¿”å›æ‰€éœ€çš„<strong>å¤åˆç±»å‹</strong>ã€‚</li>
<li>Nested Resultsï¼šåµŒå¥—ç»“æœã€‚é€šè¿‡ä½¿ç”¨åµŒå¥—çš„ç»“æœæ˜ å°„æ¥å¤„ç† join ç»“æœçš„é‡å¤å­é›†ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">property</td>
<td align="left">å­—æ®µæˆ–å±æ€§ã€‚å¦‚æœç»™å®šåç§°å­˜åœ¨ Java Bean åŒ¹é…çš„å±æ€§ï¼Œåˆ™ä¼šä½¿ç”¨ã€‚å¦åˆ™ï¼ŒMyBatis ä¼šå¯»æ‰¾ç»™å®šåç§°çš„å­—æ®µã€‚</td>
</tr>
<tr>
<td align="left">javaType</td>
<td align="left">å®Œå…¨é™å®šçš„ Java ç±»åï¼ˆæˆ–è€… aliasï¼‰ã€‚å¦‚æœä½ æ˜ å°„åˆ° Java Beanï¼ŒMyBatis ä¼šå¼„æ¸…æ¥šç±»å‹ã€‚å¦‚æœä½ æ˜ å°„åˆ° HashMapï¼Œä½ éœ€è¦æŒ‡å®š javaType ä»¥ç¡®ä¿æ‰€éœ€çš„è¡Œä¸ºã€‚</td>
</tr>
<tr>
<td align="left">jdbcType</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">typeHandler</td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="Nested-Select-for-Association"><a href="#Nested-Select-for-Association" class="headerlink" title="Nested Select for Association"></a>Nested Select for Association</h4><table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">column</td>
<td align="left">å°†è¦ä¼ é€’ç»™åµŒå¥—è¯­å¥çš„åˆ—åæˆ–è€…åˆ«åã€‚<strong>å¯ä»¥ç¡®å®šå”¯ä¸€ä¸€æ¡è®°å½•ã€‚</strong><br>æ³¨æ„ï¼šä¸ºäº†å¤„ç†å¤åˆé”®ï¼Œå¯ä»¥ä½¿ç”¨è¯­æ³• <code>column=&quot;prop1=col1,prop2=col2&quot;</code> æŒ‡å®šå¤šä¸ªåˆ—åä¼ é€’ç»™åµŒå¥—çš„ select è¯­å¥</td>
</tr>
<tr>
<td align="left">select</td>
<td align="left">æ˜ å°„è¯­å¥çš„ IDï¼Œå°†ä¼šåŠ è½½éœ€è¦çš„å¤æ‚ç±»å‹</td>
</tr>
<tr>
<td align="left">fetchType</td>
<td align="left">å¯é€‰ã€‚æœ‰æ•ˆå€¼æ˜¯ lazy å’Œ eagerã€‚å¦‚æœå­˜åœ¨ï¼Œå®ƒä¼šè¦†ç›–å…¨å±€é…ç½®å‚æ•° <code>lazyLoadingEnabled</code></td>
</tr>
</tbody></table>
<blockquote>
<p>åµŒå¥— SELECT å¿…é¡»ç¡®ä¿ç»“æœé›†çš„æ•°é‡å°äºç­‰äº 1 ä¸ªï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°å¼‚å¸¸ï¼š<br>org.apache.ibatis.executor.ExecutorException: Statement returned more than one row, where no more than one was expected.</p>
</blockquote>
<p><strong>å®˜æ–¹æç¤º</strong> è™½ç„¶è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ï¼Œå¯¹äºå¤§é‡æ•°æ®é›†æˆ–è€…åˆ—è¡¨æ€§èƒ½å¹¶ä¸å¥½ã€‚è¿™ç§é—®é¢˜ä¹Ÿè¢«ç§°ä¹‹ä¸º â€œN + 1 Select é—®é¢˜â€ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒN + 1 Select é—®é¢˜æ˜¯ç”±ç±»ä¼¼å¦‚ä¸‹å¼•èµ·çš„ï¼š</p>
<ul>
<li>ä½ æ‰§è¡Œå•ä¸ª SQL æ£€ç´¢å‡ºä¸€ä¸ªè®°å½•åˆ—è¡¨ï¼ˆ+1ï¼‰</li>
<li>å¯¹äºæ¯ä¸ªè¿”å›çš„è®°å½•ï¼Œä½ æ‰§è¡Œ select è¯­å¥æ¥åŠ è½½æ¯ä¸ªçš„ç»†èŠ‚ï¼ˆNï¼‰</li>
</ul>
<p>è¯¥é—®é¢˜ä¼šå¯¼è‡´å¤§é‡ SQL æ‰§è¡Œï¼Œå¹¶ä¸æ˜¯å¯å–çš„ã€‚MyBatis å¯ä»¥æ‹¦æˆªåœ¨è¿™äº›æŸ¥è¯¢è¯­å¥ï¼Œå› æ­¤ä½ å¯èƒ½ä¼šå¿½ç•¥è¿™äº›è¯­å¥çš„å¼€é”€ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åŠ è½½è¿™æ ·çš„åˆ—è¡¨ï¼Œç„¶åç«‹å³è¿­ä»£å®ƒè®¿é—®åµŒå¥—æ•°æ®ï¼Œåˆ™ä¼šè°ƒç”¨æ‰€æœ‰å»¶è¿ŸåŠ è½½ï¼Œå› æ­¤æ€§èƒ½å¯èƒ½éå¸¸ç³Ÿç³•ã€‚</p>
<blockquote>
<p>è¿™ä¹Ÿæ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒå¿Œè®³çš„ï¼Œåœ¨å¾ªç¯ä½“ä¸­å‘èµ· SQL æŸ¥è¯¢</p>
</blockquote>
<h4 id="Nested-Results-for-Association"><a href="#Nested-Results-for-Association" class="headerlink" title="Nested Results for Association"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Nested_Results_for_Association">Nested Results for Association</a></h4><table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">resultMap</td>
<td align="left">ID</td>
</tr>
<tr>
<td align="left">columnPrefix</td>
<td align="left">å½“ join å¤šå¼ è¡¨æ—¶ï¼Œä½ å¾€å¾€ä¼šä½¿ç”¨åˆ«åæ¥é¿å…ç»“æœé‡å¤åˆ—åã€‚æŒ‡å®š <code>columnPrefix</code> å…è®¸ä½ åœ¨æ˜ å°„æ—¶æ·»åŠ ç»Ÿä¸€çš„å‰ç¼€</td>
</tr>
<tr>
<td align="left">notNullColumn</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">autoMapping</td>
<td align="left">å¦‚æœè¯¥å±æ€§å­˜åœ¨ï¼ŒMyBatis åœ¨æ˜ å°„è¯¥å±æ€§æ—¶ï¼Œå°†ä¼šå¯ç”¨æˆ–è€…ç¦ç”¨è‡ªåŠ¨æ˜ å°„</td>
</tr>
</tbody></table>
<h4 id="Multiple-ResultSets-for-Association"><a href="#Multiple-ResultSets-for-Association" class="headerlink" title="Multiple ResultSets for Association"></a>Multiple ResultSets for Association</h4><h4 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h4><ul>
<li>åµŒå¥— select</li>
<li>ä½¿ç”¨ join + åµŒå¥—ç»“æœ</li>
</ul>
<h4 id="Nested-Select-for-Collection"><a href="#Nested-Select-for-Collection" class="headerlink" title="Nested Select for Collection"></a>Nested Select for Collection</h4><p><code>&lt;collection&gt;</code> å…ƒç´ å°†ä¼šä½¿ç”¨æ–°çš„å±æ€§ <code>ofType</code>ï¼Œè¯¥å±æ€§é€‚ç”¨äºåŒºåˆ† Java Bean å±æ€§ç±»å‹å’Œ collection åŒ…å«çš„ç±»å‹ã€‚</p>
<h4 id="Nested-Results-for-Collection"><a href="#Nested-Results-for-Collection" class="headerlink" title="Nested Results for Collection"></a>Nested Results for Collection</h4><p>éœ€è¦æ³¨æ„ collection å­å…ƒç´  id çš„é‡è¦æ€§ã€‚</p>
<h4 id="Multiple-ResultSets-for-Collection"><a href="#Multiple-ResultSets-for-Collection" class="headerlink" title="Multiple ResultSets for Collection"></a>Multiple ResultSets for Collection</h4><h4 id="discriminator"><a href="#discriminator" class="headerlink" title="discriminator"></a>discriminator</h4><h3 id="Auto-mapping"><a href="#Auto-mapping" class="headerlink" title="Auto-mapping"></a>Auto-mapping</h3><p>MyBatis å¯ä»¥è‡ªåŠ¨æ˜ å°„ç»“æœï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æ„å»º result mapï¼Œä½ ç”šè‡³å¯ä»¥ç»“åˆä¸¤ç§ã€‚</p>
<p>é€šå¸¸ï¼Œæ•°æ®åº“åˆ—ä½¿ç”¨å¤§å†™å­—æ¯ä¸”å•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿ï¼Œè€Œ Java å±æ€§é€šå¸¸éµå¾ªé©¼å³°å‘½åçº¦å®šã€‚å¯ä»¥è®¾ç½® <code>mapUnderscoreToCamelCase </code> ä¸º true å®Œæˆè‡ªåŠ¨æ˜ å°„ã€‚</p>
<p>å³ä½¿å­˜åœ¨ <code>resultMap</code>ï¼Œè‡ªåŠ¨æ˜ å°„ä¹Ÿä¼šå‘ç”Ÿã€‚å¯¹äºæ¯ä¸ªç»“æœæ˜ å°„ï¼Œåœ¨ç»“æœé›†ä¸­ä½†æ²¡æœ‰è¿›è¡Œæ‰‹å·¥æ˜ å°„çš„åˆ—ï¼Œå°†ä¼šè¢«è‡ªåŠ¨æ˜ å°„ï¼Œä¹‹åè¿›è¡Œæ‰‹å·¥æ˜ å°„ã€‚</p>
<p>æœ‰ 3 ä¸ªæ˜ å°„çº§åˆ«ï¼š</p>
<ul>
<li><code>NONE</code> ç¦ç”¨è‡ªåŠ¨æ˜ å°„ã€‚å³ï¼Œåªä¼šèµ‹å€¼æ‰‹åŠ¨æ˜ å°„å±æ€§ã€‚</li>
<li><code>PARTIAL</code> é™¤äº†å…¶ä¸­å®šä¹‰çš„åµŒå¥—ç»“æœæ˜ å°„ï¼Œå…¶ä»–éƒ½ä¼šè‡ªåŠ¨æ˜ å°„</li>
<li><code>FULL</code> è‡ªåŠ¨æ˜ å°„æ‰€æœ‰</li>
</ul>
<h2 id="3-6-cache"><a href="#3-6-cache" class="headerlink" title="3.6. cache"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html#cache">3.6. cache</a></h2><p>é»˜è®¤åœ°ï¼Œåªæœ‰ Local Cache æ˜¯å¯ç”¨çš„ï¼Œç”¨äºç¼“å­˜ä¼šè¯çš„æ•°æ®ã€‚è¦å¯ç”¨å…¨å±€äºŒçº§ç¼“å­˜ï¼Œä½ åªéœ€æ·»åŠ ä¸€è¡Œæ–‡å­—åˆ°ä½ çš„ SQL Mapper æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>äºŒçº§ç¼“å­˜éœ€è¦é…ç½® <code>cacheEnabled</code> ä¸º <code>true</code> æ‰ä¼šå¼€å¯ï¼Œä¸€èˆ¬é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä½†å»ºè®®æ˜¾å¼è®¾ç½®ã€‚å¦å¤–ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œè¿˜éœ€è¦å®ä½“ç±»å®ç° <code>Serializable</code> æ¥å£ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
</blockquote>
<p>è¿™ä¸ªç®€å•çš„è¯­å¥æ•ˆæœå¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¼“å­˜æ‰€æœ‰æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­ SELECT è¯­å¥çš„ç»“æœ</li>
<li>æ‰€æœ‰ insert, update, delete è¯­å¥å°†åˆ·æ–°ç¼“å­˜</li>
<li>ç¼“å­˜å°†ä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç®—æ³•è¿›è¡Œé©±é€</li>
<li>ç¼“å­˜ä¸ä¼šä»¥åŸºäºè®¡åˆ’çš„æ—¶é—´é¡ºåºåˆ·æ–°</li>
<li>ç¼“å­˜å°†å­˜å‚¨ 1024 ä¸ªåˆ—è¡¨æˆ–å¯¹è±¡çš„å¼•ç”¨ï¼ˆæ— è®ºæ–¹æ³•è¿”å›ä»€ä¹ˆï¼‰</li>
<li>ç¼“å­˜ä¼šè¢«è§†ä¸ºè¯»&#x2F;å†™ç¼“å­˜ï¼Œè¿™æ„å‘³ï¼Œè¢«æ£€ç´¢çš„å¯¹è±¡ä¸ä¼šè¢«å…±äº«ï¼Œå¯ä»¥è¢«è°ƒç”¨è€…å®‰å…¨çš„ä¿®æ”¹ï¼Œä¸ä¼šå¹²æ‰°å…¶ä»–çº¿ç¨‹å¯èƒ½çš„ä¿®æ”¹</li>
</ul>
<h3 id="Using-a-Custom-Cache"><a href="#Using-a-Custom-Cache" class="headerlink" title="Using a Custom Cache"></a>Using a Custom Cache</h3><p>å®ç° Cache æ¥å£ï¼Œå¹¶åœ¨ Mapper æ–‡ä»¶ä¸­æŒ‡å®š typeï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.domain.something.MyCustomCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="cache-ref"><a href="#cache-ref" class="headerlink" title="cache-ref"></a>cache-ref</h3><p>åœ¨ä¸åŒ namespace ä¹‹é—´å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®å’Œå®ä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache-ref</span> <span class="attr">namespace</span>=<span class="string">&quot;com.someone.application.data.SomeMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="5-Java-API"><a href="#5-Java-API" class="headerlink" title="5. Java API"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/java-api.html">5. Java API</a></h2><h3 id="5-2-SqlSessions"><a href="#5-2-SqlSessions" class="headerlink" title="5.2. SqlSessions"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/java-api.html#sqlSessions">5.2. SqlSessions</a></h3><p>é€šè¿‡ <code>SqlSession</code>ï¼Œä½ å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œè·å¾— Mapperï¼Œç®¡ç†äº‹åŠ¡ã€‚<code>SqlSession</code> ç”± <code>SqlSessionFactory</code> åˆ›å»ºã€‚</p>
<h4 id="5-2-1-SqlSessionFactoryBuilder"><a href="#5-2-1-SqlSessionFactoryBuilder" class="headerlink" title="5.2.1. SqlSessionFactoryBuilder"></a>5.2.1. SqlSessionFactoryBuilder</h4><p><code>SqlSessionFactoryBuilder</code> æœ‰ 5 ä¸ª build() æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å…è®¸ä½ ä»ä¸åŒæ¥æºæ„å»º <code>SqlSessionFactory</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, String environment)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, Properties properties)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, String env, Properties props)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(Configuration config)</span></span><br></pre></td></tr></table></figure>

<p><code>environment</code> MyBatis å°†ä¼šä½¿ç”¨çš„ç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨åŒ…å« environment å‚æ•°çš„æ–¹æ³•ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç¯å¢ƒã€‚</p>
<p><code>properties</code> MyBatis å°†ä¼šåŠ è½½çš„å±æ€§ï¼Œå¯ä½¿ç”¨ <code>$&#123;propName&#125;</code> è¿›è¡Œé…ç½®</p>
<p><strong>å…³äº properties åŠ è½½çš„é¡ºåº</strong> </p>
<ul>
<li>é¦–å…ˆï¼Œè¯»å– properties å…ƒç´ ä¸»ä½“ä¸­æŒ‡å®šçš„å±æ€§</li>
<li>å…¶æ¬¡ï¼ŒåŠ è½½äº properties å…ƒç´ çš„ resource ç±»è·¯å¾„èµ„æºæˆ–è€… url å±æ€§æŒ‡å®šçš„èµ„æºå°†ä¼šè¢«è¯»å–</li>
<li>æœ€åï¼Œä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’çš„ properties æœ€åè¯»å–</li>
</ul>
<p>ååŠ è½½çš„å±æ€§ä¼šè¦†ç›–å‰è€…</p>
<h4 id="5-2-2-SqlSessionFactory"><a href="#5-2-2-SqlSessionFactory" class="headerlink" title="5.2.2. SqlSessionFactory"></a>5.2.2. SqlSessionFactory</h4><p>SqlSessionFactory æœ‰ 6 ç§æ–¹æ³•ç”¨äºåˆ›å»º SqlSession å®ä¾‹ã€‚ä¸€èˆ¬åœ°ï¼Œå½“ä½ é€‰æ‹©ç”¨å“ªä¸ªæ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li><strong>Transaction</strong>ï¼šä½ æ˜¯å¦å¸Œæœ›ä¸º session ä½¿ç”¨äº‹åŠ¡èŒƒå›´ï¼Œæˆ–è€…ä½¿ç”¨ auto-commitï¼ˆè¿™é€šå¸¸æ„å‘³ç€æ•°æ®åº“æˆ– JDBC æ²¡æœ‰äº‹åŠ¡ï¼‰ï¼Ÿ</li>
<li><strong>Connection</strong>ï¼šä» MyBatis é…ç½®å¥½çš„æ•°æ®æºè·å–è¿˜æ˜¯è‡ªå·±æä¾›</li>
<li><strong>Execution</strong>ï¼šé‡ç”¨ PreparedStatement è¿˜æ˜¯æ‰¹å¤„ç†</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">()</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(<span class="type">boolean</span> autoCommit)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(Connection connection)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(TransactionIsolationLevel level)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, TransactionIsolationLevel level)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, <span class="type">boolean</span> autoCommit)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, Connection connection)</span></span><br><span class="line">Configuration <span class="title function_">getConfiguration</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤åœ°ï¼Œæ— å‚çš„ openSession() å°†ä¼šåˆ›å»ºå…·æœ‰å¦‚ä¸‹ç‰¹å¾çš„ SqlSessionï¼š</p>
<ul>
<li>å¯åŠ¨äº‹åŠ¡ï¼Œå³ä¸ä¼š auto commit</li>
<li>Connection å¯¹è±¡ä» DataSource ä¸­è·å–</li>
<li>äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯é©±åŠ¨æˆ–è€…æ•°æ®æºä½¿ç”¨çš„é»˜è®¤å€¼</li>
<li>ä¸ä¼šé‡ç”¨ PreparedStatementsï¼Œä¸ä¼šæ‰¹é‡æ›´æ–°</li>
</ul>
<p>ExecutorType å‚æ•°å®šä¹‰äº† 3 ä¸ªå¯é€‰å€¼ï¼š</p>
<ul>
<li>ExecutorType.SIMPLEï¼šæœ´ç´ çš„æ‰§è¡Œå™¨ã€‚ä¸ºæ¯ä¸ªæ‰§è¡Œè¯­å¥åˆ›å»ºä¸€ä¸ª PreparedStatementã€‚</li>
<li>ExecutorType.REUSEï¼šè¿™ç§ç±»å‹ä¼šé‡ç”¨ PreparedStatementã€‚</li>
<li>ExecutorType.BATCHï¼šæ‰¹é‡æ›´æ–°ï¼ŒåŒæ—¶ï¼Œå¦‚æœæ‰§è¡Œè¯­å¥ä¹‹é—´æœ‰ SELECT è¯­å¥ï¼Œä¹Ÿä¼šåœ¨å¿…è¦çš„åœ°æ–¹åˆ’æ¸…ã€‚</li>
</ul>
<h4 id="5-2-3-SqlSession"><a href="#5-2-3-SqlSession" class="headerlink" title="5.2.3. SqlSession"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/java-api.html#SqlSession">5.2.3. SqlSession</a></h4><h5 id="5-2-3-1-Statement-Execution-Methods"><a href="#5-2-3-1-Statement-Execution-Methods" class="headerlink" title="5.2.3.1. Statement Execution Methods"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/java-api.html#Statement_Execution_Methods">5.2.3.1. Statement Execution Methods</a></h5><p>SqlSession å…·æœ‰è®¸å¤šæ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œ SQL æ˜ å°„æ–‡ä»¶ä¸­å®šä¹‰çš„ SELECT, INSERT, UPDATE, DELETE è¯­å¥ã€‚æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ª <code>statement</code> å‚æ•°ï¼ˆStatement IDï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æœ‰ parameter å‚æ•°ï¼Œå‚æ•°å¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼ˆè‡ªåŠ¨è£…ç®±ï¼‰ï¼Œæˆ–è€… Java Beanï¼ŒPOJOï¼ŒMapã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement)</span>;</span><br><span class="line">&lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement)</span>;</span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span>;</span><br><span class="line"></span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement)</span>;</span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span>;</span><br><span class="line"></span><br><span class="line">&lt;K, V&gt; Map&lt;K, V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, String mapKey)</span>;</span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey)</span>;</span><br><span class="line">&lt;K, V&gt; Map&lt;K, V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey, RowBounds rowBounds)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span><span class="params">(String statement, ResultHandler handler)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span><span class="params">(String statement, Object parameter, ResultHandler handler)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span><span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(String statement)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(String statement)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(String statement)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(String statement, Object parameter)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><code>selectOne</code> å’Œ <code>selectList</code> ä¸åŒç‚¹åœ¨äºï¼Œ <code>selectOne</code> å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–è€… nullï¼ˆæ²¡æœ‰å¯¹è±¡ï¼‰ã€‚å¦‚æœè¶…è¿‡ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
</blockquote>
<p>å¦‚æœä½ ä¸çŸ¥é“æœ‰å¤šå°‘å¯¹è±¡ï¼Œä½¿ç”¨ <code>selectList</code> æ€»æ˜¯å®‰å…¨çš„ã€‚</p>
<p>å¦‚æœä½ æƒ³æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œä½ æœ€å¥½è¿”å›ä¸€ä¸ªè®¡æ•°å€¼ï¼ˆ0 æˆ– 1ï¼‰ã€‚</p>
<p><code>selectMap</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µï¼Œå®ƒä¼šåŸºäºç»“æœä¸­çš„æŸä¸ªå±æ€§ï¼Œå°†ç»“æœåˆ—è¡¨è½¬æ¢ä¸ºä¸€ä¸ª Mapã€‚</p>
<p>å› ä¸ºä¸æ˜¯æ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦å‚æ•°ï¼Œå› æ­¤è¿™äº›æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªæ— å‚æ•°çš„é‡è½½æ–¹æ³•ã€‚</p>
<p><code>insert</code>, <code>update</code>, <code>delete</code> çš„è¿”å›å€¼è¡¨ç¤ºçš„æ˜¯å½±å“è¡Œæ•°ã€‚</p>
<p>æœ‰å‡ ç§é«˜çº§çš„ <code>select</code> æ–¹æ³•ï¼Œå®ƒä»¬å…è®¸ä½ é™åˆ¶è¦è¿”å›çš„è¡ŒèŒƒå›´ï¼Œæˆ–è€…æä¾›è‡ªå®šä¹‰çš„ç»“æœå¤„ç†é€»è¾‘ï¼ˆResultHandlerï¼‰ï¼Œé€šå¸¸ç”¨äºéå¸¸å¤§çš„æ•°æ®é›†ï¼ˆMySQL å‡ ä¹ä¸ä½¿ç”¨ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span> <span class="params">(String statement, Object parameter, RowBounds rowBounds)</span></span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span></span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey, RowBounds rowbounds)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span> <span class="params">(String statement, Object parameter, ResultHandler&lt;T&gt; handler)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span> <span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler&lt;T&gt; handler)</span></span><br></pre></td></tr></table></figure>
<p><code>RowBounds</code> å‚æ•°ä¼šè®© MyBatis è·³è¿‡æŒ‡å®šçš„è®°å½•æ•°ï¼ŒåŒæ—¶é™åˆ¶è¦è¿”å›çš„è®°å½•æ•°ã€‚</p>
<blockquote>
<ul>
<li>åœ¨è¿™é‡Œï¼Œä¸åŒçš„é©±åŠ¨èƒ½å¤Ÿè·å¾—ä¸åŒçš„æ•ˆç‡ã€‚ä¸ºäº†æœ€ä½³æ€§èƒ½ï¼Œéœ€è¦ä½¿ç”¨ç»“æœé›†ç±»å‹ä¸º <code>SCROLL_SENSITIVE </code> æˆ–è€… <code>SCROLL_INSENSITIVE </code></li>
</ul>
</blockquote>
<p><code>ResultHandler</code> å‚æ•°å…è®¸ä½ æŒ‰ç…§ä½ çš„æ–¹å¼å¤„ç†æ¯ä¸€è¡Œã€‚ä½ å¯ä»¥æŠŠå®ƒæ·»åŠ åˆ° Listï¼Œåˆ›å»ºä¸€ä¸ª Mapï¼ŒSetï¼Œæˆ–è€…æŠ›å‡ºä¹°ä¸ªç»“æœï¼Œè€Œåªä¿ç•™è®¡ç®—çš„è®¡ç®—çš„æ€»æ•°ã€‚ä½ å¯ä»¥ä½¿ç”¨ ResultHandler åšä»»ä½•äº‹æƒ…ï¼Œè¿™å°±æ˜¯ MyBatis å†…éƒ¨ä½¿ç”¨æ¥æ„é€ ç»“æœé›†åˆ—è¡¨çš„ã€‚</p>
<p>ResultHandler æ¥å£å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResultHandler</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">handleResult</span><span class="params">(ResultContext&lt;? extends T&gt; context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ResultContext</code> å‚æ•°ç”¨äºè®¿é—®ç»“æœå¯¹è±¡æœ¬èº«ï¼Œè¿™æ˜¯è¢«åˆ›å»ºçš„ç»“æœå¯¹è±¡çš„æ•°é‡è®¡æ•°ï¼Œä»¥åŠä½ å¯ä»¥ä½¿ç”¨ <code>stop()</code> æ–¹æ³•åœæ­¢ MyBatis åŠ è½½æ›´å¤šç»“æœã€‚</p>
<p>ä½¿ç”¨ <code>ResultHandler</code> æœ‰ä¸¤ç‚¹ä½ åº”è¯¥äº†è§£ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>ResultHandler</code> è°ƒç”¨çš„æ–¹æ³•ç§çš„æ•°æ®ä¸ä¼šè¢«ç¼“å­˜</li>
<li>å½“ä½¿ç”¨é«˜çº§ <code>resultMap</code> æ—¶ï¼ŒMyBatis æœ‰å¯èƒ½éœ€è¦å¤šè¡Œæ¥æ„å»º 1 ä¸ªå¯¹è±¡ã€‚å¦‚æœä½¿ç”¨ <code>ResultHandler</code>ï¼Œå¯èƒ½ä¼šç»™ä½ ä¸€ä¸ªå…³è”æˆ–è€…é›†åˆæœªè¢«å¡«å……çš„å¯¹è±¡ã€‚</li>
</ul>
<h5 id="Local-Cache"><a href="#Local-Cache" class="headerlink" title="Local Cache"></a><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/java-api.html#Local_Cache">Local Cache</a></h5><p>MyBatis ä½¿ç”¨äº† 2 ä¸ªç¼“å­˜ï¼ŒLocal Cache å’Œ äºŒçº§ç¼“å­˜ã€‚</p>
<p>æ¯æ¬¡ MyBatis åˆ›å»ºæ–°çš„ä¼šè¯æ—¶ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ª Local Cache é™„åŠ åˆ°ä¼šè¯ä¸­ã€‚åœ¨<strong>æœ¬æ¬¡ä¼šè¯</strong>ä¸­æ‰§è¡Œçš„ä»»ä½•æŸ¥è¯¢éƒ½å°†å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­ï¼Œå› æ­¤å…·æœ‰ç›¸åŒè¾“å…¥å‚æ•°çš„ç›¸åŒæŸ¥è¯¢ï¼Œä»¥åéƒ½ä¸ä¼šæŸ¥è¯¢æ•°æ®åº“ã€‚å½“ update, commit, rollback å’Œ close æ—¶ï¼ŒLocal Cache ä¼šæ¸…é™¤ã€‚</p>
<h6 id="1-Local-Cache-åŸç†-ğŸ‘‡"><a href="#1-Local-Cache-åŸç†-ğŸ‘‡" class="headerlink" title="1. Local Cache åŸç† ğŸ‘‡"></a>1. Local Cache åŸç† ğŸ‘‡</h6><p>ä¸€èˆ¬åœ°ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ–¹æ³•çš„æ—¶å€™éƒ½æ˜¯è°ƒç”¨ BaseExecutor çš„ query() æ–¹æ³•ï¼Œå…¶æ–¹æ³•å†…éƒ¨ä¼šå…ˆè€ƒè™‘æ˜¯å¦ä» Local Cache ä¸­è·å–æ•°æ®ï¼Œå¦‚æœä¸ä»ç¼“å­˜ä¸­è·å–ï¼Œåˆ™è°ƒç”¨å†…éƒ¨çš„ doQuery() æ–¹æ³•</p>
<h6 id="Local-Cache-çš„-Key-ğŸ±"><a href="#Local-Cache-çš„-Key-ğŸ±" class="headerlink" title="Local Cache çš„ Key ğŸ±"></a>Local Cache çš„ Key ğŸ±</h6><p>org.apache.ibatis.cache.CacheKey æ˜¯ Local Cache çš„ key</p>
<h6 id="ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ-Local-Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ-ğŸŒ"><a href="#ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ-Local-Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ-ğŸŒ" class="headerlink" title="ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ Local Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ ğŸŒ"></a>ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ Local Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ ğŸŒ</h6><ul>
<li>ä¸åŒçš„ä¼šè¯</li>
</ul>
<p>ä¸åŒçš„ Session æœ¬èº«ä¸å…±äº« Local Cacheã€‚æˆ‘å¹¶ä¸è®¤ä¸ºè¿™æ˜¯å¤±æ•ˆçš„åŸå› ã€‚è¿™åè€Œæ˜¯ä¸€ç§ä½¿ç”¨é”™è¯¯çš„æ–¹å¼ã€‚</p>
<ul>
<li>æ‰§è¡Œ update æ“ä½œ</li>
</ul>
<p>å¦‚æœæ‰§è¡Œäº†æ›´æ–°æ“ä½œä¼šæ¸…ç©º Local Cache</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(MappedStatement ms, Object parameter)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    ErrorContext.instance().resource(ms.getResource()).activity(<span class="string">&quot;executing an update&quot;</span>).object(ms.getId());</span><br><span class="line">    <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExecutorException</span>(<span class="string">&quot;Executor was closed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    clearLocalCache();</span><br><span class="line">    <span class="keyword">return</span> doUpdate(ms, parameter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ‰‹åŠ¨è°ƒç”¨ DefaultSqlSession.clearCache()</li>
</ul>
<p>åº•å±‚ä¼šè°ƒç”¨ executor çš„ clearLocalCache() æ–¹æ³•</p>
<ul>
<li><p>è®¾ç½®äº†è¯­å¥å±æ€§ <code>flushCache</code> ä¸º <code>true</code>ï¼Œç¼“å­˜å…¨æ¸…</p>
</li>
<li><p>è®¾ç½® flushCacheRequired</p>
</li>
<li><p>é…ç½® localCacheScope ä¸º STATEMENT</p>
</li>
<li><p>commit å’Œ rollback</p>
</li>
</ul>
<h5 id="Ensuring-that-SqlSession-is-Closed"><a href="#Ensuring-that-SqlSession-is-Closed" class="headerlink" title="Ensuring that SqlSession is Closed"></a>Ensuring that SqlSession is Closed</h5><p>ä½ å¿…é¡»ç¡®ä¿å…³é—­æ‰€æœ‰ä½ æ‰“å¼€çš„ä¼šè¯ã€‚æ¨èæ–¹å¼æ˜¯ä½¿ç”¨ try åŒ…è£¹èµ„æºã€‚</p>
<h5 id="Using-Mappers"><a href="#Using-Mappers" class="headerlink" title="Using Mappers"></a>Using Mappers</h5><h5 id="Mapper-Annotations"><a href="#Mapper-Annotations" class="headerlink" title="Mapper Annotations"></a>Mapper Annotations</h5><table>
<thead>
<tr>
<th align="left">æ³¨è§£</th>
<th align="left">ç›®æ ‡</th>
<th align="left">XML ç­‰ä»·ç‰©</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@CacheNamespace</td>
<td align="left">Class</td>
<td align="left"><code>&lt;cache&gt;</code></td>
<td align="left">ä¸ºç»™å®šçš„å‘½åç©ºé—´é…ç½®ç¼“å­˜</td>
</tr>
<tr>
<td align="left">@CacheNamespaceRef</td>
<td align="left">Class</td>
<td align="left"><code>&lt;cacheRef&gt;</code></td>
<td align="left">å¼•ç”¨å…¶ä»–å‘½åç©ºé—´çš„ç¼“å­˜ã€‚æ³¨æ„ï¼šxml mapper æ–‡ä»¶å£°æ˜çš„ç¼“å­˜æ˜¯éš”ç¦»çš„</td>
</tr>
<tr>
<td align="left">@MapKey</td>
<td align="left">Method</td>
<td align="left"></td>
<td align="left">ç”¨äºè¿”å›ç±»å‹æ˜¯ Map çš„æ–¹æ³•ã€‚åŸºäºå¯¹è±¡çš„å±æ€§å°†ç»“æœ List è½¬æ¢ä¸º Mapã€‚æ³¨è§£çš„å±æ€§ <code>value</code> ä½œä¸º Map çš„ key</td>
</tr>
</tbody></table>
<h1 id="MyBatisPlus"><a href="#MyBatisPlus" class="headerlink" title="MyBatisPlus"></a><a target="_blank" rel="noopener" href="https://mp.baomidou.com/">MyBatisPlus</a></h1><hr>
<h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.cannedbread.dictionary.mapper&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="åˆ†é¡µæ’ä»¶"><a href="#åˆ†é¡µæ’ä»¶" class="headerlink" title="åˆ†é¡µæ’ä»¶"></a>åˆ†é¡µæ’ä»¶</h1><hr>
<ul>
<li>PageHelper</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ–¹æ³•ï¼š<br>(1) PageHelper.start()ï¼Œä¼ å…¥ pageNum å½“å‰é¡µç ï¼ŒpageSize æ¯é¡µæ˜¾ç¤ºæ•°ç›®ã€‚<br>(2) è°ƒç”¨ Mapper æ–¹æ³•æŸ¥è¯¢<br>(3) ä½¿ç”¨ pageInfo æ„é€ å™¨ä¼ å…¥æŸ¥è¯¢ç»“æœé›†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageInfo&lt;ProjectArea&gt; <span class="title function_">listPageByExample</span><span class="params">(<span class="type">int</span> pageNum, <span class="type">int</span> pageSize, ProjectArea example)</span> &#123;</span><br><span class="line">	PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">	List&lt;ProjectArea&gt; result = projectAreaMapper.selectList(example);</span><br><span class="line">	PageInfo&lt;ProjectArea&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(result);</span><br><span class="line">	<span class="keyword">return</span> pageInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="å„ç§-Logger"><a href="#å„ç§-Logger" class="headerlink" title="å„ç§ Logger"></a>å„ç§ Logger</h2><ul>
<li>PreparedStatementLogger</li>
<li>ConnectionLogger</li>
</ul>
<h2 id="StatementHandler"><a href="#StatementHandler" class="headerlink" title="StatementHandler"></a>StatementHandler</h2><h3 id="PreparedStatementHandler"><a href="#PreparedStatementHandler" class="headerlink" title="PreparedStatementHandler"></a>PreparedStatementHandler</h3><p>æ‰§è¡Œ SQL çš„æ—¶å€™ä¼šå°† statement å¼ºåˆ¶è½¬æ¢ä¸º PreparedStatement ç±»å‹ï¼Œå¹¶è¿›è¡Œæ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">	<span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> (PreparedStatement) statement;</span><br><span class="line">	ps.execute();</span><br><span class="line">	<span class="keyword">return</span> resultSetHandler.handleResultSets(ps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="SqlSource"><a href="#SqlSource" class="headerlink" title="SqlSource"></a>SqlSource</h2><ul>
<li>RawSqlSource</li>
<li>DynamicSqlSource</li>
<li>StaticSqlSourceï¼Œç”Ÿæˆ BoundSQL</li>
</ul>
<h3 id="RawSqlSource"><a href="#RawSqlSource" class="headerlink" title="RawSqlSource"></a>RawSqlSource</h3><p>RawSqlSource æ‹¥æœ‰ä¸€ä¸ª SqlSource çš„å±æ€§ï¼Œå®ƒæ˜¯ StaticSqlSourceï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RawSqlSource</span> <span class="keyword">implements</span> <span class="title class_">SqlSource</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> SqlSource sqlSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª SqlNode æ˜¯å¦æ˜¯åŠ¨æ€çš„ ?</strong></p>
<ul>
<li>å¦‚æœæ˜¯çº¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œä¸”å­˜åœ¨ <code>$&#123;&#125;</code>ï¼Œè®¤ä¸ºæ˜¯åŠ¨æ€</li>
<li>å¦‚æœæ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œåˆ™ä¸€å®šæ˜¯åŠ¨æ€</li>
</ul>
<p>å…·ä½“ä»£ç è§ XMLScriptBuilder.parseDynamicTags &gt; TextSqlNode.isDynamic</p>
<p><strong>ä¸ºä»€ä¹ˆ RawSqlSourceã€DynamicSqlSource ä¸ç›´æ¥ç”Ÿæˆ BoundSQLï¼Œåè€Œé€šè¿‡   StaticSqlSource ç”Ÿæˆ?</strong></p>
<p>è®¾è®¡çš„é—®é¢˜</p>
<p>DynamicSqlSource è§£ææ˜¯å¯¹ SqlNode çš„è§£æï¼Œå…¶ä¸­ä¼šå­˜å‚¨æ ¹èŠ‚ç‚¹ rootSqlNodeï¼ŒèŠ‚ç‚¹å¯ä»¥è®¤ä¸ºæ˜¯ç±»ä¼¼ DOM çš„èŠ‚ç‚¹ã€‚</p>
<p><code>rootSqlNode.apply(context);</code> å³éå† SqlNode æ ‘è¿›è¡Œè§£æï¼Œæœ€ç»ˆç”Ÿæˆ contextã€‚</p>
<h2 id="SqlNode"><a href="#SqlNode" class="headerlink" title="SqlNode"></a>SqlNode</h2><ul>
<li>MixedSqlNode</li>
</ul>
<p>SQL è¯­æ³•æ ‘ä»ç»“æ„æ¥çœ‹æ˜¯æ ‘å½¢ï¼Œä½†æ˜¯ MyBatis ä¼šå°†åŒä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ç”¨ MixedSqlNode åŒ…è£…ï¼Œå› æ­¤ï¼Œä»èŠ‚ç‚¹çš„è§’åº¦çœ‹ï¼Œæ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(DynamicContext context)</span> &#123;</span><br><span class="line">    contents.forEach(node -&gt; node.apply(context));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>StaticTextSqlNode é™æ€æ–‡æœ¬</p>
</li>
<li><p>TextSqlNode åŒ…å«äº†è¡¨è¾¾å¼çš„æ–‡æœ¬ï¼Œå¦‚ï¼šselect * from ${table}</p>
</li>
<li><p>IfSqlNode</p>
</li>
</ul>
<p>è®¡ç®—è¡¨è¾¾å¼çš„å€¼ï¼Œå¦‚æœä¸º trueï¼Œåˆ™ç»§ç»­è§£æï¼Œä¸€èˆ¬ if è¡¨è¾¾å¼ä¸‹é¢å°±æ˜¯é™æ€æ–‡æœ¬äº†ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µåˆ™æ˜¯ç›´æ¥è¿½åŠ  SQL</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(DynamicContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (evaluator.evaluateBoolean(test, context.getBindings())) &#123;</span><br><span class="line">        contents.apply(context);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ForEachNode</li>
</ul>
<p>è§£æå®Œæ¯•ä¹‹åä¼šç”Ÿæˆç‰¹å®šçš„åºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªæ¯ä¸ª</p>
<p>è¯¥è§£æä¸€å®šä¼šæ·»åŠ  open ä¸ closeï¼Œæ‰€ä»¥å¦‚æœåœ¨æ‹¼æ¥ in è¯­å¥çš„æ—¶å€™æ²¡æœ‰å…ƒç´ ï¼Œå¯èƒ½å¯¼è‡´ SQL é”™è¯¯</p>
<ul>
<li>TrimSqlNode</li>
</ul>
<p>ä»è¿›å…¥è¯¥èŠ‚ç‚¹å¼€å§‹ï¼Œå°†ä¼šä½¿ç”¨ <code>FilteredDynamicContext</code> åŒ…è£…åŸæ¥çš„ contextï¼Œä¹‹åçš„ç»“æœä¼šç¼“å­˜åœ¨ <code>FilteredDynamicContext</code> çš„ <code>sqlBuffer</code> ä¸­ï¼Œç›´è‡³è¯¥èŠ‚ç‚¹è§£æå®Œæ¯•ï¼Œæœ€åä½¿ç”¨ filteredDynamicContext.applyAll() çœŸæ­£è¿›è¡Œåº”ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(DynamicContext context)</span> &#123;</span><br><span class="line">    TrimSqlNode.<span class="type">FilteredDynamicContext</span> <span class="variable">filteredDynamicContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrimSqlNode</span>.FilteredDynamicContext(context);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> contents.apply(filteredDynamicContext);</span><br><span class="line">    filteredDynamicContext.applyAll();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆåŠ è¿™ä¸€ä¸ªç¼“å­˜ ?</strong></p>
<p>å¦‚æœç›´æ¥è¿½åŠ  SQL åˆ°æœ€ç»ˆçš„ç»“æœä¸Šï¼Œæœ€åè¿˜éœ€è¦åšä¸€æ­¥ trimï¼Œæ­¤æ—¶å·²ç»ä¸æ–¹ä¾¿ trim äº†ã€‚</p>
<ul>
<li>WhereSqlNode</li>
</ul>
<p>å°†ä¼šåˆ é™¤ç‰¹å®šçš„å‰ç¼€ï¼Œå¹¶è¿½åŠ å‰ç¼€ WHERE</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; prefixList = Arrays.asList(<span class="string">&quot;AND &quot;</span>,<span class="string">&quot;OR &quot;</span>,<span class="string">&quot;AND\n&quot;</span>, <span class="string">&quot;OR\n&quot;</span>, <span class="string">&quot;AND\r&quot;</span>, <span class="string">&quot;OR\r&quot;</span>, <span class="string">&quot;AND\t&quot;</span>, <span class="string">&quot;OR\t&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WhereSqlNode</span> <span class="keyword">extends</span> <span class="title class_">TrimSqlNode</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">WhereSqlNode</span><span class="params">(Configuration configuration, SqlNode contents)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>(configuration, contents, <span class="string">&quot;WHERE&quot;</span>, prefixList, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="rootSqlNode-apply-context"><a href="#rootSqlNode-apply-context" class="headerlink" title="rootSqlNode.apply(context)"></a>rootSqlNode.apply(context)</h2><h2 id="MapperProxy"><a href="#MapperProxy" class="headerlink" title="MapperProxy"></a>MapperProxy</h2><p>MapperProxy æ˜¯ MyBatis ä¸­ InvacationHandler çš„å®ç°ç±»ã€‚å…¶ä¸­ï¼ŒåŒ…å«ä¸€ä¸ª SqlSessionTemplateï¼ŒSqlSessionTemplate å†…éƒ¨åˆåŒ…å«ä¸€ä¸ª DefaultSqlSession </p>
<p><strong>ä¸ºä»€ä¹ˆ SqlSessionTemplate åˆä½¿ç”¨ä»£ç†å¯¹è±¡ sqlSessionProxy å»æ‰§è¡Œæ–¹æ³•ï¼Ÿ</strong></p>
<p>ä¸ºäº†å®ç°æ‹¦æˆªæ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.sqlSessionProxy = (SqlSession) newProxyInstance(SqlSessionFactory.class.getClassLoader(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; SqlSession.class &#125;, <span class="keyword">new</span> <span class="title class_">SqlSessionInterceptor</span>());</span><br></pre></td></tr></table></figure>




<h2 id="CachingExecutor-çš„æ‰§è¡Œ"><a href="#CachingExecutor-çš„æ‰§è¡Œ" class="headerlink" title="CachingExecutor çš„æ‰§è¡Œ"></a>CachingExecutor çš„æ‰§è¡Œ</h2><h3 id="query"><a href="#query" class="headerlink" title="query"></a>query</h3><p>(1) è·å¾— BoundSql</p>
<p>BoundSql </p>
<p>(2) åˆ›å»ºç¼“å­˜ key</p>
<p>åˆ›å»ºæ˜¯ç”± BaseExecutor å®Œæˆçš„ï¼Œå…¶ä¸­å½±å“å› ç´ æœ‰ï¼š</p>
<ul>
<li>MappedStatement.idï¼Œå³æ–¹æ³•å…¨é™å®šå</li>
<li>rowBounds.offset</li>
<li>rowBounds.limit</li>
<li>boundSql.sql</li>
<li>parameterMappings çš„å‚æ•°å€¼</li>
<li>parameterMappings.environment.id</li>
</ul>
<p>(3) flushCacheIfRequired<br>(4) ä½¿ç”¨ä»£ç† Executor æ‰§è¡ŒæŸ¥è¯¢</p>
<h2 id="SimpleExecutor"><a href="#SimpleExecutor" class="headerlink" title="SimpleExecutor"></a>SimpleExecutor</h2><h3 id="queryFromDatabase"><a href="#queryFromDatabase" class="headerlink" title="queryFromDatabase"></a>queryFromDatabase</h3><p>(1) è·å– Configuration<br>(2) åˆ›å»º StatementHandler<br>(3) prepareStatement<br>(4) StatementHandler.query</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#MyBatis" >
    <span class="tag-code">MyBatis</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2022/07/15/MyBatis/Spring-Boot-%E6%95%B4%E5%90%88-MyBatis-%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/">
        <span class="nav-arrow">â† </span>
        
          Spring Boot æ•´åˆ MyBatis å¯åŠ¨åŸç†
        
      </a>
    
    
      <a class="nav-right" href="/2022/07/16/MyBatis/MyBatis-%E6%9E%84%E9%80%A0-Mapper-Proxy-%E5%8E%9F%E7%90%86/">
        
          MyBatis æ„é€  Mapper Proxy åŸç†
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
      <div class="money-like">
        <div class="reward-btn">
          èµ
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨æ”¯ä»˜å®æ‰“èµ</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>ä½¿ç”¨å¾®ä¿¡æ‰“èµ</b>
            </span>
          </span>
        </div>
        <p class="notice">è‹¥ä½ è§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¯¹æˆ‘æ‰“èµ</p>
      </div>
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">æ‰«æäºŒç»´ç ï¼Œåˆ†äº«æ­¤æ–‡ç« </p>
      </div>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js"
        repo="JiangChunbo/jiangchunbo.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async></script>
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#MyBatis"><span class="toc-nav-text">MyBatis</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-Getting-started"><span class="toc-nav-text">1. Getting started</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-1-Installation"><span class="toc-nav-text">1.1. Installation</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-2-Building-SqlSessionFactory-from-XML"><span class="toc-nav-text">1.2. Building SqlSessionFactory from XML</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-3-Building-SqlSessionFactory-without-XML"><span class="toc-nav-text">1.3. Building SqlSessionFactory without XML</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-4-Acquiring-a-SqlSession-from-SqlSessionFactory"><span class="toc-nav-text">1.4. Acquiring a SqlSession from SqlSessionFactory</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-5-Exploring-Mapped-SQL-Statements"><span class="toc-nav-text">1.5. Exploring Mapped SQL Statements</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-Configuration-XML"><span class="toc-nav-text">2. Configuration XML</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-1-properties"><span class="toc-nav-text">2.1. properties</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-2-settings"><span class="toc-nav-text">2.2. settings</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-3-typeAliases"><span class="toc-nav-text">2.3. typeAliases</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-4-typeHandlers"><span class="toc-nav-text">2.4. typeHandlers</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-5-Handling-Enums"><span class="toc-nav-text">2.5. Handling Enums</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-6-objectFactory"><span class="toc-nav-text">2.6. objectFactory</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-7-plugins"><span class="toc-nav-text">2.7. plugins</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-8-environments"><span class="toc-nav-text">2.8. environments</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-9-databaseIdProvider"><span class="toc-nav-text">2.9. databaseIdProvider</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-10-mappers"><span class="toc-nav-text">2.10. mappers</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%96%B9%E5%BC%8F1-%E7%B1%BB%E8%B7%AF%E5%BE%84%E7%9B%B8%E5%AF%B9%E8%B5%84%E6%BA%90%E5%BC%95%E7%94%A8"><span class="toc-nav-text">æ–¹å¼1 ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%96%B9%E5%BC%8F2-%E5%AE%8C%E5%85%A8%E9%99%90%E5%AE%9A-url-%E5%BC%95%E7%94%A8"><span class="toc-nav-text">æ–¹å¼2 å®Œå…¨é™å®š url å¼•ç”¨</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%96%B9%E5%BC%8F3-%E7%B1%BB%E5%90%8D"><span class="toc-nav-text">æ–¹å¼3 ç±»å</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%96%B9%E5%BC%8F4-%E5%8C%85%E5%90%8D"><span class="toc-nav-text">æ–¹å¼4 åŒ…å</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3-Mapper-XML-Files"><span class="toc-nav-text">3. Mapper XML Files</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-1-select"><span class="toc-nav-text">3.1. select</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-2-insert-update-and-delete"><span class="toc-nav-text">3.2. insert, update and delete</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E8%81%94"><span class="toc-nav-text">ä¸€å¯¹å¤šå…³è”</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-3-Parameters"><span class="toc-nav-text">3.3. Parameters</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-4-Result-Maps"><span class="toc-nav-text">3.4. Result Maps</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-4-1-Advanced-Result-Maps"><span class="toc-nav-text">3.4.1. Advanced Result Maps</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-4-2-resultMap"><span class="toc-nav-text">3.4.2. resultMap</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-4-3-id-amp-result"><span class="toc-nav-text">3.4.3. id &amp; result</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#association"><span class="toc-nav-text">association</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Nested-Select-for-Association"><span class="toc-nav-text">Nested Select for Association</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Nested-Results-for-Association"><span class="toc-nav-text">Nested Results for Association</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Multiple-ResultSets-for-Association"><span class="toc-nav-text">Multiple ResultSets for Association</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#collection"><span class="toc-nav-text">collection</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Nested-Select-for-Collection"><span class="toc-nav-text">Nested Select for Collection</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Nested-Results-for-Collection"><span class="toc-nav-text">Nested Results for Collection</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Multiple-ResultSets-for-Collection"><span class="toc-nav-text">Multiple ResultSets for Collection</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#discriminator"><span class="toc-nav-text">discriminator</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Auto-mapping"><span class="toc-nav-text">Auto-mapping</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3-6-cache"><span class="toc-nav-text">3.6. cache</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Using-a-Custom-Cache"><span class="toc-nav-text">Using a Custom Cache</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#cache-ref"><span class="toc-nav-text">cache-ref</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#5-Java-API"><span class="toc-nav-text">5. Java API</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-2-SqlSessions"><span class="toc-nav-text">5.2. SqlSessions</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-2-1-SqlSessionFactoryBuilder"><span class="toc-nav-text">5.2.1. SqlSessionFactoryBuilder</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-2-2-SqlSessionFactory"><span class="toc-nav-text">5.2.2. SqlSessionFactory</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-2-3-SqlSession"><span class="toc-nav-text">5.2.3. SqlSession</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#5-2-3-1-Statement-Execution-Methods"><span class="toc-nav-text">5.2.3.1. Statement Execution Methods</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Local-Cache"><span class="toc-nav-text">Local Cache</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#1-Local-Cache-%E5%8E%9F%E7%90%86-%F0%9F%91%87"><span class="toc-nav-text">1. Local Cache åŸç† ğŸ‘‡</span></a></li><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#Local-Cache-%E7%9A%84-Key-%F0%9F%90%B1"><span class="toc-nav-text">Local Cache çš„ Key ğŸ±</span></a></li><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#%E4%BD%95%E6%97%B6%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%A4%B1%E6%95%88-Local-Cache%EF%BC%88%E5%A4%B1%E6%95%88%EF%BC%89%EF%BC%9F-%F0%9F%90%8C"><span class="toc-nav-text">ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ Local Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ ğŸŒ</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Ensuring-that-SqlSession-is-Closed"><span class="toc-nav-text">Ensuring that SqlSession is Closed</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Using-Mappers"><span class="toc-nav-text">Using Mappers</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Mapper-Annotations"><span class="toc-nav-text">Mapper Annotations</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#MyBatisPlus"><span class="toc-nav-text">MyBatisPlus</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Spring"><span class="toc-nav-text">Spring</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-nav-text">åˆ†é¡µæ’ä»¶</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-nav-text">æºç åˆ†æ</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%90%84%E7%A7%8D-Logger"><span class="toc-nav-text">å„ç§ Logger</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#StatementHandler"><span class="toc-nav-text">StatementHandler</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#PreparedStatementHandler"><span class="toc-nav-text">PreparedStatementHandler</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#SqlSource"><span class="toc-nav-text">SqlSource</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#RawSqlSource"><span class="toc-nav-text">RawSqlSource</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#SqlNode"><span class="toc-nav-text">SqlNode</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#rootSqlNode-apply-context"><span class="toc-nav-text">rootSqlNode.apply(context)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#MapperProxy"><span class="toc-nav-text">MapperProxy</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#CachingExecutor-%E7%9A%84%E6%89%A7%E8%A1%8C"><span class="toc-nav-text">CachingExecutor çš„æ‰§è¡Œ</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#query"><span class="toc-nav-text">query</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#SimpleExecutor"><span class="toc-nav-text">SimpleExecutor</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#queryFromDatabase"><span class="toc-nav-text">queryFromDatabase</span></a></li></ol></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://example.com/2022/07/15/MyBatis/MyBatis-å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ç¬”è®°/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>






    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a target="_blank" rel="noopener" href="https://github.com/yanm1ng">yanm1ng</a>
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


  </body>
</html>