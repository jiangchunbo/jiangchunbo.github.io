<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ğŸ¥«ğŸ</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-09-22T12:14:24.780Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>å§œæ˜¥æ³¢</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Thymeleaf ä½¿ç”¨ç¬”è®°</title>
    <link href="http://example.com/2022/09/20/TemplateEngine/Thymeleaf-%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/09/20/TemplateEngine/Thymeleaf-%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/</id>
    <published>2022-09-20T12:01:57.000Z</published>
    <updated>2022-09-22T12:14:24.780Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h2><p>å¦‚æœä½¿ç”¨ Spring Bootï¼Œé»˜è®¤æ¨¡æ¿å¼•æ“çš„è·¯å¾„æ˜¯ <code>classpath:/template</code>ï¼Œä½†æ˜¯æ— æ³•ç›´æ¥è®¿é—®ï¼Œéœ€è¦é€šè¿‡æ§åˆ¶å™¨ &gt; è§£ææ¨¡æ¿æ‰å¯ä»¥è®¿é—®ã€‚</p><blockquote><p>å¦‚æœæ²¡æœ‰è¿›è¡Œæ§åˆ¶å™¨è·³è½¬ï¼Œé‚£ä¹ˆ Spring Boot å°†ä¼šä½¿ç”¨ <code>ResourceHttpRequestHandler</code> æ¥å¤„ç†ä½ çš„è¯·æ±‚ï¼›å¦‚æœé™æ€è·¯å¾„åˆæ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æºï¼Œåˆ™è¿”å› 404.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Spring-Boot&quot;&gt;&lt;a href=&quot;#Spring-Boot&quot; class=&quot;headerlink&quot; title=&quot;Spring Boot&quot;&gt;&lt;/a&gt;Spring Boot&lt;/h2&gt;&lt;p&gt;å¦‚æœä½¿ç”¨ Spring Bootï¼Œé»˜è®¤æ¨¡æ¿å¼•æ“çš„è·¯å¾„æ˜¯ &lt;code&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Freemarker ä½¿ç”¨ç¬”è®°</title>
    <link href="http://example.com/2022/09/20/TemplateEngine/Freemarker-%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/09/20/TemplateEngine/Freemarker-%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/</id>
    <published>2022-09-20T11:56:36.000Z</published>
    <updated>2022-09-22T12:14:24.780Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.freemarker&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;freemarker&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">2.3</span><span class="number">.27</span>-incubating&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>è½¯ä»¶æ¶æ„çš„æ‚é¡¹è®°å½•</title>
    <link href="http://example.com/2022/09/20/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E7%9A%84%E6%9D%82%E9%A1%B9%E8%AE%B0%E5%BD%95/"/>
    <id>http://example.com/2022/09/20/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E7%9A%84%E6%9D%82%E9%A1%B9%E8%AE%B0%E5%BD%95/</id>
    <published>2022-09-20T11:24:59.000Z</published>
    <updated>2022-09-22T12:14:24.780Z</updated>
    
    <content type="html"><![CDATA[<p>ä¼ ç»Ÿè½¯ä»¶æ¶æ„ï¼šå®¢æˆ·å±‚ã€è¡¨ç°å±‚ã€æ§åˆ¶å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®åº“å±‚</p><p>å®¢æˆ·å±‚: ä¸€èˆ¬æŒ‡å®¢æˆ·ç«¯å’Œæµè§ˆå™¨</p><p>è¡¨ç°å±‚: å°†å®¢æˆ·ç«¯çš„è¯·æ±‚æäº¤åˆ°ä¸šåŠ¡å±‚, å°†æ§åˆ¶å±‚çš„è¿”å›çš„æ•°æ®æ¸²æŸ“å±•ç¤ºç»™å®¢æˆ·</p><p>æ§åˆ¶å±‚: ç­‰åŒäº MVC ä¸­çš„æ§åˆ¶å±‚ã€‚æ¥å—è¡¨ç°å±‚çš„è¯·æ±‚å¯»æ‰¾ç›¸åº”çš„ä¸šåŠ¡å¤„ç†</p><p>ä¸šåŠ¡é€»è¾‘å±‚ï¼šå®ç°ä¸šåŠ¡é€»è¾‘</p><p>æ•°æ®åº“å±‚ï¼šå­˜æ”¾å’Œç®¡ç†ç”¨æˆ·æ‰€ä½¿ç”¨çš„æ•°æ®</p><p>ä¼ ç»Ÿè½¯ä»¶æ¶æ„ï¼šå®¢æˆ·å±‚ã€è¡¨ç°å±‚ã€æ§åˆ¶å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®åº“å±‚</p><h2 id="å¤šç§Ÿæˆ·æ•°æ®å­˜å‚¨æ–¹æ¡ˆ"><a href="#å¤šç§Ÿæˆ·æ•°æ®å­˜å‚¨æ–¹æ¡ˆ" class="headerlink" title="å¤šç§Ÿæˆ·æ•°æ®å­˜å‚¨æ–¹æ¡ˆ"></a>å¤šç§Ÿæˆ·æ•°æ®å­˜å‚¨æ–¹æ¡ˆ</h2><ul><li>ç‹¬ç«‹æ•°æ®åº“</li></ul><p>æœ€ä¾¿æ·ã€‚ç‰©ç†ä¸Šï¼Œæ¯ä¸ªç§Ÿæˆ·éƒ½å•ç‹¬æ‹¥æœ‰è‡ªå·±çš„ä¸€æ•´å¥—æ•°æ®ï¼Œè€Œä¸”æ˜¯å•ç‹¬å­˜æ”¾ã€‚</p><blockquote><p>å…·ä½“æ¥è¯´ï¼Œå¤šä¸ªæœºå™¨åˆ†åˆ«å®‰è£… MySQL å®ä¾‹ï¼Œæ¯ä¸ªä¼ä¸šä½¿ç”¨å•ç‹¬ä¸€å°æœºå™¨ã€‚</p></blockquote><ul><li>å…±äº«æ•°æ®åº“ï¼Œéš”ç¦»æ•°æ®æ¶æ„</li></ul><p>æ‰€æœ‰ç§Ÿæˆ·å…±åŒä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ï¼Œä½†æ˜¯å„è‡ªæœ‰å„è‡ªçš„ä¸€å¥—ä¸åŒçš„æ•°æ®è¡¨ç»“æ„ã€‚</p><blockquote><p>å…·ä½“æ¥è¯´ï¼Œå•å°æœºå™¨å®‰è£… MySQLï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„ schema ï¼ˆåº“ï¼‰åŒºåˆ†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¡¨ååŒºåˆ†ï¼Œä¾‹å¦‚ï¼ša_user, b_user</p></blockquote><ul><li>å…±äº«æ•°æ®åº“ï¼Œå…±äº«æ•°æ®æ¶æ„</li></ul><p>æ‰€æœ‰ç§Ÿæˆ·å…±äº«åŒä¸€ä¸ªæ•°æ®è¡¨ï¼ŒåŒä¸€ä¸ªæ•°æ®è¡¨ç»“æ„ï¼Œå­˜å‚¨åœ¨åŒä¸€æ¨¡å¼ä¸­ã€‚</p><blockquote><p>å…·ä½“æ¥è¯´ï¼Œå°†æ‰€æœ‰ç§Ÿæˆ·éƒ½è®°å½•åœ¨åŒä¸€å¼ è¡¨ä¸­ï¼Œé€šè¿‡ç‰¹å®šå­—æ®µåŒºåˆ†ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ TenantID åŒºåˆ«</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¼ ç»Ÿè½¯ä»¶æ¶æ„ï¼šå®¢æˆ·å±‚ã€è¡¨ç°å±‚ã€æ§åˆ¶å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®åº“å±‚&lt;/p&gt;
&lt;p&gt;å®¢æˆ·å±‚: ä¸€èˆ¬æŒ‡å®¢æˆ·ç«¯å’Œæµè§ˆå™¨&lt;/p&gt;
&lt;p&gt;è¡¨ç°å±‚: å°†å®¢æˆ·ç«¯çš„è¯·æ±‚æäº¤åˆ°ä¸šåŠ¡å±‚, å°†æ§åˆ¶å±‚çš„è¿”å›çš„æ•°æ®æ¸²æŸ“å±•ç¤ºç»™å®¢æˆ·&lt;/p&gt;
&lt;p&gt;æ§åˆ¶å±‚: ç­‰åŒäº MVC ä¸­çš„æ§åˆ¶å±‚ã€‚æ¥å—è¡¨ç°å±‚çš„è¯·æ±‚å¯»æ‰¾ç›¸åº”çš„</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Java æ—¥æœŸæ“ä½œé—®é¢˜æ±‡æ€»</title>
    <link href="http://example.com/2022/09/20/Java-%E6%97%A5%E6%9C%9F%E6%93%8D%E4%BD%9C%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"/>
    <id>http://example.com/2022/09/20/Java-%E6%97%A5%E6%9C%9F%E6%93%8D%E4%BD%9C%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</id>
    <published>2022-09-20T03:24:42.000Z</published>
    <updated>2022-09-22T12:14:24.775Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h2><p>è·å¾—æœ¬æœˆç¬¬ä¸€å¤©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">calendar.set(Calendar.DAY_OF_MONTH, <span class="number">1</span>);</span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> calendar.getTime();</span><br></pre></td></tr></table></figure><p>è·å¾—æœ¬æœˆæœ€åä¸€å¤©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">calendar.add(Calendar.MONTH, <span class="number">1</span>);</span><br><span class="line">calendar.set(Calendar.DAY_OF_MONTH, <span class="number">1</span>);</span><br><span class="line">calendar.add(Calendar.DAY_OF_MONTH, -<span class="number">1</span>);</span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> calendar.getTime();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Date&quot;&gt;&lt;a href=&quot;#Date&quot; class=&quot;headerlink&quot; title=&quot;Date&quot;&gt;&lt;/a&gt;Date&lt;/h2&gt;&lt;p&gt;è·å¾—æœ¬æœˆç¬¬ä¸€å¤©&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td clas</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Java çº¿ç¨‹æ± ç¬”è®°</title>
    <link href="http://example.com/2022/09/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/09/14/%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2022-09-14T10:40:44.000Z</published>
    <updated>2022-09-22T12:14:24.780Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h1><p>ThreadPoolExecutor ç»§æ‰¿äº† AbstractExecutorServiceï¼Œæˆå‘˜å˜é‡ ctl æ˜¯ä¸€ä¸ª Integer çš„åŸå­å˜é‡ï¼Œç”¨æ¥è®°å½•çº¿ç¨‹æ± çŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹ä¸ªæ•°ã€‚</p><blockquote><p>é«˜ 3 ä½ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼Œä½ 29 ä½ç”¨æ¥è®°å½•çº¿ç¨‹æ± çº¿ç¨‹ä¸ªæ•°ã€‚å³ï¼Œçº¿ç¨‹æ± çŠ¶æ€ç†è®ºä¸Šå¯ä»¥è‡³å¤šæ‹¥æœ‰ 8 ç§ã€‚</p></blockquote><p>å®é™…ä¸Šï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="left">çº¿ç¨‹æ± çŠ¶æ€</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">RUNNING</td><td align="left">æ¥æ”¶æ–°ä»»åŠ¡å¹¶ä¸”å¤„ç†é˜»å¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡</td></tr><tr><td align="left">SHUTDOWN</td><td align="left">æ‹’ç»æ–°ä»»åŠ¡ä½†æ˜¯å¤„ç†é˜»å¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡</td></tr><tr><td align="left">STOP</td><td align="left">æ‹’ç»æ–°ä»»åŠ¡å¹¶ä¸”æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼ŒåŒæ—¶ä¼šä¸­æ–­æ­£åœ¨å¤„ç†çš„ä»»åŠ¡</td></tr><tr><td align="left">TIDYING</td><td align="left">æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œï¼ˆåŒ…å«é˜»å¡é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡ï¼‰åå½“å‰çº¿ç¨‹æ± æ´»åŠ¨çº¿ç¨‹æ•°ä½ 0ï¼Œå°†è¦è°ƒç”¨ terminated æ–¹æ³•</td></tr><tr><td align="left">TERMINATED</td><td align="left">ç»ˆæ­¢çŠ¶æ€ã€‚terminated æ–¹æ³•è°ƒç”¨å®Œæˆä»¥åçš„çŠ¶æ€</td></tr></tbody></table><p>çº¿ç¨‹æ± å‚æ•°ï¼š</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">corePoolSize</td><td align="left">æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ä½¿ä»–ä»¬ç©ºé—²ä¹Ÿä¼šä¿æŒåœ¨çº¿ç¨‹æ± ä¸­</td></tr><tr><td align="left">maximumPoolSize</td><td align="left">çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°</td></tr><tr><td align="left">keepAliveTime</td><td align="left">ä¿æŒå­˜æ´»æ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹æ•°è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œè€Œä¸”è¶…è¿‡çš„çº¿ç¨‹ä¸åœ¨å·¥ä½œï¼ˆç©ºé—²ï¼‰ï¼Œä»–ä»¬å…è®¸æœ‰keepAliveTime çš„æ—¶é—´å­˜æ´»ï¼Œä»¥ä¾¿ç­‰å¾…æ–°ä»»åŠ¡ã€‚</td></tr><tr><td align="left">TimeUnit</td><td align="left">æ—¶é•¿å•ä½ï¼Œç”¨äº keepAliveTime</td></tr><tr><td align="left">workQueue</td><td align="left">ç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—</td></tr><tr><td align="left">threadFactory</td><td align="left">executor ç”¨äºåˆ›å»ºçº¿ç¨‹çš„å·¥å‚</td></tr><tr><td align="left">RejectedExecutionHandler</td><td align="left">é¥±å’Œç­–ç•¥ï¼Œå½“é˜Ÿåˆ—æ»¡å¹¶ä¸”çº¿ç¨‹ä¸ªæ•°è¾¾åˆ° maximunPoolSize åé‡‡å–çš„ç­–ç•¥</td></tr></tbody></table><ul><li>keepAliveTime</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒkeepAliveTime å¯ä»¥è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºçº¿ç¨‹è¿è¡Œå®Œæ¯•ç«‹å³é”€æ¯ï¼›keepAliveTime &lt; 0ï¼Œåˆå§‹åŒ–æ‰ä¼šæŠ¥é”™</p><p>å¦‚æœè°ƒç”¨äº† allowCoreThreadTimeOut(true)ï¼Œé‚£ä¹ˆ keepAlive &lt;&#x3D; 0 å°±ä¼šæŠ¥é”™ï¼Œè¿™è¡¨ç¤ºå…è®¸æ ¸å¿ƒçº¿ç¨‹ç­‰å¾…ä»»åŠ¡è¶…æ—¶ï¼Œè€Œä¸æ˜¯å¸¸é©»ã€‚</p><h2 id="newFixedThreadPool"><a href="#newFixedThreadPool" class="headerlink" title="newFixedThreadPool"></a>newFixedThreadPool</h2><p><code>newFixedThreadPool</code> åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°å’Œæœ€å¤§çº¿ç¨‹ä¸ªæ•°éƒ½ä¸º nThreads çš„çº¿ç¨‹æ± ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                      <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">//ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹åˆ›å»ºå·¥å‚</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads, ThreadFactory threadFactory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                      <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;(),</span><br><span class="line">                                      threadFactory);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>keepAliveTime ä¸º 0ï¼Œè¯´æ˜åªè¦çº¿ç¨‹ä¸ªæ•°æ¯”æ ¸å¿ƒçº¿ç¨‹ä¸ªæ•°å¤šå¹¶ä¸”å½“å‰ç©ºé—²åˆ™å›æ”¶ã€‚</p><p>è¿™é‡Œä¼ é€’äº† <code>new LinkedBlockingQueue&lt;Runnable&gt;()</code> ä½œä¸ºé˜»å¡é˜Ÿåˆ—ï¼Œé»˜è®¤å¤§å°ä¸º <code>Integer.MAX_VALUE</code>ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ã€‚</p><h2 id="newSingleThreadExecutor"><a href="#newSingleThreadExecutor" class="headerlink" title="newSingleThreadExecutor"></a>newSingleThreadExecutor</h2><p>åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½ä¸º 1 çš„çº¿ç¨‹æ± ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br></pre></td></tr></table></figure><p>æœ‰ç•Œé˜Ÿåˆ—ç¦æ­¢è®¾ç½®é•¿åº¦ä¸º 0ï¼Œè‡³å°‘æ˜¯ 1ï¼Œå› æ­¤ä¼¼ä¹æ²¡æœ‰åŠæ³•åšåˆ°ä»…å›ºå®šçº¿ç¨‹æ´»è·ƒï¼Œå…¶ä»–ä»»åŠ¡æ‹’ç»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯</span></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">threadPoolExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">            THREAD_POOL_SIZE, THREAD_POOL_SIZE, <span class="number">0L</span>, TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());</span><br></pre></td></tr></table></figure><h2 id="Executor"><a href="#Executor" class="headerlink" title="Executor"></a>Executor</h2><p>Executor &gt; ExecutorService &gt; AbstractExecutorService &gt; ThreadPoolExecutor</p><p>execute() å’Œ submit() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><ol><li><p>execute æ— æ³•è¿”å›å€¼ï¼›submit å¯ä»¥è¿”å›å€¼</p></li><li><p>submit åº•å±‚è°ƒç”¨äº† execute</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(</span></span><br><span class="line"><span class="params"><span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params"><span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params"><span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">TimeUnit unit,</span></span><br><span class="line"><span class="params">BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">RejectedExecutionHandler handler)</span></span><br></pre></td></tr></table></figure><h2 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown"></a>shutdown</h2><p>è°ƒç”¨ shutdown æ–¹æ³•åï¼Œçº¿ç¨‹æ± å°±ä¸ä¼šå†æ¥å—æ–°çš„ä»»åŠ¡äº†ï¼Œä½†æ˜¯å·¥ä½œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡è¿˜æ˜¯è¦æ‰§è¡Œçš„ã€‚è¯¥æ–¹æ³•ä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸ç­‰å¾…é˜Ÿåˆ—ä»»åŠ¡å®Œæˆå†è¿”å›ã€‚</p><h2 id="shutdownNow"><a href="#shutdownNow" class="headerlink" title="shutdownNow"></a>shutdownNow</h2><p>è°ƒç”¨ shutdownNow æ–¹æ³•åï¼Œçº¿ç¨‹æ± å°±ä¸ä¼šå†æ¥å—æ–°çš„ä»»åŠ¡äº†ï¼Œå¹¶ä¸”ä¼šä¸¢å¼ƒå·¥ä½œé˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡ï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¼šè¢«ä¸­æ–­ï¼Œè¯¥æ–¹æ³•ä¼šç«‹å³è¿”å›ï¼Œå¹¶ä¸ç­‰å¾…æ¿€æ´»çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚</p><h1 id="org-springframework-scheduling-concurrent-ThreadPoolTaskExecutor"><a href="#org-springframework-scheduling-concurrent-ThreadPoolTaskExecutor" class="headerlink" title="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"></a>org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor</h1><p>åˆ›å»ºä¸€ä¸ª Spring çº¿ç¨‹æ±  ThreadPoolTaskExecutor</p><p>å®ƒæš´éœ²äº†Executorçš„é…ç½®å‚æ•°ä½œä¸ºbeanå±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line"><span class="comment">//é…ç½®æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">executor.setCorePoolSize(<span class="number">100</span>);</span><br><span class="line"><span class="comment">//é…ç½®æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">executor.setMaxPoolSize(<span class="number">200</span>);</span><br><span class="line"><span class="comment">//é…ç½®é˜Ÿåˆ—å¤§å°</span></span><br><span class="line">executor.setQueueCapacity(<span class="number">2000000</span>);</span><br><span class="line"><span class="comment">//é…ç½®çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹çš„åç§°å‰ç¼€</span></span><br><span class="line">executor.setThreadNamePrefix(<span class="string">&quot;mythread-&quot;</span>);</span><br><span class="line"><span class="comment">//çº¿ç¨‹æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">executor.setKeepAliveSeconds(customPool.getKeepAliveSeconds());</span><br><span class="line"></span><br><span class="line"><span class="comment">// rejection-policyï¼šå½“poolå·²ç»è¾¾åˆ°max sizeçš„æ—¶å€™ï¼Œå¦‚ä½•å¤„ç†æ–°ä»»åŠ¡</span></span><br><span class="line"><span class="comment">// CALLER_RUNSï¼šä¸åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯æœ‰è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œ</span></span><br><span class="line">executor.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolRejectedPolicyHandler</span>());</span><br><span class="line"><span class="comment">//æ‰§è¡Œåˆå§‹åŒ–</span></span><br><span class="line">executor.initialize();</span><br><span class="line"><span class="keyword">return</span> executor;</span><br></pre></td></tr></table></figure><h1 id="çº¿ç¨‹æ± -main-çº¿ç¨‹ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ"><a href="#çº¿ç¨‹æ± -main-çº¿ç¨‹ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ" class="headerlink" title="çº¿ç¨‹æ±  main çº¿ç¨‹ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ"></a>çº¿ç¨‹æ±  main çº¿ç¨‹ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mainWait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">    executor.setCorePoolSize(<span class="number">5</span>); <span class="comment">//æ ¸å¿ƒæ± å¤§å°</span></span><br><span class="line">    executor.setMaxPoolSize(<span class="number">10</span>); <span class="comment">//æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">    executor.setQueueCapacity(<span class="number">10</span>); <span class="comment">//é˜Ÿåˆ—ç¨‹åº¦</span></span><br><span class="line">    executor.setThreadNamePrefix(<span class="string">&quot;sub-thread-&quot;</span>);<span class="comment">//çº¿ç¨‹å‰ç¼€åç§°</span></span><br><span class="line">    executor.initialize(); <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">5</span>; <span class="comment">// ä»»åŠ¡æ•°é‡</span></span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(count); <span class="comment">// åŒæ­¥å·¥å…·</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        executor.execute(() -&gt; task(countDownLatch));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;main çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹å®Œæˆ...&quot;</span>);</span><br><span class="line">    countDownLatch.await();</span><br><span class="line">    System.out.println(<span class="string">&quot;main çº¿ç¨‹å·¥ä½œç»“æŸ.&quot;</span>);</span><br><span class="line">    executor.shutdown();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">task</span><span class="params">(CountDownLatch countDownLatch)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å·¥ä½œå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">        Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">2000</span>));</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å·¥ä½œç»“æŸï¼&quot;</span>);</span><br><span class="line">        countDownLatch.countDown();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ThreadPoolExecutor&quot;&gt;&lt;a href=&quot;#ThreadPoolExecutor&quot; class=&quot;headerlink&quot; title=&quot;ThreadPoolExecutor&quot;&gt;&lt;/a&gt;ThreadPoolExecutor&lt;/h1&gt;&lt;p&gt;Thread</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>SMB åè®®å¯¹æ¥</title>
    <link href="http://example.com/2022/09/14/SMB-%E5%8D%8F%E8%AE%AE%E5%AF%B9%E6%8E%A5/"/>
    <id>http://example.com/2022/09/14/SMB-%E5%8D%8F%E8%AE%AE%E5%AF%B9%E6%8E%A5/</id>
    <published>2022-09-14T07:53:39.000Z</published>
    <updated>2022-09-22T12:14:24.776Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒå¼•ç”¨"><a href="#å‚è€ƒå¼•ç”¨" class="headerlink" title="å‚è€ƒå¼•ç”¨"></a>å‚è€ƒå¼•ç”¨</h1><p><a href="https://github.com/hierynomus/smbj">https://github.com/hierynomus/smbj</a></p><p>fileAttributesï¼ŒåŒ…å«æ–‡ä»¶å±æ€§æ©ç <br><a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/ca28ec38-f155-4768-81d6-4bfeb8586fc9">https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/ca28ec38-f155-4768-81d6-4bfeb8586fc9</a></p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>maven</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hierynomus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>smbj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SMB å…³äº Windows çš„å…±äº«æ–‡ä»¶å¤¹</p><p>å¦‚æœå¼€å¯äº†<strong>å¯†ç ä¿æŠ¤</strong>éœ€è¦æä¾›<strong>è´¦æˆ·</strong>å’Œ<strong>å¯†ç </strong></p><p>è®¡ç®—æœºå¤„äºç¡çœ çŠ¶æ€æ—¶æ— æ³•è®¿é—®å…±äº«ç›®å½•</p><p>å¦‚æœä¸º EveryOne å¼€å¯äº†è®¿é—®æƒé™ï¼Œå³ä½¿ä¸å­˜åœ¨çš„<strong>è´¦æˆ·</strong>ï¼Œä¹Ÿå¯ä»¥è®¿é—®ï¼Œæ­¤æ—¶å¯†ç åº”è¯¥è¢«å¿½ç•¥</p><p>å¦‚æœ<strong>è´¦æˆ·</strong>æ˜¯ç³»ç»Ÿå­˜åœ¨çš„ï¼Œåˆ™ä¼šè¿›è¡Œ<strong>å¯†ç </strong>è®¤è¯ï¼Œå¤±è´¥åˆ™ä¸é€šè¿‡ã€‚</p><h2 id="è·å¾—ä¸€ä¸ª-SMBClient"><a href="#è·å¾—ä¸€ä¸ª-SMBClient" class="headerlink" title="è·å¾—ä¸€ä¸ª SMBClient"></a>è·å¾—ä¸€ä¸ª SMBClient</h2><p>æ— å‚æ„é€ å™¨:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SMBClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SMBClient</span>();</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰é…ç½®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SmbConfig</span> <span class="variable">config</span> <span class="operator">=</span> SmbConfig.builder()</span><br><span class="line">        .withTimeout(<span class="number">120</span>, TimeUnit.SECONDS) <span class="comment">// Timeout sets Read, Write, and Transact timeouts (default is 60 seconds)</span></span><br><span class="line">        .withSoTimeout(<span class="number">180</span>, TimeUnit.SECONDS) <span class="comment">// Socket Timeout (default is 0 seconds, blocks forever)</span></span><br><span class="line">        .build();</span><br><span class="line"><span class="type">SMBClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SMBClient</span>(config);</span><br></pre></td></tr></table></figure><h2 id="è·å¾—ä¸€ä¸ª-Connection"><a href="#è·å¾—ä¸€ä¸ª-Connection" class="headerlink" title="è·å¾—ä¸€ä¸ª Connection"></a>è·å¾—ä¸€ä¸ª Connection</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨æ„å…³é—­</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> client.connect(<span class="string">&quot;127.0.0.1&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="comment">// å¯èƒ½ client connect è¶…æ—¶</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e.getMessage(), e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è·å¾—ä¸€ä¸ª-Session"><a href="#è·å¾—ä¸€ä¸ª-Session" class="headerlink" title="è·å¾—ä¸€ä¸ª Session"></a>è·å¾—ä¸€ä¸ª Session</h2><p>è·å¾—ä¸€ä¸ªä¼šè¯ç¤ºä¾‹ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> connection.authenticate(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AuthenticationContext</span>(<span class="string">&quot;USERNAME&quot;</span>, <span class="string">&quot;PASSWORD&quot;</span>.toCharArray(), <span class="literal">null</span>));</span><br></pre></td></tr></table></figure><h2 id="è·å¾—-DiskShare"><a href="#è·å¾—-DiskShare" class="headerlink" title="è·å¾— DiskShare"></a>è·å¾— DiskShare</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Connect to Share</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">DiskShare</span> <span class="variable">share</span> <span class="operator">=</span> (DiskShare) session.connectShare(<span class="string">&quot;shareDirectory&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (FileIdBothDirectoryInformation f : share.list(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;*.csv&quot;</span>)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File : &quot;</span> + f.getFileName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•´ä½“-Demo"><a href="#æ•´ä½“-Demo" class="headerlink" title="æ•´ä½“ Demo"></a>æ•´ä½“ Demo</h2><p>è·å¾—å…±äº«åç§°ä¸º shareDir ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åä¿¡æ¯ï¼Œå¹¶è¾“å‡º: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 1. ä½¿ç”¨ try è¯­å¥å—è‡ªåŠ¨å…³é—­èµ„æº</span></span><br><span class="line"><span class="comment">    * 2. client.connect å‚æ•° hostname å¯èƒ½å¯¼è‡´æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">    * 3. connection.authenticate è®¤è¯å¤±è´¥å¯èƒ½å¯¼è‡´æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">    * 4. session.connectShare shareName ä¸å­˜åœ¨å¯èƒ½å¯¼è‡´æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">    * 5. share.list ä¼ å…¥çš„ path é”™è¯¯å¯èƒ½å¯¼è‡´æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">SMBClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SMBClient</span>();</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> client.connect(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> connection.authenticate(<span class="keyword">new</span> <span class="title class_">AuthenticationContext</span>(<span class="string">&quot;USERNAME&quot;</span>, <span class="string">&quot;PASSWORD&quot;</span>.toCharArray(), <span class="literal">null</span>));</span><br><span class="line">        <span class="type">DiskShare</span> <span class="variable">share</span> <span class="operator">=</span> (DiskShare) session.connectShare(<span class="string">&quot;shareDir&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (FileIdBothDirectoryInformation f : share.list(<span class="string">&quot;&quot;</span>, <span class="string">&quot;*.csv&quot;</span>)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File : &quot;</span> + f.getFileName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="com-hierynomus-smbj-share-File"><a href="#com-hierynomus-smbj-share-File" class="headerlink" title="com.hierynomus.smbj.share.File"></a><code>com.hierynomus.smbj.share.File</code></h2><ul><li>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼ˆè¯»ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">smbFileRead</span> <span class="operator">=</span> dirShare.openFile(</span><br><span class="line">    fileName, <span class="comment">// è·¯å¾„</span></span><br><span class="line">    EnumSet.of(AccessMask.GENERIC_READ), <span class="comment">// Set&lt;AccessMask&gt;</span></span><br><span class="line">    <span class="literal">null</span>, <span class="comment">// Set&lt;FileAttributes&gt;</span></span><br><span class="line">    SMB2ShareAccess.ALL, <span class="comment">// Set&lt;SMB2ShareAccess&gt;</span></span><br><span class="line">    SMB2CreateDisposition.FILE_OPEN, <span class="comment">// SMB2CreateDisposition</span></span><br><span class="line">    <span class="literal">null</span>); <span class="comment">// Set&lt;SMB2CreateOptions&gt;</span></span><br></pre></td></tr></table></figure><p>SMB2CreateDisposition: å¦‚æœä¼ é€’ <code>FILE_OPEN</code>ï¼Œé‚£ä¹ˆæ–‡ä»¶æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›å¦‚æœè®¾ç½®ä¸º <code>FILE_OPEN_IF</code>ï¼Œé‚£ä¹ˆæ–‡ä»¶æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹ä¼šé™é»˜ç»§ç»­</p><ul><li>è¿œç¨‹æ‹·è´</li></ul><p>å°±æ˜¯ç›´æ¥åœ¨è¿œç¨‹æœºå™¨ä¸Šå°†ä¸€ä¸ªæ–‡ä»¶æ‹·è´åˆ°å¦ä¸€ä¸ªæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¡®ä¿æ‹·è´åˆ°çš„æ–‡ä»¶å¤¹å­˜åœ¨</span></span><br><span class="line"><span class="built_in">this</span>.ensureDirectoryExists(diskShare, dir);</span><br><span class="line">com.hierynomus.smbj.share.<span class="type">File</span> <span class="variable">backupShareFile</span> <span class="operator">=</span> diskShare.openFile(</span><br><span class="line">        <span class="string">&quot;copy-directory\\&quot;</span> + filename,</span><br><span class="line">        EnumSet.of(AccessMask.GENERIC_ALL), <span class="comment">// Set&lt;AccessMask&gt;</span></span><br><span class="line">        <span class="literal">null</span>, <span class="comment">// Set&lt;FileAttributes&gt;</span></span><br><span class="line">        SMB2ShareAccess.ALL, <span class="comment">// Set&lt;SMB2ShareAccess&gt;</span></span><br><span class="line">        SMB2CreateDisposition.FILE_CREATE, <span class="comment">// SMB2CreateDisposition</span></span><br><span class="line">        <span class="literal">null</span>);</span><br><span class="line">smbFile.remoteCopyTo(backupShareFile);</span><br></pre></td></tr></table></figure><ul><li>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª <code>File</code> æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FileIdBothDirectoryInformation</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isDirectory</span> <span class="operator">=</span> (f.getFileAttributes() &amp; <span class="number">0x10</span>) == <span class="number">0x10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// File</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">directory</span> <span class="operator">=</span> shareFile.getFileInformation().getStandardInformation().isDirectory();</span><br></pre></td></tr></table></figure><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h2><p>å°†å…±äº«æ–‡ä»¶å¤¹ <code>\\127.0.0.1\shareDirectory</code> ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½è½¬ç§»åˆ° <code>\\127.0.0.1\shareDirectory\backup</code> æ–‡ä»¶å¤¹ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">transferAllFiles</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SMBClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SMBClient</span>();</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> client.connect(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">            <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> connection.authenticate(<span class="keyword">new</span> <span class="title class_">AuthenticationContext</span>(<span class="string">&quot;USERNAME&quot;</span>, <span class="string">&quot;PASSWORD&quot;</span>.toCharArray(), <span class="literal">null</span>));</span><br><span class="line">            <span class="type">DiskShare</span> <span class="variable">share</span> <span class="operator">=</span> (DiskShare) session.connectShare(<span class="string">&quot;shareDirectory&quot;</span>)) &#123;</span><br><span class="line">        List&lt;FileIdBothDirectoryInformation&gt; fileIdBothDirectoryInformationList = share.list(path, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        fileIdBothDirectoryInformationList = fileIdBothDirectoryInformationList.stream().filter(fileIdBothDirectoryInformation -&gt; &#123;</span><br><span class="line">            <span class="comment">// è¿‡æ»¤æ‰æ–‡ä»¶å¤¹</span></span><br><span class="line">            <span class="keyword">return</span> (fileIdBothDirectoryInformation.getFileAttributes() &amp; <span class="number">0x10</span>) == <span class="number">0</span>;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (FileIdBothDirectoryInformation f : fileIdBothDirectoryInformationList) &#123;</span><br><span class="line">            com.hierynomus.smbj.share.<span class="type">File</span> <span class="variable">shareFile</span> <span class="operator">=</span> share.openFile(</span><br><span class="line">                    path + <span class="string">&quot;\\&quot;</span> + f.getFileName(), <span class="comment">// è·¯å¾„</span></span><br><span class="line">                    EnumSet.of(AccessMask.GENERIC_ALL), <span class="comment">// Set&lt;AccessMask&gt;</span></span><br><span class="line">                    <span class="literal">null</span>, <span class="comment">// Set&lt;FileAttributes&gt;</span></span><br><span class="line">                    SMB2ShareAccess.ALL, <span class="comment">// Set&lt;SMB2ShareAccess&gt;</span></span><br><span class="line">                    SMB2CreateDisposition.FILE_OPEN, <span class="comment">// SMB2CreateDisposition</span></span><br><span class="line">                    <span class="literal">null</span>); <span class="comment">// Set&lt;SMB2CreateOptions&gt;</span></span><br><span class="line">            com.hierynomus.smbj.share.<span class="type">File</span> <span class="variable">backupShareFile</span> <span class="operator">=</span> share.openFile(</span><br><span class="line">                    path + <span class="string">&quot;\\backup\\&quot;</span> + f.getFileName(),</span><br><span class="line">                    EnumSet.of(AccessMask.GENERIC_ALL), <span class="comment">// Set&lt;AccessMask&gt;</span></span><br><span class="line">                    <span class="literal">null</span>, <span class="comment">// Set&lt;FileAttributes&gt;</span></span><br><span class="line">                    SMB2ShareAccess.ALL, <span class="comment">// Set&lt;SMB2ShareAccess&gt;</span></span><br><span class="line">                    SMB2CreateDisposition.FILE_CREATE, <span class="comment">// SMB2CreateDisposition</span></span><br><span class="line">                    <span class="literal">null</span>);</span><br><span class="line">            shareFile.remoteCopyTo(backupShareFile);</span><br><span class="line">            <span class="comment">// æœ€åè¦åˆ æ‰</span></span><br><span class="line">            shareFile.deleteOnClose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‚è€ƒå¼•ç”¨&quot;&gt;&lt;a href=&quot;#å‚è€ƒå¼•ç”¨&quot; class=&quot;headerlink&quot; title=&quot;å‚è€ƒå¼•ç”¨&quot;&gt;&lt;/a&gt;å‚è€ƒå¼•ç”¨&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/hierynomus/smbj&quot;&gt;https://github.co</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Maven ç¬”è®°</title>
    <link href="http://example.com/2022/09/08/maven/Maven-%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/09/08/maven/Maven-%E7%AC%94%E8%AE%B0/</id>
    <published>2022-09-07T16:06:31.000Z</published>
    <updated>2022-09-22T12:14:24.780Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Maven-ç¬”è®°"><a href="#Maven-ç¬”è®°" class="headerlink" title="Maven ç¬”è®°"></a>Maven ç¬”è®°</h1><h2 id="Maven-æ˜¯ä»€ä¹ˆ"><a href="#Maven-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Maven æ˜¯ä»€ä¹ˆ"></a>Maven æ˜¯ä»€ä¹ˆ</h2><p><a href="https://maven.apache.org/what-is-maven.html">å®˜æ–¹ä»‹ç» What is  Maven?</a></p><p>Maven æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šå”¯ä¸€ç»´æŠ¤çš„ä¸€æ¬¾ã€è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‘ã€‚ä¸“æ³¨äº Java å¹³å°çš„ã€é¡¹ç›®æ„å»ºã€‘å’Œã€é¡¹ç›®ç®¡ç†ã€‘</p><h2 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h2><p>Maven ä¸ºæ„å»ºç®¡ç†å¸¦æ¥çš„å¼ºå¤§çš„é¢å¤–ç‰¹æ€§å°±æ˜¯é¡¹ç›®ç»§æ‰¿ (Inheritance) çš„æ¦‚å¿µã€‚</p><p>å¯¹äºçˆ¶å·¥ç¨‹å’Œèšåˆ (å¤šæ¨¡å—) å·¥ç¨‹ï¼Œ<code>packaging</code> ç±»å‹å¿…é¡»æ˜¯ <code>pom</code>ã€‚è¿™äº›ç±»å‹å®šä¹‰äº†ç»‘å®šåˆ°ä¸€ç»„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µçš„ç›®æ ‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ packaging æ˜¯ <code>jar</code>, é‚£ä¹ˆ <code>package</code> é˜¶æ®µå°±ä¼šæ‰§è¡Œ <code>jar:jar</code> ç›®æ ‡ã€‚</p><p>è¯·æ³¨æ„ <code>relativePath</code> å…ƒç´ ã€‚å®ƒä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªæŒ‡ç¤ºå™¨ï¼Œå‘Šè¯‰ Maven åœ¨æœç´¢æœ¬åœ°ä»¥åŠè¿œç¨‹ä»“åº“ä¹‹å‰ï¼Œé¦–å…ˆæœç´¢è¯¥å·¥ç¨‹çš„çˆ¶å·¥ç¨‹ç»™å®šçš„è·¯å¾„ã€‚</p><blockquote><p>ä¸ªäººæ„Ÿè§‰ <code>relativePath</code> ä½¿ç”¨åœºæ™¯å¾ˆå°</p></blockquote><h2 id="æ„å»ºé¡¹ç›®çš„ä¸»è¦ç¯èŠ‚"><a href="#æ„å»ºé¡¹ç›®çš„ä¸»è¦ç¯èŠ‚" class="headerlink" title="æ„å»ºé¡¹ç›®çš„ä¸»è¦ç¯èŠ‚"></a>æ„å»ºé¡¹ç›®çš„ä¸»è¦ç¯èŠ‚</h2><ul><li>cleanï¼šæ¸…ç†ï¼Œåˆ é™¤ä»¥å‰çš„ç¼–è¯‘ç»“æœ</li><li>compileï¼šç¼–è¯‘ï¼Œå°† Java æºç¨‹åºç¼–è¯‘ä¸ºå­—èŠ‚ç </li><li>testï¼šå¯¹é¡¹ç›®è¿›è¡Œæµ‹è¯•</li><li>packageï¼šå°†é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼Œä»¥ jar æˆ– war æ ¼å¼ã€‚</li><li>installï¼šå°†æ‰“åŒ…çš„ç»“æœ jar æˆ–è€… war å®‰è£…åˆ°æœ¬åœ°ä»“åº“ã€‚</li><li>deployï¼šå°†æ‰“åŒ…çš„ç»“æœéƒ¨ç½²åˆ°è¿œç¨‹ä»“åº“æˆ–è€… war åŒ…éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šè¿è¡Œ</li></ul><h2 id="Maven-å¸¸ç”¨å‘½ä»¤"><a href="#Maven-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Maven å¸¸ç”¨å‘½ä»¤"></a>Maven å¸¸ç”¨å‘½ä»¤</h2><p><code>mvn -version / mvn -v</code> æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯<br><code>mvn clean</code> æ¸…ç†<br><code>mvn compile</code> ç¼–è¯‘<br><code>mvn test</code> ç¼–è¯‘å¹¶æµ‹è¯•<br><code>mvn package</code> ç”Ÿæˆ target ç›®å½•ï¼Œç¼–è¯‘ã€æµ‹è¯•ä»£ç ï¼Œç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œç”Ÿæˆ jar&#x2F;war<br><code>mvn site</code> ç”Ÿæˆé¡¹ç›®ç›¸å…³ä¿¡æ¯çš„ç½‘ç«™<br><code>mvn clean compile</code> æ¸…ç†ä¹‹åç¼–è¯‘<br><code>mvn clean package</code> æ¸…ç†ä¹‹åæ‰“åŒ…<br><code>mvn clean install</code> æ¸…ç†ä¹‹åå®‰è£…<br><code>mvn clean deploy</code> æ¸…ç†ä¹‹åå‘å¸ƒ</p><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><h3 id="ä¾èµ–çš„èŒƒå›´"><a href="#ä¾èµ–çš„èŒƒå›´" class="headerlink" title="ä¾èµ–çš„èŒƒå›´"></a>ä¾èµ–çš„èŒƒå›´</h3><p>ä¾èµ–èŒƒå›´ <code>&lt;scope&gt;</code> æ§åˆ¶å“ªäº›ä¾èµ–åœ¨å“ªäº› classpath ä¸­å¯ç”¨ï¼Œå“ªäº›ä¾èµ–åŒ…å«åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ã€‚</p><p>ã€compileã€‘é»˜è®¤çš„èŒƒå›´ï¼›ç¼–è¯‘èŒƒå›´ä¾èµ–åœ¨æ‰€æœ‰çš„ classpath ä¸­å¯ç”¨ï¼ŒåŒæ—¶å®ƒä»¬ä¹Ÿä¼šè¢«æ‰“åŒ…ã€‚</p><p>ã€providedã€‘provided ä¾èµ–åªæœ‰åœ¨å½“ JDK æˆ–è€…ä¸€ä¸ªå®¹å™¨å·²æä¾›è¯¥ä¾èµ–ä¹‹åæ‰ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œ å¦‚æœä½ å¼€å‘äº†ä¸€ä¸ªweb åº”ç”¨ï¼Œä½ å¯èƒ½åœ¨ç¼–è¯‘ classpath ä¸­éœ€è¦å¯ç”¨çš„ Servlet API æ¥ç¼–è¯‘ä¸€ä¸ª servletï¼Œä½†æ˜¯ä½ ä¸ä¼šæƒ³è¦åœ¨æ‰“åŒ…å¥½çš„ WAR ä¸­åŒ…å«è¿™ä¸ªServlet APIï¼›è¿™ä¸ªServlet API JAR ç”±ä½ çš„åº”ç”¨æœåŠ¡å™¨æˆ–è€…servlet å®¹å™¨æä¾›ã€‚å·²æä¾›èŒƒå›´çš„ä¾èµ–åœ¨ç¼–è¯‘classpath ï¼ˆä¸æ˜¯è¿è¡Œæ—¶ï¼‰å¯ç”¨ã€‚å®ƒä»¬ä¸æ˜¯ä¼ é€’æ€§çš„ï¼Œä¹Ÿä¸ä¼šè¢«æ‰“åŒ…ã€‚</p><p>æˆ–è€…è¿˜æœ‰ lombok çš„ä½¿ç”¨ï¼Œæ‰“åŒ…å®Œæ¯•ä¹‹åä¾¿ä¸å†éœ€è¦åŒ…å«è¿™ä¸ª APIã€‚</p><p>ã€runtimeã€‘ runtime ä¾èµ–åœ¨è¿è¡Œå’Œæµ‹è¯•ç³»ç»Ÿçš„æ—¶å€™éœ€è¦ï¼Œä½†åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸éœ€è¦ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½åœ¨ç¼–è¯‘çš„æ—¶å€™åªéœ€è¦JDBC API JARï¼Œè€Œåªæœ‰åœ¨è¿è¡Œçš„æ—¶å€™æ‰éœ€è¦JDBC é©±åŠ¨å®ç°ã€‚</p><p>ã€testã€‘ testèŒƒå›´ä¾èµ– åœ¨ä¸€èˆ¬çš„ç¼–è¯‘å’Œè¿è¡Œæ—¶éƒ½ä¸éœ€è¦ï¼Œå®ƒä»¬åªæœ‰åœ¨æµ‹è¯•ç¼–è¯‘å’Œæµ‹è¯•è¿è¡Œé˜¶æ®µå¯ç”¨ã€‚</p><p>ã€systemã€‘ systemèŒƒå›´ä¾èµ–ä¸providedç±»ä¼¼ï¼Œä½†æ˜¯ä½ å¿…é¡»æ˜¾å¼çš„æä¾›ä¸€ä¸ªå¯¹äºæœ¬åœ°ç³»ç»Ÿä¸­JARæ–‡ä»¶çš„è·¯å¾„ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†å…è®¸åŸºäºæœ¬åœ°å¯¹è±¡ç¼–è¯‘ï¼Œè€Œè¿™äº›å¯¹è±¡æ˜¯ç³»ç»Ÿç±»åº“çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·çš„æ„å»ºåº”è¯¥æ˜¯ä¸€ç›´å¯ç”¨çš„ï¼ŒMaven ä¹Ÿä¸ä¼šåœ¨ä»“åº“ä¸­å»å¯»æ‰¾å®ƒã€‚å¦‚æœä½ å°†ä¸€ä¸ªä¾èµ–èŒƒå›´è®¾ç½®æˆç³»ç»ŸèŒƒå›´ï¼Œä½ å¿…é¡»åŒæ—¶æä¾›ä¸€ä¸ªsystemPathå…ƒç´ ã€‚æ³¨æ„è¯¥èŒƒå›´æ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼ˆå»ºè®®å°½é‡å»ä»å…¬å…±æˆ–å®šåˆ¶çš„ Maven ä»“åº“ä¸­å¼•ç”¨ä¾èµ–ï¼‰ã€‚</p><p>ã€importã€‘ import ä»…æ”¯æŒåœ¨ <code>&lt;dependencyManagement&gt;</code> ä¸­çš„ç±»å‹ä¾èµ–é¡¹ä¸Šã€‚è¯¥é€‰é¡¹å¯ä»¥ç”¨æ¥è§£å†³ Maven çš„å•ç»§æ‰¿ã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ spring-boot-starter-parent ä½œä¸ºé¡¹ç›®çš„çˆ¶å·¥ç¨‹ï¼Œå› ä¸ºå…¶ä¸­è¿›è¡Œäº†å¾ˆå¤šç‰ˆæœ¬ç®¡ç†ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¸Œæœ›å¼•å…¥å…¶ä»–ç‰ˆæœ¬ç®¡ç†çš„å·¥ç¨‹ï¼Œå¦‚ spring-cloudã€spring-cloud-alibabaã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="lt-version-gt"><a href="#lt-version-gt" class="headerlink" title="&lt;version&gt;"></a><code>&lt;version&gt;</code></h3><ul><li><code>&lt;parent&gt;</code> æ ‡ç­¾ä¸‹çš„ <code>&lt;version&gt;</code></li></ul><p>Snapshotç‰ˆæœ¬ä»£è¡¨ä¸ç¨³å®šã€å°šå¤„äºå¼€å‘ä¸­çš„ç‰ˆæœ¬  Releaseç‰ˆæœ¬åˆ™ä»£è¡¨ç¨³å®šçš„ç‰ˆæœ¬<br>å¦‚æœ deploy åˆ°è¿œç¨‹æœåŠ¡å™¨ å¦‚æœæ˜¯ release åªèƒ½ deploy ä¸€æ¬¡ï¼Œä»¥åéƒ¨ç½²çš„è¯ï¼Œå°±ä¼šæŠ¥é”™å†²çªï¼Œå› ä¸ºæ˜¯ç¨³å®šç‰ˆ<br>ä½†æ˜¯å¦‚æœæ˜¯ snapshot çš„è¯ï¼Œä½ å¯ä»¥ deploy å¤šæ¬¡ï¼Œæ¯ä¸€æ¬¡éƒ½ä¼šå†²æ‰åŸæ¥çš„ç‰ˆæœ¬ï¼Œè¡¨ç¤ºä¸ç¨³å®š</p><ul><li><code>&lt;dependency&gt;</code> ä¸‹çš„ <code>&lt;version&gt;</code></li></ul><p>æ˜¾å¼è®¾ç½®ä¾èµ–çš„ç‰ˆæœ¬</p><h3 id="lt-dependencyManagement-gt"><a href="#lt-dependencyManagement-gt" class="headerlink" title="&lt;dependencyManagement &gt;"></a><code>&lt;dependencyManagement &gt;</code></h3><p>Maven ä½¿ç”¨ dependencyManagement å…ƒç´ æ¥æä¾›ä¸€ç§ç®¡ç†<strong>ä¾èµ–ç‰ˆæœ¬</strong>çš„æ–¹å¼ã€‚é€šå¸¸ä¼šåœ¨ä¸€ä¸ªç»„ç»‡æˆ–é¡¹ç›®çš„æœ€é¡¶å±‚çš„çˆ¶ POM ä¸­çœ‹åˆ°ã€‚</p><p>ä½¿ç”¨ pom.xml ä¸­çš„ <code>&lt;dependencyManagement &gt; </code>èƒ½è®©æ‰€æœ‰åœ¨å­é¡¹ç›®ä¸­å¼•ç”¨ä¸€ä¸ªä¾èµ–è€Œä¸ç”¨æ˜¾å¼åœ°å†™ <code>&lt;version&gt;</code>ï¼ŒMaven ä¼šæ²¿ç€çˆ¶å­å±‚æ¬¡å‘ä¸Šæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ‹¥æœ‰ dependencyManagement å…ƒç´ çš„é¡¹ç›®ï¼Œç„¶åå®ƒå°±ä¼šä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬å·ã€‚</p><p>dependencyManagement åªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸å¼•å…¥ä¾èµ–ï¼Œå› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾å¼è¿›è¡Œä¾èµ–å¼•å…¥ã€‚</p><h3 id="lt-optional-gt"><a href="#lt-optional-gt" class="headerlink" title="&lt;optional&gt;"></a><code>&lt;optional&gt;</code></h3><p>é»˜è®¤ä¸º falseï¼Œoptional æ ‡ç­¾ è®¾ç½®ä¸ºtrue å¯ä»¥é˜²æ­¢ä¾èµ–ç»§æ‰¿åˆ° jar åŒ…ï¼Œæ¯”å¦‚ spring-boot-devtools</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Maven-ç¬”è®°&quot;&gt;&lt;a href=&quot;#Maven-ç¬”è®°&quot; class=&quot;headerlink&quot; title=&quot;Maven ç¬”è®°&quot;&gt;&lt;/a&gt;Maven ç¬”è®°&lt;/h1&gt;&lt;h2 id=&quot;Maven-æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#Maven-æ˜¯ä»€ä¹ˆ&quot; class=&quot;he</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Spring Framework Data Access</title>
    <link href="http://example.com/2022/08/26/Spring-Framework/Spring-Framework-Data-Access/"/>
    <id>http://example.com/2022/08/26/Spring-Framework/Spring-Framework-Data-Access/</id>
    <published>2022-08-26T03:50:01.000Z</published>
    <updated>2022-09-22T12:14:24.778Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Data-Access"><a href="#Data-Access" class="headerlink" title="Data Access"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#spring-data-tier">Data Access</a></h1><hr><h2 id="1-Transaction-Management"><a href="#1-Transaction-Management" class="headerlink" title="1. Transaction Management"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction">1. Transaction Management</a></h2><h3 id="1-1-Advantages-of-the-Spring-Frameworkâ€™s-Transaction-Support-Model"><a href="#1-1-Advantages-of-the-Spring-Frameworkâ€™s-Transaction-Support-Model" class="headerlink" title="1.1. Advantages of the Spring Frameworkâ€™s Transaction Support Model"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-motivation">1.1. Advantages of the Spring Frameworkâ€™s Transaction Support Model</a></h3><h3 id="1-1-1-Global-Transactions"><a href="#1-1-1-Global-Transactions" class="headerlink" title="1.1.1. Global Transactions"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-global">1.1.1. Global Transactions</a></h3><h2 id="1-2-Understanding-the-Spring-Framework-Transaction-Abstraction"><a href="#1-2-Understanding-the-Spring-Framework-Transaction-Abstraction" class="headerlink" title="1.2. Understanding the Spring Framework Transaction Abstraction"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-strategies">1.2. Understanding the Spring Framework Transaction Abstraction</a></h2><p>Spring äº‹åŠ¡æŠ½è±¡çš„å…³é”®åœ¨äºäº‹åŠ¡ç­–ç•¥æ¦‚å¿µã€‚äº‹åŠ¡ç­–ç•¥è¢«å®šä¹‰åœ¨ <code>TransactionManager</code>ï¼Œç‰¹åˆ«æ˜¯ï¼ŒPlatformTransactionManager ç”¨äºå‘½ä»¤å¼äº‹åŠ¡ç®¡ç†å’Œ ReactiveTransactionManager ç”¨äºå“åº”å¼äº‹åŠ¡ç®¡ç†ã€‚</p><p>PlatformTransactionManager ç±»ä¼¼ Spring Framework IoC å®¹å™¨çš„å…¶ä»– beanã€‚è¿™ç§å¥½å¤„æ˜¯ï¼Œè®© Spring Framework äº‹åŠ¡ç§°ä¸ºä¸€ä¸ªæŠ½è±¡ï¼Œå³ä½¿ä½ ä½¿ç”¨ JTAã€‚ä½ å¯ä»¥æ¯”ç›´æ¥ä½¿ç”¨ JTA æ›´è½»æ¾åœ°æµ‹è¯•äº‹åŠ¡ä»£ç ã€‚</p><p>åŒæ ·ï¼Œåœ¨ Spring ä¸­ï¼Œå¯ä»¥è¢«ä»»ä½• PlatformTransactionManager æ¥å£é¢æ–¹æ³•æŠ›å‡ºçš„ TransactionException æ˜¯æœªæ£€æŸ¥çš„ï¼ˆä¹Ÿå°±æ˜¯ç»§æ‰¿äº RuntimeExceptionï¼‰ã€‚äº‹åŠ¡åŸºç¡€æ¶æ„çš„é”™è¯¯æ€»æ˜¯è‡´å‘½çš„ã€‚åœ¨ç½•è§çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºçš„ä»£ç å¯ä»¥ä»äº‹åŠ¡å‘ç”Ÿçš„æ•…éšœä¸­æ¢å¤ï¼Œå¼€å‘äººå‘˜ä»ç„¶å¯ä»¥é€‰æ‹© catch å’Œå¤„ç† TransactionExceptionã€‚</p><p><code>TransactionDefinition</code> æ¥å£æŒ‡å®šå¦‚ä¸‹å†…å®¹ï¼š</p><ul><li>Propagationï¼šé€šå¸¸ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡èŒƒå›´ä¸­çš„æ‰€æœ‰ä»£ç è¿è¡Œåœ¨é‚£ä¸ªäº‹åŠ¡ä¸­ã€‚ä½†æ˜¯ï¼Œå¦‚æœå½“ä¸€ä¸ªäº‹åŠ¡ä¸Šä¸‹æ–‡å·²ç»å­˜åœ¨æ—¶ï¼Œè¿è¡Œäº†ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼Œåˆ™å¯ä»¥æŒ‡å®šè¿™ç§è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä»£ç å¯ä»¥ç»§ç»­è¿è¡Œåœ¨ç°æœ‰äº‹åŠ¡ä¸­ï¼ˆé€šå¸¸çš„æƒ…å†µï¼‰ï¼Œæˆ–è€…æš‚åœå·²å­˜åœ¨çš„äº‹åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€‚</li><li>Isolationï¼šéš”ç¦»çº§åˆ«ã€‚è¯¥äº‹åŠ¡ä»å…¶ä»–äº‹åŠ¡çš„å·¥ä½œä¸­éš”ç¦»çš„ç¨‹åº¦ã€‚</li><li>Timeoutï¼šè¶…æ—¶ã€‚åœ¨è¶…æ—¶ä¹‹å‰è¯¥äº‹åŠ¡å¯ä»¥è¿è¡Œçš„æ—¶é—´ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨ç”±äº‹åŠ¡åº•å±‚æœºåˆ¶å›æ»šã€‚</li><li>Read-only statusï¼šä½ å¯ä»¥åœ¨ä»£ç è¯»å–ä½†ä¸ä¿®æ”¹æ•°æ®æ—¶ä½¿ç”¨åªè¯»çŠ¶æ€ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåªè¯»äº‹åŠ¡æ—¶æœ‰ç”¨çš„ä¼˜åŒ–ï¼Œå¦‚ Hibernateã€‚</li></ul><p>è¿™äº›è®¾ç½®åæ˜ äº†æ ‡å‡†çš„äº‹åŠ¡æ¦‚å¿µã€‚</p><h3 id="1-4-Declarative-Transaction-Management"><a href="#1-4-Declarative-Transaction-Management" class="headerlink" title="1.4. Declarative Transaction Management"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-declarative">1.4. Declarative Transaction Management</a></h3><blockquote><p>å¤§å¤šæ•° Spring æ¡†æ¶ç”¨æˆ·é€‰æ‹©å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚æ­¤é€‰é¡¹å¯¹åº”ç”¨ç¨‹åºä»£ç å½±å“æœ€å°ï¼Œæ˜¯æœ€ç¬¦åˆéä¾µå…¥å¼è½»é‡å®¹å™¨çš„ç†æƒ³æ–¹å¼ã€‚</p></blockquote><p>åŸºäº Spring é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ï¼ŒSpring æ¡†æ¶çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯å¯èƒ½çš„ã€‚ä½†æ˜¯ï¼Œç”±äºäº‹åŠ¡åˆ‡é¢ä»£ç éšç€ Spring Framework å‘å¸ƒè€Œæ¥ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ ·æ¿ä¸­ä½¿ç”¨ï¼ŒAOP çš„æ¦‚å¿µæ²¡æœ‰å¿…è¦ç†è§£ä¸ºå……åˆ†åˆ©ç”¨è¿™æ®µä»£ç ã€‚</p><p>Spring Framework çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†ç±»ä¼¼äº EJB CMTï¼Œå› æ­¤ä½ å¯ä»¥æŒ‡å®šäº‹åŠ¡è¡Œä¸ºåˆ°å•ä¸ªæ–¹æ³•çº§åˆ«ã€‚å¦‚æœ‰å¿…è¦ï¼Œä½ å¯ä»¥åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ setRollBackOnly()ã€‚</p><h4 id="1-4-1-Understanding-the-Spring-Frameworkâ€™s-Declarative-Transaction-Implementation"><a href="#1-4-1-Understanding-the-Spring-Frameworkâ€™s-Declarative-Transaction-Implementation" class="headerlink" title="1.4.1. Understanding the Spring Frameworkâ€™s Declarative Transaction Implementation"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#tx-decl-explained">1.4.1. Understanding the Spring Frameworkâ€™s Declarative Transaction Implementation</a></h4><p>ä»…ä»…ä½¿ç”¨ <code>@Transactional</code> æ³¨è§£æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œè¿˜éœ€è¦æ·»åŠ  <code>@EnableTransactionManagement</code> åˆ°é…ç½®ç±»ä¸­ã€‚</p><p>æŒæ¡ Spring Framework å£°æ˜å¼äº‹åŠ¡æ”¯æŒæœ€é‡è¦çš„æ¦‚å¿µæ˜¯é€šè¿‡ AOP ä»£ç†å¼€å¯çš„æ”¯æŒå’Œç”±å…ƒæ•°æ®ï¼ˆXML æˆ–è€… æ³¨è§£ï¼‰é©±åŠ¨çš„ transactional adviceã€‚AOP å’Œäº‹åŠ¡å…ƒæ•°æ®çš„ç»„åˆäº§ç”Ÿäº† AOP ä»£ç†ï¼Œå…¶ä½¿ç”¨ TransactionInterceptor ä¸é€‚å½“çš„ TransactionManager å®ç°æ¥é©±åŠ¨å›´ç»•æ–¹æ³•è°ƒç”¨äº‹åŠ¡ã€‚</p><p>Spring æ¡†æ¶çš„ <code>TransactionInterceptor</code> ä¸ºå‘½ä»¤å¼å’Œå“åº”å¼ç¼–ç¨‹æ¨¡å‹æä¾›äº‹åŠ¡ç®¡ç†ã€‚æ‹¦æˆªå™¨é€šè¿‡æ£€æŸ¥æ–¹æ³•è¿”å›ç±»å‹æ¥æ£€æµ‹æ‰€éœ€çš„äº‹åŠ¡ç®¡ç†ã€‚</p><h4 id="1-4-6-Using-Transactional"><a href="#1-4-6-Using-Transactional" class="headerlink" title="1.4.6. Using @Transactional"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-declarative-annotations">1.4.6. Using @Transactional</a></h4><p>é™¤äº†åŸºäºæ³¨è§£çš„å£°æ˜å¼æ–¹å¼è¿›è¡Œäº‹åŠ¡é…ç½®ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨åŸºäºæ³¨è§£çš„æ–¹å¼ã€‚ç›´æ¥åœ¨ Java ä»£ç ä¸­å£°æ˜äº‹åŠ¡è¯­ä¹‰ä¸Šæ›´è´´è¿‘å—å½±å“çš„ä»£ç ã€‚</p><p>ä½¿ç”¨åœ¨ç±»çº§åˆ«ä¸Šï¼Œè¡¨ç¤ºæ³¨è§£é»˜è®¤ä½œç”¨åŸŸå£°æ˜ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼ˆåŒ…æ‹¬å­ç±»ï¼‰ã€‚æˆ–è€…ï¼Œæ¯ä¸ªæ–¹æ³•å¯ä»¥è¢«å•ç‹¬æ³¨è§£ã€‚æ³¨æ„ï¼Œç±»çº§åˆ«çš„æ³¨è§£ä¸ä¼šä½¿ç”¨ç¥–å…ˆç±»åˆ°ç±»çš„å±‚æ¬¡ç»“æ„ï¼›åœ¨è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œéœ€è¦åœ¨æœ¬åœ°é‡æ–°å£°æ˜ï¼Œä¸€è¾¹å‚ä¸å­ç±»çº§æ³¨è§£ã€‚</p><p>åœ¨ xml é…ç§ï¼Œæ ‡ç­¾ <code>&lt;tx:annotation-driven/&gt;</code>æä¾›ç›¸ä¼¼çš„ç®€ä¾¿æ–¹å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><blockquote><ul><li>å¦‚æœä½ æƒ³ç»‘å®šçš„ <code>TransactionManager</code> åç§°å°±æ˜¯ <code>transactionManager</code>ï¼Œä½ å¯ä»¥çœç•¥é…ç½® <code>&lt;tx:annotation-driven/&gt;</code> æ ‡ç­¾ä¸­çš„ <code>transaction-manager</code> å±æ€§ï¼›å¦åˆ™ä½ ä¸å¾—ä¸æŒ‡å®š <code>transaction-manager</code> å±æ€§ã€‚</li></ul></blockquote><h5 id="Transactional-Settings"><a href="#Transactional-Settings" class="headerlink" title="@Transactional Settings"></a>@Transactional Settings</h5><p><code>@Transactional</code> æ³¨è§£æ˜¯æŒ‡å®šæ¥å£ï¼Œç±»æˆ–è€…æ–¹æ³•å¿…é¡»å…·æœ‰äº‹åŠ¡è¯­ä¹‰ã€‚é»˜è®¤çš„ <code>@Transactional</code> è®¾ç½®å¦‚ä¸‹ï¼š</p><ul><li>ä¼ æ’­ç±»å‹ <code>PROPAGATION_REQUIRED</code></li><li>éš”ç¦»çº§åˆ« <code>ISOLATION_DEFAULT</code></li><li>äº‹åŠ¡æ˜¯è¯»å†™å‹</li><li>äº‹åŠ¡è¶…æ—¶é»˜è®¤ä¸ºåº•å±‚äº‹åŠ¡ç³»ç»Ÿçš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœä¸æ”¯æŒè¶…æ—¶ï¼Œåˆ™æ²¡æœ‰</li><li>ä»»ä½• <code>RuntimeException</code> è§¦å‘å›æ»šï¼Œä»»ä½•æ£€æŸ¥å‹ <code>Exception</code> å¹¶ä¸ä¼šã€‚</li></ul><p>&amp;nbsp;</p><h5 id="Custom-Composed-Annotations"><a href="#Custom-Composed-Annotations" class="headerlink" title="Custom Composed Annotations"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#tx-custom-attributes">Custom Composed Annotations</a></h5><h4 id="1-4-7-Transaction-Propagation"><a href="#1-4-7-Transaction-Propagation" class="headerlink" title="1.4.7. Transaction Propagation"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#tx-propagation">1.4.7. Transaction Propagation</a></h4><p>æœ¬èŠ‚æè¿° Spring ä¸­äº‹åŠ¡ä¼ æ’­çš„ä¸€äº›è¯­ä¹‰ã€‚è¯·æ³¨æ„ï¼Œæœ¬èŠ‚ä¸æ˜¯å¯¹äº‹åŠ¡ä¼ æ’­æœ¬èº«çš„ä»‹ç»ã€‚ç›¸åï¼Œå®ƒè¯¦ç»†æè¿°äº† Spring ä¸­å…³äºäº‹åŠ¡ä¼ æ’­çš„ä¸€äº›è¯­ä¹‰ã€‚</p><p>åœ¨ Spring ç®¡ç†çš„äº‹åŠ¡ä¸­ï¼Œè¦æ³¨æ„ç‰©ç†äº‹åŠ¡å’Œé€»è¾‘äº‹åŠ¡ä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠä¼ æ’­è®¾ç½®å¦‚ä½•åº”ç”¨çš„åŒºåˆ«ã€‚</p><h5 id="Understanding-PROPAGATION-REQUIRED"><a href="#Understanding-PROPAGATION-REQUIRED" class="headerlink" title="Understanding PROPAGATION_REQUIRED"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#tx-propagation-required">Understanding <code>PROPAGATION_REQUIRED</code></a></h5><img src="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/images/tx_prop_required.png"><p><code>PROPAGATION_REQUIRED</code> å¼ºåˆ¶æ‰§è¡Œä¸€ä¸ªç‰©ç†äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æœ¬åœ°ä¸ºå½“å‰èŒƒå›´å¼€å¯äº‹åŠ¡ï¼Œæˆ–è€…å‚ä¸å®šä¹‰ä¸ºæ›´å¤§èŒƒå›´çš„å·²ç»å­˜åœ¨çš„å¤–éƒ¨äº‹åŠ¡ã€‚åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…çš„å…¬ç”¨è°ƒç”¨æ ˆå®‰æ’ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤å€¼ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªå§”æ‰˜ç»™å‡ ä¸ªä»“åº“æ–¹æ³•çš„æœåŠ¡é—¨é¢ï¼Œå…¶ä¸­æ‰€æœ‰çš„åº•å±‚èµ„æºéƒ½å¿…é¡»å‚ä¸æœåŠ¡çº§åˆ«äº‹åŠ¡ï¼‰</p><p>å½“ä¼ æ’­è®¾ç½®ä¸º <code>PROPAGATION_REQUIRED</code> æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªè®¾ç½®åº”ç”¨çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªé€»è¾‘äº‹åŠ¡èŒƒå›´ã€‚æ¯ä¸ªæ­¤ç±»é€»è¾‘äº‹åŠ¡èŒƒå›´å¯ä»¥å•ç‹¬å†³å®šä»…å›æ»šçŠ¶æ€ï¼Œå¤–éƒ¨äº‹åŠ¡èŒƒå›´é€»è¾‘ä¸Šç‹¬ç«‹äºå†…éƒ¨äº‹åŠ¡èŒƒå›´ã€‚åœ¨æ ‡å‡†çš„ <code>PROPAGATION_REQUIRED</code> è¡Œä¸ºä¸‹ï¼Œæ‰€æœ‰è¿™äº›èŒƒå›´éƒ½æ˜ å°„ç›¸åŒçš„ç‰©ç†äº‹åŠ¡ã€‚å†…éƒ¨äº‹åŠ¡èŒƒå›´çš„ä»…å›æ»šæ ‡è®°ç¡®å®ä¼šå½±å“åˆ°å¤–éƒ¨äº‹åŠ¡å®é™…æäº¤çš„æœºä¼šã€‚</p><h5 id="Understanding-PROPAGATION-REQUIRES-NEW"><a href="#Understanding-PROPAGATION-REQUIRES-NEW" class="headerlink" title="Understanding PROPAGATION_REQUIRES_NEW"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#tx-propagation-requires_new">Understanding <code>PROPAGATION_REQUIRES_NEW</code></a></h5><p>ç›¸è¾ƒäº <code>PROPAGATION_REQUIRED</code>ï¼Œ<code>PROPAGATION_REQUIRES_NEW</code> æ€»æ˜¯ä¸ºæ¯ä¸ªå—å½±å“çš„äº‹åŠ¡èŒƒå›´ä½¿ç”¨ç‹¬ç«‹çš„ç‰©ç†äº‹åŠ¡ï¼Œä»ä¸å‚ä¸åˆ°å¤–éƒ¨èŒƒå›´çš„ç°æœ‰äº‹åŠ¡ä¸­å»ã€‚åœ¨è¿™ç§å®‰æ’ä¸‹ï¼Œåº•å±‚èµ„æºäº‹åŠ¡æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ï¼Œå¯ä»¥ç‹¬ç«‹æäº¤ã€å›æ»šï¼Œå¤–éƒ¨äº‹åŠ¡ä¸å—å†…éƒ¨äº‹åŠ¡å›æ»šçŠ¶æ€å½±å“ï¼Œå¹¶ä¸”å†…éƒ¨äº‹åŠ¡çš„é”åœ¨å®Œæˆåç«‹å³é‡Šæ”¾ã€‚è¿™ç§ç‹¬ç«‹çš„å†…éƒ¨äº‹åŠ¡ä¹Ÿå¯ä»¥å£°æ˜è‡ªå·±çš„éš”ç¦»çº§åˆ«ï¼Œè¶…æ—¶ï¼Œä»¥åŠæ˜¯å¦åªè¯»ï¼Œè€Œä¸ç»§æ‰¿å¤–éƒ¨äº‹ç‰©çš„ç‰¹å¾ã€‚</p><h5 id="Understanding-PROPAGATION-NESTED"><a href="#Understanding-PROPAGATION-NESTED" class="headerlink" title="Understanding PROPAGATION_NESTED"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#tx-propagation-nested">Understanding <code>PROPAGATION_NESTED</code></a></h5><p><code>PROPAGATION_NESTED</code> ä½¿ç”¨ä¸€ä¸ªå…·æœ‰å¤šä¸ªå¯ä»¥å›æ»šä¿å­˜ç‚¹çš„ç‰©ç†äº‹åŠ¡ã€‚è¿™ç§éƒ¨åˆ†å›æ»šè®©å†…éƒ¨äº‹åŠ¡èŒƒå›´è§¦å‘å…¶èŒƒå›´å†…çš„å›æ»šï¼Œå¹¶ä¸”å³ä½¿æŸäº›æ“ä½œå·²ç»å›æ»šï¼Œå¤–éƒ¨äº‹åŠ¡ä»èƒ½å¤Ÿç»§ç»­ç‰©ç†äº‹åŠ¡ã€‚è¿™ä¸ªè®¾ç½®é€šå¸¸æ˜ å°„åˆ° JDBC ä¿å­˜ç‚¹ï¼Œå› æ­¤å®ƒåªé€‚ç”¨äº JDBC èµ„æºäº‹åŠ¡ã€‚å‚è§ Spring çš„ <a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/javadoc-api/org/springframework/jdbc/datasource/DataSourceTransactionManager.html"><code>DataSourceTransactionManager</code></a></p><h4 id="1-5-3-Using-the-TransactionManager"><a href="#1-5-3-Using-the-TransactionManager" class="headerlink" title="1.5.3. Using the TransactionManager"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-programmatic-tm">1.5.3. Using the TransactionManager</a></h4><h5 id="Using-the-PlatformTransactionManager"><a href="#Using-the-PlatformTransactionManager" class="headerlink" title="Using the PlatformTransactionManager"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-programmatic-ptm">Using the PlatformTransactionManager</a></h5><p>å¯¹äºå¼ºåˆ¶æ€§çš„äº‹åŠ¡ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>org.springframework.transaction.PlatformTransactionManager</code> æ¥ç®¡ç†äº‹åŠ¡ã€‚ä¸ºæ­¤ï¼Œå°†ä½ è¦ä½¿ç”¨çš„ <code>PlatformTransactionManager</code> çš„å®ç°ç±»ä¼ é€’ç»™ä½ çš„ beanã€‚ç„¶åï¼Œé€šè¿‡ä½¿ç”¨ <code>TransactionDefinition</code> å’Œ <code>TransactionStatus</code> å¯¹è±¡ï¼Œä½ å¯ä»¥å¯åŠ¨ï¼Œå›æ»šä»¥åŠæäº¤äº‹åŠ¡ã€‚</p><h5 id="Using-the-ReactiveTransactionManager"><a href="#Using-the-ReactiveTransactionManager" class="headerlink" title="Using the ReactiveTransactionManager"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#transaction-programmatic-rtm">Using the ReactiveTransactionManager</a></h5><p>å½“ä½¿ç”¨å“åº”å¼äº‹åŠ¡æ—¶ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>org.springframework.transaction.ReactiveTransactionManager</code> ç®¡ç†ä½ çš„äº‹åŠ¡ã€‚</p><h3 id="1-6-Choosing-Between-Programmatic-and-Declarative-Transaction-Management"><a href="#1-6-Choosing-Between-Programmatic-and-Declarative-Transaction-Management" class="headerlink" title="1.6. Choosing Between Programmatic and Declarative Transaction Management"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#tx-decl-vs-prog">1.6. Choosing Between Programmatic and Declarative Transaction Management</a></h3><p>å½“ä½ å…·æœ‰å°‘é‡çš„äº‹åŠ¡æ“ä½œæ—¶ï¼Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†é€šå¸¸æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚</p><p>&amp;nbsp;</p><h2 id="2-DAO-Support"><a href="#2-DAO-Support" class="headerlink" title="2. DAO Support"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#dao">2. DAO Support</a></h2><h3 id="2-1-Consistent-Exception-Hierarchy"><a href="#2-1-Consistent-Exception-Hierarchy" class="headerlink" title="2.1. Consistent Exception Hierarchy"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#dao-exceptions">2.1. Consistent Exception Hierarchy</a></h3><p>Spring æä¾›äº†ç‰¹å®šå¼‚å¸¸åˆ°è‡ªå·±å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„çš„è½¬æ¢ã€‚è¯¥ç±»å±‚æ¬¡ç»“æ„å°† <code>DataAccessException</code> ä½œä¸ºæ ¹å¼‚å¸¸ã€‚</p><h2 id="3-Data-Access-with-JDBC"><a href="#3-Data-Access-with-JDBC" class="headerlink" title="3. Data Access with JDBC"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#jdbc">3. Data Access with JDBC</a></h2><h3 id="3-1-Choosing-an-Approach-for-JDBC-Database-Access"><a href="#3-1-Choosing-an-Approach-for-JDBC-Database-Access" class="headerlink" title="3.1. Choosing an Approach for JDBC Database Access"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#jdbc-choose-style">3.1. Choosing an Approach for JDBC Database Access</a></h3><p>ä½ å¯ä»¥é€‰æ‹©åŠä¸­æ–¹æ¥æ„å»º JDBC æ•°æ®åº“è®¿é—®åŸºç¡€ã€‚é™¤äº†ä¸‰ç§ JdbcTemplate ä¹‹å¤–ï¼Œä¸€ä¸ªæ–°çš„ SimpleJdbcInsert å’Œ SimpleJdbcCall æ–¹æ³•ä¼˜åŒ–äº†æ•°æ®åº“å…ƒæ•°æ®ï¼Œå¹¶ä¸” RDBMS å¯¹è±¡é£æ ¼é‡‡å–äº†ä¸€ç§æ›´é¢å‘å¯¹è±¡çš„æ–¹å¼ï¼Œç±»ä¼¼äº JDO æŸ¥è¯¢è®¾è®¡ã€‚</p><ul><li><code>JdbcTemplate</code> æ˜¯ç»å…¸ä¸”æœ€æµè¡Œçš„ Spring JDBC æ–¹å¼ã€‚è¿™ç§ â€œæœ€ä½çº§åˆ«â€ çš„æ–¹æ³•å’Œæ‰€æœ‰å…¶ä»–å°è£…çš„æ–¹æ³•ä½¿ç”¨ <code>JdbcTemplate</code></li><li><code>NamedParameterJdbcTemplate</code> åŒ…è£…äº†ä¸€ä¸ª <code>JdbcTemplate</code> ä»¥æä¾›å‘½åå‚æ•°è€Œä¸æ˜¯ä¼ ç»Ÿçš„ JDBC ? å ä½ç¬¦ã€‚å½“ä½ çš„ SQL è¯­å¥æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œè¿™ç§æ–¹æ³•æä¾›äº†æ›´å¥½çš„æ–‡æ¡£æ€§ä¸”æ˜“äºä½¿ç”¨ã€‚</li><li><code>SimpleJdbcInsert</code> å’Œ <code>SimpleJdbcCall</code> ä¼˜åŒ–äº†æ•°æ®åº“å…ƒæ•°æ®æ¥é™åˆ¶å¿…è¦é…ç½®çš„æ•°é‡ã€‚è¿™ç§æ–¹æ³•ç®€åŒ–äº†ç¼–ç ï¼Œä½ åªéœ€è¦æä¾›è¡¨åç§°ï¼Œæˆ–è€…å­˜å‚¨è¿‡ç¨‹åç§°ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªå‚æ•°ä¸åˆ—ååŒ¹é…çš„æ˜ å°„ã€‚</li></ul><h3 id="3-3-Using-the-JDBC-Core-Classes-to-Control-Basic-JDBC-Processing-and-Error-Handling"><a href="#3-3-Using-the-JDBC-Core-Classes-to-Control-Basic-JDBC-Processing-and-Error-Handling" class="headerlink" title="3.3. Using the JDBC Core Classes to Control Basic JDBC Processing and Error Handling"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#jdbc-core">3.3. Using the JDBC Core Classes to Control Basic JDBC Processing and Error Handling</a></h3><h4 id="3-3-1-Using-JdbcTemplate"><a href="#3-3-1-Using-JdbcTemplate" class="headerlink" title="3.3.1. Using JdbcTemplate"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#jdbc-JdbcTemplate">3.3.1. Using JdbcTemplate</a></h4><p><code>JdbcTemplate</code> æ˜¯ JDBC <code>core</code> åŒ…ä¸‹çš„æ ¸å¿ƒç±»ã€‚å®ƒå¤„ç†èµ„æºçš„åˆ›å»ºä¸é‡Šæ”¾ï¼Œè¿™å¯ä»¥å¸®åŠ©ä½ é¿å…ä¸€äº›å¸¸è§çš„é”™è¯¯ï¼Œæ¯”å¦‚å¿˜è®°å…³é—­è¿æ¥ã€‚å®ƒæ‰§è¡Œæ ¸å¿ƒ JDBC å·¥ä½œæµçš„åŸºæœ¬ä»»åŠ¡ï¼ˆå¦‚è¯­å¥çš„åˆ›å»ºå’Œæ‰§è¡Œï¼‰ï¼Œè®©åº”ç”¨ç¨‹åºä»£ç æ¥æä¾› SQL å’Œè·å–ç»“æœé›†ã€‚</p><p><code>JdbcTemplate</code> å¯ä»¥åšå¦‚ä¸‹çš„äº‹æƒ…ï¼š</p><ul><li>è¿è¡Œ SQL æŸ¥è¯¢</li><li>æ›´æ–°è¯­å¥ä»¥åŠå­˜å‚¨è¿‡ç¨‹è°ƒç”¨</li><li>æ‰§è¡Œ <code>ResultSet</code> çš„è¿­ä»£ï¼Œä»¥åŠæå–è¿”å›å‚æ•°å€¼çš„ç»“æœ</li><li>æ•è· JDBC å¼‚å¸¸ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå®šä¹‰åœ¨ <code>org.springframework.dao</code> åŒ…ä¸‹çš„æ›´é€šç”¨ï¼Œæ›´å…·ä¿¡æ¯æ„ä¹‰çš„å¼‚å¸¸å±‚æ¬¡</li></ul><p>å½“ä½ ä½¿ç”¨ <code>JdbcTemplate</code> æ—¶ï¼Œä½ åªéœ€è¦å®ç°ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œç»™å‡ºæ˜ç¡®å®šä¹‰çš„çº¦å®šã€‚ç»™å®šä¸€ä¸ª <code>JdbcTemplate</code> ç±»æä¾›çš„ <code>Connection</code>ï¼Œ<code>PreparedStatementCreator</code> å›è°ƒæ¥å£ä¼šåˆ›å»ºä¸€ä¸ª é¢„ç¼–è¯‘çš„è¯­å¥ï¼Œæä¾›äº† SQL ä»¥åŠä»»ä½•å¿…è¦çš„å‚æ•°ã€‚<code>CallableStatementCreator</code> æ¥å£ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒåˆ›å»ºå¯è°ƒç”¨çš„è¯­å¥ã€‚<code>RowCallbackHandler</code> æ¥å£ä» <code>ResultSet</code> çš„æ¯ä¸€è¡Œä¸­æå–å€¼ã€‚</p><p>ä½ å¯ä»¥åœ¨ä½ çš„ DAO å®ç°ä¸­é€šè¿‡ç»™äºˆä¸€ä¸ª <code>DataSource</code> çš„å¼•ç”¨ç›´æ¥å®ä¾‹åŒ– <code>JdbcTempalte</code> å¹¶ä½¿ç”¨ï¼›æˆ–è€…ï¼Œä½ å¯ä»¥é…ç½®å®ƒåˆ° Spring IoC å®¹å™¨é‡Œï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ª bean å¼•ç”¨ç»™ DAOã€‚</p><blockquote><p><code>DataSource</code> åº”å½“æ€»æ˜¯é…ç½®ä¸ºä¸€ä¸ª Spring Ioc å®¹å™¨ä¸­çš„ beanã€‚</p></blockquote><p>æ­¤ç±»å‘å‡ºçš„æ‰€æœ‰ SQL éƒ½ä»¥ debug çº§åˆ«çš„æ—¥å¿—è®°å½•ä¸‹æ¥ï¼Œ</p><h5 id="Querying-SELECT"><a href="#Querying-SELECT" class="headerlink" title="Querying (SELECT)"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#jdbc-JdbcTemplate-examples-query">Querying (SELECT)</a></h5><h5 id="Updating-INSERT-UPDATE-and-DELETE-with-JdbcTemplate"><a href="#Updating-INSERT-UPDATE-and-DELETE-with-JdbcTemplate" class="headerlink" title="Updating (INSERT, UPDATE, and DELETE) with JdbcTemplate"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#jdbc-JdbcTemplate-examples-update">Updating (INSERT, UPDATE, and DELETE) with JdbcTemplate</a></h5><h4 id="3-3-3-Using-SQLExceptionTranslator"><a href="#3-3-3-Using-SQLExceptionTranslator" class="headerlink" title="3.3.3. Using SQLExceptionTranslator"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/data-access.html#jdbc-SQLExceptionTranslator">3.3.3. Using SQLExceptionTranslator</a></h4><p>SQLExceptionTranslator æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”¨äº SQLExceptions å’Œ Spring çš„ DataAccessException ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p><p>SQLErrorCodeSQLExceptionTranslator æ˜¯ SQLExceptionTranslator é»˜è®¤çš„å®ç°ã€‚æ­¤å®ç°ä½¿ç”¨ç‰¹å®šçš„ä¾›åº”å•†ä»£ç ï¼Œæ¯” SQLState æ›´ç²¾ç¡®ã€‚é”™è¯¯ä»£ç è½¬æ¢åŸºäºåä¸º SQLErrorCodes çš„ JavaBean ç±»ä¸­ä¿å­˜çš„ä»£ç ã€‚æ­¤ç±»ç”± SQLErrorCodesFactory åˆ›å»ºå’Œå¡«å……ï¼Œæ˜¯åŸºäº sql-error-codes.xml çš„é…ç½®æ–‡ä»¶çš„å†…å®¹åˆ›å»ºçš„å·¥å‚ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Data-Access&quot;&gt;&lt;a href=&quot;#Data-Access&quot; class=&quot;headerlink&quot; title=&quot;Data Access&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://docs.spring.io/spring-framework/docs</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Spring è¯·æ±‚å‚æ•°å¤„ç†å®è·µ</title>
    <link href="http://example.com/2022/08/17/Spring-Framework/Spring-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E5%AE%9E%E8%B7%B5/"/>
    <id>http://example.com/2022/08/17/Spring-Framework/Spring-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E5%AE%9E%E8%B7%B5/</id>
    <published>2022-08-17T07:37:26.000Z</published>
    <updated>2022-09-22T12:14:24.778Z</updated>
    
    <content type="html"><![CDATA[<p>åœºæ™¯æè¿°ï¼šè¯·æ±‚ Content Type ä¸º <code>application/x-www-form-urlencoded</code>ï¼Œå³å‚æ•°ä»¥é”®å€¼å¯¹å½¢å¼ä¼ é€’ï¼Œå…¶ä¸­æœ‰ç®€å•ç±»å‹ï¼Œå¦‚ï¼šæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œä¹Ÿæœ‰ JSON ç±»å‹ï¼Œéœ€è¦ç»‘å®šåˆ° Spring çš„æ¨¡å‹ä¸­ï¼Œå®Œæˆæ ¡éªŒã€‚</p><p>å‚æ•°æ ¼å¼å‚è€ƒå¦‚ä¸‹ï¼Œä¸ºäº†ä¾¿äºæ˜¾ç¤ºï¼Œè¿›è¡Œäº†æ¢è¡Œ: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lesson_date=2022-08-08</span><br><span class="line">&amp;lesson_period_id=1</span><br><span class="line">&amp;subject_id=1</span><br><span class="line">&amp;grade_id=1</span><br><span class="line">&amp;class_id=1</span><br><span class="line">&amp;teacher_id=1</span><br><span class="line">&amp;student_list=[&#123;<span class="string">&quot;x&quot;</span>:0,<span class="string">&quot;y&quot;</span>:0,<span class="string">&quot;speak_num&quot;</span>:0,<span class="string">&quot;distract_num&quot;</span>:0,<span class="string">&quot;is_special&quot;</span>:0&#125;]</span><br></pre></td></tr></table></figure><p>å¦‚ä½•æ”¯æŒä¸‹åˆ’çº¿ä¼ å‚æ˜ å°„åˆ° Model æ¨¡å‹? è£…é¥°å™¨æ¨¡å¼ Request</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiParamCaseRequest</span> <span class="keyword">extends</span> <span class="title class_">HttpServletRequestWrapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String[]&gt; additionalParams;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiParamCaseRequest</span><span class="params">(HttpServletRequest request, Map&lt;String, String[]&gt; additionalParams)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(request);</span><br><span class="line">        <span class="built_in">this</span>.additionalParams = additionalParams;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Enumeration&lt;String&gt; <span class="title function_">getParameterNames</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> HashSet&lt;String&gt; parameterNames = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        parameterNames.addAll(getRequest().getParameterMap().keySet());</span><br><span class="line">        parameterNames.addAll(additionalParams.keySet());</span><br><span class="line">        <span class="keyword">return</span> Collections.enumeration(parameterNames);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getParameter</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">parameter</span> <span class="operator">=</span> <span class="built_in">super</span>.getParameter(name);</span><br><span class="line">        <span class="keyword">if</span> (parameter != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> parameter;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> String[] parameterValues = additionalParams.get(name);</span><br><span class="line">        <span class="keyword">if</span> (parameterValues != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (parameterValues.length == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> parameterValues[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] getParameterValues(String name) &#123;</span><br><span class="line">        <span class="keyword">final</span> String[] parameterValues = <span class="built_in">super</span>.getParameterValues(name);</span><br><span class="line">        <span class="keyword">if</span> (parameterValues != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> parameterValues;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> additionalParams.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamNameExtensionFilter</span> <span class="keyword">extends</span> <span class="title class_">HttpFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">underLinePattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;_(\\w)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        Map&lt;String, String[]&gt; additionalParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">final</span> Enumeration&lt;String&gt; parameterNames = request.getParameterNames();</span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, String[]&gt; parameterMap = request.getParameterMap();</span><br><span class="line">        <span class="keyword">while</span> (parameterNames.hasMoreElements()) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">parameterName</span> <span class="operator">=</span> parameterNames.nextElement();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">camelCaseParameterName</span> <span class="operator">=</span> <span class="built_in">this</span>.underLineToCamel(parameterName);</span><br><span class="line">            <span class="keyword">if</span> (parameterName.equals(camelCaseParameterName)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">final</span> String[] values = parameterMap.get(parameterName);</span><br><span class="line">            additionalParams.put(camelCaseParameterName, values);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">MultiParamCaseRequest</span> <span class="variable">multiParamCaseRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiParamCaseRequest</span>(request, additionalParams);</span><br><span class="line">        chain.doFilter(multiParamCaseRequest, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">underLineToCamel</span><span class="params">(<span class="keyword">final</span> String value)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">m</span> <span class="operator">=</span> <span class="built_in">this</span>.underLinePattern.matcher(value);</span><br><span class="line">        <span class="keyword">while</span> (m.find()) &#123;</span><br><span class="line">            m.appendReplacement(sb, m.group(<span class="number">1</span>).toUpperCase());</span><br><span class="line">        &#125;</span><br><span class="line">        m.appendTail(sb);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ Model å¯¹è±¡åŒ…å« <code>Collection</code>ï¼Œéœ€è¦å®šåˆ¶ DataBinder:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@InitBinder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initBinder</span><span class="params">(WebDataBinder dataBinder)</span> &#123;</span><br><span class="line">    dataBinder.registerCustomEditor(List.class, <span class="string">&quot;studentList&quot;</span>, <span class="keyword">new</span> <span class="title class_">PropertyEditorSupport</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAsText</span><span class="params">(String text)</span> <span class="keyword">throws</span> IllegalArgumentException &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(text)) &#123;</span><br><span class="line">                setValue(Collections.EMPTY_LIST);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    setValue(objectMapper.readValue(text, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;EvaluationVO.Student&gt;&gt;() &#123;</span><br><span class="line">                    &#125;));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœºæ™¯æè¿°ï¼šè¯·æ±‚ Content Type ä¸º &lt;code&gt;application/x-www-form-urlencoded&lt;/code&gt;ï¼Œå³å‚æ•°ä»¥é”®å€¼å¯¹å½¢å¼ä¼ é€’ï¼Œå…¶ä¸­æœ‰ç®€å•ç±»å‹ï¼Œå¦‚ï¼šæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œä¹Ÿæœ‰ JSON ç±»å‹ï¼Œéœ€è¦ç»‘å®šåˆ° Spring çš„æ¨¡å‹ä¸­ï¼Œå®Œæˆæ ¡éªŒã€‚&lt;/p&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>MyBatis Generator ç¬”è®°</title>
    <link href="http://example.com/2022/08/16/MyBatis/MyBatis-Generator-%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/08/16/MyBatis/MyBatis-Generator-%E7%AC%94%E8%AE%B0/</id>
    <published>2022-08-16T10:00:58.000Z</published>
    <updated>2022-09-22T12:14:24.775Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MyBatis-Generator-ç¬”è®°"><a href="#MyBatis-Generator-ç¬”è®°" class="headerlink" title="MyBatis Generator ç¬”è®°"></a>MyBatis Generator ç¬”è®°</h1><h2 id="XML-é…ç½®å‚è€ƒ"><a href="#XML-é…ç½®å‚è€ƒ" class="headerlink" title="XML é…ç½®å‚è€ƒ"></a>XML é…ç½®å‚è€ƒ</h2><h3 id="lt-context-gt-å…ƒç´ "><a href="#lt-context-gt-å…ƒç´ " class="headerlink" title="&lt;context&gt; å…ƒç´ "></a><code>&lt;context&gt;</code> å…ƒç´ </h3><h4 id="å¿…éœ€çš„å±æ€§"><a href="#å¿…éœ€çš„å±æ€§" class="headerlink" title="å¿…éœ€çš„å±æ€§"></a>å¿…éœ€çš„å±æ€§</h4><ul><li>id</li></ul><p>è¯¥ä¸Šä¸‹æ–‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚è¯¥å€¼å°†ä¼šåœ¨ä¸€äº›é”™è¯¯ä¿¡æ¯ä¸­ä½¿ç”¨åˆ°ã€‚</p><h4 id="å¯é€‰çš„å±æ€§"><a href="#å¯é€‰çš„å±æ€§" class="headerlink" title="å¯é€‰çš„å±æ€§"></a>å¯é€‰çš„å±æ€§</h4><ul><li>defaultModelType</li></ul><p>å¦‚æœ targer runtime æ˜¯ MyBatis3Simple, MyBatis3DynamicSql, æˆ–è€… MyBatis3Kotlinï¼Œè¯¥å±æ€§ä¼šè¢«å¿½ç•¥ã€‚</p><ul><li>targetRuntime</li></ul><p>è¯¥å±æ€§ç”¨äºç”Ÿæˆä»£ç çš„è¿è¡Œæ—¶ç›®æ ‡ã€‚</p><p><strong>MyBatisDynamicSql</strong></p><h4 id="æ”¯æŒçš„å±æ€§"><a href="#æ”¯æŒçš„å±æ€§" class="headerlink" title="æ”¯æŒçš„å±æ€§"></a>æ”¯æŒçš„å±æ€§</h4><ul><li><p>beginningDelimiter</p></li><li><p>endingDelimiter</p></li></ul><h3 id="lt-javaClientGenerator-gt-å…ƒç´ "><a href="#lt-javaClientGenerator-gt-å…ƒç´ " class="headerlink" title="&lt;javaClientGenerator&gt; å…ƒç´ "></a><code>&lt;javaClientGenerator&gt;</code> å…ƒç´ </h3><p><code>&lt;javaClientGenerator&gt;</code> å…ƒç´ ç”¨äºå®šä¹‰ Java å®¢æˆ·ç«¯ç”Ÿæˆå™¨çš„å±æ€§ã€‚</p><h4 id="å¿…éœ€çš„å±æ€§-1"><a href="#å¿…éœ€çš„å±æ€§-1" class="headerlink" title="å¿…éœ€çš„å±æ€§"></a>å¿…éœ€çš„å±æ€§</h4><ul><li>type</li></ul><p>è¯¥å±æ€§ç”¨æ¥é€‰æ‹©é¢„å®šä¹‰çš„ Java å®¢æˆ·ç«¯ç”Ÿæˆå™¨ä¹‹ä¸€ï¼Œæˆ–è€…æŒ‡å®šä¸€ä¸ªç”¨æˆ·æä¾›çš„ Java å®¢æˆ·ç«¯ç”Ÿæˆå™¨ã€‚</p><p><strong>XMLMAPPER</strong></p><p>ç”Ÿæˆçš„å¯¹è±¡æ˜¯ MyBatis 3.x mapper åŸºç¡€è®¾æ–½çš„ Java æ¥å£ã€‚æ¥å£å°†ä¾èµ–äºç”Ÿæˆçš„ XML mapper æ–‡ä»¶ã€‚</p><ul><li>targetPackage</li></ul><p>è¿™æ˜¯ç”Ÿæˆçš„æ¥å£å’Œå®ç°ç±»æ‰€åœ¨çš„åŒ…ã€‚</p><ul><li>targetProject</li></ul><p>è¿™ç”¨äºä¸ºç”Ÿæˆçš„æ¥å£å’Œç±»æŒ‡å®šç›®æ ‡é¡¹ç›®ã€‚</p><h3 id="lt-javaModelGenerator-gt-å…ƒç´ "><a href="#lt-javaModelGenerator-gt-å…ƒç´ " class="headerlink" title="&lt;javaModelGenerator&gt; å…ƒç´ "></a><code>&lt;javaModelGenerator&gt;</code> å…ƒç´ </h3><p><code>&lt;javaModelGenerator&gt;</code> å…ƒç´ ç”¨äºå®šä¹‰ Java æ¨¡å‹ç”Ÿæˆå™¨çš„å±æ€§ã€‚Java æ¨¡å‹ç”Ÿæˆå™¨æ„å»ºä¸»é”®ç±»ï¼Œè®°å½•ç±»ï¼Œä»¥åŠä¸è‡ªçœè¡¨åŒ¹é…çš„æŒ‰ç…§ Example ç±»æŸ¥è¯¢ã€‚è¯¥å…ƒç´ æ˜¯ <code>&lt;context&gt;</code> å…ƒç´ å¿…é¡»çš„å­å…ƒç´ ã€‚</p><h4 id="å¿…éœ€çš„å±æ€§-2"><a href="#å¿…éœ€çš„å±æ€§-2" class="headerlink" title="å¿…éœ€çš„å±æ€§"></a>å¿…éœ€çš„å±æ€§</h4><ul><li>targetPackage</li></ul><p>è¿™æ˜¯ç”Ÿæˆçš„ç±»å°†è¢«æ”¾ç½®çš„åŒ…ã€‚åœ¨é»˜è®¤çš„ç”Ÿæˆå™¨ä¸­ï¼Œå±æ€§ â€œenableSubPackagesâ€ æ§åˆ¶å¦‚ä½•è®¡ç®—å®é™…çš„åŒ…ã€‚å¦‚æœä¸º trueï¼Œåˆ™è®¡ç®—å‡ºçš„åŒ…æ˜¯ targetPackage åŠ ä¸Šè¡¨çš„ catalog å’Œ schema çš„å­åŒ…ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</p><ul><li>targetProject</li></ul><p>è¿™ç”¨äºä¸ºç”Ÿæˆçš„å¯¹è±¡æŒ‡å®šç›®æ ‡é¡¹ç›®ã€‚åœ¨ Eclipse ç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼Œè¿™å°†ä¼šæŒ‡å®šä¿å­˜å¯¹è±¡çš„é¡¹ç›®å’Œæºæ–‡ä»¶å¤¹ã€‚åœ¨å…¶ä»–ç¯å¢ƒä¸­ï¼Œè¯¥å€¼åº”è¯¥æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å·²ç»å­˜åœ¨çš„ç›®å½•ã€‚å¦‚æœæ­¤ç›®å½•ä¸å­˜åœ¨ï¼Œ MyBatis Generator å°†ä¸ä¼šåˆ›å»ºæ­¤ç›®å½•ã€‚</p><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚åœ¨ resources&#x2F;mybatis-generator&#x2F; ä¸‹é¢åˆ›å»º generatorConfig.xml é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;mybatis-generator/generator.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span>  <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;beginningDelimiter&quot;</span> <span class="attr">value</span>=<span class="string">&quot;`&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;endingDelimiter&quot;</span> <span class="attr">value</span>=<span class="string">&quot;`&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--æ³¨é‡Š--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ˜¯å¦å‹åˆ¶æ—¶é—´æˆ³--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Š trueï¼šæ˜¯ ï¼š false:å¦ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ³¨è§£é‡‡ç”¨æ•°æ®åº“çš„æ ‡æ³¨ï¼ŒsuppressAllComments å¿…é¡»è®¾ç½®ä¸º false æ‰ä¼šç”Ÿæ•ˆ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;addRemarkComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“è¿æ¥å‚æ•° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span></span></span><br><span class="line"><span class="tag">                <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/xxx?characterEncoding=utf8<span class="symbol">&amp;amp;</span>serverTimezone=UTC&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">userId</span>=<span class="string">&quot;xxx&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">password</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- mysql è·å–æ•°æ®åº“æ³¨è§£çš„æ–¹å¼ï¼Œæƒ³è¦è·å–æ•°æ®åº“æ³¨è§£å¿…é¡»æ·»åŠ  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;useInformationSchema&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å®ä½“ç±»çš„åŒ…åå’Œå­˜æ”¾è·¯å¾„ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- ç”Ÿæˆæ˜ å°„æ–‡ä»¶*.xmlçš„ä½ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- ç”ŸæˆDAOçš„åŒ…åå’Œä½ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- tableNameï¼šæ•°æ®åº“ä¸­çš„è¡¨åæˆ–è§†å›¾åï¼›domainObjectNameï¼šç”Ÿæˆçš„å®ä½“ç±»çš„ç±»å--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;book&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Book&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableSelectByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å­—æ®µåå’Œå…³é”®å­—å†²çªé—®é¢˜</li></ul><p>é…ç½®ç•Œå®šç¬¦</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;beginningDelimiter&quot;</span> <span class="attr">value</span>=<span class="string">&quot;`&quot;</span>&gt;</span>&lt;/property &gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;endingDelimiter&quot;</span> <span class="attr">value</span>=<span class="string">&quot;`&quot;</span>&gt;</span>&lt;/property &gt;</span><br></pre></td></tr></table></figure><p>åœ¨ table èŠ‚ç‚¹æ·»åŠ å±æ€§ <code>delimitAllColumns=&quot;true&quot;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MyBatis-Generator-ç¬”è®°&quot;&gt;&lt;a href=&quot;#MyBatis-Generator-ç¬”è®°&quot; class=&quot;headerlink&quot; title=&quot;MyBatis Generator ç¬”è®°&quot;&gt;&lt;/a&gt;MyBatis Generator ç¬”è®°&lt;/h1&gt;&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>OAuth 2.0 Authorization Server è®¾è®¡</title>
    <link href="http://example.com/2022/08/12/Security/OAuth-2-0-Authorization-Server-%E8%AE%BE%E8%AE%A1/"/>
    <id>http://example.com/2022/08/12/Security/OAuth-2-0-Authorization-Server-%E8%AE%BE%E8%AE%A1/</id>
    <published>2022-08-12T00:53:36.000Z</published>
    <updated>2022-09-07T13:43:59.975Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>OAuth 2.0 Client è®¾è®¡</title>
    <link href="http://example.com/2022/08/04/Security/OAuth-2.0-Client-%E8%AE%BE%E8%AE%A1/"/>
    <id>http://example.com/2022/08/04/Security/OAuth-2.0-Client-%E8%AE%BE%E8%AE%A1/</id>
    <published>2022-08-04T15:27:25.000Z</published>
    <updated>2022-09-07T13:43:59.975Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h2><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring boot web starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.oltu.oauth2<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>org.apache.oltu.oauth2.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><ul><li><p>AuthorizationServerConfig<br>æ¥å£ï¼Œæä¾›å„ä¸ªæˆæƒæœåŠ¡å™¨çš„åŸºæœ¬é…ç½®</p></li><li><p>AuthorizationServerToken<br>æ¥å£ï¼Œæä¾›å„ä¸ªæˆæƒæœåŠ¡å™¨çš„ token è®¿é—®</p></li><li><p>AuthorizationServer<br>å®ä½“ç±»ï¼Œå®ç°äº† token è®¿é—®å’ŒåŸºæœ¬ä¿¡æ¯è®¿é—®</p></li></ul><p><code>AuthorizationServer.java</code> ç”¨äºè¡¨ç¤ºè¯¥å®¢æˆ·ç«¯æ¥å…¥çš„æŸä¸€ä¸ªæˆæƒæœåŠ¡å™¨ã€‚</p><p>è€ƒè™‘åˆ°å®¢æˆ·ç«¯å¯èƒ½æ¥å…¥å¤šä¸ªæˆæƒæœåŠ¡å™¨ï¼Œå› æ­¤éœ€è¦ç»´æŠ¤å®¢æˆ·ç«¯åœ¨ä¸åŒæˆæƒæœåŠ¡å™¨ä¸­çš„åŸºç¡€ä¿¡æ¯ã€‚</p><p>åŸºç¡€ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li>name, æ ‡è¯†ä¸åŒæˆæƒæœåŠ¡å™¨</li><li>client_id, è¯¥æˆæƒæœåŠ¡å™¨ä¸­çš„ client_id</li><li>client_secret, è¯¥æˆæƒæœåŠ¡å™¨ä¸­ client_secret</li><li>access_token_uri, è¯¥æˆæƒæœåŠ¡å™¨æš´éœ²çš„ token è·å–ç«¯ç‚¹</li><li>user_info_uri, è¯¥èµ„æºæœåŠ¡å™¨æš´éœ²çš„ user_info è·å–ç«¯ç‚¹</li><li>redirect_uri, è·³è½¬åœ°å€</li><li>â€¦</li></ul><h4 id="AuthorizationServerConfig"><a href="#AuthorizationServerConfig" class="headerlink" title="AuthorizationServerConfig"></a>AuthorizationServerConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiangchunbo.oauth2.client.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorizationServerConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æˆæƒæœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ baiduã€tencent</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒæœåŠ¡å™¨çš„ authorize ç«¯ç‚¹åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> authorize_uri</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getAuthorizeUri</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒæœåŠ¡å™¨çš„ scope</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> scope</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getScope</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒåœ°å€é¢å¤–çš„è‡ªå®šä¹‰å‚æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getCustomParams</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * access_token è·å–åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> access_token_uri</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getAccessTokenUri</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯¥æˆæƒæœåŠ¡å™¨ä¸­çš„ client_id</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> client_id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getClientId</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯¥æˆæƒæœåŠ¡å™¨ä¸­ client_secret</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> client_secret</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getClientSecret</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·³è½¬åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> redirect_uri</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getRedirectUri</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç”¨æˆ·ä¿¡æ¯åœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user_info_uri</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getUserInfoUri</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AuthorizationServerToken"><a href="#AuthorizationServerToken" class="headerlink" title="AuthorizationServerToken"></a>AuthorizationServerToken</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jiangchunbo.oauth2.client.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorizationServerToken</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å­˜å‚¨çš„ access token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> access token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getAccessToken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å­˜å‚¨çš„ refresh token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> refresh token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getRefreshToken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å­˜å‚¨çš„ access token è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> access token è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getAccessTokenExpire</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å­˜å‚¨çš„ refresh token è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> refresh token è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getRefreshTokenExpire</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="AuthorizationServer"><a href="#AuthorizationServer" class="headerlink" title="AuthorizationServer"></a>AuthorizationServer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServer</span> <span class="keyword">implements</span> <span class="title class_">AuthorizationServerConfig</span>, AuthorizationServerToken &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String authorizeUri;</span><br><span class="line">    <span class="keyword">private</span> String scope;</span><br><span class="line">    <span class="keyword">private</span> String customParams;</span><br><span class="line">    <span class="keyword">private</span> String accessTokenUri;</span><br><span class="line">    <span class="keyword">private</span> String clientId;</span><br><span class="line">    <span class="keyword">private</span> String clientSecret;</span><br><span class="line">    <span class="keyword">private</span> String redirectUri;</span><br><span class="line">    <span class="keyword">private</span> String userInfoUri;</span><br><span class="line">    <span class="keyword">private</span> String accessToken;</span><br><span class="line">    <span class="keyword">private</span> String refreshToken;</span><br><span class="line">    <span class="keyword">private</span> String accessTokenExpire;</span><br><span class="line">    <span class="keyword">private</span> String refreshTokenExpire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCustomParams</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> customParams;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCustomParams</span><span class="params">(String customParams)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.customParams = customParams;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> scope;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScope</span><span class="params">(String scope)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.scope = scope;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccessTokenUri</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accessTokenUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccessTokenUri</span><span class="params">(String accessTokenUri)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accessTokenUri = accessTokenUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getClientId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clientId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setClientId</span><span class="params">(String clientId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clientId = clientId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getClientSecret</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> clientSecret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setClientSecret</span><span class="params">(String clientSecret)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clientSecret = clientSecret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRedirectUri</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redirectUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRedirectUri</span><span class="params">(String redirectUri)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redirectUri = redirectUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserInfoUri</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userInfoUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserInfoUri</span><span class="params">(String userInfoUri)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userInfoUri = userInfoUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAuthorizeUri</span><span class="params">(String authorizeUri)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.authorizeUri = authorizeUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAuthorizeUri</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.authorizeUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccessToken</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accessToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccessToken</span><span class="params">(String accessToken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accessToken = accessToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRefreshToken</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> refreshToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRefreshToken</span><span class="params">(String refreshToken)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.refreshToken = refreshToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccessTokenExpire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accessTokenExpire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccessTokenExpire</span><span class="params">(String accessTokenExpire)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accessTokenExpire = accessTokenExpire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRefreshTokenExpire</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> refreshTokenExpire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRefreshTokenExpire</span><span class="params">(String refreshTokenExpire)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.refreshTokenExpire = refreshTokenExpire;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æˆæƒæœåŠ¡å™¨é…ç½®-Bean"><a href="#æˆæƒæœåŠ¡å™¨é…ç½®-Bean" class="headerlink" title="æˆæƒæœåŠ¡å™¨é…ç½® Bean"></a>æˆæƒæœåŠ¡å™¨é…ç½® Bean</h3><p>åˆ›å»º Bean æ—¶è°ƒç”¨ init æ–¹æ³•ä»æ•°æ®åº“åŠ è½½æ‰€æœ‰é…ç½®åˆ°å†…å­˜</p><blockquote><p>ä¹Ÿå¯ä»¥è€ƒè™‘ä»é…ç½®æ–‡ä»¶åŠ è½½</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServerConfigProperties</span> <span class="keyword">extends</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, AuthorizationServerConfig&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AuthorizationServerMapper authorizationServerMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> List&lt;AuthorizationServerConfig&gt; configs = authorizationServerMapper.selectAllConfig();</span><br><span class="line">        <span class="keyword">if</span> (configs != <span class="literal">null</span> &amp;&amp; !configs.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (AuthorizationServerConfig config : configs) &#123;</span><br><span class="line">                <span class="built_in">this</span>.put(config.getName(), config);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DAO-Mapper"><a href="#DAO-Mapper" class="headerlink" title="DAO(Mapper)"></a>DAO(Mapper)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorizationServerMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¾æ®æˆæƒæœåŠ¡å™¨çš„æ ‡è¯†ç¬¦ä»æ•°æ®åº“è®¿é—®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name æˆæƒæœåŠ¡å™¨æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åŸºæœ¬é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AuthorizationServerConfig <span class="title function_">selectConfigByName</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ•°æ®åº“å–å‡ºæ‰€æœ‰çš„æˆæƒæœåŠ¡å™¨é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆæƒæœåŠ¡å™¨é…ç½®ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;AuthorizationServerConfig&gt; <span class="title function_">selectAllConfig</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¾æ®æˆæƒæœåŠ¡å™¨çš„æ ‡è¯†ç¬¦ä»æ•°æ®åº“å–å‡ºä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name æˆæƒæœåŠ¡å™¨æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆæƒæœåŠ¡å™¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    AuthorizationServer <span class="title function_">selectByName</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ä¸»é”® Id æ›´æ–°å­˜å‚¨çš„æˆæƒæœåŠ¡å™¨ token ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authorizationServer token ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id                  ä¸»é”® id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½±å“è¡Œæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">updateTokenById</span><span class="params">(<span class="meta">@Param(&quot;authorizationServer&quot;)</span> AuthorizationServer authorizationServer, <span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jiangchunbo.oauth2.client.mapper.AuthorizationServerMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateTokenById&quot;</span>&gt;</span></span><br><span class="line">        update `authorization_server`</span><br><span class="line">        set `access_token`=#&#123;authorizationServer.accessToken&#125;,</span><br><span class="line">            `access_token_expire`=#&#123;authorizationServer.accessTokenExpire&#125;,</span><br><span class="line">            `refresh_token`=#&#123;authorizationServer.refreshToken&#125;,</span><br><span class="line">            `refresh_token_expire` = #&#123;authorizationServer.refreshTokenExpire&#125;</span><br><span class="line">        where `id` = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectConfigByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.jiangchunbo.oauth2.client.entity.AuthorizationServer&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from `authorization_server`</span><br><span class="line">        where `name` = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.jiangchunbo.oauth2.client.entity.AuthorizationServer&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from `authorization_server`</span><br><span class="line">        where `name` = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllConfig&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.jiangchunbo.oauth2.client.entity.AuthorizationServer&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from `authorization_server` where `is_del`=0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthorizationServerService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–° token ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authorizationServer token ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id                  ä¸»é”® id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½±å“å‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">updateTokenById</span><span class="params">(AuthorizationServer authorizationServer, Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ code è¯·æ±‚ access_tokenï¼›å¦‚æœç¼“å­˜ token æœªè¿‡æœŸï¼Œåˆ™ä½¿ç”¨ç¼“å­˜ token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token code token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> access_token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getAccessToken</span><span class="params">(OAuthCodeToken token)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServerServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AuthorizationServerService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AuthorizationServerMapper authorizationServerMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">updateTokenById</span><span class="params">(AuthorizationServer authorizationServer, Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> authorizationServerMapper.updateTokenById(authorizationServer, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccessToken</span><span class="params">(OAuthCodeToken token)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> token.getName();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">AuthorizationServer</span> <span class="variable">server</span> <span class="operator">=</span> authorizationServerMapper.selectByName(name);</span><br><span class="line">        <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æœªæ‰¾åˆ° &quot;</span> + name + <span class="string">&quot; ç›¸å…³çš„é…ç½®&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(server.getAccessToken()) &amp;&amp; <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).parse(server.getAccessTokenExpire()).after(<span class="keyword">new</span> <span class="title class_">Date</span>())) &#123;</span><br><span class="line">            <span class="keyword">return</span> server.getAccessToken();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> token.getCode();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">OAuthClientRequest</span> <span class="variable">accessTokenRequest</span> <span class="operator">=</span> OAuthClientRequest.tokenLocation(server.getAccessTokenUri())</span><br><span class="line">                .setGrantType(GrantType.AUTHORIZATION_CODE)</span><br><span class="line">                .setClientId(server.getClientId())</span><br><span class="line">                .setClientSecret(server.getClientSecret())</span><br><span class="line">                .setCode(code)</span><br><span class="line">                .setRedirectURI(server.getRedirectUri())</span><br><span class="line">                .buildQueryMessage();</span><br><span class="line">        <span class="type">OAuthClient</span> <span class="variable">oAuthClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OAuthClient</span>(<span class="keyword">new</span> <span class="title class_">URLConnectionClient</span>());</span><br><span class="line">        <span class="type">OAuthAccessTokenResponse</span> <span class="variable">oAuthResponse</span> <span class="operator">=</span> oAuthClient.accessToken(accessTokenRequest, OAuth.HttpMethod.GET);</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessToken</span> <span class="operator">=</span> oAuthResponse.getAccessToken();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">refreshToken</span> <span class="operator">=</span> oAuthResponse.getRefreshToken();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">expiresIn</span> <span class="operator">=</span> oAuthResponse.getExpiresIn();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">accessTokenExpire</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)</span><br><span class="line">                .format(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + expiresIn * <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">refreshTokenExpire</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)</span><br><span class="line">                .format(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + <span class="number">10L</span> * <span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">AuthorizationServer</span> <span class="variable">authorizationServer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthorizationServer</span>();</span><br><span class="line">        authorizationServer.setAccessToken(accessToken);</span><br><span class="line">        authorizationServer.setRefreshToken(refreshToken);</span><br><span class="line">        authorizationServer.setAccessTokenExpire(accessTokenExpire);</span><br><span class="line">        authorizationServer.setRefreshTokenExpire(refreshTokenExpire);</span><br><span class="line">        <span class="built_in">this</span>.updateTokenById(authorizationServer, server.getId());</span><br><span class="line">        <span class="keyword">return</span> accessToken;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Shiro-ç›¸å…³çš„å‡†å¤‡"><a href="#Shiro-ç›¸å…³çš„å‡†å¤‡" class="headerlink" title="Shiro ç›¸å…³çš„å‡†å¤‡"></a>Shiro ç›¸å…³çš„å‡†å¤‡</h3><h3 id="Shiro-é…ç½®ç±»"><a href="#Shiro-é…ç½®ç±»" class="headerlink" title="Shiro é…ç½®ç±»"></a>Shiro é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;shiro.web.enabled&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Realm <span class="title function_">baiduOAuthRealm</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">BaiduOAuthRealm</span> <span class="variable">baiduOAuthRealm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BaiduOAuthRealm</span>();</span><br><span class="line">        baiduOAuthRealm.setAuthenticationTokenClass(OAuthCodeToken.class);</span><br><span class="line">        <span class="keyword">return</span> baiduOAuthRealm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;oauth2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> OAuth2AuthenticationFilter <span class="title function_">oAuth2AuthenticationFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OAuth2AuthenticationFilter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean&lt;OAuth2AuthenticationFilter&gt; <span class="title function_">oAuth2AuthenticationFilterRegistrationBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> FilterRegistrationBean&lt;OAuth2AuthenticationFilter&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;();</span><br><span class="line">        registrationBean.setFilter(oAuth2AuthenticationFilter());</span><br><span class="line">        registrationBean.setEnabled(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é…ç½® chain definition</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> chainDefinition</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">protected</span> ShiroFilterChainDefinition <span class="title function_">shiroFilterChainDefinition</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultShiroFilterChainDefinition</span> <span class="variable">chainDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShiroFilterChainDefinition</span>();</span><br><span class="line">        chainDefinition.addPathDefinition(<span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;oauth2&quot;</span>);</span><br><span class="line">        chainDefinition.addPathDefinition(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> chainDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AuthenticatingFilter"><a href="#AuthenticatingFilter" class="headerlink" title="AuthenticatingFilter"></a>AuthenticatingFilter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OAuth2AuthenticationFilter</span> <span class="keyword">extends</span> <span class="title class_">AuthenticatingFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">CODE_PARAM</span> <span class="operator">=</span> <span class="string">&quot;code&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">NAME_PARAM</span> <span class="operator">=</span> <span class="string">&quot;name&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“ isAccessDenied è¿”å› true æ—¶ï¼Œå›é€€åˆ°è¯¥æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸€èˆ¬ä¼šæ‰§è¡Œ login é€»è¾‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response å“åº”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦ç»§ç»­</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception executeLogin æŠ›å‡ºçš„ä¸€äº›å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">onAccessDenied</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> getSubject(request, response);</span><br><span class="line">        <span class="keyword">if</span> (!subject.isAuthenticated() &amp;&amp; !StringUtils.isEmpty(request.getParameter(CODE_PARAM))) &#123;</span><br><span class="line">            <span class="keyword">return</span> executeLogin(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡Œ login é€»è¾‘çš„æ—¶å€™åˆ›å»ºçš„ token</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response å“åº”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œ login çš„ token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationToken <span class="title function_">createToken</span><span class="params">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> request.getParameter(CODE_PARAM);</span><br><span class="line">        code = !StringUtils.isEmpty(code) ? code : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getParameter(NAME_PARAM);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OAuthCodeToken</span>(name, code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•å¤±è´¥çš„é€»è¾‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token    token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e        å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response å“åº”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦ç»§ç»­è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">onLoginFailure</span><span class="params">(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> OAuthResponse.errorResponse(HttpServletResponse.SC_BAD_REQUEST)</span><br><span class="line">                    .setError(<span class="string">&quot;é”™è¯¯&quot;</span>)</span><br><span class="line">                    .setErrorDescription(e.getMessage())</span><br><span class="line">                    .buildJSONMessage().getBody();</span><br><span class="line">            response.setContentType(MediaType.APPLICATION_JSON_VALUE);</span><br><span class="line">            response.setCharacterEncoding(StandardCharsets.UTF_8.name());</span><br><span class="line">            response.getWriter().print(body);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | OAuthSystemException ex) &#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AuthenticationToken"><a href="#AuthenticationToken" class="headerlink" title="AuthenticationToken"></a>AuthenticationToken</h3><p>å­˜å‚¨ code ä»¥åŠ name æ ‡è¯†æˆæƒæœåŠ¡å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OAuthCodeToken</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationToken</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆæƒç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯ä¸ªæˆæƒæœåŠ¡å™¨æ–¹çš„åå­—æ ‡è¯†ï¼Œå¦‚: baiduã€tencent</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OAuthCodeToken</span><span class="params">(String name, String code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getPrincipal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getCredentials</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h3><p><code>OAuthRealm</code> æä¾›åŸºæœ¬çš„ OAuth2 è·å–ç”¨æˆ·åçš„æµç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">OAuthRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthenticatingRealm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AuthorizationServerConfigProperties authorizationServerProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AuthorizationServerService authorizationServerService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="comment">// ç¡®ä¿ token ä¸­çš„ credential ä¸ authentication info çš„ credentials ä¸€è‡´ï¼Œå¦åˆ™åé¢éªŒè¯ä¼šå‡ºé”™</span></span><br><span class="line">        <span class="type">OAuthCodeToken</span> <span class="variable">codeToken</span> <span class="operator">=</span> (OAuthCodeToken) token;</span><br><span class="line">        <span class="type">SimpleAuthenticationInfo</span> <span class="variable">authenticationInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> extractUsername(codeToken);</span><br><span class="line">            authenticationInfo.setPrincipals(<span class="keyword">new</span> <span class="title class_">SimplePrincipalCollection</span>(username, getName()));</span><br><span class="line">            authenticationInfo.setCredentials(codeToken.getCode());</span><br><span class="line">            <span class="keyword">return</span> authenticationInfo;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> authenticationInfo;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title function_">extractUsername</span><span class="params">(OAuthCodeToken codeToken)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>BaiduOAuthRealm</code> å®ç°äº† <code>OAuthRealm</code>ï¼Œè¿”å› netdisk_name åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaiduOAuthRealm</span> <span class="keyword">extends</span> <span class="title class_">OAuthRealm</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">extractUsername</span><span class="params">(OAuthCodeToken codeToken)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">OAuthClient</span> <span class="variable">oAuthClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OAuthClient</span>(<span class="keyword">new</span> <span class="title class_">URLConnectionClient</span>());</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">accessToken</span> <span class="operator">=</span> authorizationServerService.getAccessToken(codeToken);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">AuthorizationServerConfig</span> <span class="variable">serverConfig</span> <span class="operator">=</span> authorizationServerProperties.get(codeToken.getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¿å­˜ access_token å’Œ expires in</span></span><br><span class="line">            <span class="type">OAuthClientRequest</span> <span class="variable">userInfoRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OAuthBearerClientRequest</span>(serverConfig.getUserInfoUri())</span><br><span class="line">                    .setAccessToken(accessToken)</span><br><span class="line">                    .buildQueryMessage();</span><br><span class="line">            <span class="type">OAuthResourceResponse</span> <span class="variable">resourceResponse</span> <span class="operator">=</span> oAuthClient.resource(userInfoRequest, OAuth.HttpMethod.GET, OAuthResourceResponse.class);</span><br><span class="line">            <span class="keyword">final</span> Map&lt;String, Object&gt; data = JSONUtils.parseJSON(resourceResponse.getBody());</span><br><span class="line">            <span class="keyword">return</span> data.get(<span class="string">&quot;netdisk_name&quot;</span>).toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (OAuthSystemException | OAuthProblemException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationException</span>(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Client&quot;&gt;&lt;a href=&quot;#Client&quot; class=&quot;headerlink&quot; title=&quot;Client&quot;&gt;&lt;/a&gt;Client&lt;/h2&gt;&lt;h3 id=&quot;ä¾èµ–&quot;&gt;&lt;a href=&quot;#ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;ä¾èµ–&quot;&gt;&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>OAuth2 è®¾è®¡</title>
    <link href="http://example.com/2022/08/03/Security/OAuth2-%E8%AE%BE%E8%AE%A1/"/>
    <id>http://example.com/2022/08/03/Security/OAuth2-%E8%AE%BE%E8%AE%A1/</id>
    <published>2022-08-03T12:02:33.000Z</published>
    <updated>2022-09-07T13:43:59.975Z</updated>
    
    <content type="html"><![CDATA[<h1 id="OAuth2-è®¾è®¡"><a href="#OAuth2-è®¾è®¡" class="headerlink" title="OAuth2 è®¾è®¡"></a>OAuth2 è®¾è®¡</h1><h2 id="æš´éœ²çš„ç«¯ç‚¹"><a href="#æš´éœ²çš„ç«¯ç‚¹" class="headerlink" title="æš´éœ²çš„ç«¯ç‚¹"></a>æš´éœ²çš„ç«¯ç‚¹</h2><ul><li><p>GET &#x2F;oauth&#x2F;authorize<br>è¯¥ç«¯ç‚¹é‡‡ç”¨ GET è¯·æ±‚ï¼Œä¸»è¦æ˜¯è®©ç”¨æˆ·èƒ½å¤Ÿè·³è½¬åˆ°æˆæƒé¡µé¢ã€‚</p></li><li><p>GET &#x2F;oauth&#x2F;confirm_access<br>æä¾›ç”¨æˆ·ç¡®è®¤æˆæƒçš„è§†å›¾</p></li><li><p>POST &#x2F;oauth&#x2F;authorize<br>ç”¨æˆ·ç¡®è®¤æˆæƒ</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;OAuth2-è®¾è®¡&quot;&gt;&lt;a href=&quot;#OAuth2-è®¾è®¡&quot; class=&quot;headerlink&quot; title=&quot;OAuth2 è®¾è®¡&quot;&gt;&lt;/a&gt;OAuth2 è®¾è®¡&lt;/h1&gt;&lt;h2 id=&quot;æš´éœ²çš„ç«¯ç‚¹&quot;&gt;&lt;a href=&quot;#æš´éœ²çš„ç«¯ç‚¹&quot; class=&quot;header</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Spring MVC ReturnValueHandler åŸç†</title>
    <link href="http://example.com/2022/07/30/Spring-Framework/Spring-MVC-ReturnValueHandlerr-%E5%8E%9F%E7%90%86/"/>
    <id>http://example.com/2022/07/30/Spring-Framework/Spring-MVC-ReturnValueHandlerr-%E5%8E%9F%E7%90%86/</id>
    <published>2022-07-30T09:28:13.000Z</published>
    <updated>2022-09-07T13:43:59.980Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-MVC-ReturnValueHandler-åŸç†"><a href="#Spring-MVC-ReturnValueHandler-åŸç†" class="headerlink" title="Spring MVC ReturnValueHandler åŸç†"></a>Spring MVC ReturnValueHandler åŸç†</h1><p>æœ¬æ–‡ç« ä¸­æåŠçš„ ReturnValueHandler å®é™…ä¸º <code>HandlerMethodReturnValueHandler</code> ç±»å‹ã€‚</p><p>è¯¥ <code>ReturnValueHandler</code> ä¼šåœ¨è°ƒç”¨ handler æ–¹æ³•çš„æ—¶å€™å‘æŒ¥ä½œç”¨ï¼Œå…¶ä¸­é€šè¿‡ä»¥ä¸‹ä»£ç æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å…¥ç±»å‹ä¸º HandlerMethodReturnValueHandlerCompositeï¼Œæ˜¯ä¸€ä¸ªå…·æœ‰è®¸å¤š ReturnValueHandler çš„ç±»å‹</span></span><br><span class="line">invocableMethod.setHandlerMethodReturnValueHandlers(<span class="built_in">this</span>.returnValueHandlers);</span><br></pre></td></tr></table></figure><h2 id="Handler-Method-å¤„ç†æ¡†æ¶"><a href="#Handler-Method-å¤„ç†æ¡†æ¶" class="headerlink" title="Handler Method å¤„ç†æ¡†æ¶"></a>Handler Method å¤„ç†æ¡†æ¶</h2><p>ä»¥ä¸‹æ˜¯ handler æ–¹æ³•è¢«è°ƒç”¨çš„æ•´ä½“æµç¨‹: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer, Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ handlerï¼Œè·å¾—è¿”å›å€¼</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">    setResponseStatus(webRequest);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (returnValue == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRequestNotModified(webRequest) || getResponseStatus() != <span class="literal">null</span> || mavContainer.isRequestHandled()) &#123;</span><br><span class="line">            disableContentCachingIfNecessary(webRequest);</span><br><span class="line">            mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(getResponseStatusReason())) &#123;</span><br><span class="line">        <span class="comment">// ä¸ ResponseStatus ç›¸å…³</span></span><br><span class="line">        mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mavContainer.setRequestHandled(<span class="literal">false</span>);</span><br><span class="line">    Assert.state(<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>, <span class="string">&quot;No return value handlers&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†è¿”å›å€¼</span></span><br><span class="line">        <span class="built_in">this</span>.returnValueHandlers.handleReturnValue(</span><br><span class="line">                returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(formatErrorForReturnValue(returnValue), ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Return-Value-å¤„ç†æ¡†æ¶"><a href="#Return-Value-å¤„ç†æ¡†æ¶" class="headerlink" title="Return Value å¤„ç†æ¡†æ¶"></a>Return Value å¤„ç†æ¡†æ¶</h2><p>è‹¥è¦å¤„ç†è¿”å›å€¼ï¼Œéœ€è¦æ‰¾åˆ°åˆé€‚çš„è¿”å›å€¼å¤„ç†å™¨ï¼Œç„¶åè°ƒç”¨å…¶ <code>handleReturnValue</code> æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œä»¥ä¸‹æ˜¯å¤„ç†è¿”å›å€¼çš„æ•´ä½“æµç¨‹ä»£ç æ¸…å•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HandlerMethodReturnValueHandlerComposite</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">        ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­-Return-Value-æ˜¯å¦æ”¯æŒ"><a href="#åˆ¤æ–­-Return-Value-æ˜¯å¦æ”¯æŒ" class="headerlink" title="åˆ¤æ–­ Return Value æ˜¯å¦æ”¯æŒ"></a>åˆ¤æ–­ Return Value æ˜¯å¦æ”¯æŒ</h2><p>å…³äºå¦‚ä½•åˆ¤æ–­ä¸€ä¸ª <code>ReturnValueHandler</code> æ˜¯å¦æ”¯æŒè¿™ç§è¿”å›å€¼ï¼Œä¸»è¦æ˜¯é€šè¿‡è‡ªå®šä¹‰å®ç°çš„æ–¹æ³• <code>supportsReturnType</code> å®Œæˆï¼Œä»¥ä¸‹æ˜¯æŒ‘é€‰åˆé€‚ <code>ReturnValueHandler</code> çš„ä»£ç æ¸…å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HandlerMethodReturnValueHandler <span class="title function_">selectHandler</span><span class="params">(<span class="meta">@Nullable</span> Object value, MethodParameter returnType)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isAsyncValue</span> <span class="operator">=</span> isAsyncReturnValue(value, returnType);</span><br><span class="line">    <span class="keyword">for</span> (HandlerMethodReturnValueHandler handler : <span class="built_in">this</span>.returnValueHandlers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isAsyncValue &amp;&amp; !(handler <span class="keyword">instanceof</span> AsyncHandlerMethodReturnValueHandler)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (handler.supportsReturnType(returnType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> handler;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ˜¯å¦æ”¯æŒè¯¥è¿”å›å€¼ï¼Œå…·ä½“é€»è¾‘æ ¹æ®ä¸åŒ <code>ReturnValueHandler</code> æœ‰æ‰€ä¸åŒï¼Œä½†ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯é€šè¿‡ç±»å‹åˆ¤æ–­</p></blockquote><p>åº”è¯¥æ³¨æ„åˆ°ï¼Œ<code>selectHandler</code> ä¼šé¦–å…ˆè°ƒç”¨ <code>isAsyncReturnValue</code> åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿”å›å€¼ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œå§‹ç»ˆè¿”å› falseï¼Œå› ä¸ºå¹¶ä¸å­˜åœ¨ <code>AsyncHandlerMethodReturnValueHandler</code> å®ä¾‹ï¼Œ<code>isAsyncReturnValue</code> é€»è¾‘å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAsyncReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object value, MethodParameter returnType)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (HandlerMethodReturnValueHandler handler : <span class="built_in">this</span>.returnValueHandlers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> AsyncHandlerMethodReturnValueHandler &amp;&amp;</span><br><span class="line">                ((AsyncHandlerMethodReturnValueHandler) handler).isAsyncReturnValue(value, returnType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring-MVC-æ”¯æŒçš„è¿”å›å€¼"><a href="#Spring-MVC-æ”¯æŒçš„è¿”å›å€¼" class="headerlink" title="Spring MVC æ”¯æŒçš„è¿”å›å€¼"></a>Spring MVC æ”¯æŒçš„è¿”å›å€¼</h2><ul><li><code>ModelAndView</code> å¯¹è±¡</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-MVC-ReturnValueHandler-åŸç†&quot;&gt;&lt;a href=&quot;#Spring-MVC-ReturnValueHandler-åŸç†&quot; class=&quot;headerlink&quot; title=&quot;Spring MVC ReturnValueHandle</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>è·å–ç”¨æˆ· IP</title>
    <link href="http://example.com/2022/07/28/%E5%B7%A5%E5%85%B7/%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7-IP/"/>
    <id>http://example.com/2022/07/28/%E5%B7%A5%E5%85%B7/%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7-IP/</id>
    <published>2022-07-28T03:34:25.000Z</published>
    <updated>2022-09-07T13:43:59.981Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">getIp</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">$ips = array();</span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>]) &#123;</span><br><span class="line">$ips[] = $_SERVER[<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]) &#123;</span><br><span class="line">$tmp = explode(<span class="string">&#x27;, &#x27;</span>, $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line">$ips = array_merge($ips, $tmp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) &#123;</span><br><span class="line">$ips[] = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line">$ip = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">foreach ($ips <span class="type">as</span> <span class="variable">$k</span> <span class="operator">=</span>&gt; $v) &#123;</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^(10|172\.16|192\.168)\./&#x27;</span>, $v) &amp;&amp; strtolower($v) != <span class="string">&#x27;unknown&#x27;</span>) &#123;</span><br><span class="line">$ip = $v;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $ip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>çŸ­ä¿¡æ¥å£é˜²ç›—ç”¨</title>
    <link href="http://example.com/2022/07/27/Security/%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E9%98%B2%E7%9B%97%E7%94%A8/"/>
    <id>http://example.com/2022/07/27/Security/%E7%9F%AD%E4%BF%A1%E6%8E%A5%E5%8F%A3%E9%98%B2%E7%9B%97%E7%94%A8/</id>
    <published>2022-07-27T08:49:03.000Z</published>
    <updated>2022-09-07T13:43:59.975Z</updated>
    
    <content type="html"><![CDATA[<ol><li>æ ¡éªŒ Referer å¤´éƒ¨</li><li>ç­¾åæ ¡éªŒ</li><li>mobile å‚æ•°å¯ä»¥ç•¥å¾®è¿›è¡Œ AES åŠ å¯†ç­‰ï¼Œå¢åŠ å¤æ‚åº¦</li><li>IP + UA é™åˆ¶æ¬¡æ•°<br>ä¾‹å¦‚ï¼Œä½¿ç”¨ Redis è®°å½•æ¬¡æ•°</li></ol><p>å‡è®¾ key ç‰¹å®šå‰ç¼€æ˜¯ code_send_limit_</p><p>key &#x3D; code_send_limit_ + <code>&lt;IP å’Œ UA çš„æ··åˆ&gt;</code><br>value &#x3D; æ¬¡æ•°</p><blockquote><p>incr  expireAt</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FrequencyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€å¤§é™åˆ¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxLimit;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¶é—´æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> periodInSeconds;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FrequencyInterceptor</span><span class="params">(<span class="type">int</span> maxLimit, <span class="type">int</span> periodInSeconds, RedisTemplate&lt;String, Object&gt; redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxLimit = maxLimit;</span><br><span class="line">        <span class="built_in">this</span>.periodInSeconds = periodInSeconds;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ipAddr</span> <span class="operator">=</span> IpUtil.getIpAddr(request);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userAgent</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;user-agent&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">md5</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;md5&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] digest = md5.digest((ipAddr + userAgent).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ipAndUa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, md5.digest()).toString(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;send_msg_limit:&quot;</span> + ipAndUa;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">limit</span> <span class="operator">=</span> (Integer) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (limit == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ­¤å¤„å¯èƒ½é«˜å¹¶å‘</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">newValue</span> <span class="operator">=</span> redisTemplate.opsForValue().increment(key);</span><br><span class="line">            <span class="keyword">if</span> (newValue == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å‡ºé”™</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç½‘ç»œç¹å¿™ï¼Œè¯·ç¨åé‡è¯•&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åªéœ€è€ƒè™‘ç¬¬ä¸€ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">            <span class="keyword">if</span> (newValue == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, Duration.ofSeconds(periodInSeconds));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newValue &lt;= maxLimit) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯æº¢å‡ºè¯·æ±‚ï¼Œå…¨éƒ¨æ‰“å›</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ“ä½œé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (limit &gt; <span class="number">5</span>) &#123;</span><br><span class="line">            <span class="comment">// ä¸€èˆ¬æƒ…å†µï¼Œæº¢å‡ºæ‰“å›</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ“ä½œé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">newValue</span> <span class="operator">=</span> redisTemplate.opsForValue().increment(key);</span><br><span class="line">            <span class="keyword">if</span> (newValue == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç½‘ç»œç¹å¿™ï¼Œè¯·ç¨åé‡è¯•&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (newValue &lt;= maxLimit) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ“ä½œé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;ol&gt;
&lt;li&gt;æ ¡éªŒ Referer å¤´éƒ¨&lt;/li&gt;
&lt;li&gt;ç­¾åæ ¡éªŒ&lt;/li&gt;
&lt;li&gt;mobile å‚æ•°å¯ä»¥ç•¥å¾®è¿›è¡Œ AES åŠ å¯†ç­‰ï¼Œå¢åŠ å¤æ‚åº¦&lt;/li&gt;
&lt;li&gt;IP + UA é™åˆ¶æ¬¡æ•°&lt;br&gt;ä¾‹å¦‚ï¼Œä½¿ç”¨ Redis è®°å½•æ¬¡æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‡è®¾ key ç‰¹</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Spring Framework Integration</title>
    <link href="http://example.com/2022/07/27/Spring-Framework/Spring-Framework-Integration/"/>
    <id>http://example.com/2022/07/27/Spring-Framework/Spring-Framework-Integration/</id>
    <published>2022-07-27T08:11:28.000Z</published>
    <updated>2022-09-07T13:43:59.980Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Integration"><a href="#Integration" class="headerlink" title="Integration"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#spring-integration">Integration</a></h1><hr><h2 id="Message-Conversion"><a href="#Message-Conversion" class="headerlink" title="Message Conversion"></a><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#rest-message-conversion">Message Conversion</a></h2><p>WebMvcConfigurationSupport å†…å«é»˜è®¤çš„ Converter</p><p>BufferedImageHttpMessageConverter è¿”å›å›¾ç‰‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/image/&#123;id&#125;&quot;, produces = MediaType.IMAGE_JPEG_VALUE)</span></span><br><span class="line"><span class="keyword">public</span> BufferedImage <span class="title function_">getImage</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Weather</span> <span class="variable">weather</span> <span class="operator">=</span> weatherMapper.getById(id);</span><br><span class="line">    <span class="keyword">return</span> ImageIO.read(weather.getPicture());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-Mail"><a href="#6-Mail" class="headerlink" title="6. Mail"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#mail">6. Mail</a></h2><p>Spring Boot çš„ä½¿ç”¨æ–¹å¼ï¼š</p><p>(1) é…ç½®å¹¶å°† <code>JavaMailSender</code> æ³¨å…¥åˆ° IOC å®¹å™¨ï¼Œç±»ä¼¼ä¸€ä¸ª Mail å·¥å‚é…ç½®ï¼Œå¯ä»¥ getSessionï¼Œä¹Ÿå¯ä»¥ createMimeMessage</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaMailConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;javaMailSender&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JavaMailSenderImpl <span class="title function_">javaMailSender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JavaMailSenderImpl</span> <span class="variable">javaMailSender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaMailSenderImpl</span>(); <span class="comment">// å”¯ä¸€çš„å®ç°</span></span><br><span class="line">        javaMailSender.setHost(<span class="string">&quot;smtp.qq.com&quot;</span>); <span class="comment">// è®¾ç½® SMTP ä¸»æœº</span></span><br><span class="line">        javaMailSender.setUsername(<span class="string">&quot;945086245@qq.com&quot;</span>);</span><br><span class="line">        javaMailSender.setPassword(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        javaMailSender.setDefaultEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> javaMailSender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2) ä½¿ç”¨ javaMailSender å‘é€ã€‚MimeMessageHelper ç±»ä¼¼ Builder è®¾è®¡ï¼Œä½†æ˜¯æ²¡æœ‰åšé“¾å¼è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MimeMessage</span> <span class="variable">mimeMessage</span> <span class="operator">=</span> javaMailSender.createMimeMessage();</span><br><span class="line"><span class="type">MimeMessageHelper</span> <span class="variable">mimeMessageHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(mimeMessage, <span class="literal">true</span>);</span><br><span class="line">mimeMessageHelper.setFrom(<span class="string">&quot;945086245@qq.com&quot;</span>); <span class="comment">// å‘é€äºº</span></span><br><span class="line">mimeMessageHelper.setTo(email); <span class="comment">// æ¥æ”¶äºº</span></span><br><span class="line">mimeMessageHelper.setSubject(<span class="string">&quot;éªŒè¯ç &quot;</span>);</span><br><span class="line">mimeMessageHelper.setText(<span class="string">&quot;æ‚¨çš„éªŒè¯ç æ˜¯: 9836, å¦‚éæœ¬äººæ“ä½œè¯·å¿½è§†ã€‚&quot;</span>);</span><br><span class="line">javaMailSender.send(mimeMessage);</span><br></pre></td></tr></table></figure><h2 id="7-Task-Execution-and-Scheduling"><a href="#7-Task-Execution-and-Scheduling" class="headerlink" title="7. Task Execution and Scheduling"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#scheduling">7. Task Execution and Scheduling</a></h2><p>Spring Framework åˆ†åˆ«ä½¿ç”¨ <code>TaskExecutor</code> å’Œ <code>TaskScheduler</code> æ¥å£ä¸ºå¼‚æ­¥æ‰§è¡Œå’Œä»»åŠ¡è°ƒåº¦æä¾›äº†æŠ½è±¡ã€‚Spring è¿˜å…·æœ‰é‚£äº›æ”¯æŒçº¿ç¨‹æ± çš„æ¥å£å®ç°æˆ–åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¯å¢ƒä¸­å§”æ‰˜ CommonJã€‚æœ€ç»ˆï¼Œé€šç”¨æ¥å£ä¹‹é—´çš„è¿™äº›å®ç°çš„ä½¿ç”¨æŠ½è±¡å‡ºäº† Java SE5ï¼ŒJava SE 6 ä»¥åŠ Java EE ç¯å¢ƒçš„å·®å¼‚ã€‚</p><p>Spring è¿˜å…·æœ‰æ”¯æŒä½¿ç”¨ <code>Timer</code> è°ƒåº¦çš„é›†æˆç±»ï¼Œä»¥åŠ Quartz Schedulerã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>FactoryBean</code>ï¼Œå¯é€‰çš„åˆ†åˆ«å¯¹ <code>Timer</code> æˆ–è€… <code>Trigger</code> å®ä¾‹çš„å¼•ç”¨è®¾ç½®è¿™ä¸¤ä¸ªè°ƒåº¦å™¨ã€‚æ­¤å¤–ï¼Œç”¨äº Quartz è°ƒåº¦å™¨å’Œ <code>Timer</code> çš„ä¾¿åˆ©ç±»æ˜¯å¯ç”¨çš„ï¼Œå®ƒè®©ä½ è°ƒç”¨ç°å­˜çš„ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼ˆç±»ä¼¼äºæ™®é€šçš„ <code>MethodInvokingFactoryBean</code> æ“ä½œï¼‰ã€‚</p><h3 id="7-1-The-Spring-TaskExecutor-Abstraction"><a href="#7-1-The-Spring-TaskExecutor-Abstraction" class="headerlink" title="7.1. The Spring TaskExecutor Abstraction"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#scheduling-task-executor">7.1. The Spring TaskExecutor Abstraction</a></h3><p>Executor æ˜¯ JDK ç”¨äºçº¿ç¨‹æ± æ¦‚å¿µçš„åç§°ã€‚ä¹‹æ‰€ä»¥å« â€œexecutorâ€ æ˜¯å› ä¸ºå®é™…ä¸Šä¸èƒ½ä¿è¯åº•å±‚çš„å®ç°å°±æ˜¯æ± ã€‚ä¸€ä¸ª executor å¯ä»¥æ˜¯å•çº¿ç¨‹ï¼Œç”šè‡³æ˜¯åŒæ­¥çš„ã€‚Spring çš„æŠ½è±¡éšè—äº† Java SE å’Œ Java EE ç¯å¢ƒä¹‹é—´çš„å®ç°ç»†èŠ‚ã€‚</p><p>Spring çš„ <code>TaskExecutor</code> æ¥å£ä¸ <code>java.util.concurrent.Executor</code> æ¥å£ç›¸åŒã€‚å®é™…ä¸Šï¼Œæœ€åˆå…¶ä¸»è¦å­˜åœ¨çš„åŸå› å°±æ˜¯åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™æŠ½è±¡å‡ºå¯¹ Java 5 çš„éœ€æ±‚ã€‚è¯¥æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼ˆ<code>execute(Runnable task)</code>ï¼‰ï¼Œè¯¥æ–¹æ³•æ¥å—ç»™äºˆçº¿ç¨‹æ± çš„è¯­ä¹‰å’Œé…ç½®çš„ä»»åŠ¡ã€‚</p><h4 id="7-1-1-TaskExecutor-Types"><a href="#7-1-1-TaskExecutor-Types" class="headerlink" title="7.1.1. TaskExecutor Types"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#scheduling-task-executor-types">7.1.1. TaskExecutor Types</a></h4><p>Spring åŒ…å«äº†è®¸å¤šé¢„ç½®çš„ <code>TaskExecutor</code> å®ç°ã€‚å¾ˆæœ‰å¯èƒ½ï¼Œä½ æ°¸è¿œä¸éœ€è¦å®ç°è‡ªå·±çš„ç±»ã€‚Spring æä¾›çš„å˜ä½“å¦‚ä¸‹ï¼š</p><ul><li><p><code>SyncTaskExecutor</code>: æ­¤å®ç°ä¸ä¼šå¼‚æ­¥è¿è¡Œè°ƒç”¨ã€‚ç›¸åï¼Œæ¯ä¸ªè°ƒç”¨éƒ½å‘ç”Ÿåœ¨è°ƒç”¨çº¿ç¨‹ä¸­ã€‚å®ƒä¸»è¦ç”¨äºä¸éœ€è¦å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨ç®€å•çš„æµ‹è¯•ç”¨ä¾‹ä¸­ã€‚</p></li><li><p><code>ThreadPoolTaskExecutor</code>: æ­¤å®ç°æœ€å¸¸ç”¨ã€‚å®ƒæš´éœ²äº†ç”¨äºé…ç½® <code>java.util.concurrent.ThreadPoolExecutor</code> çš„ Bean å±æ€§ï¼Œå¹¶å°†å…¶åŒ…è£…åœ¨ <code>TaskExecutor</code> ä¸­ã€‚å¦‚æœä½ éœ€è¦é€‚åº”å…¶ä»–ç±»å‹çš„ <code>java.util.concurrent.Executor</code>ï¼Œæˆ‘ä»¬å»ºè®®ä½ æ”¹ç”¨ <code>ConcurrentTaskExecutor</code>ã€‚</p></li></ul><h4 id="7-1-2-Using-a-TaskExecutor"><a href="#7-1-2-Using-a-TaskExecutor" class="headerlink" title="7.1.2. Using a TaskExecutor"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#scheduling-task-executor-usage">7.1.2. Using a TaskExecutor</a></h4><p>Spring çš„ <code>TaskExecutor</code> å®ç°è¢«ç”¨ä½œç®€å•çš„ Java Beanã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä½¿ç”¨ <code>ThreadPoolTaskExecutor</code> çš„ Beanï¼Œå¼‚æ­¥åœ°æ‰“å°ä¸€ç»„æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.core.task.TaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskExecutorExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">MessagePrinterTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">MessagePrinterTask</span><span class="params">(String message)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.message = message;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TaskExecutor taskExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TaskExecutorExample</span><span class="params">(TaskExecutor taskExecutor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.taskExecutor = taskExecutor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printMessages</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">25</span>; i++) &#123;</span><br><span class="line">            taskExecutor.execute(<span class="keyword">new</span> <span class="title class_">MessagePrinterTask</span>(<span class="string">&quot;Message&quot;</span> + i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½ æ‰€è§ï¼Œä½ æ²¡æœ‰ä»æ± ä¸­æ£€ç´¢çº¿ç¨‹å¹¶è‡ªå·±æ‰§è¡Œï¼Œè€Œæ˜¯å°†ä½ çš„ <code>Runnable</code> æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚ç„¶å <code>TaskExecutor</code> ä½¿ç”¨å…¶å†…éƒ¨è§„åˆ™æ¥å†³å®šä»»åŠ¡ä½•æ—¶è¿è¡Œã€‚</p><p>ä¸ºäº†é…ç½® <code>TaskExecutor</code> ä½¿ç”¨çš„è§„åˆ™ï¼Œæˆ‘ä»¬å°†å…¬å¼€ç®€å•çš„ Bean å±æ€§ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;taskExecutor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;corePoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;queueCapacity&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;taskExecutorExample&quot;</span> <span class="attr">class</span>=<span class="string">&quot;TaskExecutorExample&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;taskExecutor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="7-2-The-Spring-TaskScheduler-Abstraction"><a href="#7-2-The-Spring-TaskScheduler-Abstraction" class="headerlink" title="7.2. The Spring TaskScheduler Abstraction"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#scheduling-task-scheduler">7.2. The Spring TaskScheduler Abstraction</a></h3><p>é™¤äº† <code>TaskExecutor</code> æŠ½è±¡å¤–ï¼Œ</p><h2 id="8-Cache-Abstraction"><a href="#8-Cache-Abstraction" class="headerlink" title="8. Cache Abstraction"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache">8. Cache Abstraction</a></h2><h3 id="8-1-Understanding-the-Cache-Abstraction"><a href="#8-1-Understanding-the-Cache-Abstraction" class="headerlink" title="8.1. Understanding the Cache Abstraction"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-strategies">8.1. Understanding the Cache Abstraction</a></h3><p><strong>Buffer å’Œ Cache</strong></p><p>ä¸€èˆ¬åœ°ï¼Œbuffer å¯ä»¥ç¿»è¯‘ä¸ºç¼“å†²åŒºï¼Œç”¨äºé«˜é€Ÿä¸ä½é€Ÿçš„å®ä½“ä¹‹é—´çš„ä¸­é—´å­˜å‚¨ï¼Œç¼“å†²åŒºè‡³å°‘å¯¹çŸ¥æ™“å®ƒçš„ä¸€æ–¹æ˜¯å¯è§çš„ã€‚</p><p>cache å¯ä»¥ç¿»è¯‘ä¸ºç¼“å­˜ï¼Œæ ¹æ®å®šä¹‰æ˜¯éšè—çš„ï¼Œä»»ä½•ä¸€æ–¹éƒ½ä¸çŸ¥æ™“ã€‚</p><p><strong>Spring æä¾›äº†ä¸€äº›ç¼“å­˜æŠ½è±¡çš„å®ç°</strong>ï¼š</p><ul><li>SimpleCacheConfiguration</li><li>EhCacheCacheConfiguration</li><li>GenericCacheConfiguration</li><li>RedisCacheConfiguration</li><li>â€¦</li></ul><p>SpringBoot <code>CacheAutoConfiguration</code> ä¸­ä½¿ç”¨ <code>@Import</code> å¯¼å…¥äº† <code>CacheConfigurationImportSelector.class</code>ï¼Œå…¶ä¸­å¯¼å…¥äº†æšä¸¾ç±» <code>CacheType</code> ä¸­æ‰€æœ‰çš„ç¼“å­˜ç±»å‹ã€‚</p><p><strong>SimpleCacheConfiguration</strong></p><p>åº•å±‚ä½¿ç”¨ <code>concurrentMap</code> å®ç°ï¼Œè§ <code>SimpleCacheConfiguration</code>  æ³¨å…¥ <code>ConcurrentMapCacheManager</code>ã€‚<code>ConcurrentMapCacheManager </code> å±æ€§ <code>dynamic</code> å¯ä»¥é…ç½® <code>cacheName</code> æ˜¯å¦å¯ä»¥åŠ¨æ€ç”Ÿæˆï¼Œé»˜è®¤ä¸º trueã€‚</p><h3 id="8-2-Declarative-Annotation-based-Caching"><a href="#8-2-Declarative-Annotation-based-Caching" class="headerlink" title="8.2. Declarative Annotation-based Caching"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-annotations">8.2. Declarative Annotation-based Caching</a></h3><p>Spring ç¼“å­˜æŠ½è±¡æä¾›äº†ä¸€ç»„ Java æ³¨è§£ï¼š</p><ul><li><code>@Cacheable</code>ï¼šè§¦å‘ç¼“å­˜å¡«å……</li><li><code>@CacheEvict</code>ï¼šè§¦å‘ç¼“å­˜é©±é€</li><li><code>@CachePut</code>ï¼šåœ¨ä¸å¹²æ‰°æ–¹æ³•æ‰§è¡Œçš„æƒ…å†µä¸‹æ›´æ–°ç¼“å­˜</li><li><code>@Caching</code>ï¼šé‡æ–°ç»„åˆè¦åº”ç”¨äºæ–¹æ³•çš„å¤šä¸ªç¼“å­˜æ“ä½œ</li><li><code>@CacheConfig</code>ï¼šåœ¨ç±»çº§åˆ«å…±äº«ä¸€äº›å¸¸è§çš„ç¼“å­˜ç›¸å…³è®¾ç½®</li></ul><h4 id="8-2-1-The-Cacheable-Annotation"><a href="#8-2-1-The-Cacheable-Annotation" class="headerlink" title="8.2.1. The @Cacheable Annotation"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-annotations-cacheable">8.2.1. The @Cacheable Annotation</a></h4><table><thead><tr><th align="left">æ³¨è§£å±æ€§</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">value &#x2F; cacheNames</td><td align="left">ç¼“å­˜çš„åå­—</td></tr><tr><td align="left">key</td><td align="left">ç¼“å­˜æ•°æ®ä½¿ç”¨çš„ keyï¼Œé»˜è®¤ä½¿ç”¨æ–¹æ³•å‚æ•°</td></tr><tr><td align="left">keyGenerator</td><td align="left">è‡ªå®šä¹‰ key ç”Ÿæˆå™¨ï¼Œå®ç° KeyGenerator</td></tr><tr><td align="left">cacheManager</td><td align="left">æŒ‡å®šç¼“å­˜ç®¡ç†å™¨</td></tr><tr><td align="left">condition</td><td align="left">æŒ‡å®šç¬¦åˆæ¡ä»¶çš„æƒ…å†µä¸‹æ‰ç¼“å­˜</td></tr><tr><td align="left">unless</td><td align="left">ç¼“å­˜çš„å¦å®šæ¡ä»¶</td></tr><tr><td align="left">sync</td><td align="left">æ˜¯å¦ä½¿ç”¨å¼‚æ­¥æ¨¡å¼</td></tr></tbody></table><h5 id="Default-Key-Generation"><a href="#Default-Key-Generation" class="headerlink" title="Default Key Generation"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-annotations-cacheable-default-key">Default Key Generation</a></h5><p>key é»˜è®¤é‡‡ç”¨ <code>SimpleKeyGenerator</code> ç”Ÿæˆã€‚ä»¥æ–¹æ³•å‚æ•°ä¸ºæ ‡è¯†ã€‚</p><h5 id="Synchronized-Caching"><a href="#Synchronized-Caching" class="headerlink" title="Synchronized Caching"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-annotations-cacheable-synchronized">Synchronized Caching</a></h5><p>Spring Core æ¡†æ¶çš„ <code>CacheManager</code> å®ç°éƒ½æ”¯æŒ syncã€‚å…¶ä»–ç¼“å­˜åº“æœªå¿…ã€‚</p><h5 id="Available-Caching-SpEL-Evaluation-Context"><a href="#Available-Caching-SpEL-Evaluation-Context" class="headerlink" title="Available Caching SpEL Evaluation Context"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-spel-context">Available Caching SpEL Evaluation Context</a></h5><p>Cache SpEL å¯ç”¨å…ƒæ•°æ®ï¼Œå…·ä½“è§å®˜æ–¹è¡¨ã€‚</p><h4 id="8-2-2-The-CachePut-Annotation"><a href="#8-2-2-The-CachePut-Annotation" class="headerlink" title="8.2.2. The @CachePut Annotation"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-annotations-put">8.2.2. The @CachePut Annotation</a></h4><p>æ¯æ¬¡éƒ½è°ƒç”¨æ–¹æ³•ï¼Œç¼“å­˜ç»“æœã€‚</p><h4 id="8-2-3-The-CacheEvict-annotation"><a href="#8-2-3-The-CacheEvict-annotation" class="headerlink" title="8.2.3. The @CacheEvict annotation"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-annotations-evict">8.2.3. The @CacheEvict annotation</a></h4><p>æ¸…ç©ºç¼“å­˜</p><h4 id="8-2-6-Enabling-Caching-Annotations"><a href="#8-2-6-Enabling-Caching-Annotations" class="headerlink" title="8.2.6. Enabling Caching Annotations"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-annotation-enable">8.2.6. Enabling Caching Annotations</a></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-3-JCache-JSR-107-Annotations"><a href="#8-3-JCache-JSR-107-Annotations" class="headerlink" title="8.3. JCache (JSR-107) Annotations"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-jsr-107">8.3. JCache (JSR-107) Annotations</a></h3><p>ä» Spring 4.1 å¼€å§‹ï¼ŒSpring ç¼“å­˜æŠ½è±¡å®Œå…¨æ”¯æŒ JCache æ³¨è§£</p><h4 id="8-3-1-Feature-Summary"><a href="#8-3-1-Feature-Summary" class="headerlink" title="8.3.1. Feature Summary"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#cache-jsr-107-summary">8.3.1. Feature Summary</a></h4><table><thead><tr><th align="left">Spring</th><th align="left">JSR-107</th><th align="left">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="left">@Cacheable</td><td align="left">@CacheResult</td><td align="left"></td></tr><tr><td align="left">@CachePut</td><td align="left">@CachePut</td><td align="left"></td></tr><tr><td align="left">@CacheEvict</td><td align="left">@CacheRemove</td><td align="left"></td></tr><tr><td align="left">@CacheEvict(allEntries&#x3D;true)</td><td align="left">@CacheRemoveAll</td><td align="left"></td></tr><tr><td align="left">@CacheConfig</td><td align="left">@CacheDefaults</td><td align="left"></td></tr></tbody></table><p>JCache çš„ CacheResolver æ¦‚å¿µä¸Šä¸ Spring CacheResolver æ¥å£ç›¸åŒï¼Œåªæ˜¯ JCache ä»…æ”¯æŒå•ä¸ª Cacheã€‚é»˜è®¤ï¼ŒSimple å®ç°ä¼šæ ¹æ®æ³¨è§£ä¸Šçš„åç§°æ£€ç´¢è¦ä½¿ç”¨çš„ Cacheï¼Œå¦‚æœæ³¨è§£ä¸Šæ²¡æœ‰æŒ‡å®šåç§°ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤å€¼ã€‚</p><h4 id="8-3-2-Enabling-JSR-107-Support"><a href="#8-3-2-Enabling-JSR-107-Support" class="headerlink" title="8.3.2. Enabling JSR-107 Support"></a><a href="https://docs.spring.io/spring-framework/docs/5.2.17.RELEASE/spring-framework-reference/integration.html#enabling-jsr-107-support">8.3.2. Enabling JSR-107 Support</a></h4><p>å¦‚æœç±»è·¯å¾„åŒæ—¶å­˜åœ¨ JSR-107 API å’Œ spring-context-supportï¼Œ<code>@EnableCaching</code> å’Œ <code>cache:annotation-driven</code> éƒ½ä¼šè‡ªå¯ç”¨ JCacheã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Integration&quot;&gt;&lt;a href=&quot;#Integration&quot; class=&quot;headerlink&quot; title=&quot;Integration&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://docs.spring.io/spring-framework/docs</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>RFC 6749</title>
    <link href="http://example.com/2022/07/26/RFC/RFC-6749/"/>
    <id>http://example.com/2022/07/26/RFC/RFC-6749/</id>
    <published>2022-07-26T11:56:44.000Z</published>
    <updated>2022-09-07T13:43:59.975Z</updated>
    
    <content type="html"><![CDATA[<p>1.1. Roles è§’è‰²</p><p>OAuth å®šä¹‰äº†å››ä¸ªè§’è‰²ï¼š</p><ul><li>resource owner èµ„æºæ‹¥æœ‰è€…:</li></ul><p>ä¸€ä¸ªå®ä½“ï¼Œå…¶èƒ½å¤Ÿæˆäºˆå—ä¿æŠ¤çš„èµ„æºçš„è®¿é—®æƒé™ã€‚å½“ resource owner æ˜¯ä¸€ä¸ªäººï¼Œä»–è¢«ç§°ä¹‹ä¸ºä¸€ä¸ªç»ˆç«¯ç”¨æˆ·ã€‚</p><ul><li>resource server èµ„æºæœåŠ¡å™¨</li></ul><p>ä¸€ä¸ªæœåŠ¡ï¼Œå…¶æ‰˜ç®¡å—ä¿æŠ¤çš„èµ„æºï¼Œèƒ½å¤Ÿæ¥å—å¹¶å“åº”ä½¿ç”¨ access token è¿›è¡Œå—ä¿æŠ¤èµ„æºçš„è¯·æ±‚ã€‚</p><ul><li>client å®¢æˆ·ç«¯</li></ul><p>ä¸€ä¸ªåº”ç”¨ï¼Œä»£è¡¨èµ„æºæ‹¥æœ‰è€…å‘å‡ºå—ä¿æŠ¤èµ„æºçš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨å…¶æˆæƒã€‚æœ¯è¯­ â€œclientâ€ å¹¶ä¸è¡¨ç¤ºä»»ä½•ç‰¹åˆ«çš„å®ç°ç‰¹å¾ï¼ˆä¾‹å¦‚ï¼Œä¸è®ºè¯¥åº”ç”¨åœ¨æœåŠ¡å™¨ï¼Œæ¡Œé¢ï¼Œæˆ–è€…å…¶ä»–è®¾å¤‡ä¸Šæ‰§è¡Œï¼‰ã€‚</p><ul><li>authorization server</li></ul><p>ä¸€ä¸ªæœåŠ¡ï¼Œåœ¨æˆåŠŸè®¤è¯äº†  å¹¶è·å¾—äº†æˆæƒä¹‹åï¼Œé¢å‘ access_token ç»™ clientã€‚</p><p>OAuth å®šä¹‰äº†å››ç§æˆäºˆç±»å‹:</p><ul><li>authorization codeï¼Œæˆæƒç </li><li>implicitï¼Œéšè—å¼</li><li>resource owner password credentialsï¼Œå¯†ç </li><li>client credentialsï¼Œå‡­è¯å¼</li></ul><h2 id="authorization-code"><a href="#authorization-code" class="headerlink" title="authorization code"></a>authorization code</h2><blockquote><p>ä¼ä¸šå¾®ä¿¡çš„æˆæƒä¸ code å¾ˆç±»ä¼¼ï¼Œä½†æœ‰æ‰€ä¸åŒã€‚ä¼ä¸šå¾®ä¿¡ code å¹¶ä¸æ˜¯æ¢å– access_tokenï¼Œè€Œæ˜¯æ¢å– useridã€‚ä¹Ÿå°±æ˜¯ï¼Œä¸€èˆ¬çš„ OAuth2ï¼Œcode ä¸ user æœ‰å…³è”ï¼Œcode æ¢å–çš„ access_token ä¸ user ä¹Ÿæœ‰å…³è”ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ access_token è®¿é—®è‡ªå·±æƒé™ä¸‹çš„ä¿¡æ¯ã€‚ </p></blockquote><h2 id="resource-owner-password-credentialsï¼Œå¯†ç "><a href="#resource-owner-password-credentialsï¼Œå¯†ç " class="headerlink" title="resource owner password credentialsï¼Œå¯†ç "></a>resource owner password credentialsï¼Œå¯†ç </h2><p>A ç½‘ç«™ç›´æ¥è¦æ±‚ç”¨æˆ·æä¾› B ç½‘ç«™çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‹¿åˆ°ä¹‹åï¼ŒA ç›´æ¥å‘ B è¯·æ±‚ä»¤ç‰Œã€‚</p><h2 id="client-credentialsï¼Œå®¢æˆ·ç«¯å‡­è¯å¼"><a href="#client-credentialsï¼Œå®¢æˆ·ç«¯å‡­è¯å¼" class="headerlink" title="client credentialsï¼Œå®¢æˆ·ç«¯å‡­è¯å¼"></a>client credentialsï¼Œå®¢æˆ·ç«¯å‡­è¯å¼</h2><p>é€‚ç”¨äºæ²¡æœ‰å‰ç«¯çš„å‘½ä»¤è¡Œåº”ç”¨ã€‚</p><p>è¿™ç§æ–¹å¼ç»™å‡ºçš„ä»¤ç‰Œï¼Œæ˜¯é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç”¨æˆ·çš„ï¼Œå³æœ‰å¯èƒ½å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªä»¤ç‰Œã€‚</p><p>ä¼ä¸šå¾®ä¿¡çš„ access_token è·å–ç±»ä¼¼äºè¿™ç§æ–¹å¼</p><p>(A) client é€šè¿‡å°† resource owner çš„ user-agent é‡å®šå‘åˆ° authorization åç«¯ï¼Œå¼€å§‹æµç¨‹ã€‚client åŒ…å«å®ƒçš„ client identifierï¼Œrequested scopeï¼Œlocal stateï¼Œä»¥åŠä¸€ä¸ª redirection uriï¼Œä¸€æ—¦æˆæƒï¼ˆæˆ–è€…æ‹’ç»ï¼‰è¯¥è®¿é—®ï¼ŒæˆæƒæœåŠ¡å™¨ä¼šæŠŠ user-agent å‘å›è¯¥ uriã€‚</p><blockquote><p>client å¯ä»¥è®¤ä¸ºæ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨çš„é¡µé¢ï¼ˆä¸Šé¢å…·æœ‰ä¸€ä¸ªæˆæƒæŒ‰é’®ï¼‰ï¼Œç”¨æˆ·ç‚¹å‡»è¯¥æŒ‰é’®ï¼Œå°±ä¼šè·³è½¬åˆ°æˆæƒæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¼šé™„å¸¦ä¸€äº›å‚æ•°ã€‚</p></blockquote><p>(B) æˆæƒæœåŠ¡å™¨è®¤è¯ resource ownerï¼Œå¹¶ç¡®å®š resource owner æ˜¯æˆæƒè¿˜æ˜¯æ‹’ç» client çš„èŒƒå›´è¯·æ±‚ã€‚</p><p>(C) å‡è®¾ resource owner æˆæƒè®¿é—®ï¼ŒæˆæƒæœåŠ¡å™¨ä½¿ç”¨ä¹‹å‰æä¾›çš„ redirection uri å°† user-agent é‡å®šå‘å› clientã€‚redirection uri åŒ…å« authorization code ä»¥åŠä¹‹å‰ client æä¾›çš„ä»»ä½•æœ¬åœ°çŠ¶æ€ã€‚</p><blockquote><p>code çš„å®ç°å¯ä»¥æ˜¯ UUIDã€UUID+MD5 ç­‰</p></blockquote><p>(D) client é€šè¿‡å‰é¢æ­¥éª¤è·å¾—çš„ authorization code ä»æˆæƒæœåŠ¡å™¨çš„ token åç«¯è¯·æ±‚ access tokenã€‚å½“å‘å‡ºè¯·æ±‚æ—¶ï¼Œclient ä½¿ç”¨æˆæƒæœåŠ¡å™¨è®¤è¯ã€‚client åŒ…å« redirection URI ï¼Œç”¨äºè·å–è¿›è¡ŒéªŒè¯çš„æˆæƒç ã€‚</p><p>(E) æˆæƒæœåŠ¡å™¨è®¤è¯å®¢æˆ·ç«¯ï¼ŒéªŒè¯æˆæƒç ï¼Œç¡®ä¿æ¥å—åˆ°çš„ redirection URI  </p><h1 id="10-Security-Considerations"><a href="#10-Security-Considerations" class="headerlink" title="10. Security Considerations"></a>10. Security Considerations</h1><h2 id="10-4-Refresh-Tokens"><a href="#10-4-Refresh-Tokens" class="headerlink" title="10.4. Refresh Tokens"></a>10.4. Refresh Tokens</h2><p>Authorization Server å¯ä»¥ï¼ˆMAYï¼‰ç»™ Web åº”ç”¨å®¢æˆ·ç«¯å’Œæœ¬åœ°åº”ç”¨å®¢æˆ·ç«¯é¢å‘ Refresh Tokenã€‚</p><p>Refresh Token å¿…é¡»ï¼ˆMUSTï¼‰åœ¨è¿è¾“å’Œå­˜å‚¨çš„è¿‡ç¨‹ä¸­ä¿å¯†ï¼Œå¹¶ä¸”ä»…ä»…åœ¨ Authorization Server å’Œé¢å‘äº† Refresh Token çš„å®¢æˆ·ç«¯ä¹‹é—´å…±äº«ã€‚Authorzation Server å¿…é¡»ï¼ˆMUSTï¼‰ ç»´æŠ¤ Refresh Token å’Œé¢å‘äº† Refresh Token çš„å®¢æˆ·ç«¯ä¹‹é—´çš„ç»‘å®šå…³ç³»ã€‚Refresh Token å¿…é¡»ï¼ˆMUSTï¼‰åªèƒ½ä½¿ç”¨ TLS ä¼ è¾“ã€‚??</p><p>æ¯å½“å®¢æˆ·èº«ä»½å¯ä»¥éªŒè¯æ—¶ï¼ŒAuthorzation Server å¿…é¡»ï¼ˆMUSTï¼‰éªŒè¯ Refresh Token å’Œå®¢æˆ·èº«ä»½ä¹‹é—´çš„ç»‘å®šå…³ç³»ã€‚å½“æ— æ³•è¿›è¡Œå®¢æˆ·ç«¯è®¤è¯æ—¶ï¼ŒAuthorization Server åº”å½“ï¼ˆSHOULDï¼‰è°ƒé…å…¶ä»–æ–¹æ¡ˆï¼Œä»¥æ£€æµ‹ Refresh Token æ»¥ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼ŒAuthorization Server å¯ä»¥ä½¿ç”¨ Refresh Token å¾ªç¯ï¼Œæ¯ä¸ª access Token åˆ·æ–°å“åº”å°±åœ¨å¾ªç¯ä¸­é¢å‘ä¸€ä¸ªæ–°çš„ Refresh Tokenã€‚å‰ä¸€ä¸ª Refresh Token å¤±æ•ˆï¼Œä½†æ˜¯è¿˜ä¼šè¢« Authorization Server ä¿ç•™ã€‚å¦‚æœä¸€ä¸ª Refresh Token è¢«æ¸—é€äº†ï¼Œéšåéƒ½è¢«æ”»å‡»è€…å’Œåˆæ³•å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªä¼šå‡ºç°æ— æ•ˆçš„ Refresh Tokenï¼Œå®ƒå°†å‘ŠçŸ¥æˆæƒæœåŠ¡å™¨è¿è§„ã€‚</p><p><em>æˆæƒæœåŠ¡å™¨</em>å¿…é¡»ç¡®ä¿ Refresh Token ä¸èƒ½è¢«ç”Ÿæˆï¼Œç¯¡æ”¹ï¼Œæˆ–è€…çŒœæµ‹ä»¥ç”Ÿæˆæœ‰æ•ˆçš„åˆ·æ–°ä»¤ç‰Œã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1.1. Roles è§’è‰²&lt;/p&gt;
&lt;p&gt;OAuth å®šä¹‰äº†å››ä¸ªè§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;resource owner èµ„æºæ‹¥æœ‰è€…:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€ä¸ªå®ä½“ï¼Œå…¶èƒ½å¤Ÿæˆäºˆå—ä¿æŠ¤çš„èµ„æºçš„è®¿é—®æƒé™ã€‚å½“ resource owner æ˜¯ä¸€ä¸ªäººï¼Œä»–è¢«ç§°ä¹‹ä¸ºä¸€ä¸ªç»ˆ</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>yum çš„ä½¿ç”¨</title>
    <link href="http://example.com/2022/07/25/Linux/yum-%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2022/07/25/Linux/yum-%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2022-07-25T08:39:13.000Z</published>
    <updated>2022-09-07T13:43:59.975Z</updated>
    
    <content type="html"><![CDATA[<p>æ›´æ–°æ‰€æœ‰å·²å®‰è£…çš„ rpm åŒ…<br>yum -y update</p><p>yum clean all</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ›´æ–°æ‰€æœ‰å·²å®‰è£…çš„ rpm åŒ…&lt;br&gt;yum -y update&lt;/p&gt;
&lt;p&gt;yum clean all&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Redis é¢è¯•é¢„å¤‡</title>
    <link href="http://example.com/2022/07/24/%E9%9D%A2%E8%AF%95/Redis-%E9%9D%A2%E8%AF%95%E9%A2%84%E5%A4%87/"/>
    <id>http://example.com/2022/07/24/%E9%9D%A2%E8%AF%95/Redis-%E9%9D%A2%E8%AF%95%E9%A2%84%E5%A4%87/</id>
    <published>2022-07-24T10:38:41.000Z</published>
    <updated>2022-09-07T13:43:59.981Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis-é¢è¯•é¢„å¤‡"><a href="#Redis-é¢è¯•é¢„å¤‡" class="headerlink" title="Redis é¢è¯•é¢„å¤‡"></a>Redis é¢è¯•é¢„å¤‡</h1><h2 id="ä¸ºä»€ä¹ˆç”¨-Redis"><a href="#ä¸ºä»€ä¹ˆç”¨-Redis" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨ Redis"></a>ä¸ºä»€ä¹ˆç”¨ Redis</h2><ul><li>é«˜å¹¶å‘</li><li>é«˜å¯ç”¨</li></ul><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>ç¼“å­˜ç©¿é€: ç¼“å­˜ä¸­æŸ¥ä¸åˆ°ï¼Œæ•°æ®åº“ä¸­ä¹Ÿå·®ä¸å¤š</p><p>è§£å†³æ–¹æ¡ˆ: 1. å¯¹å‚æ•°è¿›è¡Œåˆæ³•æ€§æ ¡éªŒ 2. å°†æ•°æ®åº“ä¸­æ²¡æœ‰æŸ¥åˆ°çš„ä¹Ÿå†™å…¥åˆ°ç¼“å­˜</p><p>ä¸ºäº†é˜²æ­¢ç¼“å­˜åƒåœ¾ï¼Œè¿™ä¸€ç±»çš„ç¼“å­˜å¯ä»¥è®¾ç½®çŸ­ä¸€äº›</p><blockquote><p>BloomFilter ï¼ŒMySQL çš„ id å¼•å…¥è¯¥è¿‡æ»¤å™¨ã€‚</p></blockquote><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ol><li><p>ç¼“å­˜</p></li><li><p>è®°å½•ç”¨æˆ·åœ¨çº¿äººæ•°</p></li></ol><p>ä½¿ç”¨ zSet ç»“æ„</p><p>ç”¨æˆ·æ¯æ¬¡è°ƒç”¨æ¥å£ï¼Œåœ¨é‰´æƒçš„æ—¶å€™åˆ·æ–°ä¸€æ¬¡è¯¥ç”¨æˆ· user_id å¯¹åº”çš„ score</p><p>å®šæ—¶è„šæœ¬ï¼Œåˆ é™¤è¿‡æœŸçš„æ•°æ®:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$redis</span>-&gt;<span class="title function_ invoke__">zRemRangeByScore</span>(REDIS_ONLINE_USER, <span class="number">0</span>, <span class="title function_ invoke__">time</span>() - <span class="number">5200</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Redis-é¢è¯•é¢„å¤‡&quot;&gt;&lt;a href=&quot;#Redis-é¢è¯•é¢„å¤‡&quot; class=&quot;headerlink&quot; title=&quot;Redis é¢è¯•é¢„å¤‡&quot;&gt;&lt;/a&gt;Redis é¢è¯•é¢„å¤‡&lt;/h1&gt;&lt;h2 id=&quot;ä¸ºä»€ä¹ˆç”¨-Redis&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆç”¨-Redis&quot;</summary>
      
    
    
    
    
    <category term="Redis" scheme="http://example.com/tags/Redis/"/>
    
  </entry>
  
</feed>
