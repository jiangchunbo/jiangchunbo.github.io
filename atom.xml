<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ğŸ¥«ğŸ</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-07-19T02:24:20.767Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>å§œæ˜¥æ³¢</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring Bean @Autowired ä¸ JSR-250 @Resource</title>
    <link href="http://example.com/2022/07/19/Spring-Core/Spring-Core-@Resource-%E4%B8%8E-@Autowired/"/>
    <id>http://example.com/2022/07/19/Spring-Core/Spring-Core-@Resource-%E4%B8%8E-@Autowired/</id>
    <published>2022-07-19T01:11:46.000Z</published>
    <updated>2022-07-19T02:24:20.767Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Bean-Autowired-ä¸-JSR-250-Resource"><a href="#Spring-Bean-Autowired-ä¸-JSR-250-Resource" class="headerlink" title="Spring Bean @Autowired ä¸ JSR-250 @Resource"></a>Spring Bean @Autowired ä¸ JSR-250 @Resource</h1><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h2><p>ç”± Spring æä¾›çš„æ³¨è§£ï¼Œä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ç”± <code>AutowiredAnnotationBeanPostProcessor</code> æ‰§è¡Œã€‚</p><p>é€šå¸¸è¿™ä¸€æ­¥éª¤å‘ç”Ÿåœ¨ <code>populateBean</code> æµç¨‹ä¹‹ä¸­ï¼Œä½¿ç”¨ç‰¹å®šçš„ <code>InstantiationAwareBeanPostProcessor</code> è¿›è¡Œå±æ€§æ³¨å…¥</p><h2 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h2><p>ç”± JSR-250 ä¸­æä¾›çš„æ³¨è§£ï¼Œä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ç”± <code>CommonAnnotationBeanPostProcessor</code> æ‰§è¡Œã€‚</p><p>é€šå¸¸è¿™ä¸€æ­¥éª¤å‘ç”Ÿåœ¨ <code>populateBean</code> æµç¨‹ä¹‹ä¸­ï¼Œä½¿ç”¨ç‰¹å®šçš„ <code>InstantiationAwareBeanPostProcessor</code> è¿›è¡Œå±æ€§æ³¨å…¥</p><ol><li>å¦‚æœ <code>@Resource</code> æŒ‡å®šäº† <code>name</code>ï¼Œåˆ™æŒ‰ç…§ <code>name</code> æŸ¥æ‰¾ Beanï¼Œæ‰¾åˆ°åˆ™æ³¨å…¥ï¼›æ‰¾ä¸åˆ°æŠ›å‡ºå¼‚å¸¸</li><li>å¦‚æœ <code>@Resource</code> æ²¡æœ‰æŒ‡å®š <code>name</code>ï¼Œé€šè¿‡ Java åå°„å¾—åˆ° <code>Field</code> å±æ€§ <code>name</code>ï¼Œæ‰¾ä¸åˆ°åˆ™æŒ‰ç…§ç±»å‹åŒ¹é…</li></ol><blockquote><p>ç”±äºæ˜¾å¼æŒ‡å®šäº† <code>@Resource</code> çš„ <code>name</code>ï¼Œå› æ­¤åœ¨æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹å¿…é¡»æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™å¯èƒ½æ˜¯äººä¸ºçš„ç–æ¼ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®š <code>name</code>ï¼Œé‚£ä¹ˆå®¹å™¨ä¼šæ™ºèƒ½åœ°æŒ‰ç…§å±æ€§åã€ç±»å‹åœ°é¡ºåºä¾æ¬¡å¯»æ‰¾ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">autowireResource</span><span class="params">(BeanFactory factory, LookupElement element, <span class="meta">@Nullable</span> String requestingBeanName)</span></span><br><span class="line">        <span class="keyword">throws</span> NoSuchBeanDefinitionException &#123;</span><br><span class="line"></span><br><span class="line">    Object resource;</span><br><span class="line">    Set&lt;String&gt; autowiredBeanNames;</span><br><span class="line">    <span class="comment">// æ­¤å¤„çš„ element.name ä»¥åŠåœ¨æ„é€ å™¨ä¸­èµ‹å€¼</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> element.name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (factory <span class="keyword">instanceof</span> AutowireCapableBeanFactory) &#123;</span><br><span class="line">        <span class="type">AutowireCapableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> (AutowireCapableBeanFactory) factory;</span><br><span class="line">        <span class="type">DependencyDescriptor</span> <span class="variable">descriptor</span> <span class="operator">=</span> element.getDependencyDescriptor();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.fallbackToDefaultTypeMatch &amp;&amp; element.isDefaultName &amp;&amp; !factory.containsBean(name)) &#123;</span><br><span class="line">            autowiredBeanNames = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">            resource = beanFactory.resolveDependency(descriptor, requestingBeanName, autowiredBeanNames, <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (resource == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchBeanDefinitionException</span>(element.getLookupType(), <span class="string">&quot;No resolvable resource object&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            resource = beanFactory.resolveBeanByName(name, descriptor);</span><br><span class="line">            autowiredBeanNames = Collections.singleton(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        resource = factory.getBean(name, element.lookupType);</span><br><span class="line">        autowiredBeanNames = Collections.singleton(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (factory <span class="keyword">instanceof</span> ConfigurableBeanFactory) &#123;</span><br><span class="line">        <span class="type">ConfigurableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> (ConfigurableBeanFactory) factory;</span><br><span class="line">        <span class="keyword">for</span> (String autowiredBeanName : autowiredBeanNames) &#123;</span><br><span class="line">            <span class="keyword">if</span> (requestingBeanName != <span class="literal">null</span> &amp;&amp; beanFactory.containsBean(autowiredBeanName)) &#123;</span><br><span class="line">                beanFactory.registerDependentBean(autowiredBeanName, requestingBeanName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Bean-Autowired-ä¸-JSR-250-Resource&quot;&gt;&lt;a href=&quot;#Spring-Bean-Autowired-ä¸-JSR-250-Resource&quot; class=&quot;headerlink&quot; title=&quot;Spring Bean </summary>
      
    
    
    
    
    <category term="Spring Bean" scheme="http://example.com/tags/Spring-Bean/"/>
    
  </entry>
  
  <entry>
    <title>Android ç¬”è®°</title>
    <link href="http://example.com/2022/07/18/Android/Android-%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/07/18/Android/Android-%E7%AC%94%E8%AE%B0/</id>
    <published>2022-07-18T14:56:44.000Z</published>
    <updated>2022-07-18T14:57:07.110Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¸…å•æ–‡ä»¶"><a href="#æ¸…å•æ–‡ä»¶" class="headerlink" title="æ¸…å•æ–‡ä»¶"></a>æ¸…å•æ–‡ä»¶</h1><h1 id="Activities"><a href="#Activities" class="headerlink" title="Activities"></a>Activities</h1><h2 id="Fragments"><a href="#Fragments" class="headerlink" title="Fragments"></a>Fragments</h2><h3 id="åˆ›å»ºä¸€ä¸ª-fragment"><a href="#åˆ›å»ºä¸€ä¸ª-fragment" class="headerlink" title="åˆ›å»ºä¸€ä¸ª fragment"></a>åˆ›å»ºä¸€ä¸ª fragment</h3><p>ä¸€ä¸ª fragment è¡¨ç¤ºæŸä¸ª activity ä¸­ç”¨æˆ·æ¥å£çš„ä¸€ä¸ªæ¨¡å—åŒ–éƒ¨åˆ†ã€‚ä¸€ä¸ª fragment æœ‰å®ƒè‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¥å—å®ƒè‡ªå·±çš„è¾“å…¥äº‹ä»¶ï¼Œå¹¶ä¸”ä½ å¯ä»¥åœ¨activity è¿è¡Œæ—¶æ·»åŠ æˆ–ç§»é™¤ fragmentã€‚</p><h4 id="è®¾ç½®ç¯å¢ƒ"><a href="#è®¾ç½®ç¯å¢ƒ" class="headerlink" title="è®¾ç½®ç¯å¢ƒ"></a>è®¾ç½®ç¯å¢ƒ</h4><p>fragments éœ€è¦ AndroidX fragment åº“çš„ä¾èµ–ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦æ·»åŠ  Google Maven ä»“åº“åˆ°ä½ çš„é¡¹ç›® build.grade æ–‡ä»¶ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ...</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å°† AndroidX Fragment åº“åŒ…å«åˆ°ä½ çš„é¡¹ç›®ï¼Œéœ€è¦åœ¨ä½ çš„ App çš„ build.gradle æ–‡ä»¶æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    def fragment_version = &quot;<span class="number">1.3</span>.<span class="number">5</span>&quot;</span><br><span class="line"></span><br><span class="line">    // Java language implementation</span><br><span class="line">    implementation &quot;androidx<span class="selector-class">.fragment</span>:fragment:$fragment_version<span class="string">&quot;</span></span><br><span class="line"><span class="string">    // Kotlin</span></span><br><span class="line"><span class="string">    implementation &quot;</span>androidx.fragment:fragment-ktx:$fragment_version<span class="string">&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºä¸€ä¸ª-fragment-ç±»"><a href="#åˆ›å»ºä¸€ä¸ª-fragment-ç±»" class="headerlink" title="åˆ›å»ºä¸€ä¸ª fragment ç±»"></a>åˆ›å»ºä¸€ä¸ª fragment ç±»</h4><p>ä¸ºäº†åˆ›å»ºä¸€ä¸ª fragmentï¼Œéœ€è¦ç»§æ‰¿ AndroidX çš„ <code>Fragment</code> ç±»ï¼Œå¹¶è¦†ç›–å®ƒçš„æ–¹æ³•ï¼Œç±»ä¼¼ä½ åˆ›å»ºä¸€ä¸ª <code>Activity</code> ç±»ã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªå®šä¹‰äº†è‡ªå·±çš„å¸ƒå±€çš„æœ€å° fragmentï¼Œéœ€è¦ä¸ºåŸºæœ¬æ„é€ å™¨æä¾› fragment çš„å¸ƒå±€èµ„æºã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleFragment</span> <span class="keyword">extends</span> <span class="title class_">Fragment</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExampleFragment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(R.layout.example_fragment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Fragment åº“è¿˜æä¾›äº†æ›´å¤šä¸“ä¸šçš„ fragment åŸºç±»ï¼š</p><ul><li><p>DialogFragment<br>æ˜¾ç¤ºæ‚¬æµ®å¯¹è¯æ¡†ï¼Œä½¿ç”¨æ­¤ç±»åˆ›å»ºä¸€ä¸ªå¯¹è¯æ¡†æ˜¯ä¸€ä¸ªå¯¹äºä½¿ç”¨ Activity  dialog helper æ–¹æ³•çš„å¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ä¸º fragment ä¼šè‡ªåŠ¨å¤„ç†å¯¹è¯æ¡†çš„åˆ›å»ºå’Œæ¸…ç†ã€‚è¯¦ç»†ä¿¡æ¯å‚è€ƒ DialogFragmentã€‚</p></li><li><p>PreferenceFragmentCompat<br>æ˜¾ç¤ºä½œä¸ºåˆ—è¡¨çš„ Preference å¯¹è±¡çš„å±‚æ¬¡ç»“æ„ã€‚ä½ å¯ä»¥ä½¿ç”¨<br>PreferenceFragmentCompat æ¥ä¸ºä½ çš„ App åˆ›å»ºä¸€ä¸ªè®¾ç½®å±å¹•ã€‚</p></li></ul><h4 id="æ·»åŠ ä¸€ä¸ª-fragment-åˆ°-activity"><a href="#æ·»åŠ ä¸€ä¸ª-fragment-åˆ°-activity" class="headerlink" title="æ·»åŠ ä¸€ä¸ª fragment åˆ° activity"></a>æ·»åŠ ä¸€ä¸ª fragment åˆ° activity</h4><p>é€šå¸¸ï¼Œä½ çš„ fragment å¿…é¡»åµŒå…¥åœ¨ AndroidX <code>FragmentActivity</code> ä¸­ï¼Œç”¨ä»¥è´¡çŒ®ä¸€éƒ¨åˆ† UI åˆ° activity å¸ƒå±€ã€‚<code>FragmentActivity</code> æ˜¯ <code>AppCompatActivity</code> åŸºç±»ï¼Œå› æ­¤å¦‚æœä½ å·²ç»åœ¨ä½ çš„ App ä¸­ä¸º AppCompatActivity æä¾›äº†å‘åå…¼å®¹æ€§ï¼Œé‚£ä¹ˆä½ ä¸å¿…æ”¹å˜ä½ çš„ activity åŸºç±»ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ·»åŠ  fragmentï¼š</p><ul><li>åœ¨ activity çš„å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰ç‰‡æ®µ</li><li>åœ¨ activity å¸ƒå±€æ–‡ä»¶å®šä¹‰ fragment å®¹å™¨ï¼Œåé¢é€šè¿‡ç¨‹åºæ·»åŠ åˆ° activityã€‚</li></ul><p>åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œä½ éƒ½éœ€è¦æ·»åŠ ä¸€ä¸ª <code>FragmentContainerView</code>ï¼Œå®šä¹‰äº† fragment åº”è¯¥æ”¾åœ¨ activity è¯•å›¾å±‚æ¬¡ç»“æ„ä¸­çš„ä½ç½®ã€‚</p><p>å¼ºçƒˆå»ºè®®ï¼šä½¿ç”¨ Fragment ä½œä¸º fragment çš„å®¹å™¨ï¼Œå› ä¸º <code>FragmentContainerView</code> åŒ…å«äº†å…¶ä»– View Groupï¼ˆå¦‚ FrameLayoutï¼‰æ²¡æœ‰æä¾›çš„ä¿®å¤ç¨‹åºã€‚</p><h5 id="é€šè¿‡-XML-æ·»åŠ -fragment"><a href="#é€šè¿‡-XML-æ·»åŠ -fragment" class="headerlink" title="é€šè¿‡ XML æ·»åŠ  fragment"></a>é€šè¿‡ XML æ·»åŠ  fragment</h5><p>ä¸ºäº†å£°æ˜å°† fragment æ·»åŠ åˆ°ä½ çš„ activity å¸ƒå±€ XMLï¼Œä½ éœ€è¦æ·»åŠ ä¸€ä¸ª <code>FragmentContainerView</code> å…ƒç´ ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- res/layout/example_activity.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.fragment.app.FragmentContainerView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/fragment_container_view&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.example.ExampleFragment&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>Android:name æŒ‡å®šè¦å®ä¾‹åŒ–çš„ fragment ç±»åã€‚å½“ activity å¸ƒå±€å¡«å……æ—¶ï¼ŒæŒ‡å®šçš„ fragment ä¼šå®ä¾‹åŒ–ï¼Œå½“æ–°å®ä¾‹åŒ– fragment æ—¶ï¼ŒonInflate() ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä¼šåˆ›å»ºä¸€ä¸ª <code>FragmentTransaction</code> å»å°† fragment æ·»åŠ åˆ° <code>FragmentManager</code>ã€‚</p><h5 id="ç¨‹åºåŒ–æ·»åŠ -fragment"><a href="#ç¨‹åºåŒ–æ·»åŠ -fragment" class="headerlink" title="ç¨‹åºåŒ–æ·»åŠ  fragment"></a>ç¨‹åºåŒ–æ·»åŠ  fragment</h5><p>ä¸ºäº†ç¨‹åºåŒ–æ·»åŠ  fragment åˆ° activityï¼Œå¸ƒå±€åº”è¯¥å¼•å…¥ <code>FragmentContainerView</code> ä½œä¸º fragment å®¹å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- res/layout/example_activity.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.fragment.app.FragmentContainerView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/fragment_container_view&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ XML æ–¹å¼ä¸åŒï¼Œandroid:name å±æ€§å¹¶æœªä½¿ç”¨ï¼Œå› æ­¤ä¸ä¼šè‡ªåŠ¨å®ä¾‹åŒ–ç‰¹å®š fragmentã€‚ç›¸åï¼Œä½¿ç”¨ FragmentTransaction æ¥å®ä¾‹åŒ– fragment å¹¶å°†å…¶æ·»åŠ åˆ° activity çš„å¸ƒå±€ä¸­ã€‚</p><p>å½“ä½ çš„ activity åœ¨è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥åˆ¶é€  fragment transaction ä¾‹å¦‚æ·»åŠ ã€åˆ é™¤æˆ–è€…æ›¿æ¢ fragmentã€‚åœ¨ <code>FragmentActivity</code> ä¸­ï¼Œä½ å¯ä»¥è·å¾— <code>FragmentManager</code> çš„å®ä¾‹ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒåˆ›å»º <code>FragmentTransaction</code>ã€‚ åœ¨ activity çš„ onCreate() æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ FragmentTransaction.add() å®ä¾‹åŒ–ä½ çš„ fragmentï¼Œä¼ é€’å‚æ•° ViewGroup ID å’Œ fragment Classï¼Œç„¶åæäº¤äº‹åŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExampleActivity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(R.layout.example_activity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">if</span> (savedInstanceState == <span class="literal">null</span>) &#123;</span><br><span class="line">            getSupportFragmentManager().beginTransaction()</span><br><span class="line">                .setReorderingAllowed(<span class="literal">true</span>)</span><br><span class="line">                .add(R.id.fragment_container_view, ExampleFragment.class, <span class="literal">null</span>)</span><br><span class="line">                .commit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå½“æ‰§è¡Œä¸€ä¸ª FragmentTransaction æ—¶ï¼Œä½ åº”è¯¥æ€»æ˜¯ä½¿ç”¨ setReorderingAllowed(true)ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒå®˜ç½‘ã€‚</p></blockquote><p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œè¯·æ³¨æ„ï¼Œåªæœ‰åœ¨ savedInstanceState ä¸º null æ—¶ï¼Œæ‰ä¼šåˆ›å»º fragment äº‹åŠ¡ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä»…ä»…å½“ activity ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™ï¼Œfragment æ‰ä¼šæ·»åŠ ä¸€æ¬¡ã€‚å‘ç”Ÿé…ç½®æ›´æ”¹æˆ–è€… activity recreateï¼ŒsavedInstanceState ä¸å†ä¸º nullï¼Œå¹¶ä¸”ä¸éœ€è¦å†æ·»åŠ ä¸€æ¬¡ fragmentï¼Œå› ä¸º fragment å¯ä»¥è‡ªåŠ¨ä» savedInstanceState æ¢å¤ã€‚</p><p>å¦‚æœä½ çš„ fragment éœ€è¦ä¸€äº›åˆå§‹åŒ–æ•°æ®ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨ FragmentTransaction.add() æ—¶æä¾›ä¸€ä¸ª Bundleï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExampleActivity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(R.layout.example_activity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">if</span> (savedInstanceState == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Bundle</span> <span class="variable">bundle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">            bundle.putInt(<span class="string">&quot;some_int&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            getSupportFragmentManager().beginTransaction()</span><br><span class="line">                .setReorderingAllowed(<span class="literal">true</span>)</span><br><span class="line">                .add(R.id.fragment_container_view, ExampleFragment.class, bundle)</span><br><span class="line">                .commit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ fragment ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>requireArguments()</code> æ¥è·å–å‚æ•° Bundleï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨é€‚åˆçš„ getter æ–¹æ³•æ¥è·å–æ¯ä¸ªå‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleFragment</span> <span class="keyword">extends</span> <span class="title class_">Fragment</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExampleFragment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(R.layout.example_fragment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewCreated</span><span class="params">(<span class="meta">@NonNull</span> View view, Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">someInt</span> <span class="operator">=</span> requireArguments().getInt(<span class="string">&quot;some_int&quot;</span>);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="OkHttp"><a href="#OkHttp" class="headerlink" title="OkHttp"></a>OkHttp</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#x27;com<span class="selector-class">.squareup</span><span class="selector-class">.okhttp3</span>:okhttp:<span class="number">4.9</span>.<span class="number">0</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ¸…å•æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#æ¸…å•æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;æ¸…å•æ–‡ä»¶&quot;&gt;&lt;/a&gt;æ¸…å•æ–‡ä»¶&lt;/h1&gt;&lt;h1 id=&quot;Activities&quot;&gt;&lt;a href=&quot;#Activities&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="Android ç¬”è®°" scheme="http://example.com/categories/Android-%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Android ç¬”è®°" scheme="http://example.com/tags/Android-%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>å‘ Activity æ·»åŠ  Fragment</title>
    <link href="http://example.com/2022/07/18/Android/%E5%90%91-Activity-%E6%B7%BB%E5%8A%A0-Fragment/"/>
    <id>http://example.com/2022/07/18/Android/%E5%90%91-Activity-%E6%B7%BB%E5%8A%A0-Fragment/</id>
    <published>2022-07-18T14:32:36.000Z</published>
    <updated>2022-07-18T14:40:50.788Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‘-Activity-æ·»åŠ -Fragment"><a href="#å‘-Activity-æ·»åŠ -Fragment" class="headerlink" title="å‘ Activity æ·»åŠ  Fragment"></a>å‘ Activity æ·»åŠ  Fragment</h1><h2 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h2><p>åœ¨ Activity çš„å¸ƒå±€æ–‡ä»¶å†…å£°æ˜ç‰‡æ®µ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.news.ArticleListFragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/list&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.news.ArticleReaderFragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/viewer&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;fragment&gt;</code> çš„ android:name å±æ€§æŒ‡å®šè¦åœ¨å¸ƒå±€ä¸­è¿›è¡Œå®ä¾‹åŒ–çš„ Fragment ç±»ã€‚</p><p>åˆ›å»º activity å¸ƒå±€æ—¶ï¼Œç³»ç»Ÿä¼šå°†æ¯ä¸ª fragment å®ä¾‹åŒ–ï¼Œå¹¶è°ƒç”¨ OnCreateView() æ–¹æ³•ï¼Œä»¥æ£€ç´¢æ¯ä¸ªç‰‡æ®µçš„å¸ƒå±€ã€‚ç³»ç»Ÿä¼šè¿”å›æ’å…¥ fragment åçš„ Viewã€‚</p><blockquote><p>æ³¨æ„ï¼šæ¯ä¸ªç‰‡æ®µéƒ½éœ€è¦å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé‡å¯ Activity æ—¶ï¼Œç³»ç»Ÿå¯ä½¿ç”¨è¯¥æ ‡è¯†ç¬¦æ¥æ¢å¤ç‰‡æ®µï¼ˆæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥æ ‡è¯†ç¬¦æ¥æ•è·ç‰‡æ®µï¼Œä»è€Œæ‰§è¡ŒæŸäº›äº‹åŠ¡ï¼Œå¦‚å°†å…¶ç§»é™¤ï¼‰ã€‚å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä¸ºç‰‡æ®µæä¾› IDï¼š</p></blockquote><p>ä¸ºÂ android:idÂ å±æ€§æä¾›å”¯ä¸€ IDã€‚<br>ä¸ºÂ android:tagÂ å±æ€§æä¾›å”¯ä¸€å­—ç¬¦ä¸²ã€‚</p><h2 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h2><p>åœ¨ activity è¿è¡ŒæœŸé—´ï¼Œå¯ä»¥éšæ—¶å°†ç‰‡æ®µæ·»åŠ åˆ° activity å¸ƒå±€ä¸­ï¼Œåªéœ€æŒ‡å®š fragment æ”¾å…¥å“ªä¸ª ViewGroupã€‚</p><p>åœ¨ activity ä¸­æ‰§è¡Œç‰‡æ®µäº‹åŠ¡ï¼ˆå¦‚æ·»åŠ ã€ç§»é™¤æˆ–æ›¿æ¢ç‰‡æ®µï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ FragmentTransaction APIã€‚</p><p>å¯ä»¥ä» FragmentActivity è·å–ä¸€ä¸ªFragmentTransactionå®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FragmentManager</span> <span class="variable">fragmentManager</span> <span class="operator">=</span> getSupportFragmentManager();</span><br><span class="line"><span class="type">FragmentTransaction</span> <span class="variable">fragmentTransaction</span> <span class="operator">=</span> fragmentManager.beginTransaction();</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œä½¿ç”¨ add() æ–¹æ³•æ·»åŠ ç‰‡æ®µï¼ŒæŒ‡å®šè¦æ·»åŠ çš„ç‰‡æ®µä»¥åŠæ’å…¥å“ªä¸ªè§†å›¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExampleFragment</span> <span class="variable">fragment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExampleFragment</span>();</span><br><span class="line">fragmentTransaction.add(R.id.fragment_container, fragment);</span><br><span class="line">fragmentTransaction.commit();</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦é€šè¿‡ FragmentTransaction åšå‡ºäº†æ›´æ”¹ï¼Œå°±å¿…é¡»è°ƒç”¨ commit() ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‘-Activity-æ·»åŠ -Fragment&quot;&gt;&lt;a href=&quot;#å‘-Activity-æ·»åŠ -Fragment&quot; class=&quot;headerlink&quot; title=&quot;å‘ Activity æ·»åŠ  Fragment&quot;&gt;&lt;/a&gt;å‘ Activity æ·»åŠ  Fragme</summary>
      
    
    
    
    <category term="Android" scheme="http://example.com/categories/Android/"/>
    
    
    <category term="Android" scheme="http://example.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ç®€å†</title>
    <link href="http://example.com/2022/07/18/%E7%AE%80%E5%8E%86/"/>
    <id>http://example.com/2022/07/18/%E7%AE%80%E5%8E%86/</id>
    <published>2022-07-18T09:04:36.000Z</published>
    <updated>2022-07-18T09:38:10.766Z</updated>
    
    <content type="html"><![CDATA[<p>çŸ¥è¯†ï¼š</p><p><strong>PHP</strong> <strong>Java</strong> JavaScript HTML CSS <strong>MySQL</strong> <strong>Redis</strong> <strong>Nginx</strong> XML Json Node.js Vue ä¼ä¸šå¾®ä¿¡è‡ªå»º ä¼ä¸šå¾®ä¿¡ä»£å¼€å‘</p><p>äº‘å°šä½œä¸šç»Ÿè®¡æ¨¡å—</p><p>ç©ºä¸­è¯¾å ‚ä¸€æœŸå¤§å±ç»Ÿè®¡æ¨¡å—</p><p>å®éªŒç«èµ›ç»Ÿè®¡æ¨¡å—</p><p>è…¾è®¯äº‘äº‘ç‚¹æ’­ã€å¯¹è±¡å­˜å‚¨ã€æ‹“è¯¾äº‘ã€æ¨æµç›´æ’­ç­‰æœåŠ¡å¯¹æ¥</p><p>2020 å¹´</p><p>è´Ÿè´£ç§¯åˆ†ç³»ç»Ÿï¼›</p><p>è´Ÿè´£æ±Ÿè‹åå¸ˆç©ºä¸­è¯¾å ‚æ•™å¸ˆæˆé•¿å¤‡è¯¾æ¨¡å—çš„æ•°æ®åº“è®¾è®¡ï¼Œå‘èµ·å¤‡è¯¾ï¼Œå¤‡è¯¾æŸ¥è¯¢ï¼Œå¤‡è¯¾è¯¦æƒ…ã€å¤‡è¯¾å†…å®¹è®¨è®ºï¼›</p><p>è´Ÿè´£æ±Ÿè‹åå¸ˆç©ºä¸­è¯¾å ‚é¢˜åº“æ¨¡å—çš„é¢˜åº“ä¸Šä¼ ï¼Œæ‰¹é‡ä¸Šä¼ ï¼ŒåŸºç¡€æ•™å­¦æ•°æ®æŸ¥è¯¢ï¼›</p><p>è´Ÿè´£æ±Ÿè‹åå¸ˆç©ºä¸­è¯¾å ‚èµ„æºä¸­å¿ƒçš„æ•°æ®åº“è®¾è®¡ï¼Œèµ„æºç»Ÿè®¡ï¼Œæ—§æ•°æ®è¡¨è¿ç§»ç­‰ï¼›</p><p>2021å¹´Â </p><p>è´Ÿè´£æ±Ÿè‹åå¸ˆä¸€æœŸç©ºä¸­è¯¾å ‚å¤§å±æ¥å£ï¼Œç»Ÿè®¡ç¼“å­˜å„ç»´åº¦æ•°æ®ï¼›</p><p>è´Ÿè´£ä¼å¾®è‡ªå»ºåº”ç”¨äº‘ä¸Šå®¶é•¿è¯¾å ‚æ¥å£ï¼›</p><p>è´Ÿè´£æ ¡å›­å®‰å…¨ç³»ç»Ÿå­¦ç”Ÿã€æ•™å¸ˆè€ƒå‹¤ï¼ŒåŠŸèƒ½å®¤ç®¡ç†ã€æŠ¤å¯¼ç®¡ç†åŠŸèƒ½ï¼ŒåæœŸç‹¬ç«‹è´Ÿè´£ç»´æŠ¤åç»­é—®é¢˜ï¼Œè‡ªè¡Œæ­å»ºç»´æŠ¤äº†ä¸€ä¸ªåŸºäº vue element admin åå°æ¡†æ¶çš„å‰ç«¯é¡¹ç›®ï¼Œä¾¿äºç®¡ç†å¤šä¸ªå­¦æ ¡è®¾å¤‡ï¼Œç”¨äºçŠ¶æ€æŸ¥çœ‹ï¼Œè®¾å¤‡ä¿¡æ¯å¯¼å…¥ç­‰ï¼›</p><p>è´Ÿè´£ä¼å¾®åº”ç”¨æ•°æ®æ‰“å¡è®¾è®¡ã€æ¥å£ç¼–å†™ï¼›</p><p>è´Ÿè´£ä¼å¾®åº”ç”¨é¼“ e å°è§†é¢‘è®¾è®¡ã€ç¼–ç ;</p><p>è´Ÿè´£æ¢æºªåå¸ˆåœ¨çº¿çš„å›¢é˜Ÿåœ¨çº¿æ ¡éªŒï¼›</p><p>è´Ÿè´£ä¼å¾®åº”ç”¨è¡Œèµ°æ—¥è®°çš„è®¾è®¡ã€ç¼–ç ï¼›</p><p>è´Ÿè´£ä¼å¾®åº”ç”¨å­¦ç”Ÿç‚¹åè®¾è®¡ã€ç¼–ç ï¼›</p><p>è´Ÿè´£é¼“æ¥¼äº‘å°šä½œä¸šçš„åˆ†ç»„åŠŸèƒ½ã€ä½œä¸šæ•°æ®ç»Ÿè®¡åŠŸèƒ½ã€è‡ªåŠ¨åŒ–æ‰¹æ”¹è„šæœ¬ã€å­¦ç”Ÿä½œä¸šæŠ¥å‘Šã€å­¦ç”Ÿé”™é¢˜ç»Ÿè®¡ï¼›</p><p>è´Ÿè´£ä¼å¾®åº”ç”¨æ ¡é•¿ä¿¡ç®±è®¾è®¡ã€ç¼–ç ï¼›</p><p>è´Ÿè´£å—äº¬å¸ˆèŒƒå¤§å­¦é™„å±ä¸­å­¦æ ‘äººå­¦æ ¡ã€åŠ›äººåˆä¸­çš„æ‹›ç”Ÿç³»ç»Ÿç¼–ç ï¼›</p><p>è´Ÿè´£å—äº¬å®éªŒå¹¼å„¿å›­æ‹›ç”Ÿç³»ç»Ÿï¼›</p><p>è´Ÿè´£äº”å¡˜ã€å®å–„ã€é‡‘è¾¾ã€æ»¨æ±Ÿã€é¼“æ¥¼ç¬¬äºŒå®éªŒå¹¼å„¿å›­è”åˆæ‹›ç”Ÿç³»ç»Ÿï¼›</p><p>è´Ÿè´£é¼“æ¥¼ä¸€ä¸­å¿ƒå­¦æ ¡æ‹›ç”Ÿç³»ç»Ÿï¼›</p><p>è´Ÿè´£æ±Ÿè‹åå¸ˆç©ºä¸­è¯¾å ‚è‹ e ä¼˜è¯¾çš„è¯ä¹¦æ–¹æ³•ä¸ç¼“å­˜ï¼Œä»¥åŠåç»­è¯ä¹¦é—®é¢˜çš„æ›´è¿›ï¼›</p><p>è´Ÿè´£çœæœºå…³å¹¼å„¿å›­å®¶æ ¡åŠ©ç†å›¢çš„è®¾è®¡ã€ç¼–ç  8.1</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;çŸ¥è¯†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PHP&lt;/strong&gt; &lt;strong&gt;Java&lt;/strong&gt; JavaScript HTML CSS &lt;strong&gt;MySQL&lt;/strong&gt; &lt;strong&gt;Redis&lt;/strong&gt; &lt;strong&gt;Nginx&lt;/st</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>AES åŠ å¯†ç®—æ³•</title>
    <link href="http://example.com/2022/07/18/Security/AES-%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    <id>http://example.com/2022/07/18/Security/AES-%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/</id>
    <published>2022-07-18T04:31:01.000Z</published>
    <updated>2022-07-18T07:48:36.966Z</updated>
    
    <content type="html"><![CDATA[<h1 id="AES-åŠ å¯†ç®—æ³•"><a href="#AES-åŠ å¯†ç®—æ³•" class="headerlink" title="AES åŠ å¯†ç®—æ³•"></a>AES åŠ å¯†ç®—æ³•</h1><h2 id="å¯†é’¥æ‰©å±•ç®—æ³•"><a href="#å¯†é’¥æ‰©å±•ç®—æ³•" class="headerlink" title="å¯†é’¥æ‰©å±•ç®—æ³•"></a>å¯†é’¥æ‰©å±•ç®—æ³•</h2><img src="https://cannedbread-1302516612.cos.ap-shanghai.myqcloud.com/crypto/AES%E5%AF%86%E9%92%A5%E6%89%A9%E5%B1%95%E7%AE%97%E6%B3%95.drawio.svg"><p>æ­¥éª¤è¯´æ˜ï¼š</p><ol><li><p>å°†å¯†é’¥ key æŒ‰å·¦å›¾çš„æ ¼å¼ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³æ’åˆ—ï¼Œæ¯ä¸€åˆ— 4 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ $k_n$ è¡¨ç¤º 1 ä¸ªå­—èŠ‚ã€‚</p><blockquote><p>AES æ”¯æŒå¯†é’¥é•¿åº¦ä¸º 16ã€24ã€32 å­—èŠ‚ï¼Œå› æ­¤å¯èƒ½çš„åˆ—æ•°æ˜¯ 4ã€6ã€8</p></blockquote></li><li><p>å°†æ¯ä¸€åˆ—çš„ 4 å­—èŠ‚ä»ä¸Šåˆ°ä¸‹æ‹¼æ¥æˆ 32 bitï¼Œè®°ä¸º $W_t$</p></li></ol><blockquote><p>æ ¹æ®å¯†é’¥é•¿åº¦ä¸åŒï¼Œåˆ—æ•°æ˜¯ 4ã€6ã€8ï¼Œå› æ­¤ $W$ æ¯ä¸€è¡Œçš„é•¿åº¦æ˜¯ 4ã€6ã€8</p></blockquote><ol start="3"><li>ä¾æ¬¡æ±‚è§£ $W_t$ï¼Œ$t$ çš„èŒƒå›´æ˜¯ $[4,43]$ï¼ˆå› ä¸ºå·²ç»å¾—åˆ° $[0,3]$ çš„å€¼ï¼‰ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š<br>è‹¥ $t%4&#x3D;0$ï¼Œåˆ™ï¼š<br>$$w[t]&#x3D;w[t-4]âŠ•g(w[t-1])$$<br>å¦åˆ™ï¼š<br>$$w[t]&#x3D;w[t-4]âŠ•w[t-1]ï¼›$$</li></ol><p>g å‡½æ•°çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å°† $W_t$ å¾ªç¯å·¦ç§» 8 bitï¼ˆå³ 1 å­—èŠ‚ï¼‰</li><li>å¯¹æ¯ä¸ªå­—èŠ‚åš S ç›’ç½®æ¢</li><li>å°†æ¯ä¸ªå­—èŠ‚ä¸ 32 bit å¸¸é‡$(RC[t&#x2F;4],0,0,0)$è¿›è¡Œå¼‚æˆ–ã€‚</li></ol><blockquote><p>$RC$ æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå…¶æ‰€éœ€é•¿åº¦éšç€ AES ç®—æ³•å¯†é’¥çš„é•¿åº¦å˜åŒ–ï¼Œ</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.cnblogs.com/luop/p/4334160.html">https://www.cnblogs.com/luop/p/4334160.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;AES-åŠ å¯†ç®—æ³•&quot;&gt;&lt;a href=&quot;#AES-åŠ å¯†ç®—æ³•&quot; class=&quot;headerlink&quot; title=&quot;AES åŠ å¯†ç®—æ³•&quot;&gt;&lt;/a&gt;AES åŠ å¯†ç®—æ³•&lt;/h1&gt;&lt;h2 id=&quot;å¯†é’¥æ‰©å±•ç®—æ³•&quot;&gt;&lt;a href=&quot;#å¯†é’¥æ‰©å±•ç®—æ³•&quot; class=&quot;headerli</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨ screw</title>
    <link href="http://example.com/2022/07/18/Tool/%E6%95%B0%E6%8D%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E5%99%A8-screw/"/>
    <id>http://example.com/2022/07/18/Tool/%E6%95%B0%E6%8D%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E5%99%A8-screw/</id>
    <published>2022-07-18T00:59:38.000Z</published>
    <updated>2022-07-18T01:02:45.663Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨-screw"><a href="#æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨-screw" class="headerlink" title="æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨ screw"></a>æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨ screw</h1><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://github.com/yihr/screw">https://github.com/yihr/screw</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzU0OTE4MzYzMw==&mid=2247490367&idx=4&sn=33457d828191fc8717bf90e29d02aa5b&chksm=fbb292c1ccc51bd776a938e2a0aca306363c8ea526362c83a1ed0e7d2522d136a5482f529481&mpshare=1&scene=1&srcid=08075ho06D4MoWdvYI6HZGn2&sharer_sharetime=1596771975108&sharer_shareid=00de337ccf971170dff621a18a7fdda8&key=bbcde1cc2908d6bbca75f9126db113cba3e65212579f0c49d238ed98e48a07667ecea3754647040875027233e7254e03354cbcb58a82ff9c1b4f865e3e510b1759f8f013ff094835f46a0f3809a473f4&ascene=1&uin=MjE2Mjg4NzYz&devicetype=Windows+10+x64&version=62090529&lang=zh_CN&exportkey=A98TRXcX38ZaCSWR2WlBPus=&pass_ticket=/q1C0cKlfjbdKpTIM9MtXaZTfIIIRMMDAPgn/J8FuXo=">å‚è€ƒæ–‡ç« </a></p><h2 id="maven-ä¾èµ–"><a href="#maven-ä¾èµ–" class="headerlink" title="maven ä¾èµ–"></a>maven ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.smallbun.screw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>screw-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="JUnit-ç”Ÿæˆ"><a href="#JUnit-ç”Ÿæˆ" class="headerlink" title="JUnit ç”Ÿæˆ"></a>JUnit ç”Ÿæˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBDocument</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆæ–‡ä»¶é…ç½®</span></span><br><span class="line">        <span class="type">EngineConfig</span> <span class="variable">engineConfig</span> <span class="operator">=</span> EngineConfig.builder()</span><br><span class="line">            <span class="comment">/* ç”Ÿæˆæ–‡ä»¶è·¯å¾„ï¼Œæœ¬åœ°è·¯å¾„ */</span></span><br><span class="line">            .fileOutputDir(<span class="string">&quot;D:/&quot;</span>)</span><br><span class="line">            <span class="comment">/* æ˜¯å¦æ‰“å¼€è¾“å‡ºçš„ç›®å½• */</span></span><br><span class="line">            .openOutputDir(<span class="literal">true</span>)</span><br><span class="line">            <span class="comment">/* æ–‡ä»¶ç±»å‹ */</span></span><br><span class="line">            .fileType(EngineFileType.HTML)</span><br><span class="line">            <span class="comment">/* ç”Ÿæˆæ¨¡æ¿å®ç° */</span></span><br><span class="line">            .produceType(EngineTemplateType.freemarker)</span><br><span class="line">            .build();</span><br><span class="line">        <span class="comment">// ç”Ÿæˆæ–‡æ¡£é…ç½®ï¼ˆåŒ…å«ä»¥ä¸‹è‡ªå®šä¹‰ç‰ˆæœ¬å·ã€æè¿°ç­‰é…ç½®è¿æ¥ï¼‰</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> Configuration.builder()</span><br><span class="line">            .version(<span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;æ•°æ®åº“æ–‡æ¡£&quot;</span>)</span><br><span class="line">            .dataSource(dataSource)</span><br><span class="line">            .engineConfig(engineConfig)</span><br><span class="line">            .produceConfig(getProcessConfig())</span><br><span class="line">            .build();</span><br><span class="line">        <span class="comment">// æ‰§è¡Œç”Ÿæˆ</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DocumentationExecute</span>(config).execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é…ç½®æƒ³è¦ç”Ÿæˆçš„è¡¨ + é…ç½®æƒ³è¦å¿½ç•¥çš„è¡¨</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ProcessConfig <span class="title function_">getProcessConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ProcessConfig.builder()</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨-screw&quot;&gt;&lt;a href=&quot;#æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨-screw&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨ screw&quot;&gt;&lt;/a&gt;æ•°æ®æ–‡æ¡£ç”Ÿæˆå™¨ screw&lt;/h1&gt;&lt;h2 id=&quot;ç›¸å…³é“¾æ¥&quot;&gt;&lt;a href=&quot;#ç›¸å…³é“¾æ¥&quot;</summary>
      
    
    
    
    <category term="å·¥å…·" scheme="http://example.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="screw" scheme="http://example.com/tags/screw/"/>
    
  </entry>
  
  <entry>
    <title>Vue æ‰“åŒ…éƒ¨ç½²è„šæœ¬</title>
    <link href="http://example.com/2022/07/18/Vue/Vue-%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/"/>
    <id>http://example.com/2022/07/18/Vue/Vue-%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/</id>
    <published>2022-07-18T00:50:05.000Z</published>
    <updated>2022-07-18T00:51:22.802Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vue-æ‰“åŒ…éƒ¨ç½²è„šæœ¬"><a href="#Vue-æ‰“åŒ…éƒ¨ç½²è„šæœ¬" class="headerlink" title="Vue æ‰“åŒ…éƒ¨ç½²è„šæœ¬"></a>Vue æ‰“åŒ…éƒ¨ç½²è„šæœ¬</h1><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev scp2 cross-env ora@4.1.1 chalk</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scpClient = <span class="built_in">require</span>(<span class="string">&#x27;scp2&#x27;</span>);      <span class="comment">// åŸºäºssh2çš„çº¯javascriptå®‰å…¨å¤åˆ¶ç¨‹åº</span></span><br><span class="line"><span class="keyword">const</span> ora = <span class="built_in">require</span>(<span class="string">&#x27;ora&#x27;</span>);             <span class="comment">// ä¸€ä¸ªä¼˜é›…çš„ Node.js ç»ˆç«¯åŠ è½½åŠ¨ç”»æ•ˆæœ</span></span><br><span class="line"><span class="keyword">const</span> chalk = <span class="built_in">require</span>(<span class="string">&#x27;chalk&#x27;</span>);         <span class="comment">// å­—ä½“é¢œè‰²æ’ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> spinner = <span class="title function_">ora</span>(<span class="string">&#x27;æ­£åœ¨å‘å¸ƒåˆ° &#x27;</span> + process.<span class="property">env</span>.<span class="property">NODE_ENV</span> + <span class="string">&#x27; æœåŠ¡å™¨...\n&#x27;</span>);</span><br><span class="line">spinner.<span class="title function_">start</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SERVER_LIST</span> = &#123;</span><br><span class="line">    <span class="string">&#x27;development&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">hostname</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,            <span class="comment">// ip</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">22</span>,                       <span class="comment">// ç«¯å£</span></span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;root&#x27;</span>,               <span class="comment">// ç™»å½•æœåŠ¡å™¨çš„è´¦å·</span></span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;xxx&#x27;</span>,                <span class="comment">// ç™»å½•æœåŠ¡å™¨çš„è´¦å·</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/opt/www&#x27;</span>                <span class="comment">// å‘å¸ƒè‡³é™æ€æœåŠ¡å™¨çš„é¡¹ç›®è·¯å¾„</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;production&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">hostname</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,      <span class="comment">// ip</span></span><br><span class="line">        <span class="attr">port</span>: <span class="number">22</span>,                       <span class="comment">// ç«¯å£</span></span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;root&#x27;</span>,               <span class="comment">// ç™»å½•æœåŠ¡å™¨çš„è´¦å·</span></span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;xxx&#x27;</span>,                <span class="comment">// ç™»å½•æœåŠ¡å™¨çš„è´¦å·</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/opt/www&#x27;</span>                <span class="comment">// å‘å¸ƒè‡³é™æ€æœåŠ¡å™¨çš„é¡¹ç›®è·¯å¾„</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯å…¬é’¥è®¤è¯åœ¨è¿™é‡Œåˆ›å»ºç§é’¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="string">&#x27;C:\\Users\\Administrator\\.ssh\\id_rsa&#x27;</span></span><br><span class="line"><span class="keyword">const</span> privateKey = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(path).<span class="title function_">toString</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="variable constant_">SERVER_LIST</span>[process.<span class="property">env</span>.<span class="property">NODE_ENV</span>];</span><br><span class="line">scpClient.<span class="title function_">scp</span>(</span><br><span class="line">    <span class="string">&#x27;dist/&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">host</span>: server.<span class="property">hostname</span>,</span><br><span class="line">        <span class="attr">port</span>: server.<span class="property">port</span>,</span><br><span class="line">        <span class="attr">username</span>: server.<span class="property">username</span>,</span><br><span class="line">        <span class="attr">password</span>: server.<span class="property">password</span>,</span><br><span class="line">        privateKey,</span><br><span class="line">        <span class="attr">path</span>: server.<span class="property">path</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">        spinner.<span class="title function_">stop</span>();</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">red</span>(<span class="string">&#x27;å‘å¸ƒå¤±è´¥.\n&#x27;</span>));</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(chalk.<span class="title function_">green</span>(<span class="string">&#x27;Success! æˆåŠŸå‘å¸ƒåˆ°&#x27;</span> + process.<span class="property">env</span>.<span class="property">NODE_ENV</span> + <span class="string">&#x27;æœåŠ¡å™¨! \n&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>package.json</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span>,</span><br><span class="line">  <span class="string">&quot;deploy&quot;</span>: <span class="string">&quot;npm run build &amp;&amp; cross-env NODE_ENV=development node ./deploy&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Vue-æ‰“åŒ…éƒ¨ç½²è„šæœ¬&quot;&gt;&lt;a href=&quot;#Vue-æ‰“åŒ…éƒ¨ç½²è„šæœ¬&quot; class=&quot;headerlink&quot; title=&quot;Vue æ‰“åŒ…éƒ¨ç½²è„šæœ¬&quot;&gt;&lt;/a&gt;Vue æ‰“åŒ…éƒ¨ç½²è„šæœ¬&lt;/h1&gt;&lt;h2 id=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒå‡†å¤‡&quot; class=&quot;head</summary>
      
    
    
    
    <category term="å‰ç«¯" scheme="http://example.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="Vue" scheme="http://example.com/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud Config</title>
    <link href="http://example.com/2022/07/17/Spring-Cloud/Spring-Cloud-Config/"/>
    <id>http://example.com/2022/07/17/Spring-Cloud/Spring-Cloud-Config/</id>
    <published>2022-07-17T13:34:41.000Z</published>
    <updated>2022-07-18T14:24:55.397Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/">Spring Cloud Config</a></h1><h2 id="1-Quick-Start"><a href="#1-Quick-Start" class="headerlink" title="1. Quick Start"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_quick_start">1. Quick Start</a></h2><blockquote><p>è¯¥ç« æ˜¯å®˜ç½‘çš„ä¸€ä¸ªä½“éªŒæ¡ˆä¾‹</p></blockquote><p>é¦–å…ˆï¼Œå¯åŠ¨æœåŠ¡ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> spring-cloud-config-server</span><br><span class="line">$ ../mvnw spring-boot:run</span><br></pre></td></tr></table></figure><p>æœåŠ¡æ˜¯ä¸€ä¸ª Spring Boot ç¨‹åºï¼Œä½ ä¹Ÿå¯ä»¥ä» IDE è¿è¡Œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè¯•éªŒä¸€ä¸‹å®¢æˆ·ç«¯ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:8888/foo/development</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;foo&quot;</span>,<span class="string">&quot;label&quot;</span>:<span class="string">&quot;master&quot;</span>,<span class="string">&quot;propertySources&quot;</span>:[</span><br><span class="line">  &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;https://github.com/scratches/config-repo/foo-development.properties&quot;</span>,<span class="string">&quot;source&quot;</span>:&#123;<span class="string">&quot;bar&quot;</span>:<span class="string">&quot;spam&quot;</span>&#125;&#125;,</span><br><span class="line">  &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;https://github.com/scratches/config-repo/foo.properties&quot;</span>,<span class="string">&quot;source&quot;</span>:&#123;<span class="string">&quot;foo&quot;</span>:<span class="string">&quot;bar&quot;</span>&#125;&#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure><p>å®šä½å±æ€§èµ„æºçš„é»˜è®¤ç­–ç•¥æ˜¯å»å…‹éš†ä¸€ä¸ª git å­˜å‚¨åº“ï¼ˆä½äº <code>spring.cloud.config.server.git.uri</code>ï¼‰ï¼Œå¹¶ä½¿ç”¨å®ƒå»å®ä¾‹åŒ–ä¸€ä¸ªè¿·ä½ çš„ <code>SpringApplication</code>ã€‚</p><p>HTTP æœåŠ¡ä»¥ä¸‹æ ¼å¼çš„èµ„æºï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/&#123;application&#125;/&#123;profile&#125;[/&#123;label&#125;]</span><br><span class="line">/&#123;application&#125;-&#123;profile&#125;.yml</span><br><span class="line">/&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.yml</span><br><span class="line">/&#123;application&#125;-&#123;profile&#125;.properties</span><br><span class="line">/&#123;label&#125;/&#123;application&#125;-&#123;profile&#125;.properties</span><br></pre></td></tr></table></figure><h3 id="1-1-Client-Side-Usage"><a href="#1-1-Client-Side-Usage" class="headerlink" title="1.1. Client Side Usage"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_client_side_usage">1.1. Client Side Usage</a></h3><p>ä¸ºäº†åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œä½ å¯ä»¥å°†å…¶æ„å»ºä¸ºä¾èµ–äº <code>spring-cloud-config-client</code> çš„Spring Boot é¡¹ç›®ã€‚æœ€ç®€ä¾¿çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Spring Boot å¯åŠ¨å™¨ <code>org.springframework.cloud:spring-cloud-starter-config</code>ã€‚å¯¹äº maven ç”¨æˆ·ä»¥åŠ Gradle å’Œ Spring CLI ç”¨æˆ·çš„ Spring IO ç‰ˆæœ¬ç®¡ç†å±æ€§æ–‡ä»¶ï¼Œä¹Ÿæœ‰ä¸€ä¸ªçˆ¶ POM å’Œ BOMï¼ˆspring-cloud-starter-parentï¼‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ ‡å‡†çš„ Spring Boot åº”ç”¨ï¼Œå°±åƒä¸‹é¢çš„ HTTP æœåŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“è¿™ä¸ª HTTP æœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šä»é»˜è®¤çš„ç›‘å¬äºæœ¬åœ°ç«¯å£ 8888 é…ç½®æœåŠ¡ï¼ˆå¦‚æœå¯åŠ¨äº†ï¼‰è·å–å¤–éƒ¨é…ç½®ã€‚å¦‚æœæƒ³ä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œä½ å¯ä»¥ä¿®æ”¹ bootstrap.properties ä¸­çš„é…ç½®æœåŠ¡çš„ä½ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.config.uri: http://myconfigserver.com</span><br></pre></td></tr></table></figure><p>é»˜è®¤åœ°ï¼Œå¦‚æœåº”ç”¨åç§°æ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä¼šä½¿ç”¨ <code>application</code>ã€‚å¦‚æœè¦ä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.application.name</code> è¿›è¡Œä¿®æ”¹ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name:</span> <span class="string">myapp</span></span><br></pre></td></tr></table></figure><blockquote><ul><li>è®¾ç½®å±æ€§ <code>$&#123;spring.application.name&#125;</code> ä¸è¦ä½¿ç”¨ä¿ç•™å­— <code>application-</code> ä½œä¸ºåº”ç”¨åå‰ç¼€ï¼Œé˜²æ­¢æ— æ³•è§£æå‡ºæ­£ç¡®çš„èµ„æºã€‚</li></ul></blockquote><h2 id="2-Spring-Cloud-Config-Server"><a href="#2-Spring-Cloud-Config-Server" class="headerlink" title="2. Spring Cloud Config Server"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_spring_cloud_config_server">2. Spring Cloud Config Server</a></h2><p>Spring Cloud Config Server æä¾›äº†ä¸€ä¸ªç”¨äºå¤–éƒ¨é…ç½®çš„ HTTP èµ„æº APIã€‚é€šè¿‡ä½¿ç”¨ <code>@EnableConfigServer</code> æ³¨è§£ï¼ŒæœåŠ¡å°±èƒ½åµŒå…¥åˆ° Spring Boot åº”ç”¨ä¸­ã€‚å› æ­¤ï¼Œä¸‹é¢çš„åº”ç”¨å°±æ˜¯ä¸€ä¸ªé…ç½®æœåŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigServer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(ConfigServer.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œæ‰€æœ‰çš„ Spring Boot åº”ç”¨ä¸€æ ·ï¼Œå®ƒé»˜è®¤è¿è¡Œåœ¨ 8080 ç«¯å£ï¼Œä½†ä½ å¯ä»¥å°†å…¶åˆ‡æ¢åˆ°çº¦å®šå¥½çš„ 8888 ç«¯å£ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œé€šè¿‡é…ç½® <code>spring.config.name=configserver</code> æ¥å¯åŠ¨åº”ç”¨ï¼Œè¿™åŒæ—¶ä¹Ÿè®¾ç½®äº†é»˜è®¤çš„å­˜å‚¨åº“ç±»å‹ã€‚</p><blockquote><p>æ³¨æ„ï¼Œè¿™ç§é…ç½®æ–¹å¼çš„ä¾æ®æ˜¯ Config Server jar åŒ…ä¸‹çš„ configserver.yml æ–‡ä»¶ã€‚å®é™…å¹¶æ²¡æœ‰ä½œç”¨ï¼Œå¼•ç”¨çš„æ˜¯ github ä¸Šé¢çš„æ ·æœ¬åœ°å€ã€‚</p></blockquote><p>å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ä½ è‡ªå·±çš„ <code>application.properties</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><strong>application.properties</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port:</span> <span class="number">8888</span></span><br><span class="line"><span class="attr">spring.cloud.config.server.git.uri:</span> <span class="string">file://$&#123;user.home&#125;/config-repo</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œ<code>$&#123;user.home&#125;/config-repo</code> æ˜¯ä¸€ä¸ªåŒ…å« YAML ä»¥åŠå±æ€§æ–‡ä»¶çš„ git å­˜å‚¨åº“ã€‚</p><blockquote><p>åœ¨ Windows ä¸Šï¼Œå¦‚æœ git å­˜å‚¨åº“æ˜¯ä¸€ä¸ªç»å¯¹é©±åŠ¨çš„å‰ç¼€ï¼Œä½ éœ€è¦å†åŠ ä¸€ä¸ª â€œ&#x2F;â€œï¼Œä¾‹å¦‚ï¼š<code>file:///$&#123;user.home&#125;/config-repo)</code></p></blockquote><h3 id="2-1-Environment-Repository"><a href="#2-1-Environment-Repository" class="headerlink" title="2.1. Environment Repository"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_environment_repository">2.1. Environment Repository</a></h3><p>åœ¨ä»€ä¹ˆåœ°æ–¹å­˜å‚¨é…ç½®æœåŠ¡çš„é…ç½®æ•°æ®ï¼Ÿç®¡ç†æ­¤è¡Œä¸ºçš„ç­–ç•¥æ˜¯ <code>EnvironmentRepository</code>ï¼ŒæœåŠ¡ <code>Environment</code> å¯¹è±¡ã€‚è¿™ä¸ª <code>Environment</code> æ˜¯ Spring Environment çš„æµ…æ‹·è´ï¼ˆåŒ…æ‹¬ <code>propertySources</code> ä½œä¸ºä¸»è¦åŠŸèƒ½ï¼‰ã€‚<code>Environment</code> èµ„æºæ˜¯ä¸‰ä¸ªå˜é‡çš„å‚æ•°åŒ–ï¼š</p><ul><li><code>&#123;application&#125;</code>ï¼Œæ˜ å°„åˆ° <code>spring.application.name</code></li><li><code>&#123;profile&#125;</code>ï¼Œåœ¨å®¢æˆ·ç«¯æ˜ å°„åˆ° <code>spring.profiles.active</code></li><li><code>&#123;label&#125;</code></li></ul><p>å­˜å‚¨åº“çš„å®ç°é€šå¸¸è¡¨ç°å¾—åƒä¸€ä¸ª Spring Boot ç¨‹åºï¼Œå®ƒä» <code>spring.config.name</code> ç­‰äº <code>&#123;application&#125;</code> ä»¥åŠ <code>spring.profiles.active</code> ç­‰äº <code>&#123;profiles&#125;</code> ä¸­åŠ è½½é…ç½®æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆè§„åˆ™ä¹Ÿä¸å¸¸è§„çš„ Spring Boot ç¨‹åºç›¸åŒï¼šæ¿€æ´»çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆäºé»˜è®¤å€¼ï¼Œå¦‚æœåˆå¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ™é€‰æ‹©æœ€åä¸€ä¸ªï¼ˆç±»ä¼¼å‘ Map æ·»åŠ æ¡ç›®ï¼‰ã€‚</p><p>å¦‚æœå­˜å‚¨åº“æ˜¯åŸºäºæ–‡ä»¶çš„ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°†ä» application.yml å’Œ foo.yml ä¸­åˆ›å»ºä¸€ä¸ª <code>Environment</code>ã€‚å¦‚æœ YAML æ–‡ä»¶åœ¨å®ƒä»¬å†…éƒ¨æœ‰æŒ‡å‘ Spring é…ç½®æ–‡ä»¶çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœæœ‰ç‰¹å®šçš„é…ç½® YAML æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™äº›æ–‡ä»¶ä¹Ÿä»¥æ¯”é»˜è®¤å€¼æ›´é«˜çš„ä¼˜å…ˆçº§è€Œä½¿ç”¨ã€‚é«˜ä¼˜å…ˆçº§è½¬æ¢ä¸ºåœ¨ <code>Environment</code> ä¸­æå‰åˆ—å‡ºçš„ <code>PropertySource</code>ã€‚</p><h4 id="2-1-1-Git-Backend"><a href="#2-1-1-Git-Backend" class="headerlink" title="2.1.1. Git Backend"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_git_backend">2.1.1. Git Backend</a></h4><p>é»˜è®¤çš„ <code>EnvironmentRepository</code> çš„å®ç°ä½¿ç”¨ Git åç«¯ï¼Œè¿™å¯¹äºç®¡ç†å‡çº§å’Œç‰©ç†ç¯å¢ƒï¼Œä»¥åŠå¯¹äºè·Ÿè¸ªå˜åŒ–éå¸¸æ–¹ä¾¿ã€‚è¦æ›´æ”¹å­˜å‚¨åº“çš„ä½ç½®ï¼Œä½ å¯ä»¥åœ¨ Config Serverï¼ˆä¾‹å¦‚åœ¨ <code>application.yml</code> ä¸­ï¼‰ä¸­è®¾ç½® <code>spring.cloud.config.server.git.uri</code> é…ç½®å±æ€§ã€‚å¦‚æœä½ ç”¨ä¸€ä¸ª <code>file:</code> å‰ç¼€è¿›è¡Œè®¾ç½®ï¼Œåˆ™åº”ä»æœ¬åœ°å­˜å‚¨åº“å·¥ä½œï¼Œä»¥ä¾¿äºä½ å¯ä»¥åœ¨æ²¡æœ‰æœåŠ¡å™¨çš„æƒ…å†µä¸‹å¿«é€Ÿå¯åŠ¨ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç›´æ¥åœ¨æœ¬åœ°å­˜å‚¨åº“ä¸Šæ“ä½œè€Œæ— éœ€å…‹éš†ï¼ˆæ— è®ºæ˜¯å¦æ˜¯è£¸ä»“åº“éƒ½æ— å…³ç´§è¦ï¼Œå› ä¸º Config Server æ°¸è¿œä¸ä¼šæ›´æ”¹ â€œremoteâ€ å­˜å‚¨åº“ï¼‰ã€‚ä¸ºäº†æ‰©å±• Config Server å¹¶ä½¿å…¶é«˜åº¦å¯ç”¨ï¼Œä½ éœ€è¦å°†æ‰€æœ‰æœåŠ¡å®ä¾‹æŒ‡å‘ç›¸åŒçš„å­˜å‚¨åº“ï¼Œå› æ­¤åªæœ‰å…±äº«æ–‡ä»¶ç³»ç»Ÿæ‰èƒ½èµ·ä½œç”¨ã€‚ç”šè‡³åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½å°† <code>ssh:</code> åè®®ç”¨äºå…±äº«æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨åº“ï¼Œä»¥ä¾¿äºæœåŠ¡å¯ä»¥å…‹éš†å®ƒï¼Œå¹¶å°†æœ¬åœ°å·¥ä½œå‰¯æœ¬ä½œä¸ºç¼“å­˜ã€‚</p><h5 id="Skipping-SSL-Certificate-Validation"><a href="#Skipping-SSL-Certificate-Validation" class="headerlink" title="Skipping SSL Certificate Validation"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_skipping_ssl_certificate_validation">Skipping SSL Certificate Validation</a></h5><p>é€šè¿‡å°† <code>git.skipSslValidation</code> å±æ€§è®¾ç½®ä¸º <code>true</code>ï¼ˆé»˜è®¤ä¸º <code>false</code>ï¼‰ï¼Œå¯ä»¥ç¦ç”¨é…ç½®æœåŠ¡å™¨å¯¹ Git æœåŠ¡å™¨çš„ SSSL è¯ä¹¦æ ¡éªŒï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://example.com/my/repo</span></span><br><span class="line">          <span class="attr">skipSslValidation:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h5 id="Setting-HTTP-Connection-Timeout"><a href="#Setting-HTTP-Connection-Timeout" class="headerlink" title="Setting HTTP Connection Timeout"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_setting_http_connection_timeout">Setting HTTP Connection Timeout</a></h5><h4 id="2-1-3-File-System-Backend"><a href="#2-1-3-File-System-Backend" class="headerlink" title="2.1.3. File System Backend"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_file_system_backend">2.1.3. File System Backend</a></h4><p>Config Server ä¸­æ‹¥æœ‰ä¸€ä¸ª <code>native</code> profileï¼Œè¯¥é…ç½®ä¸ä½¿ç”¨ Gitï¼Œè€Œæ˜¯ä»æœ¬åœ°ç±»è·¯å¾„æˆ–è€…æ–‡ä»¶ç³»åŠ è½½é…ç½®æ–‡ä»¶ã€‚ä¸ºäº†ä½¿ç”¨æœ¬åœ°é…ç½®ï¼Œä»¥ <code>spring.profiles.active=native</code> å¯åŠ¨ Config Serverã€‚</p><p>æœç´¢è·¯å¾„å¯ä»¥åŒ…å«å ä½ç¬¦ <code>&#123;application&#125;</code>, <code>&#123;profile&#125;</code>, <code>&#123;label&#125;</code>ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åœ¨è·¯å¾„ä¸­åˆ†ç¦»ç›®å½•å¹¶é€‰æ‹©ä¸€ä¸ªå¯¹ä½ æœ‰æ„ä¹‰çš„ç­–ç•¥ã€‚</p><p>å¦‚æœä½ æ²¡æœ‰åœ¨æœç´¢è·¯å¾„ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œå­˜å‚¨åº“è¿˜ä¼šå°† <code>&#123;label&#125;</code> å‚æ•°è¿½åŠ åˆ°å­˜å‚¨è·¯å¾„æœ«å°¾ï¼Œå› æ­¤å±æ€§æ–‡ä»¶ä¼šä»æ¯ä¸ªæœç´¢è·¯å¾„ï¼Œä»¥åŠæœ‰ä¸€ä¸ª label åç¼€çš„å­ç›®å½•å»åŠ è½½ã€‚å› æ­¤ï¼Œæ²¡æœ‰å ä½ç¬¦çš„é»˜è®¤è¡Œä¸ºä¸åœ¨æœç´¢è·¯å¾„æœ«å°¾æ·»åŠ  <code>/&#123;label&#125;/</code> ç›¸åŒã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ<code>file:/tmp/config</code> ä¸ <code>file:/tmp/config,file:/tmp/config/&#123;label&#125;</code> ç›¸åŒã€‚è¿™ä¸ªè¡Œä¸ºå¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cloud.config.server.native.addLabelLocations=false</code> ä»è€Œç¦ç”¨ã€‚</p><blockquote><ul><li>é»˜è®¤æ·»åŠ  label åç¼€çš„è¡Œä¸ºå¾ˆå•çº¯ï¼Œä¾‹å¦‚ï¼Œä½ è®¾ç½®äº† <code>spring.cloud.config.server.native.search-locations=file:///f:/profiles/application</code>ï¼ŒåŒæ—¶ label å‚æ•°ä¸º devï¼Œé‚£ä¹ˆè¿˜ä¼šæœç´¢çš„è·¯å¾„å°±æ˜¯ <code>file:///f:/profiles/applicationdev</code>ï¼Œå¹¶ä¸ä¼šå¸®ä½ è‡ªåŠ¨æ·»åŠ è·¯å¾„åˆ†éš”ç¬¦ <code>/</code>ï¼Œè‡³å°‘åœ¨ 2.2.8.RELEASE æµ‹è¯•æ˜¯å¦‚æ­¤ã€‚</li></ul></blockquote><h4 id="2-1-6-Sharing-Configuration-With-All-Applications"><a href="#2-1-6-Sharing-Configuration-With-All-Applications" class="headerlink" title="2.1.6. Sharing Configuration With All Applications"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_sharing_configuration_with_all_applications">2.1.6. Sharing Configuration With All Applications</a></h4><h5 id="2-1-6-1-File-Based-Repositories"><a href="#2-1-6-1-File-Based-Repositories" class="headerlink" title="2.1.6.1. File Based Repositories"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#spring-cloud-config-server-file-based-repositories">2.1.6.1. File Based Repositories</a></h5><p>ä½¿ç”¨åŸºäºæ–‡ä»¶çš„å­˜å‚¨åº“ï¼Œåœ¨æ‰€æœ‰å®¢æˆ·ç«¯åº”ç”¨ä¹‹é—´å…±äº«æ–‡ä»¶åä¸º <code>application*</code> çš„èµ„æºï¼ˆ<code>application.properties</code>, <code>application.yml</code>, <code>application-*.properties</code> ç­‰ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨å…·æœ‰è¿™äº›æ–‡ä»¶åçš„èµ„æºæ¥è¿›è¡Œå…¨å±€é»˜è®¤é…ç½®ï¼Œå¹¶ä¸”æ ¹æ®éœ€è¦è®©å®ƒä»¬è¢«åº”ç”¨ç‰¹å®šçš„æ–‡ä»¶è¦†ç›–ã€‚</p><p>å±æ€§è¦†ç›–åŠŸèƒ½ä¹Ÿå¯ä»¥ç”¨äºè®¾ç½®å…¨å±€é»˜è®¤ï¼Œåº”ç”¨ç¨‹åºå…è®¸åœ¨æœ¬åœ°è¦†ç›–å®ƒä»¬ã€‚</p><blockquote><p>ä½¿ç”¨ native é…ç½®æ–‡ä»¶ï¼ˆæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿåç«¯ï¼‰ï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸å±äºæœåŠ¡è‡ªå·±çš„é…ç½®çš„æŒ‡å®šæœç´¢è·¯å¾„ã€‚å¦åˆ™ï¼Œä½äºé»˜è®¤æœç´¢è·¯å¾„ä¸­çš„ <code>application*</code> èµ„æºä¼šè¢«ç§»é™¤ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æœåŠ¡çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><h4 id="2-1-7-JDBC-Backend"><a href="#2-1-7-JDBC-Backend" class="headerlink" title="2.1.7. JDBC Backend"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_jdbc_backend">2.1.7. JDBC Backend</a></h4><p>Spring Cloud Config æœåŠ¡æ”¯æŒ JDBC ä½œä¸ºé…ç½®å±æ€§çš„åç«¯ã€‚ä½ å¯ä»¥é€šè¿‡æ·»åŠ  <code>spring-jdbc</code> åˆ°ç±»è·¯å¾„ï¼Œå¹¶ä½¿ç”¨ <code>jdbc</code> é…ç½®ï¼Œæˆ–è€…æ·»åŠ  <code>JdbcEnvironmentRepository</code> è¯¥ bean æ¥å¯ç”¨æ­¤åŠŸèƒ½ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cloud.config.server.jdbc.enabled=false</code> æ¥ç¦ç”¨ <code>JdbcEnvironmentRepository</code> çš„è‡ªåŠ¨é…ç½®ã€‚</p><blockquote><p>è‡³å°‘ Spring Cloud Config 2.2.8.RELEASE å¼€å§‹æ”¯æŒ enabled å±æ€§</p></blockquote><p>æ•°æ®åº“éœ€è¦æœ‰ä¸€ä¸ªåä¸º <code>PROPERTIES</code> çš„è¡¨ï¼Œåˆ—ä¸º <code>APPLICATION</code>, <code>PROFILE</code>, <code>LABEL</code>, <code>KEY</code>, <code>VALUE</code>ã€‚æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯ Java çš„ String ç±»å‹ï¼Œå› æ­¤ä½ å¯ä»¥å®šä¹‰ä¸º <code>VARCHAR</code>ã€‚å±æ€§å€¼è¡¨ç°ä¸å®ƒä»¬æ¥è‡ª Spring Boot å±æ€§æ–‡ä»¶ <code>&#123;application&#125;-&#123;profile&#125;.properties</code> ç›¸åŒï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„ç¼–ç ä¸è§£ç ï¼Œè¿™äº›ç¨åä¼šè¿›è¡Œå¤„ç†ï¼ˆå³ä¸ä¼šç›´æ¥å†å­˜å‚¨åº“å®ç°ä¸­ï¼‰ã€‚</p><blockquote><p>é»˜è®¤çš„ SQL ä¸º <code>SELECT KEY, VALUE from PROPERTIES where APPLICATION=? and PROFILE=? and LABEL=?</code>ï¼Œä½†è¿™å¯¹äº MySQL å¹¶ä¸ç®¡ç”¨ï¼Œå› ä¸º KEY ä¸ºå…³é”®å­—ï¼Œåº”å½“è¢«åå¼•å·åŒ…è£¹ï¼Œå¦åˆ™åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ã€‚</p></blockquote><h4 id="2-1-8-Redis-Backend"><a href="#2-1-8-Redis-Backend" class="headerlink" title="2.1.8. Redis Backend"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_redis_backend">2.1.8. Redis Backend</a></h4><h4 id="2-1-11-Composite-Environment-Repositories"><a href="#2-1-11-Composite-Environment-Repositories" class="headerlink" title="2.1.11 Composite Environment Repositories"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#composite-environment-repositories">2.1.11 Composite Environment Repositories</a></h4><p>ä»å¤šä¸ªç¯å¢ƒå­˜å‚¨åº“æå–é…ç½®æ•°æ®ã€‚</p><h3 id="2-2-Health-Indicator"><a href="#2-2-Health-Indicator" class="headerlink" title="2.2.  Health Indicator"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_health_indicator">2.2.  Health Indicator</a></h3><p>é…ç½®æœåŠ¡å™¨é™„å¸¦ä¸€ä¸ªå¥åº·æŒ‡ç¤ºå™¨ï¼Œç”¨äºæ£€æŸ¥é…ç½®çš„ <code>EnvironmentRepository</code> æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚é»˜è®¤åœ°ï¼Œå®ƒä¼šè¯·æ±‚ <code>EnvironmentRepository</code> ä¸€ä¸ªåä¸º <code>app</code> çš„åº”ç”¨ï¼Œ<code>default</code> çš„é…ç½®ï¼Œç”± <code>EnvironmentRepository</code> å®ç°æä¾›çš„é»˜è®¤æ ‡ç­¾ã€‚</p><p>é€šè¿‡ <code>health.config.enabled=false</code>ï¼Œä½ å¯ä»¥ç¦ç”¨å¥åº·æŒ‡ç¤ºå™¨ã€‚</p><h3 id="2-3-Security"><a href="#2-3-Security" class="headerlink" title="2.3. Security"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_security">2.3. Security</a></h3><p>ä½ å¯ä»¥ä»¥ä»»ä½•å¯¹ä½ æœ‰æ„ä¹‰çš„æ–¹æ³•ä¿æŠ¤ Config Serverï¼ˆä»ç‰©ç†ç½‘ç»œå®‰å…¨åˆ° OAuth2 æŒç¥¨äººä»¤ç‰Œï¼‰ï¼ŒSpring Security å’Œ Spring Boot æä¾›äº†è®¸å¤šå®‰å…¨æ€§çš„åŠŸèƒ½ã€‚</p><p>ä¸ºäº†ä½¿ç”¨é»˜è®¤çš„ Spring Boot é…ç½® HTTP Basic å®‰å…¨ï¼Œéœ€è¦åŒ…å« Spring Security åˆ°ç±»è·¯å¾„ã€‚é»˜è®¤å…·æœ‰ä¸€ä¸ªåä¸º <code>user</code> çš„ç”¨æˆ·åå’Œéšæœºç”Ÿæˆçš„å¯†ç ã€‚å®è·µä¸­ï¼Œéšæœºå¯†ç å¹¶æ²¡æœ‰å¤ªå¤§ç”¨å¤„ï¼Œæ¨èé…ç½®å¯†ç å¹¶åŠ å¯†ã€‚</p><blockquote><ul><li>éœ€è¦åŒ…å« <code>spring-boot-starter-security</code> ä¾èµ–ï¼Œä»¥ä½¿ç”¨ Spring çš„è‡ªåŠ¨é…ç½®åŒ–çš„ HTTP Basic å®‰å…¨</li><li>é€šè¿‡è®¾ç½® <code>spring.security.user.password</code> é…ç½®å¯†ç </li><li>å®¢æˆ·ç«¯æ³¨æ„è®¾ç½®ç”¨æˆ·åå’Œå¯†ç </li></ul></blockquote><h3 id="2-4-Encryption-and-Decryption"><a href="#2-4-Encryption-and-Decryption" class="headerlink" title="2.4. Encryption and Decryption"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_encryption_and_decryption">2.4. Encryption and Decryption</a></h3><blockquote><p>ä¸ºäº†ä½¿ç”¨åŠ å¯†å’Œè§£å¯†åŠŸèƒ½ï¼Œæ—§ç‰ˆæœ¬ JDK éœ€è¦ä¸‹è½½å®Œå…¨çš„ <a href="https://www.oracle.com/java/technologies/javase-jce-all-downloads.html">JCD</a></p></blockquote><p>å¦‚æœè¿œç¨‹å±æ€§èµ„æºåŒ…å«åŠ å¯†å†…å®¹ï¼ˆä»¥ <code>&#123;cipher&#125;</code> å¼€å¤´ï¼‰ï¼Œåˆ™å…ˆè§£å¯†å†é€šè¿‡ HTTP å‘é€ã€‚è¯¥è®¾ç½®çš„ä¼˜ç‚¹æ˜¯ï¼šå½“å±æ€§å€¼ â€œé™æ­¢â€ æ—¶ï¼Œä¸éœ€è¦ä»¥çº¯æ–‡æœ¬æ–¹å¼å±•ç¤ºã€‚å¦‚æœå€¼æ— æ³•è¢«è§£å¯†ï¼Œå°†ä¼šä»å±æ€§æºä¸­åˆ é™¤å®ƒï¼Œå¹¶æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æœ‰ç›¸åŒé”®çš„å±æ€§ï¼Œä½†æ˜¯å…·æœ‰ <code>invalid</code> å‰ç¼€ï¼Œå€¼æ„å‘³ç€ä¸é€‚ç”¨ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†åŠ å¯†æ–‡æœ¬ç”¨ä½œå¯†ç ï¼Œæœ‰å¯èƒ½æ„å¤–æ³„æ¼ã€‚</p><h3 id="2-5-Key-Management"><a href="#2-5-Key-Management" class="headerlink" title="2.5. Key Management"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_key_management">2.5. Key Management</a></h3><p>Config Server å¯ä»¥ä½¿ç”¨å¯¹ç§°åŠ å¯†æˆ–è€…éå¯¹ç§°åŠ å¯†ï¼ˆRSA å¯†é’¥å¯¹ï¼‰ã€‚é€‰æ‹©ä¸å¯¹ç§°åŠ å¯†åœ¨å®‰å…¨æ€§æ–¹é¢æ›´ä¼˜è¶Šï¼Œä½†ä½¿ç”¨å¯¹ç§°å¯†é’¥é€šå¸¸æ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ <code>bootstrap.properties</code> ä¸­é…ç½®çš„å•ä¸ªå±æ€§å€¼ã€‚</p><p>è¦é…ç½®å¯¹ç§°å¯†é’¥ï¼Œä½ éœ€è¦è®¾ç½® <code>encryt.key</code> ä¸ºå¯†é’¥å­—ç¬¦ä¸²ï¼ˆæˆ–è€…ä½¿ç”¨ <code>ENCRYPT_KEY</code> ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è„±ç¦»çº¯æ–‡æœ¬é…ç½®æ–‡ä»¶ï¼‰ã€‚</p><h3 id="2-6-Creating-a-Key-Store-for-Testing"><a href="#2-6-Creating-a-Key-Store-for-Testing" class="headerlink" title="2.6. Creating a Key Store for Testing"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_creating_a_key_store_for_testing">2.6. Creating a Key Store for Testing</a></h3><p>ä½¿ç”¨ JDK è‡ªå¸¦çš„ <code>keytool</code> å·¥å…·åˆ›å»ºå¯†é’¥åº“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ keytool -genkeypair -<span class="built_in">alias</span> mytestkey -keyalg RSA \</span><br><span class="line">  -dname <span class="string">&quot;CN=Web Server,OU=Unit,O=Organization,L=City,S=State,C=US&quot;</span> \</span><br><span class="line">  -keypass changeme -keystore server.jks -storepass letmein</span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„ <code>server.jks</code> æ–‡ä»¶æ”¾åˆ°ç±»è·¯å¾„ä¸‹ï¼Œç„¶ååœ¨ <code>bootstrap.yml</code> è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">encrypt:</span></span><br><span class="line">  <span class="attr">keyStore:</span></span><br><span class="line">    <span class="attr">location:</span> <span class="string">classpath:/server.jks</span> <span class="comment"># keystore æ–‡ä»¶å­˜å‚¨è·¯å¾„</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">letmein</span> <span class="comment"># storepass å¯†é’¥ä»“åº“</span></span><br><span class="line">    <span class="attr">alias:</span> <span class="string">mytestkey</span> <span class="comment"># å¯†é’¥å¯¹åˆ«å</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">changeme</span> <span class="comment"># keypass ç”¨æ¥ä¿æŠ¤æ‰€ç”Ÿæˆå¯†é’¥å¯¹ä¸­çš„ç§é’¥</span></span><br></pre></td></tr></table></figure><h3 id="2-7-Using-Multiple-Keys-and-Key-Rotation"><a href="#2-7-Using-Multiple-Keys-and-Key-Rotation" class="headerlink" title="2.7. Using Multiple Keys and Key Rotation"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_using_multiple_keys_and_key_rotation">2.7. Using Multiple Keys and Key Rotation</a></h3><h3 id="2-8-Serving-Encrypted-Properties"><a href="#2-8-Serving-Encrypted-Properties" class="headerlink" title="2.8. Serving Encrypted Properties"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_serving_encrypted_properties">2.8. Serving Encrypted Properties</a></h3><p>æœ‰æ—¶å€™ï¼Œä½ å¾€å®¢æˆ·ç«¯è‡ªè¡Œè§£å¯†é…ç½®ï¼Œè€Œä¸æ˜¯åœ¨é…ç½®ä¸­å¿ƒè§£å¯†å®Œæ¯•å†ä¼ é€è¿‡æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æä¾›äº† <code>encrypt.*</code> ç›¸å…³é…ç½®æ¥å®šä½ keyï¼Œä½ è¿˜æ˜¯å¯ä»¥å…·æœ‰ <code>/encrypt</code> å’Œ <code>/decrypt</code> ç«¯ç‚¹ï¼Œä½†æ˜¯ä½ éœ€è¦åœ¨ <code>boostrap.[yml|properties]</code> è®¾ç½® <code>spring.cloud.config.server.encrypt.enabled=false</code> æ¥æ˜¾å¼å…³é—­ä¼ å‡ºå±æ€§çš„è§£å¯†åŠŸèƒ½ã€‚å¦‚æœä½ ä¸å…³å¿ƒç«¯ç‚¹ï¼Œé‚£ä¹ˆå¦‚æœä½ æ²¡æœ‰é…ç½® key æˆ–è€… enabled æ ‡å¿—ï¼Œå°±èƒ½èµ·ä½œç”¨äº†ã€‚</p><h2 id="3-Serving-Alternative-Formats"><a href="#3-Serving-Alternative-Formats" class="headerlink" title="3. Serving Alternative Formats"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_serving_alternative_formats">3. Serving Alternative Formats</a></h2><p>æ¥è‡ªç¯å¢ƒç«¯ç‚¹çš„é»˜è®¤ JSON æ ¼å¼æ˜¯å®Œç¾è¢« Spring åº”ç”¨æ¶ˆè´¹çš„ï¼Œå› ä¸ºå®ƒç›´æ¥æ˜ å°„åˆ° <code>Environment</code> æŠ½è±¡ä¸Šã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªåç¼€ï¼ˆâ€.ymlâ€, â€œ.yamlâ€ æˆ–è€… â€œ.propertiesâ€ï¼‰ä»¥ YAML æˆ–è€… Java å±æ€§æ¶ˆè´¹ç›¸åŒçš„æ•°æ®ã€‚è¿™å¯¹äºé‚£äº›ä¸å…³å¿ƒ JSON ç«¯ç‚¹çš„ç»“æ„ï¼Œæˆ–è€…é¢å¤–å…ƒæ•°æ®çš„åº”ç”¨æ¥æ¶ˆè´¹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼ˆä¾‹å¦‚ï¼Œæœªä½¿ç”¨ Spring çš„åº”ç”¨å¯èƒ½ä¼šå—ç›Šäºæ­¤æ–¹æ³•çš„ç®€å•æ€§ï¼‰ã€‚</p><h2 id="4-Serving-Plain-Text"><a href="#4-Serving-Plain-Text" class="headerlink" title="4. Serving Plain Text"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_serving_plain_text">4. Serving Plain Text</a></h2><p>ä¸ä½¿ç”¨ <code>Environment</code> æŠ½è±¡ï¼Œä½ çš„åº”ç”¨å¯èƒ½éœ€è¦å¯¹å…¶ç¯å¢ƒé‡èº«å®šåˆ¶çš„é€šç”¨æ™®é€šæ–‡æœ¬é…ç½®æ–‡ä»¶ã€‚Config Server é€šè¿‡ä¸€ä¸ªä½äº <code>/&#123;application&#125;/&#123;profile&#125;/&#123;label&#125;/&#123;path&#125;</code> çš„é¢å¤–ç«¯ç‚¹æä¾›è¿™äº›ï¼Œå…¶ä¸­ï¼Œ<code>application</code>ï¼Œ<code>profile</code>ï¼Œ<code>label</code> ä¸å¸¸è§„çš„ç¯å¢ƒç«¯ç‚¹æœ‰ç›¸åŒå«ä¹‰ï¼Œä½†æ˜¯ <code>path</code> æ˜¯ä¸€ä¸ªæ–‡ä»¶åçš„è·¯å¾„ï¼ˆä¾‹å¦‚ log.xmlï¼‰ã€‚æ­¤ç«¯ç‚¹çš„æºæ–‡ä»¶ä»¥ä¸ç¯å¢ƒç«¯ç‚¹ç›¸åŒçš„æ–¹å¼å®šä½ã€‚ç›¸åŒçš„æœç´¢è·¯å¾„è¢«ç”¨äº properties å’Œ YAML æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œä»…è¿”å›ç¬¬ä¸€ä¸ªè¢«åŒ¹é…çš„èµ„æºï¼Œè€Œä¸æ˜¯èšåˆæ‰€æœ‰èµ„æºã€‚</p><p>åœ¨èµ„æºè¢«å®šä½ä¹‹åï¼Œä»¥å¸¸è§„æ ¼å¼çš„å ä½ç¬¦ï¼ˆ<code>$&#123;...&#125;</code>ï¼‰ä¼šè¢«ä½¿ç”¨æä¾›çš„ application nameï¼Œprofileï¼Œlabel è§£æã€‚ä»¥è¿™ç§æ–¹å¼ï¼Œèµ„æºç«¯ç‚¹ä¸ç¯å¢ƒç«¯ç‚¹ç´§å¯†é›†æˆã€‚</p><h2 id="5-Embedding-the-Config-Server"><a href="#5-Embedding-the-Config-Server" class="headerlink" title="5. Embedding the Config Server"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_embedding_the_config_server">5. Embedding the Config Server</a></h2><p>é…ç½®æœåŠ¡æœ€å¥½ä»¥ç‹¬ç«‹åº”ç”¨è¿è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ï¼Œä½ ä¹Ÿå¯ä»¥å°†å…¶åµŒå…¥åˆ°å¦ä¸€ä¸ªåº”ç”¨ä¸­ã€‚ä½¿ç”¨ <code>@EnableConfigServer</code> æ³¨è§£ï¼Œä¸€ä¸ªå¯é€‰çš„å±æ€§ <code>spring.cloud.config.server.bootstrap</code> åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æœ‰ç”¨çš„ã€‚è¿™æ˜¯ä¸€ä¸ªæ ‡è®°ï¼ŒæŒ‡ç¤ºè¯¥æœåŠ¡æ˜¯å¦åº”è¯¥ä»å®ƒè‡ªå·±çš„è¿œç¨‹å­˜å‚¨åº“é…ç½®è‡ªå·±ã€‚é»˜è®¤åœ°ï¼Œè¯¥æ ‡è®°æ˜¯å…³é—­çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å»¶è¿Ÿå¯åŠ¨ã€‚ä½†æ˜¯ï¼Œå½“åµŒå…¥å¦ä¸€ä¸ªåº”ç”¨ä¸­æ—¶ï¼Œå°†ä¸ä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºä»¥ä¸€æ ·çš„æ–¹å¼å¯åŠ¨æ˜¯æœ‰æ„ä¹‰çš„ã€‚å°† <code>spring.cloud.config.server.bootstrap</code> è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œè¿˜å¿…é¡»ä½¿ç”¨ç¬¦åˆç¯å¢ƒå­˜å‚¨åº“é…ç½®ã€‚</p><h2 id="6-Push-Notifications-and-Spring-Cloud-Bus"><a href="#6-Push-Notifications-and-Spring-Cloud-Bus" class="headerlink" title="6. Push Notifications and Spring Cloud Bus"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_push_notifications_and_spring_cloud_bus">6. Push Notifications and Spring Cloud Bus</a></h2><p>è®¸å¤šæºä»£ç å­˜å‚¨åº“æä¾›è€…ï¼ˆå¦‚ Githubï¼ŒGitlabï¼ŒGitea, Gitee, Gogs, æˆ–è€… Bitbucketï¼‰é€šè¿‡ webhook é€šçŸ¥ä½ å­˜å‚¨åº“ä¸­çš„æ›´æ”¹ã€‚ä½ å¯ä»¥é€šè¿‡æä¾›è€…çš„ç”¨æˆ·æ¥å£ä»¥ä¸€ä¸ª URL å’Œä¸€ç»„ä½ æ„Ÿå…´è¶£çš„äº‹ä»¶é…ç½® webhookã€‚å¦‚æœä½ æ·»åŠ äº† <code>spring-cloud-config-monitor</code> ä¾èµ–ï¼Œå¹¶ä¸”åœ¨ä½ çš„é…ç½®ä¸­å¿ƒæ¿€æ´»äº† Spring Cloud Busï¼Œé‚£ä¹ˆ <code>/monitor</code> ç«¯ç‚¹ä¼šè¢«å¯ç”¨ã€‚</p><p>å½“ webhook è¢«æ¿€æ´»æ—¶ï¼Œé…ç½®æœåŠ¡ä¼šé’ˆå¯¹å®ƒè®¤ä¸ºå¯èƒ½å·²ç»æ›´æ”¹çš„åº”ç”¨ç¨‹åºå‘é€ <code>RefreshRemoteApplicationEvent</code> ã€‚å˜æ›´æ£€æµ‹æ˜¯ç­–ç•¥åŒ–çš„ã€‚ä½†æ˜¯ï¼Œé»˜è®¤åœ°ï¼Œå®ƒä¼šå¯»æ‰¾ä¸åº”ç”¨ç¨‹åºåç§°åŒ¹é…çš„æ–‡ä»¶ä¸­åœ°å˜æ›´ã€‚</p><h2 id="7-Spring-Cloud-Config-Client"><a href="#7-Spring-Cloud-Config-Client" class="headerlink" title="7. Spring Cloud Config Client"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_spring_cloud_config_client">7. Spring Cloud Config Client</a></h2><p>Spring Boot åº”ç”¨å¯ä»¥ç«‹å³ä½¿ç”¨ Spring Config æœåŠ¡ã€‚</p><h3 id="7-1-Config-First-Bootstrap"><a href="#7-1-Config-First-Bootstrap" class="headerlink" title="7.1. Config First Bootstrap"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#config-first-bootstrap">7.1. Config First Bootstrap</a></h3><p>ç±»è·¯å¾„ä¸Šæ‹¥æœ‰ Spring Cloud Config Client çš„åº”ç”¨ç¨‹åºï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯ï¼šå½“é…ç½®å®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œå®ƒä¼šç»‘å®šåˆ° Config Serverï¼ˆé€šè¿‡ <code>spring.cloud.config.uri</code> å¼•å¯¼é…ç½®å±æ€§ï¼‰ï¼Œå¹¶ä½¿ç”¨è¿œç¨‹å±æ€§æºåˆå§‹åŒ– Spring çš„ <code>Environment</code>ã€‚</p><p>æ­¤è¡Œä¸ºçš„æœ€ç»ˆç»“æœæ˜¯ï¼Œæ‰€æœ‰å¸Œæœ›æ¶ˆè´¹ Config Server çš„å®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ª <code>bootstrap.yml</code>ï¼Œå…¶ä¸­éœ€è¦åœ¨ <code>spring.cloud.config.uri</code> ä¸­é…ç½®å¥½æœåŠ¡åœ°å€ï¼ˆé»˜è®¤æ˜¯ <code>http://localhost:8888</code>ï¼‰ã€‚</p><h3 id="7-2-Discovery-First-Bootstrap"><a href="#7-2-Discovery-First-Bootstrap" class="headerlink" title="7.2. Discovery First Bootstrap"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#discovery-first-bootstrap">7.2. Discovery First Bootstrap</a></h3><h3 id="7-3-Config-Client-Fail-Fast"><a href="#7-3-Config-Client-Fail-Fast" class="headerlink" title="7.3. Config Client Fail Fast"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#config-client-fail-fast">7.3. Config Client Fail Fast</a></h3><h3 id="7-4-Config-Client-Retry"><a href="#7-4-Config-Client-Retry" class="headerlink" title="7.4. Config Client Retry"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#config-client-retry">7.4. Config Client Retry</a></h3><h3 id="7-5-Locating-Remote-Configuration-Resources"><a href="#7-5-Locating-Remote-Configuration-Resources" class="headerlink" title="7.5. Locating Remote Configuration Resources"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_locating_remote_configuration_resources">7.5. Locating Remote Configuration Resources</a></h3><p>Config Service ä» <code>/&#123;application&#125;/&#123;profile&#125;/&#123;label&#125;</code> ä¾›åº”å±æ€§æºï¼Œåœ¨å®¢æˆ·ç«¯åº”ç”¨ä¸­<strong>é»˜è®¤</strong>çš„ç»‘å®šå¦‚ä¸‹ï¼š</p><ul><li>â€œapplicationâ€&#x3D;<code>$&#123;spring.application.name&#125;</code></li><li>â€œprofileâ€&#x3D;<code>$&#123;spring.profiles.active&#125;</code></li><li>â€œlabelâ€&#x3D;â€masterâ€</li></ul><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cloud.config.*</code> æ¥è¦†ç›–å®ƒä»¬ï¼ˆæ­¤å¤„ <code>*</code> è¡¨ç¤º <code>name</code>, <code>profile</code>, <code>label</code>ï¼‰ã€‚</p><p><code>label</code> å¯¹äºå›æ»šåˆ°ä¹‹å‰çš„é…ç½®ç‰ˆæœ¬æ¯”è¾ƒæœ‰ç”¨ï¼Œä½¿ç”¨é»˜è®¤çš„ Config Server å®ç°ï¼Œå®ƒå¯ä»¥æ˜¯ git labelï¼Œåˆ†æ”¯åï¼Œcommit IDã€‚</p><p><code>label</code> ä¹Ÿå¯ä»¥ç”¨é€—å·åˆ†éš”çš„åˆ—è¡¨è¡¨ç¤ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ—è¡¨ä¸­çš„é¡¹ç›®ä¼šé€ä¸ªå°è¯•ï¼Œç›´è‡³æˆåŠŸï¼ˆå³åªæœ‰ä¸€ä¸ªæœ‰æ•ˆï¼‰ã€‚å½“å·¥ä½œåœ¨åŠŸèƒ½åˆ†æ”¯ä¸Šæ—¶ï¼Œæ­¤è¡Œä¸ºå¯èƒ½æ¯”è¾ƒæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å°† <code>label</code> ä¸ä½ çš„åˆ†æ”¯å¯¹é½ï¼Œä½†ä½¿å…¶å¯é€‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>spring.cloud.config.label=myfeature,develop</code>ã€‚</p><h3 id="7-6-Specifying-Multiple-Urls-for-the-Config-Server"><a href="#7-6-Specifying-Multiple-Urls-for-the-Config-Server" class="headerlink" title="7.6. Specifying Multiple Urls for the Config Server"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_specifying_multiple_urls_for_the_config_server">7.6. Specifying Multiple Urls for the Config Server</a></h3><h3 id="7-7-Configuring-Timeouts"><a href="#7-7-Configuring-Timeouts" class="headerlink" title="7.7. Configuring Timeouts"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_configuring_timeouts">7.7. Configuring Timeouts</a></h3><p>é…ç½®è¶…æ—¶é˜ˆå€¼ï¼š</p><ul><li>è¯»å–è¶…æ—¶ï¼š<code>spring.cloud.config.request-read-timeout</code></li><li>è¿æ¥è¶…æ—¶ï¼š<code>spring.cloud.config.request-connect-timeout</code></li></ul><h3 id="7-8-Security"><a href="#7-8-Security" class="headerlink" title="7.8. Security"></a><a href="https://docs.spring.io/spring-cloud-config/docs/2.2.8.RELEASE/reference/html/#_security_2">7.8. Security</a></h3><p>å¦‚æœä½ ä½¿ç”¨ HTTP Basic å®‰å…¨éªŒè¯ï¼Œå®¢æˆ·ç«¯éœ€è¦çŸ¥æ™“å¯†ç ï¼ˆå¦‚æœä¸æ˜¯é»˜è®¤çš„ï¼Œè¿˜éœ€è¦ç”¨æˆ·åï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡é…ç½®æœåŠ¡çš„ URI æŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ–è€…é€šè¿‡ <code>username</code> å’Œ <code>password</code> å±æ€§ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">     <span class="attr">uri:</span> <span class="string">https://user:secret@myconfig.mycompany.com</span></span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">     <span class="attr">uri:</span> <span class="string">https://myconfig.mycompany.com</span></span><br><span class="line">     <span class="attr">username:</span> <span class="string">user</span></span><br><span class="line">     <span class="attr">password:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure><blockquote><p><code>spring.cloud.config.username</code> å’Œ <code>spring.cloud.config.password</code> ä¼šè¦†ç›– URI é‡Œçš„å€¼</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Cloud-Config&quot;&gt;&lt;a href=&quot;#Spring-Cloud-Config&quot; class=&quot;headerlink&quot; title=&quot;Spring Cloud Config&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://docs.spring.</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼</title>
    <link href="http://example.com/2022/07/16/%E6%9D%82%E9%A1%B9/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>http://example.com/2022/07/16/%E6%9D%82%E9%A1%B9/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</id>
    <published>2022-07-16T08:01:03.000Z</published>
    <updated>2022-07-16T09:34:40.019Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><h2 id="Proxy-æ¨¡å¼"><a href="#Proxy-æ¨¡å¼" class="headerlink" title="Proxy æ¨¡å¼"></a>Proxy æ¨¡å¼</h2><h3 id="Proxy-æ¨¡å¼ä¸­çš„è§’è‰²"><a href="#Proxy-æ¨¡å¼ä¸­çš„è§’è‰²" class="headerlink" title="Proxy æ¨¡å¼ä¸­çš„è§’è‰²"></a>Proxy æ¨¡å¼ä¸­çš„è§’è‰²</h3><p>åœ¨ Proxy æ¨¡å¼ä¸­ä¸€èˆ¬æœ‰ä»¥ä¸‹è§’è‰²ï¼š</p><ul><li>Subjectï¼ˆä¸»ä½“ï¼‰</li></ul><p>Subject å®šä¹‰äº†ä½¿ Proxy å’Œ RealSubject ä¹‹é—´å…·æœ‰ä¸€è‡´æ€§çš„æ¥å£ã€‚</p><ul><li>Proxyï¼ˆä»£ç†äººï¼‰</li></ul><p>Proxy ä¼šå°½é‡å¤„ç†æ¥è‡ªå¤–ç•Œçš„è¯·æ±‚ã€‚å½“è‡ªå·±ä¸èƒ½å¤„ç†æ—¶ï¼Œæ‰ä¼šå°†å·¥ä½œäº¤ç»™ RealSubjectã€‚Proxy ä¹Ÿè¦å®ç° Subject å®šä¹‰çš„æ¥å£ã€‚</p><ul><li>RealSubjectï¼ˆå®é™…ä¸»ä½“ï¼‰</li></ul><p>RealSubject ä¼šåœ¨ Proxy æ— æ³•èƒœä»»å·¥ä½œæ—¶å‡ºåœºã€‚å®ƒä¹Ÿä¼šå®ç° Subject æ¥å£ã€‚</p><p>ä¸‹é¢è¿™æ®µç¤ºä¾‹ç¨‹åºå®ç°äº†ä¸€ä¸ª â€œå¸¦æœ‰åå­—çš„æ‰“å°æœºâ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Printable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPrinterName</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getPrinterName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String string)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Printer</span> <span class="keyword">implements</span> <span class="title class_">Printable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Printer</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        heavyJob(<span class="string">&quot;æ­£åœ¨ç”Ÿæˆ Printer ç¤ºä¾‹ (&quot;</span> + name + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrinterName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrinterName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String string)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;===&quot;</span> + <span class="built_in">this</span>.name + <span class="string">&quot;===&quot;</span>);</span><br><span class="line">        System.out.println(string);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heavyJob</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç»“æŸã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrinterProxy</span> <span class="keyword">implements</span> <span class="title class_">Printable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Printer real;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PrinterProxy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PrinterProxy</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrinterName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.real != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.real.setPrinterName(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrinterName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String string)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ensure();</span><br><span class="line">        real.print(string);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensure</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.real == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.real == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.real = <span class="keyword">new</span> <span class="title class_">Printer</span>(<span class="built_in">this</span>.name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Proxy-æ¨¡å¼å˜ä½“"><a href="#Proxy-æ¨¡å¼å˜ä½“" class="headerlink" title="Proxy æ¨¡å¼å˜ä½“"></a>Proxy æ¨¡å¼å˜ä½“</h3><ul><li><p>Virtual Proxyï¼ˆè™šæ‹Ÿä»£ç†ï¼‰<br>Virtual Proxy å°±æ˜¯ä¸Šé¢å‘ˆç°çš„ Proxy æ¨¡å¼ã€‚å½“çœŸæ­£éœ€è¦ RealSubject æ—¶ï¼Œæ‰ç”Ÿæˆå’Œåˆå§‹åŒ–å®ä¾‹ã€‚</p></li><li><p>Remote Proxyï¼ˆè¿œç¨‹ä»£ç†ï¼‰<br>Remote Proxy å¯ä»¥è®©æˆ‘ä»¬ä¸å¿…åœ¨æ„ RealSubject æ˜¯å¦åœ¨è¿œç¨‹ç½‘ç»œä¸Šï¼Œé€æ˜åœ°ä½¿ç”¨å®ƒçš„åŠŸèƒ½ã€‚Java çš„ RMIï¼ˆRemote Method Invocationï¼šè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰å°±ç›¸å½“äº Remote Proxyã€‚</p></li><li><p>Access Proxy<br>Access Proxy ç”¨äºé™åˆ¶ RealSubject çš„åŠŸèƒ½è®¿é—®ã€‚ä¾‹å¦‚ï¼Œè¿™ç§ä»£ç†åªå…è®¸è®¿é—®ç‰¹å®šçš„æ–¹æ³•ï¼Œå½“è®¿é—®å…¶ä»–æ–¹æ³•æ—¶åˆ™æŠ¥é”™ã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;è®¾è®¡æ¨¡å¼&quot;&gt;&lt;a href=&quot;#è®¾è®¡æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;è®¾è®¡æ¨¡å¼&quot;&gt;&lt;/a&gt;è®¾è®¡æ¨¡å¼&lt;/h1&gt;&lt;h2 id=&quot;Proxy-æ¨¡å¼&quot;&gt;&lt;a href=&quot;#Proxy-æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;P</summary>
      
    
    
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis æ„é€  Mapper Proxy åŸç†</title>
    <link href="http://example.com/2022/07/16/MyBatis/MyBatis-%E6%9E%84%E9%80%A0-Mapper-Proxy-%E5%8E%9F%E7%90%86/"/>
    <id>http://example.com/2022/07/16/MyBatis/MyBatis-%E6%9E%84%E9%80%A0-Mapper-Proxy-%E5%8E%9F%E7%90%86/</id>
    <published>2022-07-16T00:10:44.000Z</published>
    <updated>2022-07-16T23:17:23.005Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ MyBatis åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰çš„ <code>Mapper</code> æ¥å£ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢ä¸º JDK åŠ¨æ€ä»£ç†å¯¹è±¡ <code>Proxy</code>ã€‚</p><p>å‡è®¾æœ‰ UserMapper.xmlï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br></pre></td></tr></table></figure><p>åœ¨ MyBatis çš„æ¡†æ¶ä¸­ï¼Œæä¾›äº† <code>SqlSession</code> çš„é»˜è®¤å®ç°ç±» <code>DefaultSqlSession</code>ï¼Œå…³æ³¨å…¶å®ç°æ–¹æ³• <code>getMapper()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DefaultSqlSession.java</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getMapper</span><span class="params">(Class&lt;T&gt; type)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> configuration.getMapper(type, <span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³• getMapper å†…éƒ¨è°ƒç”¨äº†å±æ€§ <code>Configuration</code> çš„ getMapper æ–¹æ³•ï¼Œå°†ä»£ç ç»†èŠ‚å§”æ‰˜ç»™ <code>Configuration</code> å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Configuration.java</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getMapper</span><span class="params">(Class&lt;T&gt; type, SqlSession sqlSession)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mapperRegistry.getMapper(type, sqlSession);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Configuration</code> å†…éƒ¨çš„å®ç°æ˜¯å°† getMapper çš„ç»†èŠ‚å§”æ‰˜ç»™ <code>MapperRegistry</code> å®ç°ï¼Œé¡¾åæ€ä¹‰ï¼ŒMapper æ³¨å†Œè¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapperRegistry.java</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getMapper</span><span class="params">(Class&lt;T&gt; type, SqlSession sqlSession)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¡®ä¿è¯¥ç±»å‹è¢«è¯†åˆ«</span></span><br><span class="line">    <span class="keyword">final</span> MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory&lt;T&gt;) knownMappers.get(type);</span><br><span class="line">    <span class="keyword">if</span> (mapperProxyFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BindingException</span>(<span class="string">&quot;Type &quot;</span> + type + <span class="string">&quot; is not known to the MapperRegistry.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapperProxyFactory.newInstance(sqlSession);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BindingException</span>(<span class="string">&quot;Error getting mapper instance. Cause: &quot;</span> + e, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”± <code>MapperRegistry</code> çš„å®ç°å¯ä»¥çŸ¥é“ï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª <code>knownMappers</code> ç»“æ„ï¼Œç”¨äºè¿›è¡Œ <code>Mapper</code> æ¥å£åˆ° <code>MapperProxyFactory</code> çš„æ˜ å°„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, MapperProxyFactory&lt;?&gt;&gt; knownMappers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><p><code>MapperProxyFactory</code>ï¼Œç”±ç±»åå¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªæ‰¹é‡ç”Ÿäº§ MapperProxy çš„å·¥å‚ç±»ï¼Œå…³æ³¨å…¶å¦‚ä½•ç”Ÿäº§ MapperProxy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapperProxyFactory.java</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">newInstance</span><span class="params">(SqlSession sqlSession)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ª InvocationHandler</span></span><br><span class="line">    <span class="keyword">final</span> MapperProxy&lt;T&gt; mapperProxy = <span class="keyword">new</span> <span class="title class_">MapperProxy</span>&lt;&gt;(sqlSession, mapperInterface, methodCache);</span><br><span class="line">    <span class="keyword">return</span> newInstance(mapperProxy);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> T <span class="title function_">newInstance</span><span class="params">(MapperProxy&lt;T&gt; mapperProxy)</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ JDK åŠ¨æ€ä»£ç†çš„æ–¹æ³•åˆ›å»ºä»£ç†ç±»</span></span><br><span class="line">    <span class="keyword">return</span> (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; mapperInterface &#125;, mapperProxy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œåˆ›å»ºäº†ä¸€ä¸ª <code>MapperProxy</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”± MyBatis æä¾›çš„ <code>InvocationHandler</code> çš„å®ç°ç±»ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™ <code>Proxy.newProxyInstance</code> æ–¹æ³•åˆ›å»º Proxy å¹¶è¿”å›ã€‚</p><blockquote><p>ä»åå­—ä¸Šçœ‹ï¼ŒMapperProxyFactory ä¼¼ä¹æ˜¯ç”Ÿäº§ MapperProxy çš„å·¥å‚ï¼Œä½†åœ¨è¿‡ç¨‹ä¸­ï¼ŒMapperProxy åªæ˜¯æ‰®æ¼”äº†ä»£ç†ç±»çš„ Handler è§’è‰²ï¼ŒMapperProxyFactory çœŸæ­£ç”Ÿäº§çš„åº”è¯¥æ˜¯ä»£ç†ç±»ã€‚</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨ MyBatis åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰çš„ &lt;code&gt;Mapper&lt;/code&gt; æ¥å£ï¼Œæœ€ç»ˆéƒ½ä¼šè½¬æ¢ä¸º JDK åŠ¨æ€ä»£ç†å¯¹è±¡ &lt;code&gt;Proxy&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ UserMapper.xmlï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="MyBatis" scheme="http://example.com/tags/MyBatis/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ç¬”è®°</title>
    <link href="http://example.com/2022/07/15/MyBatis/MyBatis-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/07/15/MyBatis/MyBatis-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91%E7%AC%94%E8%AE%B0/</id>
    <published>2022-07-15T10:08:57.000Z</published>
    <updated>2022-07-15T10:12:41.959Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a><a href="https://mybatis.org/mybatis-3/">MyBatis</a></h1><hr><h2 id="1-Getting-started"><a href="#1-Getting-started" class="headerlink" title="1. Getting started"></a><a href="https://mybatis.org/mybatis-3/getting-started.html#Getting_started">1. Getting started</a></h2><h3 id="1-1-Installation"><a href="#1-1-Installation" class="headerlink" title="1.1. Installation"></a><a href="https://mybatis.org/mybatis-3/getting-started.html#Installation">1.1. Installation</a></h3><p>è¿›è¡Œæœ€åŸºæœ¬çš„ MyBatis åº”ç”¨å¼€å‘éœ€è¦å¯¼å…¥çš„ä¾èµ–ï¼Œæœ€æ–°ç‰ˆæœ¬å¯ä»¥å‚è€ƒ<a href="https://github.com/mybatis/mybatis-3/releases">github</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-Building-SqlSessionFactory-from-XML"><a href="#1-2-Building-SqlSessionFactory-from-XML" class="headerlink" title="1.2. Building SqlSessionFactory from XML"></a><a href="https://mybatis.org/mybatis-3/getting-started.html#Building_SqlSessionFactory_from_XML">1.2. Building SqlSessionFactory from XML</a></h3><p>ä» XML æ„å»º SqlSessionFactoryã€‚æ‰€æœ‰ mybatis åº”ç”¨ç¨‹åºå›´ç»• <code>SqlSessionFactory</code> å®ä¾‹ã€‚å¯ä»¥é€šè¿‡ <code>SqlSessionFactoryBuilder</code> è·å–åˆ° <code>SqlSessionFactory</code> å®ä¾‹ã€‚<code>SqlSessionFactoryBuilder</code> å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ¥æºè¿›è¡Œæ„å»ºï¼š</p><ul><li>Mybatis configuration xml</li><li>Configuration object</li></ul><p>ä» XML æ–‡ä»¶æ„å»º <code>SqlSessionFactory</code> å®ä¾‹ï¼Œå»ºè®®ä½¿ç”¨<strong>ç±»è·¯å¾„èµ„æº</strong>ï¼Œä½†å®é™…ä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨ InputStreamã€‚</p><p><strong>mybatis-config.xml</strong> å¯ä»¥å‚è€ƒ<a href="https://mybatis.org/mybatis-3/getting-started.html">å®˜ç½‘</a></p><h3 id="1-3-Building-SqlSessionFactory-without-XML"><a href="#1-3-Building-SqlSessionFactory-without-XML" class="headerlink" title="1.3. Building SqlSessionFactory without XML"></a><a href="https://mybatis.org/mybatis-3/getting-started.html#Building_SqlSessionFactory_without_XML">1.3. Building SqlSessionFactory without XML</a></h3><p>å¯ä»¥å‚è€ƒå®˜ç½‘çš„æ¡ˆä¾‹ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ”¯æŒè¿™ç§åšæ³•ï¼Œå› ä¸ºé«˜çº§æ˜ å°„ä»ç„¶éœ€è¦ XML çš„æ”¯æŒã€‚</p><h3 id="1-4-Acquiring-a-SqlSession-from-SqlSessionFactory"><a href="#1-4-Acquiring-a-SqlSession-from-SqlSessionFactory" class="headerlink" title="1.4. Acquiring a SqlSession from SqlSessionFactory"></a><a href="https://mybatis.org/mybatis-3/getting-started.html#Acquiring_a_SqlSession_from_SqlSessionFactory">1.4. Acquiring a SqlSession from SqlSessionFactory</a></h3><p>é€šè¿‡ä»¥ä¸‹ä»£ç å¯ä»¥åˆ›å»ºä¸€ä¸ª Sessionï¼ˆæ³¨æ„å…³é—­ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br></pre></td></tr></table></figure><h3 id="1-5-Exploring-Mapped-SQL-Statements"><a href="#1-5-Exploring-Mapped-SQL-Statements" class="headerlink" title="1.5. Exploring Mapped SQL Statements"></a><a href="https://mybatis.org/mybatis-3/getting-started.html#Exploring_Mapped_SQL_Statements">1.5. Exploring Mapped SQL Statements</a></h3><p>è¯­å¥å¯ä»¥ç”± XML æˆ–è€… Annotation å®šä¹‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¾‹å­ï¼Œåœ¨å‘½åç©ºé—´ <code>org.mybatis.example.BlogMapper</code> ä¸­ï¼Œå®šä¹‰äº†åä¸º <code>selectBlog</code> çš„æ˜ å°„è¯­å¥ï¼Œå…è®¸ä½ é€šè¿‡å®Œå…¨é™å®šåç§° <code>org.mybatis.example.BlogMapper.selectBlog</code> æ¥è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;org.mybatis.example.BlogMapper.selectBlog&quot;</span>, <span class="number">101</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸åœ¨å®Œå…¨é™å®šçš„ Java ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œè¿™ä¹Ÿæ˜¯å¦‚æ­¤è®¾è®¡çš„åŸå› ã€‚ä½¿ç”¨ä¸æ˜ å°„çš„ select è¯­å¥åœ¨åç§°ï¼Œå‚æ•°ï¼Œè¿”å›ç±»å‹ç›¸åŒ¹é…çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ˜ å°„åˆ°ä¸å‘½åç©ºé—´åç§°ç›¸åŒçš„ Mapper ç±»ã€‚è¿™å…è®¸ä½ ç®€å•åœ°å°†æ–¹æ³•è°ƒç”¨åœ¨æ˜ å°„å™¨æ¥å£ä¸Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BlogMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(BlogMapper.class);</span><br><span class="line"><span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> mapper.selectBlog(<span class="number">101</span>);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹æ³•æœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚é¦–å…ˆï¼Œå®ƒä¸ä¾èµ–å­—ç¬¦ä¸²ï¼Œæ›´å®‰å…¨ã€‚å…¶æ¬¡ï¼Œå¦‚æœä½ çš„ IDE ç”±ä»£ç è¡¥å…¨ï¼Œå¯ä»¥åˆ©ç”¨å®ƒè·³è½¬åˆ°ä½ æ˜ å°„çš„ SQL è¯­å¥ã€‚</p><p><strong>Namespaces</strong><br>ä»¥å‰ç‰ˆæœ¬çš„ MyBatis å‘½åç©ºé—´æ˜¯å¯é€‰çš„ï¼Œç°åœ¨å¼ºåˆ¶éœ€è¦å‘½åç©ºé—´ï¼Œå…·æœ‰éš”ç¦»è¯­å¥çš„ç›®çš„ã€‚</p><p>å‘½åç©ºé—´è®©æ¥å£è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”ï¼Œå³ä½¿ä½ ç°åœ¨å¹¶ä¸è®¤ä¸ºä½ ä¼šä½¿ç”¨ï¼Œä½ ä¹Ÿåº”è¯¥éµå¾ªè¿™ç§å®è·µï¼Œé˜²æ­¢ä½ æ”¹å˜æƒ³æ³•ã€‚ä¸€æ—¦ä½¿ç”¨å‘½åç©ºé—´ï¼ŒæŠŠå®ƒæ”¾åˆ°æ­£ç¡®çš„ Java åŒ…å‘½åç©ºé—´ä¸‹èƒ½æ¸…ç†ä½ çš„ä»£ç ï¼Œå¹¶ä¸”é•¿æœŸå†…æé«˜ MyBatis çš„å¯ç”¨æ€§</p><p>å¯¹äºç®€å•çš„è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">  <span class="meta">@Select(&quot;SELECT * FROM blog WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">  Blog <span class="title function_">selectBlog</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸è¿‡ï¼Œå¯¹äºå¤æ‚çš„è¯­å¥ï¼Œå»ºè®®ä½¿ç”¨ XML æ–¹å¼å®šä¹‰ï¼Œå¦åˆ™æ˜¾å¾—æ··ä¹±ã€‚</p></blockquote><h2 id="2-Configuration-XML"><a href="#2-Configuration-XML" class="headerlink" title="2. Configuration XML"></a><a href="https://mybatis.org/mybatis-3/configuration.html">2. Configuration XML</a></h2><h3 id="2-1-properties"><a href="#2-1-properties" class="headerlink" title="2.1. properties"></a><a href="https://mybatis.org/mybatis-3/configuration.html#properties">2.1. properties</a></h3><p><code>&lt;properties&gt;</code> é™¤äº†æ”¯æŒåµŒå…¥å†…ç½®å±æ€§ï¼Œè¿˜æ”¯æŒå¼•å…¥å¤–éƒ¨ Java å±æ€§æ–‡ä»¶ï¼Œåªéœ€é€šè¿‡ resource æˆ–è€… url å±æ€§è®¾ç½®å³å¯ã€‚resource æ˜¯ä»¥ç±»è·¯å¾„ä¸ºåŸºç¡€è·¯å¾„çš„ç›¸å¯¹è·¯å¾„ï¼Œurl ä¸ºæ ‡å‡†çš„è·¯å¾„ä½ç½®ï¼Œå¦‚ file:&#x2F;&#x2F;&#x2F;ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/config.properties&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dev_user&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;F2Fa3!33TYyg&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ç‚¹</strong> </p><ul><li>resource å’Œ url ä¸å¯ä»¥åŒæ—¶è®¾ç½®ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>å¦‚æœé…ç½®äº†ç›¸åŒçš„å±æ€§ï¼Œåˆ™åé¢çš„ä¼šè¦†ç›–å‰é¢çš„ï¼›å¦‚æœæ˜¯åˆ†æ•£åœ¨å±æ€§æ–‡ä»¶å’Œå­å…ƒç´ å±æ€§ä¸­ï¼Œé‚£ä¹ˆç”±äºå±æ€§æ–‡ä»¶ååŠ è½½ï¼Œå› æ­¤å±æ€§æ–‡ä»¶ä¼šè¦†ç›–å­å…ƒç´ å±æ€§ã€‚</li><li><code>&lt;properties&gt;</code> æ ‡ç­¾å¿…éœ€ä½äº <code>configuration</code> å­å…ƒç´ ç¬¬ä¸€ä¸ª</li></ul><p>å±æ€§é…ç½®å®Œï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å±æ€§ï¼Œä»¥æ›¿ä»£éœ€è¦åŠ¨æ€é…ç½®çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å±æ€§çš„æ¥æºä¹Ÿå¯ä»¥æ˜¯ç”±ç¨‹åºä¼ é€’ç»™ SqlSessionFactoryBuilder.build() æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(reader, props);</span><br><span class="line"><span class="comment">// ... or ...</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>.build(reader, environment, props);</span><br></pre></td></tr></table></figure><h3 id="2-2-settings"><a href="#2-2-settings" class="headerlink" title="2.2. settings"></a><a href="https://mybatis.org/mybatis-3/configuration.html#settings">2.2. settings</a></h3><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th><th align="left">æœ‰æ•ˆå€¼</th><th align="left">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="left">cacheEnabled</td><td align="left">å…¨å±€å¯ç”¨æˆ–ç¦ç”¨æ­¤é…ç½®ä¸‹ä»»ä½•æ˜ å°„å™¨ä¸­çš„ä»»ä½•ç¼“å­˜</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">lazyLoadingEnabled</td><td align="left">å…¨å±€æ‡’åŠ è½½ã€‚è¯¥å€¼å¯ä»¥è¢« <code>fetchType</code> å–ä»£ã€‚</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">aggressiveLazyLoading</td><td align="left">å¯ç”¨åï¼Œä»»ä½•æ–¹æ³•è°ƒç”¨éƒ½ä¼šåŠ è½½å¯¹è±¡çš„å»¶è¿Ÿå±æ€§ã€‚å¦åˆ™ï¼Œæ¯ä¸ªå±æ€§æŒ‰éœ€åŠ è½½ã€‚å…·ä½“è§ <code>lazyLoadTriggerMethods</code></td><td align="left"></td><td align="left">false (true in â‰¤3.4.1)</td></tr><tr><td align="left">useColumnLabel</td><td align="left">ä½¿ç”¨åˆ—æ ‡ç­¾è€Œä¸æ˜¯åˆ—åã€‚ä¸åŒçš„é©±åŠ¨è¡¨ç°ä¸åŒã€‚</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">mapUnderscoreToCamelCase</td><td align="left">ä¸‹åˆ’çº¿åˆ°é©¼å³°è½¬æ¢</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">autoMappingBehavior</td><td align="left">æ˜¯å¦è‡ªåŠ¨æ˜ å°„ï¼ŒSpring MyBatis é»˜è®¤ä¸º PARTIALï¼Œæ³¨æ„ã€‚</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">defaultExecutorType</td><td align="left">é…ç½®é»˜è®¤çš„æ‰§è¡Œå™¨ã€‚SIMPLE REUSE BATCH</td><td align="left"></td><td align="left"></td></tr><tr><td align="left">localCacheScope</td><td align="left">æœ¬åœ°ç¼“å­˜çš„ä½œç”¨åŸŸ</td><td align="left">SESSION | STATEMENT</td><td align="left">SESSION</td></tr><tr><td align="left">logImpl</td><td align="left">æŒ‡å®š MyBatis åº”è¯¥ä½¿ç”¨çš„æ—¥å¿—å®ç°ã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™è‡ªåŠ¨å‘ç°ã€‚</td><td align="left">SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td><td align="left">Not set</td></tr></tbody></table><h3 id="2-3-typeAliases"><a href="#2-3-typeAliases" class="headerlink" title="2.3. typeAliases"></a><a href="https://mybatis.org/mybatis-3/configuration.html#typeAliases">2.3. typeAliases</a></h3><p>åˆ«åæ˜¯ Java ç±»å‹çš„çŸ­åç§°ï¼Œå¯ä»¥ç®€å•åœ°å‡å°‘å®Œå…¨é™å®šç±»åçš„å†—ä½™è¾“å…¥ã€‚æ”¯æŒ <code>&lt;typeAlias&gt;</code> å’Œ <code>&lt;package&gt;</code> é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æŒ‡å®š MyBatis æœç´¢ bean çš„åŒ…ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨åŒ…ä¸­çš„<strong>æ‰€æœ‰ bean</strong>ï¼Œéƒ½ä¼šä½¿ç”¨ bean çš„å°å†™éé™å®šç±»åä½œä¸ºåˆ«åã€‚å…¶ä¸­ï¼Œ<code>domain.blog.Author</code> å°†è¢«æ³¨å†Œä¸º <code>author</code>ã€‚ç‰¹æ®Šåœ°ï¼Œå¦‚æœå‘ç° @Alias æ³¨è§£ï¼Œåˆ™å…¶å€¼å°†ç”¨ä½œåˆ«åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰è®¸å¤šå†…ç½®çš„ Java ç±»å‹çš„åˆ«åã€‚å®ƒä»¬éƒ½æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ã€‚å…·ä½“å‚è§ç±» <code>TypeAliasRegistry</code></p><h3 id="2-4-typeHandlers"><a href="#2-4-typeHandlers" class="headerlink" title="2.4. typeHandlers"></a><a href="https://mybatis.org/mybatis-3/configuration.html#typeHandlers">2.4. typeHandlers</a></h3><p>typeHandler ç”¨äºä¸¤ä¸ªåœ°æ–¹ï¼š</p><ul><li>å½“ MyBatis åœ¨ PreparedStatement è®¾ç½®å‚æ•°æ—¶ã€‚å‚è§ <code>DefaultParameterHandler</code></li><li>ä» ResultSet æ£€ç´¢å€¼ã€‚å‚è§ <code>DefaultResultSetHandler</code></li></ul><blockquote><p>è‡ªä»  3.4.5, MyBatis é»˜è®¤æ”¯æŒ JSR-310 (Date and Time API)</p></blockquote><p>åœ¨ MyBatis ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ª <code>TypeHandlerRegistry</code> ç»„ä»¶ï¼Œå…¶ç»´æŠ¤äº†ä¸€ä¸ª Map ç»“æ„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Type, Map&lt;JdbcType, TypeHandler&lt;?&gt;&gt;&gt; typeHandlerMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure><p>è¯¥ Map çš„ key æ˜¯ <code>java.lang.reflect.Type</code> ç±»å‹å¯¹è±¡ï¼Œvalue åˆæ˜¯ä¸€ä¸ª Mapï¼ˆç§°ä¸º sub mapï¼‰ï¼Œé€šå¸¸ç”¨äºä¼ å…¥ä¸€ä¸ª Class å¯¹è±¡ï¼Œå¾—åˆ° Jdbc ç±»å‹æ”¯æŒçš„ç±»å‹å¤„ç†å™¨ï¼Œsub map é€šå¸¸è¿˜ä¼šå­˜å‚¨ä¸€ä¸ª key ä¸º null çš„é”®å€¼å¯¹ï¼Œç”¨äºåŒ¹é…é»˜è®¤çš„å¤„ç†å™¨ã€‚</p><blockquote><p>typeHandlers å‡ ä¹å¾ˆå°‘è‡ªå·±å®šä¹‰æ‰©å±•ï¼Œä½†å°‘éƒ¨åˆ†æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒæœ‰æ•ˆçš„ï¼Œä¾‹å¦‚ï¼šä¸æ¶‰åŠæŸ¥è¯¢çš„ä¸€å¯¹å¤šå…³ç³»ã€setString çš„ä¹±ç é—®é¢˜ã€‚</p></blockquote><h3 id="2-5-Handling-Enums"><a href="#2-5-Handling-Enums" class="headerlink" title="2.5. Handling Enums"></a><a href="https://mybatis.org/mybatis-3/configuration.html#Handling_Enums">2.5. Handling Enums</a></h3><h3 id="2-6-objectFactory"><a href="#2-6-objectFactory" class="headerlink" title="2.6. objectFactory"></a><a href="https://mybatis.org/mybatis-3/configuration.html#objectFactory">2.6. objectFactory</a></h3><p>ä½¿ç”¨ ObjectFactory è¿›è¡Œåˆ›å»ºç»“æœå¯¹è±¡çš„æ–°å®ä¾‹ã€‚ä¸ä»…æ”¯æŒæ— å‚æ„é€ å™¨çš„åˆ›å»ºï¼Œä¹Ÿæ”¯æŒæœ‰å‚æ„é€ å™¨åˆ›å»ºã€‚</p><h3 id="2-7-plugins"><a href="#2-7-plugins" class="headerlink" title="2.7. plugins"></a><a href="https://mybatis.org/mybatis-3/configuration.html#plugins">2.7. plugins</a></h3><h3 id="2-8-environments"><a href="#2-8-environments" class="headerlink" title="2.8. environments"></a><a href="https://mybatis.org/mybatis-3/configuration.html#environments">2.8. environments</a></h3><p>MyBatis å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒã€‚è¿™æœ‰åŠ©äºä½ ä»¥ä»»ä½•åŸå› å°† SQL æ˜ å°„åˆ°ä¸åŒçš„æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¯¹äºå¼€å‘ï¼Œæµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒç”±ä¸åŒçš„é…ç½®ã€‚æˆ–è€…ï¼Œä½ å¯èƒ½æœ‰å¤šä¸ªè¡¨ç»“æ„ç›¸åŒçš„ç”Ÿäº§æ•°æ®åº“ï¼Œå¹¶ä¸”ä½ å¸Œæœ›ä¸ºä¸¤è€…ä½¿ç”¨ç›¸åŒçš„ SQL æ˜ å°„ã€‚</p><p><strong>æ³¨æ„</strong> å°½ç®¡ä½ å¯ä»¥é…ç½®å¤šä¸ªç¯å¢ƒï¼Œä½†æ˜¯ä½ åªå¯ä»¥ä¸ºæ¯ä¸ª SqlSessionFactory é€‰æ‹©ä¸€ä¸ªã€‚å› æ­¤ï¼Œå¦‚æœè¦è¿æ¥åˆ°å¤šä¸ªæ•°æ®åº“ï¼Œåˆ™éœ€è¦ä¸ºæ¯ä¸ªæ•°æ®åº“åˆ›å»ºä¸€ä¸ª SqlSessionFactoryã€‚</p><ul><li><strong>æ¯ä¸ªæ•°æ®åº“ä¸€ä¸ª SqlSessionFactory å®ä¾‹</strong></li></ul><p>ä¼ é€’ç»™ build() æ–¹æ³•å‚æ•° environment å¯ä»¥æŒ‡å®šç¯å¢ƒï¼Œå¦åˆ™ä½¿ç”¨ default ç¯å¢ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader, environment);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader, environment, properties);</span><br></pre></td></tr></table></figure><p><strong>transactionManager</strong></p><p>MyBatis åŒ…å«äº†ä¸¤ç§äº‹åŠ¡ç®¡ç†å™¨ï¼ŒJDBC | MANAGED</p><p><strong>dataSource</strong></p><p>dataSource å…ƒç´ ä½¿ç”¨æ ‡å‡† JDBC DataSource æ¥å£é…ç½® JDBC Connection å¯¹è±¡ã€‚</p><p>å¤§å¤šæ•° MyBatis åº”ç”¨ç¨‹åºå°†æ ¹æ®ç¤ºä¾‹ä¸­é…ç½® dataSourceã€‚ä½†æ˜¯ï¼Œå®ƒä¸æ˜¯å¿…éœ€çš„ã€‚ä½†æ˜¯ï¼Œè¦ä¿ƒè¿›æ‡’åŠ è½½ï¼Œæ•°æ®æºæ˜¯éœ€è¦çš„ã€‚</p><p>æœ‰ä¸‰ç§å†…ç½®çš„æ•°æ®æºç±»å‹ï¼ŒUNPOOLED | POOLED | JNDI</p><p><strong>UNPOOLED</strong> æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œæ•°æ®æºéƒ½æ˜¯ç®€å•åœ°æ‰“å¼€å’Œå…³é—­ä¸€ä¸ªé“¾æ¥ã€‚è™½ç„¶å®ƒæœ‰ç‚¹æ…¢ï¼Œä½†æ˜¯å¯¹äºä¸éœ€è¦ç«‹å³å¯ç”¨è¿æ¥åœ°ç®€å•åº”ç”¨æ¥è¯´ï¼Œæ˜¯ä¸ªä¸é”™åœ°é€‰æ‹©ã€‚ä¸åŒçš„æ•°æ®åº“ä¹Ÿä¸åŒï¼Œå› æ­¤å¯¹äºä¸€äº›æ± åŒ–ä¸å¤ªé‡è¦çš„æ•°æ®åº“ï¼Œè¯¥é…ç½®ä¼šæ˜¯æ¯”è¾ƒç†æƒ³çš„ã€‚UNPOOLED æ•°æ®æºå…·æœ‰ä»¥ä¸‹å±æ€§éœ€è¦é…ç½®ï¼š</p><ul><li><code>driver</code> </li><li><code>url</code></li><li><code>username</code></li><li><code>password</code></li><li><code>defaultTransactionIsolationLevel</code> è¿æ¥çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«</li><li><code>defaultNetworkTimeout</code> é»˜è®¤ç½‘ç»œè¶…æ—¶å€¼ï¼Œä»¥ç­‰å¾…æ•°æ®åº“æ“ä½œå®Œæˆï¼Œå•ä½æ¯«ç§’</li></ul><p><strong>POOLED</strong> DataSource æ± åŒ– JDBC Connection å¯¹è±¡ï¼Œä»¥é¿å…åˆ›å»ºæ–°è¿æ¥å®ä¾‹æ‰€éœ€è¦çš„åˆå§‹åŒ–å’Œè®¤è¯æ—¶é—´ã€‚è¿™æ˜¯ä¸€ç§å½“å‰ web åº”ç”¨ä¸­æµè¡Œçš„æ–¹å¼ï¼Œå¯ä»¥è·å¾—æœ€å¿«çš„å“åº”ã€‚</p><p>é™¤äº†ä¸Šé¢çš„ï¼ˆUNPOOLEDï¼‰å±æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šå±æ€§å¯ç”¨äºé…ç½® POOLED æ•°æ®æºï¼š</p><ul><li><code>poolMaximumActiveConnections</code></li><li><code>poolMaximumIdleConnections</code></li><li><code>poolMaximumCheckoutTime</code></li><li><code>poolTimeToWait</code></li><li><code>poolMaximumLocalBadConnectionTolerance</code></li><li><code>poolPingQuery</code> ping æŸ¥è¯¢è¢«å‘é€åˆ°æ•°æ®åº“ä»¥éªŒè¯è¿æ¥å¤„äºè‰¯å¥½çš„å·¥ä½œçŠ¶æ€ï¼Œå¹¶ä¸”å·²å‡†å¤‡å¥½æ¥å—è¯·æ±‚ã€‚é»˜è®¤å€¼ï¼šâ€NO PING QUERY SETâ€ï¼Œè¿™å›å¼•èµ·å¤§å¤šæ•°æ•°æ®åº“é©±åŠ¨ä»¥é”™è¯¯ä¿¡æ¯äº§ç”Ÿå¤±è´¥ã€‚</li><li><code>poolPingEnabled</code> å¼€å¯æˆ–ç¦ç”¨ ping æŸ¥è¯¢ã€‚å¦‚æœå¼€å¯ï¼Œä½ å¿…é¡»ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ SQL è¯­å¥ï¼ˆæœ€å¥½å¾ˆå¿«ï¼‰è®¾ç½® <code>poolPingQuery</code> å±æ€§ã€‚é»˜è®¤ï¼šfalse</li><li><code>poolPingConnectionsNotUsedFor</code></li></ul><p><strong>JNDI</strong> æ­¤ DataSource çš„å®ç°æ—¨åœ¨ä¸å®¹å™¨ï¼ˆå¦‚ EJB æˆ–è€…åº”ç”¨æœåŠ¡å™¨ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œè¯¥æ•°æ®æºå¯ä»¥é…ç½®å†…éƒ¨æˆ–å¤–éƒ¨æ•°æ®æºï¼Œå¹¶ä¸”åœ¨ JNDI ä¸Šä¸‹æ–‡ä¸­å¯¹å…¶è¿›è¡Œå¼•ç”¨ã€‚è¯¥æ•°æ®æºé…ç½®åªéœ€è¦ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li>initial_context</li><li>data_source</li></ul><h3 id="2-9-databaseIdProvider"><a href="#2-9-databaseIdProvider" class="headerlink" title="2.9. databaseIdProvider"></a><a href="https://mybatis.org/mybatis-3/configuration.html#databaseIdProvider">2.9. databaseIdProvider</a></h3><h3 id="2-10-mappers"><a href="#2-10-mappers" class="headerlink" title="2.10. mappers"></a><a href="https://mybatis.org/mybatis-3/configuration.html#mappers">2.10. mappers</a></h3><p>å®šä¹‰æ˜ å°„çš„ SQL è¯­å¥ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ MyBatis åœ¨å“ªé‡Œæ‰¾åˆ°ä»–ä»¬ï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š</p><ul><li>ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨</li><li>å®Œå…¨é™å®š url å¼•ç”¨ï¼ŒåŒ…æ‹¬ <code>file:///</code></li><li>ç±»å</li><li>åŒ…å</li></ul><h4 id="æ–¹å¼1-ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨"><a href="#æ–¹å¼1-ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨" class="headerlink" title="æ–¹å¼1 ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨"></a>æ–¹å¼1 ç±»è·¯å¾„ç›¸å¯¹èµ„æºå¼•ç”¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ–¹å¼2-å®Œå…¨é™å®š-url-å¼•ç”¨"><a href="#æ–¹å¼2-å®Œå…¨é™å®š-url-å¼•ç”¨" class="headerlink" title="æ–¹å¼2 å®Œå…¨é™å®š url å¼•ç”¨"></a>æ–¹å¼2 å®Œå…¨é™å®š url å¼•ç”¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ–¹å¼3-ç±»å"><a href="#æ–¹å¼3-ç±»å" class="headerlink" title="æ–¹å¼3 ç±»å"></a>æ–¹å¼3 ç±»å</h4><p>æ³¨å†Œçš„é…ç½®ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨å†Œæºç åˆ†æ</strong></p><p>ä¾é ç»„ä»¶ <code>MapperRegistry</code> è¿›è¡Œæ³¨å†Œã€‚ä¸éœ€è¦å°è¯•é…ç½®ä¸¤ä¸ªä¸€æ ·çš„ç±»ï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°å¼‚å¸¸ã€‚</p><p>ä¾é  <code>MapperAnnotationBuilder</code> è§£ææ³¨è§£ã€‚æ³¨è§£è§£æéƒ¨åˆ†ï¼Œé€šè¿‡åå°„ Class.getMethod() è·å–åˆ°æ¥å£æ‰€æœ‰çš„æ–¹æ³•ã€‚</p><p>MapperAnnotationBuilder ä¼šå§”æ´¾å†…éƒ¨çš„ MapperBuilderAssistant è¿›è¡Œè¯­å¥æ·»åŠ ï¼Œè¿˜ä¼šç¼“å­˜åˆ° MapperBuilderAssistant  ä¸­</p><h4 id="æ–¹å¼4-åŒ…å"><a href="#æ–¹å¼4-åŒ…å" class="headerlink" title="æ–¹å¼4 åŒ…å"></a>æ–¹å¼4 åŒ…å</h4><p>æ³¨å†Œè¯¥åŒ…ä¸‹æ‰€æœ‰æ¥å£ä¸º mapper</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>ä½ åœ¨æŒ‡å®šé package çš„é…ç½®æ—¶ï¼Œåªèƒ½é…ç½® urlï¼Œnameï¼Œresource ä¹‹ä¸€çš„å±æ€§ï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°å¼‚å¸¸ã€‚</p><h2 id="3-Mapper-XML-Files"><a href="#3-Mapper-XML-Files" class="headerlink" title="3. Mapper XML Files"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#">3. Mapper XML Files</a></h2><h3 id="3-1-select"><a href="#3-1-select" class="headerlink" title="3.1. select"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#select">3.1. select</a></h3><p>å¯¹äºå½¢å¦‚ <code>#&#123;id&#125;</code> è¿™æ ·çš„æ ‡è®°ï¼Œè¿™å‘Šè¯‰ MyBatis éœ€è¦åˆ›å»ºä¸€ä¸ª PreparedStatement çš„å‚æ•°ã€‚ä½¿ç”¨ JDBCï¼Œè¿™æ ·çš„å‚æ•°ä¼šåœ¨ SQL ä¸­è¯†åˆ«ä¸º â€œ?â€ï¼Œä¼ é€’ç»™ PreparedStatementã€‚</p><table><thead><tr><th align="left">å±æ€§</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">id</td><td align="left">åœ¨è¯¥ namesapce ä¸‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯ä»¥ç”¨äºå¼•ç”¨è¯¥è¯­å¥ï¼Œå³ Statement IDã€‚</td></tr><tr><td align="left">parameterType</td><td align="left">å°†ä¼ é€’åˆ°æ­¤è¯­å¥çš„å‚æ•°çš„å®Œå…¨é™å®šç±»åæˆ–åˆ«åã€‚å¯é€‰ï¼Œå› ä¸º MyBatis å¯ä»¥é€šè¿‡ä¼ é€’ç»™è¯­å¥çš„å®é™…å‚æ•°å¾—åˆ° <code>TypeHandler</code></td></tr><tr><td align="left">resultType</td><td align="left">ä»æ­¤è¯­å¥è¿”å›çš„é¢„æœŸç±»å‹çš„å®Œå…¨é™å®šç±»åæˆ–åˆ«åã€‚åœ¨é›†åˆçš„æƒ…å†µä¸‹ï¼Œè¿™åº”è¯¥æ˜¯é›†åˆåŒ…å«çš„ç±»å‹ï¼Œè€Œä¸æ˜¯é›†åˆç±»å‹ã€‚ä½¿ç”¨ <code>resultType</code> æˆ–è€… <code>resultMap</code>ï¼Œä¸å¯ä»¥éƒ½ç”¨ã€‚</td></tr><tr><td align="left">resultMap</td><td align="left">å¤–éƒ¨ <code>resultMap</code> çš„å¼•ç”¨ã€‚ä½¿ç”¨ <code>resultMap</code> æˆ–è€… <code>resultType</code>ï¼Œä¸å¯ä»¥éƒ½ç”¨ã€‚</td></tr><tr><td align="left">flushCache</td><td align="left">è®¾ç½®ä¸º true å°†å¯¼è‡´å½“è°ƒç”¨æ­¤è¯­å¥æ—¶ä¼šåˆ·æ–° Local å’Œ 2 çº§ç¼“å­˜ã€‚å¯¹äº select é»˜è®¤æ˜¯ false</td></tr><tr><td align="left">useCache</td><td align="left">è®¾ç½®ä¸º true å°†å¯¼è‡´è¯¥è¯­å¥çš„ç»“æœç¼“å­˜åœ¨ 2 çº§ç¼“å­˜ã€‚å¯¹äº select è¯­å¥é»˜è®¤ä¸º: <code>true</code></td></tr><tr><td align="left">timeout</td><td align="left">é©±åŠ¨ç­‰å¾…æ•°æ®åº“è¿”å›æ•°æ®ï¼Œåœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ <code>unset</code>ï¼ˆé©±åŠ¨å†³å®šï¼‰</td></tr><tr><td align="left">fetchSize</td><td align="left"></td></tr><tr><td align="left">statementType</td><td align="left">å¯é€‰å€¼ï¼šSTATEMENT, PREPARED, CALLABLEã€‚é»˜è®¤å€¼ï¼šPREPARED</td></tr><tr><td align="left">resultSetType</td><td align="left"></td></tr><tr><td align="left">databaseId</td><td align="left"></td></tr><tr><td align="left">resultOrdered</td><td align="left"></td></tr><tr><td align="left">resultSets</td><td align="left"></td></tr></tbody></table><h3 id="3-2-insert-update-and-delete"><a href="#3-2-insert-update-and-delete" class="headerlink" title="3.2. insert, update and delete"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#insert.2C_update_and_delete">3.2. insert, update and delete</a></h3><p>MyBatis åŠ è½½ Mapper çš„æ—¶å€™ä¼šå°†è¯»å–åˆ°çš„è¯­å¥ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Configuration çš„å±æ€§ <code>mappedStatements</code> ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, MappedStatement&gt; mappedStatements;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>MappedStatement</code> åˆèƒ½å¤Ÿè·å– <code>BoundSql</code></p><h3 id="ä¸€å¯¹å¤šå…³è”"><a href="#ä¸€å¯¹å¤šå…³è”" class="headerlink" title="ä¸€å¯¹å¤šå…³è”"></a>ä¸€å¯¹å¤šå…³è”</h3><ul><li>collection</li></ul><p>æ”¯æŒåˆ†æ­¥æŸ¥è¯¢å’Œå…³è”æŸ¥è¯¢</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.cannedbread.dictionary.pojo.domain.DictionaryTypeDO&quot;</span> <span class="attr">id</span>=<span class="string">&quot;doctionaryType&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;t_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;type&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;t_description&quot;</span> <span class="attr">property</span>=<span class="string">&quot;description&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;dictionaryTypeList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.cannedbread.dictionary.pojo.domain.DictionaryValueDO&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;v_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;java.lang.String&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;v_label&quot;</span> <span class="attr">property</span>=<span class="string">&quot;label&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;v_value&quot;</span> <span class="attr">property</span>=<span class="string">&quot;value&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-3-Parameters"><a href="#3-3-Parameters" class="headerlink" title="3.3. Parameters"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Parameters">3.3. Parameters</a></h3><p>å‚æ•°ï¼ŒæŒ‡ä¼ é€’ç»™è¯­å¥çš„å‚æ•°ã€‚å‚æ•°å¯ä»¥è®¤ä¸ºæœ‰ 2 ç§ï¼š</p><ul><li><p>ç®€æ˜“ï¼ˆåŸå§‹ï¼‰æ•°æ®ç±»å‹ã€‚ Integerã€String ç­‰æ²¡æœ‰å±æ€§çš„å€¼ã€‚</p></li><li><p>å¤åˆæ•°æ®ç±»å‹ã€‚å¯ä»¥ç†è§£ä¸ºæ˜¯ç”±ç®€æ˜“æ•°æ®ç±»å‹ç»„åˆè€Œæˆçš„ç±»ã€‚</p></li></ul><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>#&#123;id&#125;</code> è¿™ç§æ–¹å¼å¼•ç”¨å‚æ•°ã€‚ä½†æ˜¯ï¼Œå‚æ•°å¯ä»¥æ›´å…·ä½“åœ°å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#123;property,javaType=<span class="type">int</span>,jdbcType:NUMBERIC&#125;</span><br></pre></td></tr></table></figure><p><code>javaType</code> åŸºæœ¬å¯ä»¥æ€»æ˜¯ä»å‚æ•°å¯¹è±¡ä¸­ç¡®å®šï¼Œé™¤éè¯¥å¯¹è±¡æ˜¯ <code>HashMap</code>ï¼Œé‚£ä¹ˆéœ€è¦æ˜¾å¼æŒ‡å®š <code>javaType</code> ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ TypeHandlerã€‚</p><ul><li>ä¼ å…¥ List</li></ul><p>å¼•ç”¨åç§°å¿…é¡»ä¸º <code>list</code>ï¼Œè·å–é•¿åº¦ï¼š<code>list.size</code>ï¼Œè·å–ç¬¬ n ä¸ªå…ƒç´ ï¼šlist[n]</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;list != null and list.size != 0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>ä¼ å…¥å¤šä¸ªå€¼</li></ul><p>å¤šä¸ªå‚æ•°ä¼šå°è£…æˆ Mapï¼Œkey ä¸º param1, param2, â€¦</p><p>å¼•ç”¨æ–¹å¼ï¼š<code>#&#123;param1&#125;</code>ã€<code>#&#123;param2.password&#125;</code></p><ul><li>ä¼ å…¥ Map</li></ul><p>å¯¹ XML ä¸­æ˜ å°„çš„è¯­å¥è¿›è¡Œè§£æä¹‹åï¼Œèƒ½å¤Ÿå¾—åˆ°ä¸€ä¸ª <code>List&lt;ParameterMapping&gt;</code>ï¼Œå…¶ä¸­æ”¶é›†æ‰€æœ‰ <code>#&#123;&#125;</code> å ä½ç¬¦ã€‚</p><p>è¿™äº›ç»“æ„ä¹‹åä¼šä¼ é€’ç»™ <code>StatementHandler</code>ï¼Œé€šå¸¸æ˜¯ <code>PreparedStatementHandler</code>ï¼Œä¹‹åé€šè¿‡ handler è¿›è¡Œå‚æ•°è®¾ç½®ã€‚</p><h3 id="3-4-Result-Maps"><a href="#3-4-Result-Maps" class="headerlink" title="3.4. Result Maps"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Result_Maps">3.4. Result Maps</a></h3><p>å¯¹äºå¦‚ä¸‹æ˜ å°„è¯­å¥ä¾‹å­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select id, username, hashedPassword</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ® <code>resultType</code> å±æ€§æ‰€æŒ‡å®šçš„ï¼Œè¿™æ ·çš„è¯­å¥ä¼šç®€å•åœ°å°†æ‰€æœ‰åœ°åˆ—è‡ªåŠ¨æ˜ å°„åˆ° <code>HashMap</code> çš„ key ä¸Šã€‚ä½†æ˜¯ï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œ<code>HashMap</code>å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é¢†åŸŸæ¨¡å‹ã€‚åº”ç”¨ç¨‹åºæ›´æœ‰å¯èƒ½ä½¿ç”¨ Java Bean æˆ–è€… POJOã€‚è€ƒè™‘å¦‚ä¸‹çš„ Java Beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String hashedPassword;</span><br><span class="line">  <span class="comment">// Getter Setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºäº Java Bean è§„èŒƒï¼Œä¸Šé¢çš„ç±»æœ‰ 3 ä¸ªå±æ€§ï¼šid, username, hashedPasswordã€‚è¿™äº›ä¸ SELECT è¯­å¥ä¸­çš„åˆ—å<strong>å®Œå…¨åŒ¹é…</strong>ã€‚è¿™æ ·ï¼ŒJava Bean å¯ä»¥åƒ HashMap ä¸€æ ·ï¼Œç®€å•åœ°æ˜ å°„åˆ° ResultSetã€‚</p><p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒMyBatis è‡ªåŠ¨åœ¨å¹•ååˆ›å»º ResultMap ä»¥å°†åˆ—ååŸºäºåç§°åœ°è‡ªåŠ¨æ˜ å°„åˆ° Java Bean çš„å±æ€§ã€‚</p><p><strong>åˆ—åä¸å±æ€§åä¸åŒ¹é…çš„æƒ…å†µå¦‚ä½•å¤„ç† ?</strong></p><ul><li>æ ‡å‡† SQL è¯­æ³•ï¼ŒSELECT è¯­å¥åˆ«å</li><li>ä½¿ç”¨è‡ªå®šä¹‰ <code>&lt;Result Map&gt;</code></li></ul><h4 id="3-4-1-Advanced-Result-Maps"><a href="#3-4-1-Advanced-Result-Maps" class="headerlink" title="3.4.1. Advanced Result Maps"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Advanced_Result_Maps">3.4.1. Advanced Result Maps</a></h4><p>Result Map æ˜¯ MyBatis å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥è‡ªç”±æ˜ å°„ç»“æœã€‚</p><h4 id="3-4-2-resultMap"><a href="#3-4-2-resultMap" class="headerlink" title="3.4.2. resultMap"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#resultMap">3.4.2. resultMap</a></h4><p><code>&lt;resultMap&gt;</code> å…ƒç´ çš„æ¦‚è§ˆï¼š</p><ul><li><code>&lt;constructor&gt;</code> ç”¨äºåœ¨å®ä¾‹åŒ–æ—¶å°†ç»“æœæ³¨å…¥ç±»çš„æ„é€ å‡½æ•°<ul><li><code>idArg</code> ID å‚æ•°ï¼Œæ ‡è¯† ID å°†æœ‰åŠ©äºæå‡æ•´ä½“æ€§èƒ½</li><li><code>arg</code> æ™®é€šç»“æœå‚æ•°æ³¨å…¥</li></ul></li><li><code>&lt;id&gt;</code> ä¸€ä¸ª ID ç»“æœï¼Œæ ‡è¯† ID å°†ä¼šæé«˜æ•´ä½“æ€§èƒ½</li><li><code>&lt;result&gt;</code> æ™®é€šç»“æœå‚æ•°</li><li><code>&lt;association&gt;</code> å¤åˆç±»å‹å…³è”ï¼Œè®¸å¤šç»“æœä¼šæ±‡æ€»åˆ°è¯¥ç±»å‹<ul><li>åµŒå¥—ç»“æœæ˜ å°„ - association æœ¬èº«å°±æ˜¯ <code>resultMap</code>ï¼Œæˆ–è€…å¯ä»¥å¼•ç”¨å…¶ä»–çš„ <code>resultMap</code></li></ul></li><li><code>&lt;collection&gt;</code> å¤åˆç±»å‹çš„é›†åˆ<ul><li>åµŒå¥—ç»“æœæ˜ å°„ - collection æœ¬èº«å°±æ˜¯ <code>resultMap</code>ï¼Œæˆ–è€…å¯ä»¥å¼•ç”¨å…¶ä»–çš„ <code>resultMap</code></li></ul></li><li><code>&lt;discriminator&gt;</code> ä½¿ç”¨ç»“æœçš„å€¼æ¥ç¡®å®šè¦ä½¿ç”¨çš„ <code>resultMap</code></li></ul><table><thead><tr><th align="left">å±æ€§</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">id</td><td align="left">å½“å‰å‘½åç©ºé—´ä¸‹å¼•ç”¨æ­¤ result map çš„å”¯ä¸€æ ‡è¯†ç¬¦</td></tr><tr><td align="left">type</td><td align="left">Java çš„å®Œå…¨é™å®šåï¼Œæˆ–è€…åˆ«å</td></tr><tr><td align="left">autoMapping</td><td align="left">å¦‚æœå­˜åœ¨è¯¥å±æ€§ï¼ŒMyBatis ä¼šä¸ºè¯¥ result map å¯ç”¨æˆ–ç¦ç”¨è‡ªåŠ¨æ˜ å°„</td></tr></tbody></table><h4 id="3-4-3-id-amp-result"><a href="#3-4-3-id-amp-result" class="headerlink" title="3.4.3. id &amp; result"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#id_.26_result">3.4.3. id &amp; result</a></h4><p>id å’Œ result éƒ½å¯ä»¥æ˜ å°„ä¸€ä¸ªåˆ—çš„å€¼åˆ°ä¸€ä¸ªç®€å•æ•°æ®ç±»å‹çš„å­—æ®µï¼ˆString,int,double,Date,â€¦ï¼‰</p><h4 id="association"><a href="#association" class="headerlink" title="association"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#association">association</a></h4><p>association å…ƒç´ å¤„ç† â€œhas-oneâ€ ç±»å‹å…³ç³»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåšå®¢æœ‰ä¸€ä¸ªä½œè€…ã€‚<code>&lt;association&gt;</code> æ˜ å°„åƒå…¶ä»– <code>&lt;result&gt;</code> ä¸€æ ·å·¥ä½œã€‚ä½ å¯ä»¥æŒ‡å®š <code>property</code>, <code>javaType</code>, <code>jdbcType</code>, <code>typeHandler</code>ã€‚</p><p>association ä¸åŒä¹‹å¤„åœ¨äºï¼Œä½ éœ€è¦å‘Šè¯‰ MyBatis å¦‚ä½•åŠ è½½å…³è”æ•°æ®ï¼Œæ”¯æŒ 2 ç§æ–¹å¼ï¼š</p><ul><li>Nested Selectï¼šåµŒå¥—æŸ¥è¯¢ï¼Œæˆ–è€…åµŒå¥—å­æŸ¥è¯¢ã€‚é€šè¿‡æ‰§è¡Œå¦ä¸€ä¸ªæ˜ å°„ SQL è¯­å¥è¿”å›æ‰€éœ€çš„<strong>å¤åˆç±»å‹</strong>ã€‚</li><li>Nested Resultsï¼šåµŒå¥—ç»“æœã€‚é€šè¿‡ä½¿ç”¨åµŒå¥—çš„ç»“æœæ˜ å°„æ¥å¤„ç† join ç»“æœçš„é‡å¤å­é›†ã€‚</li></ul><table><thead><tr><th align="left">å±æ€§</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">property</td><td align="left">å­—æ®µæˆ–å±æ€§ã€‚å¦‚æœç»™å®šåç§°å­˜åœ¨ Java Bean åŒ¹é…çš„å±æ€§ï¼Œåˆ™ä¼šä½¿ç”¨ã€‚å¦åˆ™ï¼ŒMyBatis ä¼šå¯»æ‰¾ç»™å®šåç§°çš„å­—æ®µã€‚</td></tr><tr><td align="left">javaType</td><td align="left">å®Œå…¨é™å®šçš„ Java ç±»åï¼ˆæˆ–è€… aliasï¼‰ã€‚å¦‚æœä½ æ˜ å°„åˆ° Java Beanï¼ŒMyBatis ä¼šå¼„æ¸…æ¥šç±»å‹ã€‚å¦‚æœä½ æ˜ å°„åˆ° HashMapï¼Œä½ éœ€è¦æŒ‡å®š javaType ä»¥ç¡®ä¿æ‰€éœ€çš„è¡Œä¸ºã€‚</td></tr><tr><td align="left">jdbcType</td><td align="left"></td></tr><tr><td align="left">typeHandler</td><td align="left"></td></tr></tbody></table><h4 id="Nested-Select-for-Association"><a href="#Nested-Select-for-Association" class="headerlink" title="Nested Select for Association"></a>Nested Select for Association</h4><table><thead><tr><th align="left">å±æ€§</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">column</td><td align="left">å°†è¦ä¼ é€’ç»™åµŒå¥—è¯­å¥çš„åˆ—åæˆ–è€…åˆ«åã€‚<strong>å¯ä»¥ç¡®å®šå”¯ä¸€ä¸€æ¡è®°å½•ã€‚</strong><br>æ³¨æ„ï¼šä¸ºäº†å¤„ç†å¤åˆé”®ï¼Œå¯ä»¥ä½¿ç”¨è¯­æ³• <code>column=&quot;prop1=col1,prop2=col2&quot;</code> æŒ‡å®šå¤šä¸ªåˆ—åä¼ é€’ç»™åµŒå¥—çš„ select è¯­å¥</td></tr><tr><td align="left">select</td><td align="left">æ˜ å°„è¯­å¥çš„ IDï¼Œå°†ä¼šåŠ è½½éœ€è¦çš„å¤æ‚ç±»å‹</td></tr><tr><td align="left">fetchType</td><td align="left">å¯é€‰ã€‚æœ‰æ•ˆå€¼æ˜¯ lazy å’Œ eagerã€‚å¦‚æœå­˜åœ¨ï¼Œå®ƒä¼šè¦†ç›–å…¨å±€é…ç½®å‚æ•° <code>lazyLoadingEnabled</code></td></tr></tbody></table><blockquote><p>åµŒå¥— SELECT å¿…é¡»ç¡®ä¿ç»“æœé›†çš„æ•°é‡å°äºç­‰äº 1 ä¸ªï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°å¼‚å¸¸ï¼š<br>org.apache.ibatis.executor.ExecutorException: Statement returned more than one row, where no more than one was expected.</p></blockquote><p><strong>å®˜æ–¹æç¤º</strong> è™½ç„¶è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯ï¼Œå¯¹äºå¤§é‡æ•°æ®é›†æˆ–è€…åˆ—è¡¨æ€§èƒ½å¹¶ä¸å¥½ã€‚è¿™ç§é—®é¢˜ä¹Ÿè¢«ç§°ä¹‹ä¸º â€œN + 1 Select é—®é¢˜â€ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒN + 1 Select é—®é¢˜æ˜¯ç”±ç±»ä¼¼å¦‚ä¸‹å¼•èµ·çš„ï¼š</p><ul><li>ä½ æ‰§è¡Œå•ä¸ª SQL æ£€ç´¢å‡ºä¸€ä¸ªè®°å½•åˆ—è¡¨ï¼ˆ+1ï¼‰</li><li>å¯¹äºæ¯ä¸ªè¿”å›çš„è®°å½•ï¼Œä½ æ‰§è¡Œ select è¯­å¥æ¥åŠ è½½æ¯ä¸ªçš„ç»†èŠ‚ï¼ˆNï¼‰</li></ul><p>è¯¥é—®é¢˜ä¼šå¯¼è‡´å¤§é‡ SQL æ‰§è¡Œï¼Œå¹¶ä¸æ˜¯å¯å–çš„ã€‚MyBatis å¯ä»¥æ‹¦æˆªåœ¨è¿™äº›æŸ¥è¯¢è¯­å¥ï¼Œå› æ­¤ä½ å¯èƒ½ä¼šå¿½ç•¥è¿™äº›è¯­å¥çš„å¼€é”€ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åŠ è½½è¿™æ ·çš„åˆ—è¡¨ï¼Œç„¶åç«‹å³è¿­ä»£å®ƒè®¿é—®åµŒå¥—æ•°æ®ï¼Œåˆ™ä¼šè°ƒç”¨æ‰€æœ‰å»¶è¿ŸåŠ è½½ï¼Œå› æ­¤æ€§èƒ½å¯èƒ½éå¸¸ç³Ÿç³•ã€‚</p><blockquote><p>è¿™ä¹Ÿæ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ¯”è¾ƒå¿Œè®³çš„ï¼Œåœ¨å¾ªç¯ä½“ä¸­å‘èµ· SQL æŸ¥è¯¢</p></blockquote><h4 id="Nested-Results-for-Association"><a href="#Nested-Results-for-Association" class="headerlink" title="Nested Results for Association"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#Nested_Results_for_Association">Nested Results for Association</a></h4><table><thead><tr><th align="left">å±æ€§</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">resultMap</td><td align="left">ID</td></tr><tr><td align="left">columnPrefix</td><td align="left">å½“ join å¤šå¼ è¡¨æ—¶ï¼Œä½ å¾€å¾€ä¼šä½¿ç”¨åˆ«åæ¥é¿å…ç»“æœé‡å¤åˆ—åã€‚æŒ‡å®š <code>columnPrefix</code> å…è®¸ä½ åœ¨æ˜ å°„æ—¶æ·»åŠ ç»Ÿä¸€çš„å‰ç¼€</td></tr><tr><td align="left">notNullColumn</td><td align="left"></td></tr><tr><td align="left">autoMapping</td><td align="left">å¦‚æœè¯¥å±æ€§å­˜åœ¨ï¼ŒMyBatis åœ¨æ˜ å°„è¯¥å±æ€§æ—¶ï¼Œå°†ä¼šå¯ç”¨æˆ–è€…ç¦ç”¨è‡ªåŠ¨æ˜ å°„</td></tr></tbody></table><h4 id="Multiple-ResultSets-for-Association"><a href="#Multiple-ResultSets-for-Association" class="headerlink" title="Multiple ResultSets for Association"></a>Multiple ResultSets for Association</h4><h4 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h4><ul><li>åµŒå¥— select</li><li>ä½¿ç”¨ join + åµŒå¥—ç»“æœ</li></ul><h4 id="Nested-Select-for-Collection"><a href="#Nested-Select-for-Collection" class="headerlink" title="Nested Select for Collection"></a>Nested Select for Collection</h4><p><code>&lt;collection&gt;</code> å…ƒç´ å°†ä¼šä½¿ç”¨æ–°çš„å±æ€§ <code>ofType</code>ï¼Œè¯¥å±æ€§é€‚ç”¨äºåŒºåˆ† Java Bean å±æ€§ç±»å‹å’Œ collection åŒ…å«çš„ç±»å‹ã€‚</p><h4 id="Nested-Results-for-Collection"><a href="#Nested-Results-for-Collection" class="headerlink" title="Nested Results for Collection"></a>Nested Results for Collection</h4><p>éœ€è¦æ³¨æ„ collection å­å…ƒç´  id çš„é‡è¦æ€§ã€‚</p><h4 id="Multiple-ResultSets-for-Collection"><a href="#Multiple-ResultSets-for-Collection" class="headerlink" title="Multiple ResultSets for Collection"></a>Multiple ResultSets for Collection</h4><h4 id="discriminator"><a href="#discriminator" class="headerlink" title="discriminator"></a>discriminator</h4><h3 id="Auto-mapping"><a href="#Auto-mapping" class="headerlink" title="Auto-mapping"></a>Auto-mapping</h3><p>MyBatis å¯ä»¥è‡ªåŠ¨æ˜ å°„ç»“æœï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æ„å»º result mapï¼Œä½ ç”šè‡³å¯ä»¥ç»“åˆä¸¤ç§ã€‚</p><p>é€šå¸¸ï¼Œæ•°æ®åº“åˆ—ä½¿ç”¨å¤§å†™å­—æ¯ä¸”å•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿ï¼Œè€Œ Java å±æ€§é€šå¸¸éµå¾ªé©¼å³°å‘½åçº¦å®šã€‚å¯ä»¥è®¾ç½® <code>mapUnderscoreToCamelCase </code> ä¸º true å®Œæˆè‡ªåŠ¨æ˜ å°„ã€‚</p><p>å³ä½¿å­˜åœ¨ <code>resultMap</code>ï¼Œè‡ªåŠ¨æ˜ å°„ä¹Ÿä¼šå‘ç”Ÿã€‚å¯¹äºæ¯ä¸ªç»“æœæ˜ å°„ï¼Œåœ¨ç»“æœé›†ä¸­ä½†æ²¡æœ‰è¿›è¡Œæ‰‹å·¥æ˜ å°„çš„åˆ—ï¼Œå°†ä¼šè¢«è‡ªåŠ¨æ˜ å°„ï¼Œä¹‹åè¿›è¡Œæ‰‹å·¥æ˜ å°„ã€‚</p><p>æœ‰ 3 ä¸ªæ˜ å°„çº§åˆ«ï¼š</p><ul><li><code>NONE</code> ç¦ç”¨è‡ªåŠ¨æ˜ å°„ã€‚å³ï¼Œåªä¼šèµ‹å€¼æ‰‹åŠ¨æ˜ å°„å±æ€§ã€‚</li><li><code>PARTIAL</code> é™¤äº†å…¶ä¸­å®šä¹‰çš„åµŒå¥—ç»“æœæ˜ å°„ï¼Œå…¶ä»–éƒ½ä¼šè‡ªåŠ¨æ˜ å°„</li><li><code>FULL</code> è‡ªåŠ¨æ˜ å°„æ‰€æœ‰</li></ul><h2 id="3-6-cache"><a href="#3-6-cache" class="headerlink" title="3.6. cache"></a><a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#cache">3.6. cache</a></h2><p>é»˜è®¤åœ°ï¼Œåªæœ‰ Local Cache æ˜¯å¯ç”¨çš„ï¼Œç”¨äºç¼“å­˜ä¼šè¯çš„æ•°æ®ã€‚è¦å¯ç”¨å…¨å±€äºŒçº§ç¼“å­˜ï¼Œä½ åªéœ€æ·»åŠ ä¸€è¡Œæ–‡å­—åˆ°ä½ çš„ SQL Mapper æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>/&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>äºŒçº§ç¼“å­˜éœ€è¦é…ç½® <code>cacheEnabled</code> ä¸º <code>true</code> æ‰ä¼šå¼€å¯ï¼Œä¸€èˆ¬é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä½†å»ºè®®æ˜¾å¼è®¾ç½®ã€‚å¦å¤–ï¼Œä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œè¿˜éœ€è¦å®ä½“ç±»å®ç° <code>Serializable</code> æ¥å£ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p></blockquote><p>è¿™ä¸ªç®€å•çš„è¯­å¥æ•ˆæœå¦‚ä¸‹ï¼š</p><ul><li>ç¼“å­˜æ‰€æœ‰æ˜ å°„è¯­å¥æ–‡ä»¶ä¸­ SELECT è¯­å¥çš„ç»“æœ</li><li>æ‰€æœ‰ insert, update, delete è¯­å¥å°†åˆ·æ–°ç¼“å­˜</li><li>ç¼“å­˜å°†ä½¿ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç®—æ³•è¿›è¡Œé©±é€</li><li>ç¼“å­˜ä¸ä¼šä»¥åŸºäºè®¡åˆ’çš„æ—¶é—´é¡ºåºåˆ·æ–°</li><li>ç¼“å­˜å°†å­˜å‚¨ 1024 ä¸ªåˆ—è¡¨æˆ–å¯¹è±¡çš„å¼•ç”¨ï¼ˆæ— è®ºæ–¹æ³•è¿”å›ä»€ä¹ˆï¼‰</li><li>ç¼“å­˜ä¼šè¢«è§†ä¸ºè¯»&#x2F;å†™ç¼“å­˜ï¼Œè¿™æ„å‘³ï¼Œè¢«æ£€ç´¢çš„å¯¹è±¡ä¸ä¼šè¢«å…±äº«ï¼Œå¯ä»¥è¢«è°ƒç”¨è€…å®‰å…¨çš„ä¿®æ”¹ï¼Œä¸ä¼šå¹²æ‰°å…¶ä»–çº¿ç¨‹å¯èƒ½çš„ä¿®æ”¹</li></ul><h3 id="Using-a-Custom-Cache"><a href="#Using-a-Custom-Cache" class="headerlink" title="Using a Custom Cache"></a>Using a Custom Cache</h3><p>å®ç° Cache æ¥å£ï¼Œå¹¶åœ¨ Mapper æ–‡ä»¶ä¸­æŒ‡å®š typeï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.domain.something.MyCustomCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="cache-ref"><a href="#cache-ref" class="headerlink" title="cache-ref"></a>cache-ref</h3><p>åœ¨ä¸åŒ namespace ä¹‹é—´å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®å’Œå®ä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache-ref</span> <span class="attr">namespace</span>=<span class="string">&quot;com.someone.application.data.SomeMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-Java-API"><a href="#5-Java-API" class="headerlink" title="5. Java API"></a><a href="https://mybatis.org/mybatis-3/java-api.html">5. Java API</a></h2><h3 id="5-2-SqlSessions"><a href="#5-2-SqlSessions" class="headerlink" title="5.2. SqlSessions"></a><a href="https://mybatis.org/mybatis-3/java-api.html#sqlSessions">5.2. SqlSessions</a></h3><p>é€šè¿‡ <code>SqlSession</code>ï¼Œä½ å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œè·å¾— Mapperï¼Œç®¡ç†äº‹åŠ¡ã€‚<code>SqlSession</code> ç”± <code>SqlSessionFactory</code> åˆ›å»ºã€‚</p><h4 id="5-2-1-SqlSessionFactoryBuilder"><a href="#5-2-1-SqlSessionFactoryBuilder" class="headerlink" title="5.2.1. SqlSessionFactoryBuilder"></a>5.2.1. SqlSessionFactoryBuilder</h4><p><code>SqlSessionFactoryBuilder</code> æœ‰ 5 ä¸ª build() æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å…è®¸ä½ ä»ä¸åŒæ¥æºæ„å»º <code>SqlSessionFactory</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, String environment)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, Properties properties)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(InputStream inputStream, String env, Properties props)</span></span><br><span class="line">SqlSessionFactory <span class="title function_">build</span><span class="params">(Configuration config)</span></span><br></pre></td></tr></table></figure><p><code>environment</code> MyBatis å°†ä¼šä½¿ç”¨çš„ç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰è°ƒç”¨åŒ…å« environment å‚æ•°çš„æ–¹æ³•ï¼Œåˆ™ä½¿ç”¨é»˜è®¤ç¯å¢ƒã€‚</p><p><code>properties</code> MyBatis å°†ä¼šåŠ è½½çš„å±æ€§ï¼Œå¯ä½¿ç”¨ <code>$&#123;propName&#125;</code> è¿›è¡Œé…ç½®</p><p><strong>å…³äº properties åŠ è½½çš„é¡ºåº</strong> </p><ul><li>é¦–å…ˆï¼Œè¯»å– properties å…ƒç´ ä¸»ä½“ä¸­æŒ‡å®šçš„å±æ€§</li><li>å…¶æ¬¡ï¼ŒåŠ è½½äº properties å…ƒç´ çš„ resource ç±»è·¯å¾„èµ„æºæˆ–è€… url å±æ€§æŒ‡å®šçš„èµ„æºå°†ä¼šè¢«è¯»å–</li><li>æœ€åï¼Œä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’çš„ properties æœ€åè¯»å–</li></ul><p>ååŠ è½½çš„å±æ€§ä¼šè¦†ç›–å‰è€…</p><h4 id="5-2-2-SqlSessionFactory"><a href="#5-2-2-SqlSessionFactory" class="headerlink" title="5.2.2. SqlSessionFactory"></a>5.2.2. SqlSessionFactory</h4><p>SqlSessionFactory æœ‰ 6 ç§æ–¹æ³•ç”¨äºåˆ›å»º SqlSession å®ä¾‹ã€‚ä¸€èˆ¬åœ°ï¼Œå½“ä½ é€‰æ‹©ç”¨å“ªä¸ªæ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li><strong>Transaction</strong>ï¼šä½ æ˜¯å¦å¸Œæœ›ä¸º session ä½¿ç”¨äº‹åŠ¡èŒƒå›´ï¼Œæˆ–è€…ä½¿ç”¨ auto-commitï¼ˆè¿™é€šå¸¸æ„å‘³ç€æ•°æ®åº“æˆ– JDBC æ²¡æœ‰äº‹åŠ¡ï¼‰ï¼Ÿ</li><li><strong>Connection</strong>ï¼šä» MyBatis é…ç½®å¥½çš„æ•°æ®æºè·å–è¿˜æ˜¯è‡ªå·±æä¾›</li><li><strong>Execution</strong>ï¼šé‡ç”¨ PreparedStatement è¿˜æ˜¯æ‰¹å¤„ç†</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">()</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(<span class="type">boolean</span> autoCommit)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(Connection connection)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(TransactionIsolationLevel level)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, TransactionIsolationLevel level)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, <span class="type">boolean</span> autoCommit)</span></span><br><span class="line">SqlSession <span class="title function_">openSession</span><span class="params">(ExecutorType execType, Connection connection)</span></span><br><span class="line">Configuration <span class="title function_">getConfiguration</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>é»˜è®¤åœ°ï¼Œæ— å‚çš„ openSession() å°†ä¼šåˆ›å»ºå…·æœ‰å¦‚ä¸‹ç‰¹å¾çš„ SqlSessionï¼š</p><ul><li>å¯åŠ¨äº‹åŠ¡ï¼Œå³ä¸ä¼š auto commit</li><li>Connection å¯¹è±¡ä» DataSource ä¸­è·å–</li><li>äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯é©±åŠ¨æˆ–è€…æ•°æ®æºä½¿ç”¨çš„é»˜è®¤å€¼</li><li>ä¸ä¼šé‡ç”¨ PreparedStatementsï¼Œä¸ä¼šæ‰¹é‡æ›´æ–°</li></ul><p>ExecutorType å‚æ•°å®šä¹‰äº† 3 ä¸ªå¯é€‰å€¼ï¼š</p><ul><li>ExecutorType.SIMPLEï¼šæœ´ç´ çš„æ‰§è¡Œå™¨ã€‚ä¸ºæ¯ä¸ªæ‰§è¡Œè¯­å¥åˆ›å»ºä¸€ä¸ª PreparedStatementã€‚</li><li>ExecutorType.REUSEï¼šè¿™ç§ç±»å‹ä¼šé‡ç”¨ PreparedStatementã€‚</li><li>ExecutorType.BATCHï¼šæ‰¹é‡æ›´æ–°ï¼ŒåŒæ—¶ï¼Œå¦‚æœæ‰§è¡Œè¯­å¥ä¹‹é—´æœ‰ SELECT è¯­å¥ï¼Œä¹Ÿä¼šåœ¨å¿…è¦çš„åœ°æ–¹åˆ’æ¸…ã€‚</li></ul><h4 id="5-2-3-SqlSession"><a href="#5-2-3-SqlSession" class="headerlink" title="5.2.3. SqlSession"></a><a href="https://mybatis.org/mybatis-3/java-api.html#SqlSession">5.2.3. SqlSession</a></h4><h5 id="5-2-3-1-Statement-Execution-Methods"><a href="#5-2-3-1-Statement-Execution-Methods" class="headerlink" title="5.2.3.1. Statement Execution Methods"></a><a href="https://mybatis.org/mybatis-3/java-api.html#Statement_Execution_Methods">5.2.3.1. Statement Execution Methods</a></h5><p>SqlSession å…·æœ‰è®¸å¤šæ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œ SQL æ˜ å°„æ–‡ä»¶ä¸­å®šä¹‰çš„ SELECT, INSERT, UPDATE, DELETE è¯­å¥ã€‚æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ª <code>statement</code> å‚æ•°ï¼ˆStatement IDï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æœ‰ parameter å‚æ•°ï¼Œå‚æ•°å¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼ˆè‡ªåŠ¨è£…ç®±ï¼‰ï¼Œæˆ–è€… Java Beanï¼ŒPOJOï¼ŒMapã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement)</span>;</span><br><span class="line">&lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement)</span>;</span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span>;</span><br><span class="line"></span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement)</span>;</span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span>;</span><br><span class="line"></span><br><span class="line">&lt;K, V&gt; Map&lt;K, V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, String mapKey)</span>;</span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey)</span>;</span><br><span class="line">&lt;K, V&gt; Map&lt;K, V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey, RowBounds rowBounds)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span><span class="params">(String statement, ResultHandler handler)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span><span class="params">(String statement, Object parameter, ResultHandler handler)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span><span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler handler)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(String statement)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(String statement)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(String statement)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(String statement, Object parameter)</span></span><br></pre></td></tr></table></figure><blockquote><ul><li><code>selectOne</code> å’Œ <code>selectList</code> ä¸åŒç‚¹åœ¨äºï¼Œ <code>selectOne</code> å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–è€… nullï¼ˆæ²¡æœ‰å¯¹è±¡ï¼‰ã€‚å¦‚æœè¶…è¿‡ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul></blockquote><p>å¦‚æœä½ ä¸çŸ¥é“æœ‰å¤šå°‘å¯¹è±¡ï¼Œä½¿ç”¨ <code>selectList</code> æ€»æ˜¯å®‰å…¨çš„ã€‚</p><p>å¦‚æœä½ æƒ³æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œä½ æœ€å¥½è¿”å›ä¸€ä¸ªè®¡æ•°å€¼ï¼ˆ0 æˆ– 1ï¼‰ã€‚</p><p><code>selectMap</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µï¼Œå®ƒä¼šåŸºäºç»“æœä¸­çš„æŸä¸ªå±æ€§ï¼Œå°†ç»“æœåˆ—è¡¨è½¬æ¢ä¸ºä¸€ä¸ª Mapã€‚</p><p>å› ä¸ºä¸æ˜¯æ‰€æœ‰æ–¹æ³•éƒ½éœ€è¦å‚æ•°ï¼Œå› æ­¤è¿™äº›æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªæ— å‚æ•°çš„é‡è½½æ–¹æ³•ã€‚</p><p><code>insert</code>, <code>update</code>, <code>delete</code> çš„è¿”å›å€¼è¡¨ç¤ºçš„æ˜¯å½±å“è¡Œæ•°ã€‚</p><p>æœ‰å‡ ç§é«˜çº§çš„ <code>select</code> æ–¹æ³•ï¼Œå®ƒä»¬å…è®¸ä½ é™åˆ¶è¦è¿”å›çš„è¡ŒèŒƒå›´ï¼Œæˆ–è€…æä¾›è‡ªå®šä¹‰çš„ç»“æœå¤„ç†é€»è¾‘ï¼ˆResultHandlerï¼‰ï¼Œé€šå¸¸ç”¨äºéå¸¸å¤§çš„æ•°æ®é›†ï¼ˆMySQL å‡ ä¹ä¸ä½¿ç”¨ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span> <span class="params">(String statement, Object parameter, RowBounds rowBounds)</span></span><br><span class="line">&lt;T&gt; Cursor&lt;T&gt; <span class="title function_">selectCursor</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span></span><br><span class="line">&lt;K,V&gt; Map&lt;K,V&gt; <span class="title function_">selectMap</span><span class="params">(String statement, Object parameter, String mapKey, RowBounds rowbounds)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span> <span class="params">(String statement, Object parameter, ResultHandler&lt;T&gt; handler)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">select</span> <span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler&lt;T&gt; handler)</span></span><br></pre></td></tr></table></figure><p><code>RowBounds</code> å‚æ•°ä¼šè®© MyBatis è·³è¿‡æŒ‡å®šçš„è®°å½•æ•°ï¼ŒåŒæ—¶é™åˆ¶è¦è¿”å›çš„è®°å½•æ•°ã€‚</p><blockquote><ul><li>åœ¨è¿™é‡Œï¼Œä¸åŒçš„é©±åŠ¨èƒ½å¤Ÿè·å¾—ä¸åŒçš„æ•ˆç‡ã€‚ä¸ºäº†æœ€ä½³æ€§èƒ½ï¼Œéœ€è¦ä½¿ç”¨ç»“æœé›†ç±»å‹ä¸º <code>SCROLL_SENSITIVE </code> æˆ–è€… <code>SCROLL_INSENSITIVE </code></li></ul></blockquote><p><code>ResultHandler</code> å‚æ•°å…è®¸ä½ æŒ‰ç…§ä½ çš„æ–¹å¼å¤„ç†æ¯ä¸€è¡Œã€‚ä½ å¯ä»¥æŠŠå®ƒæ·»åŠ åˆ° Listï¼Œåˆ›å»ºä¸€ä¸ª Mapï¼ŒSetï¼Œæˆ–è€…æŠ›å‡ºä¹°ä¸ªç»“æœï¼Œè€Œåªä¿ç•™è®¡ç®—çš„è®¡ç®—çš„æ€»æ•°ã€‚ä½ å¯ä»¥ä½¿ç”¨ ResultHandler åšä»»ä½•äº‹æƒ…ï¼Œè¿™å°±æ˜¯ MyBatis å†…éƒ¨ä½¿ç”¨æ¥æ„é€ ç»“æœé›†åˆ—è¡¨çš„ã€‚</p><p>ResultHandler æ¥å£å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResultHandler</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">handleResult</span><span class="params">(ResultContext&lt;? extends T&gt; context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ResultContext</code> å‚æ•°ç”¨äºè®¿é—®ç»“æœå¯¹è±¡æœ¬èº«ï¼Œè¿™æ˜¯è¢«åˆ›å»ºçš„ç»“æœå¯¹è±¡çš„æ•°é‡è®¡æ•°ï¼Œä»¥åŠä½ å¯ä»¥ä½¿ç”¨ <code>stop()</code> æ–¹æ³•åœæ­¢ MyBatis åŠ è½½æ›´å¤šç»“æœã€‚</p><p>ä½¿ç”¨ <code>ResultHandler</code> æœ‰ä¸¤ç‚¹ä½ åº”è¯¥äº†è§£ï¼š</p><ul><li>ä½¿ç”¨ <code>ResultHandler</code> è°ƒç”¨çš„æ–¹æ³•ç§çš„æ•°æ®ä¸ä¼šè¢«ç¼“å­˜</li><li>å½“ä½¿ç”¨é«˜çº§ <code>resultMap</code> æ—¶ï¼ŒMyBatis æœ‰å¯èƒ½éœ€è¦å¤šè¡Œæ¥æ„å»º 1 ä¸ªå¯¹è±¡ã€‚å¦‚æœä½¿ç”¨ <code>ResultHandler</code>ï¼Œå¯èƒ½ä¼šç»™ä½ ä¸€ä¸ªå…³è”æˆ–è€…é›†åˆæœªè¢«å¡«å……çš„å¯¹è±¡ã€‚</li></ul><h5 id="Local-Cache"><a href="#Local-Cache" class="headerlink" title="Local Cache"></a><a href="https://mybatis.org/mybatis-3/java-api.html#Local_Cache">Local Cache</a></h5><p>MyBatis ä½¿ç”¨äº† 2 ä¸ªç¼“å­˜ï¼ŒLocal Cache å’Œ äºŒçº§ç¼“å­˜ã€‚</p><p>æ¯æ¬¡ MyBatis åˆ›å»ºæ–°çš„ä¼šè¯æ—¶ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ª Local Cache é™„åŠ åˆ°ä¼šè¯ä¸­ã€‚åœ¨<strong>æœ¬æ¬¡ä¼šè¯</strong>ä¸­æ‰§è¡Œçš„ä»»ä½•æŸ¥è¯¢éƒ½å°†å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜ä¸­ï¼Œå› æ­¤å…·æœ‰ç›¸åŒè¾“å…¥å‚æ•°çš„ç›¸åŒæŸ¥è¯¢ï¼Œä»¥åéƒ½ä¸ä¼šæŸ¥è¯¢æ•°æ®åº“ã€‚å½“ update, commit, rollback å’Œ close æ—¶ï¼ŒLocal Cache ä¼šæ¸…é™¤ã€‚</p><h6 id="1-Local-Cache-åŸç†-ğŸ‘‡"><a href="#1-Local-Cache-åŸç†-ğŸ‘‡" class="headerlink" title="1. Local Cache åŸç† ğŸ‘‡"></a>1. Local Cache åŸç† ğŸ‘‡</h6><p>ä¸€èˆ¬åœ°ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ–¹æ³•çš„æ—¶å€™éƒ½æ˜¯è°ƒç”¨ BaseExecutor çš„ query() æ–¹æ³•ï¼Œå…¶æ–¹æ³•å†…éƒ¨ä¼šå…ˆè€ƒè™‘æ˜¯å¦ä» Local Cache ä¸­è·å–æ•°æ®ï¼Œå¦‚æœä¸ä»ç¼“å­˜ä¸­è·å–ï¼Œåˆ™è°ƒç”¨å†…éƒ¨çš„ doQuery() æ–¹æ³•</p><h6 id="Local-Cache-çš„-Key-ğŸ±"><a href="#Local-Cache-çš„-Key-ğŸ±" class="headerlink" title="Local Cache çš„ Key ğŸ±"></a>Local Cache çš„ Key ğŸ±</h6><p>org.apache.ibatis.cache.CacheKey æ˜¯ Local Cache çš„ key</p><h6 id="ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ-Local-Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ-ğŸŒ"><a href="#ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ-Local-Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ-ğŸŒ" class="headerlink" title="ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ Local Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ ğŸŒ"></a>ä½•æ—¶å¯èƒ½ä¼šå¤±æ•ˆ Local Cacheï¼ˆå¤±æ•ˆï¼‰ï¼Ÿ ğŸŒ</h6><ul><li>ä¸åŒçš„ä¼šè¯</li></ul><p>ä¸åŒçš„ Session æœ¬èº«ä¸å…±äº« Local Cacheã€‚æˆ‘å¹¶ä¸è®¤ä¸ºè¿™æ˜¯å¤±æ•ˆçš„åŸå› ã€‚è¿™åè€Œæ˜¯ä¸€ç§ä½¿ç”¨é”™è¯¯çš„æ–¹å¼ã€‚</p><ul><li>æ‰§è¡Œ update æ“ä½œ</li></ul><p>å¦‚æœæ‰§è¡Œäº†æ›´æ–°æ“ä½œä¼šæ¸…ç©º Local Cache</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(MappedStatement ms, Object parameter)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    ErrorContext.instance().resource(ms.getResource()).activity(<span class="string">&quot;executing an update&quot;</span>).object(ms.getId());</span><br><span class="line">    <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExecutorException</span>(<span class="string">&quot;Executor was closed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    clearLocalCache();</span><br><span class="line">    <span class="keyword">return</span> doUpdate(ms, parameter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰‹åŠ¨è°ƒç”¨ DefaultSqlSession.clearCache()</li></ul><p>åº•å±‚ä¼šè°ƒç”¨ executor çš„ clearLocalCache() æ–¹æ³•</p><ul><li><p>è®¾ç½®äº†è¯­å¥å±æ€§ <code>flushCache</code> ä¸º <code>true</code>ï¼Œç¼“å­˜å…¨æ¸…</p></li><li><p>è®¾ç½® flushCacheRequired</p></li><li><p>é…ç½® localCacheScope ä¸º STATEMENT</p></li><li><p>commit å’Œ rollback</p></li></ul><h5 id="Ensuring-that-SqlSession-is-Closed"><a href="#Ensuring-that-SqlSession-is-Closed" class="headerlink" title="Ensuring that SqlSession is Closed"></a>Ensuring that SqlSession is Closed</h5><p>ä½ å¿…é¡»ç¡®ä¿å…³é—­æ‰€æœ‰ä½ æ‰“å¼€çš„ä¼šè¯ã€‚æ¨èæ–¹å¼æ˜¯ä½¿ç”¨ try åŒ…è£¹èµ„æºã€‚</p><h5 id="Using-Mappers"><a href="#Using-Mappers" class="headerlink" title="Using Mappers"></a>Using Mappers</h5><h5 id="Mapper-Annotations"><a href="#Mapper-Annotations" class="headerlink" title="Mapper Annotations"></a>Mapper Annotations</h5><table><thead><tr><th align="left">æ³¨è§£</th><th align="left">ç›®æ ‡</th><th align="left">XML ç­‰ä»·ç‰©</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">@CacheNamespace</td><td align="left">Class</td><td align="left"><code>&lt;cache&gt;</code></td><td align="left">ä¸ºç»™å®šçš„å‘½åç©ºé—´é…ç½®ç¼“å­˜</td></tr><tr><td align="left">@CacheNamespaceRef</td><td align="left">Class</td><td align="left"><code>&lt;cacheRef&gt;</code></td><td align="left">å¼•ç”¨å…¶ä»–å‘½åç©ºé—´çš„ç¼“å­˜ã€‚æ³¨æ„ï¼šxml mapper æ–‡ä»¶å£°æ˜çš„ç¼“å­˜æ˜¯éš”ç¦»çš„</td></tr><tr><td align="left">@MapKey</td><td align="left">Method</td><td align="left"></td><td align="left">ç”¨äºè¿”å›ç±»å‹æ˜¯ Map çš„æ–¹æ³•ã€‚åŸºäºå¯¹è±¡çš„å±æ€§å°†ç»“æœ List è½¬æ¢ä¸º Mapã€‚æ³¨è§£çš„å±æ€§ <code>value</code> ä½œä¸º Map çš„ key</td></tr></tbody></table><h1 id="MyBatisPlus"><a href="#MyBatisPlus" class="headerlink" title="MyBatisPlus"></a><a href="https://mp.baomidou.com/">MyBatisPlus</a></h1><hr><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.cannedbread.dictionary.mapper&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ†é¡µæ’ä»¶"><a href="#åˆ†é¡µæ’ä»¶" class="headerlink" title="åˆ†é¡µæ’ä»¶"></a>åˆ†é¡µæ’ä»¶</h1><hr><ul><li>PageHelper</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼š<br>(1) PageHelper.start()ï¼Œä¼ å…¥ pageNum å½“å‰é¡µç ï¼ŒpageSize æ¯é¡µæ˜¾ç¤ºæ•°ç›®ã€‚<br>(2) è°ƒç”¨ Mapper æ–¹æ³•æŸ¥è¯¢<br>(3) ä½¿ç”¨ pageInfo æ„é€ å™¨ä¼ å…¥æŸ¥è¯¢ç»“æœé›†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageInfo&lt;ProjectArea&gt; <span class="title function_">listPageByExample</span><span class="params">(<span class="type">int</span> pageNum, <span class="type">int</span> pageSize, ProjectArea example)</span> &#123;</span><br><span class="line">PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">List&lt;ProjectArea&gt; result = projectAreaMapper.selectList(example);</span><br><span class="line">PageInfo&lt;ProjectArea&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(result);</span><br><span class="line"><span class="keyword">return</span> pageInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><h2 id="å„ç§-Logger"><a href="#å„ç§-Logger" class="headerlink" title="å„ç§ Logger"></a>å„ç§ Logger</h2><ul><li>PreparedStatementLogger</li><li>ConnectionLogger</li></ul><h2 id="StatementHandler"><a href="#StatementHandler" class="headerlink" title="StatementHandler"></a>StatementHandler</h2><h3 id="PreparedStatementHandler"><a href="#PreparedStatementHandler" class="headerlink" title="PreparedStatementHandler"></a>PreparedStatementHandler</h3><p>æ‰§è¡Œ SQL çš„æ—¶å€™ä¼šå°† statement å¼ºåˆ¶è½¬æ¢ä¸º PreparedStatement ç±»å‹ï¼Œå¹¶è¿›è¡Œæ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> (PreparedStatement) statement;</span><br><span class="line">ps.execute();</span><br><span class="line"><span class="keyword">return</span> resultSetHandler.handleResultSets(ps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SqlSource"><a href="#SqlSource" class="headerlink" title="SqlSource"></a>SqlSource</h2><ul><li>RawSqlSource</li><li>DynamicSqlSource</li><li>StaticSqlSourceï¼Œç”Ÿæˆ BoundSQL</li></ul><h3 id="RawSqlSource"><a href="#RawSqlSource" class="headerlink" title="RawSqlSource"></a>RawSqlSource</h3><p>RawSqlSource æ‹¥æœ‰ä¸€ä¸ª SqlSource çš„å±æ€§ï¼Œå®ƒæ˜¯ StaticSqlSourceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RawSqlSource</span> <span class="keyword">implements</span> <span class="title class_">SqlSource</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SqlSource sqlSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ª SqlNode æ˜¯å¦æ˜¯åŠ¨æ€çš„ ?</strong></p><ul><li>å¦‚æœæ˜¯çº¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œä¸”å­˜åœ¨ <code>$&#123;&#125;</code>ï¼Œè®¤ä¸ºæ˜¯åŠ¨æ€</li><li>å¦‚æœæ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œåˆ™ä¸€å®šæ˜¯åŠ¨æ€</li></ul><p>å…·ä½“ä»£ç è§ XMLScriptBuilder.parseDynamicTags &gt; TextSqlNode.isDynamic</p><p><strong>ä¸ºä»€ä¹ˆ RawSqlSourceã€DynamicSqlSource ä¸ç›´æ¥ç”Ÿæˆ BoundSQLï¼Œåè€Œé€šè¿‡   StaticSqlSource ç”Ÿæˆ?</strong></p><p>è®¾è®¡çš„é—®é¢˜</p><p>DynamicSqlSource è§£ææ˜¯å¯¹ SqlNode çš„è§£æï¼Œå…¶ä¸­ä¼šå­˜å‚¨æ ¹èŠ‚ç‚¹ rootSqlNodeï¼ŒèŠ‚ç‚¹å¯ä»¥è®¤ä¸ºæ˜¯ç±»ä¼¼ DOM çš„èŠ‚ç‚¹ã€‚</p><p><code>rootSqlNode.apply(context);</code> å³éå† SqlNode æ ‘è¿›è¡Œè§£æï¼Œæœ€ç»ˆç”Ÿæˆ contextã€‚</p><h2 id="SqlNode"><a href="#SqlNode" class="headerlink" title="SqlNode"></a>SqlNode</h2><ul><li>MixedSqlNode</li></ul><p>SQL è¯­æ³•æ ‘ä»ç»“æ„æ¥çœ‹æ˜¯æ ‘å½¢ï¼Œä½†æ˜¯ MyBatis ä¼šå°†åŒä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ç”¨ MixedSqlNode åŒ…è£…ï¼Œå› æ­¤ï¼Œä»èŠ‚ç‚¹çš„è§’åº¦çœ‹ï¼Œæ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(DynamicContext context)</span> &#123;</span><br><span class="line">    contents.forEach(node -&gt; node.apply(context));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>StaticTextSqlNode é™æ€æ–‡æœ¬</p></li><li><p>TextSqlNode åŒ…å«äº†è¡¨è¾¾å¼çš„æ–‡æœ¬ï¼Œå¦‚ï¼šselect * from ${table}</p></li><li><p>IfSqlNode</p></li></ul><p>è®¡ç®—è¡¨è¾¾å¼çš„å€¼ï¼Œå¦‚æœä¸º trueï¼Œåˆ™ç»§ç»­è§£æï¼Œä¸€èˆ¬ if è¡¨è¾¾å¼ä¸‹é¢å°±æ˜¯é™æ€æ–‡æœ¬äº†ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µåˆ™æ˜¯ç›´æ¥è¿½åŠ  SQL</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(DynamicContext context)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (evaluator.evaluateBoolean(test, context.getBindings())) &#123;</span><br><span class="line">        contents.apply(context);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ForEachNode</li></ul><p>è§£æå®Œæ¯•ä¹‹åä¼šç”Ÿæˆç‰¹å®šçš„åºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªæ¯ä¸ª</p><p>è¯¥è§£æä¸€å®šä¼šæ·»åŠ  open ä¸ closeï¼Œæ‰€ä»¥å¦‚æœåœ¨æ‹¼æ¥ in è¯­å¥çš„æ—¶å€™æ²¡æœ‰å…ƒç´ ï¼Œå¯èƒ½å¯¼è‡´ SQL é”™è¯¯</p><ul><li>TrimSqlNode</li></ul><p>ä»è¿›å…¥è¯¥èŠ‚ç‚¹å¼€å§‹ï¼Œå°†ä¼šä½¿ç”¨ <code>FilteredDynamicContext</code> åŒ…è£…åŸæ¥çš„ contextï¼Œä¹‹åçš„ç»“æœä¼šç¼“å­˜åœ¨ <code>FilteredDynamicContext</code> çš„ <code>sqlBuffer</code> ä¸­ï¼Œç›´è‡³è¯¥èŠ‚ç‚¹è§£æå®Œæ¯•ï¼Œæœ€åä½¿ç”¨ filteredDynamicContext.applyAll() çœŸæ­£è¿›è¡Œåº”ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(DynamicContext context)</span> &#123;</span><br><span class="line">    TrimSqlNode.<span class="type">FilteredDynamicContext</span> <span class="variable">filteredDynamicContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrimSqlNode</span>.FilteredDynamicContext(context);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> contents.apply(filteredDynamicContext);</span><br><span class="line">    filteredDynamicContext.applyAll();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆåŠ è¿™ä¸€ä¸ªç¼“å­˜ ?</strong></p><p>å¦‚æœç›´æ¥è¿½åŠ  SQL åˆ°æœ€ç»ˆçš„ç»“æœä¸Šï¼Œæœ€åè¿˜éœ€è¦åšä¸€æ­¥ trimï¼Œæ­¤æ—¶å·²ç»ä¸æ–¹ä¾¿ trim äº†ã€‚</p><ul><li>WhereSqlNode</li></ul><p>å°†ä¼šåˆ é™¤ç‰¹å®šçš„å‰ç¼€ï¼Œå¹¶è¿½åŠ å‰ç¼€ WHERE</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; prefixList = Arrays.asList(<span class="string">&quot;AND &quot;</span>,<span class="string">&quot;OR &quot;</span>,<span class="string">&quot;AND\n&quot;</span>, <span class="string">&quot;OR\n&quot;</span>, <span class="string">&quot;AND\r&quot;</span>, <span class="string">&quot;OR\r&quot;</span>, <span class="string">&quot;AND\t&quot;</span>, <span class="string">&quot;OR\t&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WhereSqlNode</span> <span class="keyword">extends</span> <span class="title class_">TrimSqlNode</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WhereSqlNode</span><span class="params">(Configuration configuration, SqlNode contents)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>(configuration, contents, <span class="string">&quot;WHERE&quot;</span>, prefixList, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="rootSqlNode-apply-context"><a href="#rootSqlNode-apply-context" class="headerlink" title="rootSqlNode.apply(context)"></a>rootSqlNode.apply(context)</h2><h2 id="MapperProxy"><a href="#MapperProxy" class="headerlink" title="MapperProxy"></a>MapperProxy</h2><p>MapperProxy æ˜¯ MyBatis ä¸­ InvacationHandler çš„å®ç°ç±»ã€‚å…¶ä¸­ï¼ŒåŒ…å«ä¸€ä¸ª SqlSessionTemplateï¼ŒSqlSessionTemplate å†…éƒ¨åˆåŒ…å«ä¸€ä¸ª DefaultSqlSession </p><p><strong>ä¸ºä»€ä¹ˆ SqlSessionTemplate åˆä½¿ç”¨ä»£ç†å¯¹è±¡ sqlSessionProxy å»æ‰§è¡Œæ–¹æ³•ï¼Ÿ</strong></p><p>ä¸ºäº†å®ç°æ‹¦æˆªæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.sqlSessionProxy = (SqlSession) newProxyInstance(SqlSessionFactory.class.getClassLoader(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; SqlSession.class &#125;, <span class="keyword">new</span> <span class="title class_">SqlSessionInterceptor</span>());</span><br></pre></td></tr></table></figure><h2 id="CachingExecutor-çš„æ‰§è¡Œ"><a href="#CachingExecutor-çš„æ‰§è¡Œ" class="headerlink" title="CachingExecutor çš„æ‰§è¡Œ"></a>CachingExecutor çš„æ‰§è¡Œ</h2><h3 id="query"><a href="#query" class="headerlink" title="query"></a>query</h3><p>(1) è·å¾— BoundSql</p><p>BoundSql </p><p>(2) åˆ›å»ºç¼“å­˜ key</p><p>åˆ›å»ºæ˜¯ç”± BaseExecutor å®Œæˆçš„ï¼Œå…¶ä¸­å½±å“å› ç´ æœ‰ï¼š</p><ul><li>MappedStatement.idï¼Œå³æ–¹æ³•å…¨é™å®šå</li><li>rowBounds.offset</li><li>rowBounds.limit</li><li>boundSql.sql</li><li>parameterMappings çš„å‚æ•°å€¼</li><li>parameterMappings.environment.id</li></ul><p>(3) flushCacheIfRequired<br>(4) ä½¿ç”¨ä»£ç† Executor æ‰§è¡ŒæŸ¥è¯¢</p><h2 id="SimpleExecutor"><a href="#SimpleExecutor" class="headerlink" title="SimpleExecutor"></a>SimpleExecutor</h2><h3 id="queryFromDatabase"><a href="#queryFromDatabase" class="headerlink" title="queryFromDatabase"></a>queryFromDatabase</h3><p>(1) è·å– Configuration<br>(2) åˆ›å»º StatementHandler<br>(3) prepareStatement<br>(4) StatementHandler.query</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MyBatis&quot;&gt;&lt;a href=&quot;#MyBatis&quot; class=&quot;headerlink&quot; title=&quot;MyBatis&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://mybatis.org/mybatis-3/&quot;&gt;MyBatis&lt;/a&gt;&lt;/h1&gt;&lt;hr&gt;
&lt;h2</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="MyBatis" scheme="http://example.com/tags/MyBatis/"/>
    
  </entry>
  
  <entry>
    <title>Spring Boot æ•´åˆ MyBatis å¯åŠ¨åŸç†</title>
    <link href="http://example.com/2022/07/15/Spring-Boot/Spring-Boot-%E6%95%B4%E5%90%88-MyBatis-%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/"/>
    <id>http://example.com/2022/07/15/Spring-Boot/Spring-Boot-%E6%95%B4%E5%90%88-MyBatis-%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86/</id>
    <published>2022-07-15T08:54:14.000Z</published>
    <updated>2022-07-16T14:32:07.253Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Boot-æ•´åˆ-MyBatis-å¯åŠ¨åŸç†"><a href="#Spring-Boot-æ•´åˆ-MyBatis-å¯åŠ¨åŸç†" class="headerlink" title="Spring Boot æ•´åˆ MyBatis å¯åŠ¨åŸç†"></a>Spring Boot æ•´åˆ MyBatis å¯åŠ¨åŸç†</h1><p>MyBatis æ•´åˆ Spring Boot éœ€è¦è§£å†³çš„æ˜¯å¦‚ä½•å°†è‡ªå·±åˆ›å»ºçš„ä»£ç†å¯¹è±¡ï¼ˆ<code>java.lang.reflect.Proxy</code>ï¼‰äº¤ç»™ Spring å®¹å™¨ç®¡ç†ï¼Œè¿™ä¸å°†ä¸€ä¸ªç±»ï¼ˆClassï¼‰äº¤ç»™ Spring ç®¡ç†æœ‰æ‰€ä¸åŒã€‚</p><blockquote><p>å°†å¯¹è±¡äº¤ç»™ Spring å®¹å™¨ç®¡ç†ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ³¨å…¥ Bean Definitionï¼Œç„¶åè®© Spring å®Œæˆå¯¹è±¡æ„é€ ã€é…ç½®ã€åˆå§‹åŒ–ç­‰æ“ä½œï¼Œç„¶åæ”¾åˆ° <code>singletonObjects</code> å•ä¾‹æ± ä¸­ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç›´æ¥æ”¾åˆ°å•ä¾‹æ± ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸æ„é€  Bean Definitionï¼Œä¹Ÿä¸ä¼šå­˜åœ¨äº <code>beanDefinitionMap</code>ï¼Œè¿™å°±æ˜¯ä¸‹é¢æåŠçš„ <code>SingletonBeanRegistry.registerSingleton</code> æ–¹å¼</p></blockquote><p>å°†è‡ªå®šä¹‰çš„å¯¹è±¡äº¤ç»™ Spring å®¹å™¨ç®¡ç†ï¼Œä¸€èˆ¬è€ƒè™‘çš„æ–¹å¼æ˜¯ï¼š</p><ul><li>@Bean</li><li>factory method</li><li>SingletonBeanRegistry.registerSingleton</li><li>FactoryBean</li></ul><p>å¯¹äº <code>@Bean</code> æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserMapper <span class="title function_">videoMapper</span><span class="params">(SqlSession sqlSession)</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ åˆ° MapperRegistry.knownMappersï¼Œå¦åˆ™ SqlSession.getMapper ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    sqlSession.getConfiguration().addMapper(UserMapper.class);</span><br><span class="line">    <span class="keyword">return</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹å¼çš„ç¡®å¯è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬æ¯å®šä¹‰ä¸€ä¸ª Mapper å°±éœ€è¦å†™ä¸€ä¸ª <code>@Bean</code> æ–¹æ³•ï¼Œè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚</p><p>factory method æ³¨å…¥çš„æ–¹å¼ä¸ <code>@Bean</code> å¤§åŒå°å¼‚ã€‚</p><p>MyBatis æ•´åˆè¿› Spring é€‰æ‹©çš„æ˜¯ <code>FactoryBean</code> æ–¹å¼ï¼Œé€šè¿‡å‘å®¹å™¨æ³¨å…¥ <code>FactoryBean</code> è¿™ç§ç‰¹æ®Šçš„ Bean Definitnionï¼Œè¿›è€Œæ³¨å…¥ <code>Mapper</code></p><p>æ¯”è¾ƒæœ´ç´ çš„æƒ³æ³•æ˜¯ï¼Œå¯¹äºæ¯ä¸ª <code>Mapper</code> æˆ‘ä»¬éƒ½ä¸ºå®ƒå®šä¹‰ä¸€ä¸ª <code>FactoryBean</code>ï¼Œä½†æ˜¯è¿™æ ·å·¥ä½œé‡å¤ªå¤§ï¼ŒMyBatis é€šè¿‡åŠ¨æ€ Class å®ç°äº†åªéœ€è¦ä¸€ä¸ª <code>MapperFactoryBean</code> å°±å¯ä»¥æ„é€ å‡ºä¸åŒçš„ <code>Mapper</code> å®ä¾‹</p><blockquote><p>åº•å±‚å¯¹åº” <code>MapperFactoryBean</code> çš„å±æ€§ <code>mapperInterface</code>ï¼Œè¡¨ç¤ºä¸åŒçš„ <code>Mapper</code> æ¥å£çš„ <code>Class</code> å¯¹è±¡</p></blockquote><p>åœ¨ä½¿ç”¨ Spring æ•´åˆ MyBatis çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼Œè¿™ä¹Ÿæ˜¯å®˜ç½‘ <a href="http://mybatis.org/spring/getting-started.html">Getting Started</a> æä¾›çš„æ¡ˆä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperInterface&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.mybatis.spring.sample.mapper.UserMapper&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>MyBatis Spring Boot Starter ä¸ºäº†è§£å†³ä¸Šè¿°è¿™ç§æŒ‰éœ€é…ç½® <code>MapperFactoryBean</code> çš„ç¹çæ­¥éª¤ï¼Œå¼•å…¥äº† Spring ç±»è·¯å¾„æ‰«ææœºåˆ¶ã€‚</p><h2 id="Spring-Boot-åŠ è½½-Mapper"><a href="#Spring-Boot-åŠ è½½-Mapper" class="headerlink" title="Spring Boot åŠ è½½ Mapper"></a>Spring Boot åŠ è½½ Mapper</h2><ol><li>Spring Boot å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨ <code>AbstractApplicationContext</code> çš„ <code>refresh</code> æ–¹æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªè¿‡ç¨‹æ˜¯ <code>invokeBeanFactoryPostProcessors</code>ï¼Œå®ƒä¼šè°ƒç”¨ <code>ConfigurationClassPostProcessor</code> åç½®å¤„ç†å™¨åŠ è½½å…·æœ‰ <code>@Configuration</code> æ³¨è§£çš„ Beanã€‚</li><li><code>ConfigurationClassPostProcessor</code> å…³æ³¨çš„æ˜¯ <code>@Configuration</code> ç±»å‹çš„ Beanï¼Œå®ƒä¼šåˆ¤æ–­è¯¥ Bean æ˜¯å¦åŒ…å« <code>@Import</code> æ³¨è§£ã€‚å‡è®¾æˆ‘ä»¬å°† <code>@MapperScan</code> æ·»åŠ åœ¨ä¸»å¯åŠ¨ç±»ä¸Šï¼ˆä¸€èˆ¬æ˜¯å…·æœ‰ <code>@SpringBootApplication</code> æ³¨è§£ï¼‰ï¼Œé‚£ä¹ˆå°†ä¼šè¯»å–ä¸»å¯åŠ¨ç±»æ³¨è§£ï¼Œå‘ç°å…·æœ‰ <code>@MapperScan</code>ï¼Œè€Œ <code>@MapperScan</code> åµŒå¥—äº† <code>@Import</code> æ³¨è§£ï¼Œvalue ä¸º <code>MapperScannerRegistrar.class</code>ï¼Œå› æ­¤ï¼Œå°†ä¼šæ„é€ <code>MapperScannerRegistrar</code> Bean Definition è¿›å…¥ Spring å®¹å™¨</li></ol><p>å½“ <code>@Configuration</code> ç±»è§£æå®Œæ¯•åŠ è½½åˆ°å®¹å™¨åï¼Œå°±ä¼šæ‰§è¡Œ <code>load</code> æ–¹æ³•ï¼Œç”¨äºåŠ è½½è¿™äº› <code>@Configuration</code> ç±»ç›¸å…³çš„ Beanã€Resource ç­‰ï¼ˆå¦‚ <code>@Import</code>, <code>@ImportResource</code>ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.reader.loadBeanDefinitions(configClasses)</span><br></pre></td></tr></table></figure><p>å½“ <code>load</code> å®Œæ¯•ï¼Œæ­¤æ—¶ <code>MapperScannerRegistrar</code> å·²ç»åŠ è½½åˆ° Spring å®¹å™¨ï¼Œè€Œä¸” <code>load</code> ä¼šä¸»åŠ¨è§¦å‘ <code>MapperScannerRegistrar</code> çš„å›è°ƒæ–¹æ³• <code>registerBeanDefinitions</code>ã€‚</p><p><code>MapperScannerRegistrar</code> æ˜¯ <code>ImportBeanDefinitionRegistrars</code> çš„å­ç±»ï¼Œå…¶å…³é”®æ–¹æ³• <code>registerBeanDefinitions</code> å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å¾— @MapperScan çš„å…¨éƒ¨å±æ€§</span></span><br><span class="line">    <span class="type">AnnotationAttributes</span> <span class="variable">mapperScanAttrs</span> <span class="operator">=</span> AnnotationAttributes</span><br><span class="line">        .fromMap(importingClassMetadata.getAnnotationAttributes(MapperScan.class.getName()));</span><br><span class="line">    <span class="keyword">if</span> (mapperScanAttrs != <span class="literal">null</span>) &#123;</span><br><span class="line">        registerBeanDefinitions(importingClassMetadata, mapperScanAttrs, registry,</span><br><span class="line">            generateBaseBeanName(importingClassMetadata, <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åº•å±‚æ„é€ äº†ä¸€ä¸ª <code>MapperScannerConfigurer</code> Bean Definitnionï¼Œå¹¶æ³¨å†Œåˆ°å®¹å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata annoMeta, AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry, String beanName)</span> &#123;</span><br><span class="line">    <span class="comment">// æ„é€  MapperScannerConfigurer Bean Definition</span></span><br><span class="line">    <span class="type">BeanDefinitionBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);</span><br><span class="line">    builder.addPropertyValue(<span class="string">&quot;processPropertyPlaceHolders&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass = annoAttrs.getClass(<span class="string">&quot;annotationClass&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!Annotation.class.equals(annotationClass)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;annotationClass&quot;</span>, annotationClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; markerInterface = annoAttrs.getClass(<span class="string">&quot;markerInterface&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!Class.class.equals(markerInterface)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;markerInterface&quot;</span>, markerInterface);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">BeanNameGenerator</span>&gt; generatorClass = annoAttrs.getClass(<span class="string">&quot;nameGenerator&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!BeanNameGenerator.class.equals(generatorClass)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;nameGenerator&quot;</span>, BeanUtils.instantiateClass(generatorClass));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">MapperFactoryBean</span>&gt; mapperFactoryBeanClass = annoAttrs.getClass(<span class="string">&quot;factoryBean&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!MapperFactoryBean.class.equals(mapperFactoryBeanClass)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;mapperFactoryBeanClass&quot;</span>, mapperFactoryBeanClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sqlSessionTemplateRef</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;sqlSessionTemplateRef&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(sqlSessionTemplateRef)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;sqlSessionTemplateBeanName&quot;</span>, annoAttrs.getString(<span class="string">&quot;sqlSessionTemplateRef&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sqlSessionFactoryRef</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;sqlSessionFactoryRef&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(sqlSessionFactoryRef)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span>, annoAttrs.getString(<span class="string">&quot;sqlSessionFactoryRef&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¶é›† basePackage</span></span><br><span class="line">    List&lt;String&gt; basePackages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    basePackages.addAll(</span><br><span class="line">        Arrays.stream(annoAttrs.getStringArray(<span class="string">&quot;value&quot;</span>)).filter(StringUtils::hasText).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">    basePackages.addAll(Arrays.stream(annoAttrs.getStringArray(<span class="string">&quot;basePackages&quot;</span>)).filter(StringUtils::hasText)</span><br><span class="line">        .collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">    basePackages.addAll(Arrays.stream(annoAttrs.getClassArray(<span class="string">&quot;basePackageClasses&quot;</span>)).map(ClassUtils::getPackageName)</span><br><span class="line">        .collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (basePackages.isEmpty()) &#123;</span><br><span class="line">        basePackages.add(getDefaultBasePackage(annoMeta));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">lazyInitialization</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;lazyInitialization&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(lazyInitialization)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;lazyInitialization&quot;</span>, lazyInitialization);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">defaultScope</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;defaultScope&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!AbstractBeanDefinition.SCOPE_DEFAULT.equals(defaultScope)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;defaultScope&quot;</span>, defaultScope);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½® basePackage å±æ€§ï¼Œç”¨é€—å·(,)åˆ†éš”</span></span><br><span class="line">    builder.addPropertyValue(<span class="string">&quot;basePackage&quot;</span>, StringUtils.collectionToCommaDelimitedString(basePackages));</span><br><span class="line"></span><br><span class="line">    registry.registerBeanDefinition(beanName, builder.getBeanDefinition());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MapperScannerConfigurer</code> æ˜¯ <code>BeanDefinitionRegistryPostProcessor</code> çš„å®ç°ç±»ï¼Œä¹Ÿå°±è¯´å…¶è°ƒç”¨æ—¶æœºåœ¨ refresh æ–¹æ³•çš„ <code>invokeBeanFactoryPostProcessors</code> ä¸­ï¼Œå®ƒæ‰§è¡Œäº†ç±»è·¯å¾„æ‰«æï¼Œå¹¶æ³¨å†Œäº†ç›¸å…³çš„ Mapperï¼Œå…³é”®æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.processPropertyPlaceHolders) &#123;</span><br><span class="line">        processPropertyPlaceHolders();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰«æå™¨</span></span><br><span class="line">    <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">    scanner.setAddToConfig(<span class="built_in">this</span>.addToConfig);</span><br><span class="line">    scanner.setAnnotationClass(<span class="built_in">this</span>.annotationClass);</span><br><span class="line">    scanner.setMarkerInterface(<span class="built_in">this</span>.markerInterface);</span><br><span class="line">    scanner.setSqlSessionFactory(<span class="built_in">this</span>.sqlSessionFactory);</span><br><span class="line">    scanner.setSqlSessionTemplate(<span class="built_in">this</span>.sqlSessionTemplate);</span><br><span class="line">    scanner.setSqlSessionFactoryBeanName(<span class="built_in">this</span>.sqlSessionFactoryBeanName);</span><br><span class="line">    scanner.setSqlSessionTemplateBeanName(<span class="built_in">this</span>.sqlSessionTemplateBeanName);</span><br><span class="line">    scanner.setResourceLoader(<span class="built_in">this</span>.applicationContext);</span><br><span class="line">    scanner.setBeanNameGenerator(<span class="built_in">this</span>.nameGenerator);</span><br><span class="line">    scanner.setMapperFactoryBeanClass(<span class="built_in">this</span>.mapperFactoryBeanClass);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(lazyInitialization)) &#123;</span><br><span class="line">        scanner.setLazyInitialization(Boolean.valueOf(lazyInitialization));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(defaultScope)) &#123;</span><br><span class="line">        scanner.setDefaultScope(defaultScope);</span><br><span class="line">    &#125;</span><br><span class="line">    scanner.registerFilters();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œå°†ä¹‹å‰ç”¨é€—å·(,)åˆ†éš”çš„ basePackage å­—ç¬¦ä¸²åˆ†è§£æˆ String[]</span></span><br><span class="line">    scanner.scan(</span><br><span class="line">        StringUtils.tokenizeToStringArray(<span class="built_in">this</span>.basePackage, ConfigurableApplicationContext.CONFIG_LOCATION_DELIMITERS));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ClassPathBeanDefinitionScanner</code> çš„ scan æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">scan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">beanCountAtScanStart</span> <span class="operator">=</span> <span class="built_in">this</span>.registry.getBeanDefinitionCount();</span><br><span class="line"></span><br><span class="line">    doScan(basePackages);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register annotation config processors, if necessary.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.includeAnnotationConfig) &#123;</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(<span class="built_in">this</span>.registry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">this</span>.registry.getBeanDefinitionCount() - beanCountAtScanStart);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ClassPathBeanDefinitionScanner</code> çš„ doScan æ–¹æ³•å¦‚ä¸‹ï¼Œå®ƒè¿”å›æ‰«æåˆ°çš„æ‰€æœ‰ <code>BeanDefinitionHolder</code> çš„é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">    Assert.notEmpty(basePackages, <span class="string">&quot;At least one base package must be specified&quot;</span>);</span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String basePackage : basePackages) &#123;</span><br><span class="line">        Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);</span><br><span class="line">        <span class="keyword">for</span> (BeanDefinition candidate : candidates) &#123;</span><br><span class="line">            <span class="type">ScopeMetadata</span> <span class="variable">scopeMetadata</span> <span class="operator">=</span> <span class="built_in">this</span>.scopeMetadataResolver.resolveScopeMetadata(candidate);</span><br><span class="line">            candidate.setScope(scopeMetadata.getScopeName());</span><br><span class="line">            <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> <span class="built_in">this</span>.beanNameGenerator.generateBeanName(candidate, <span class="built_in">this</span>.registry);</span><br><span class="line">            <span class="keyword">if</span> (candidate <span class="keyword">instanceof</span> AbstractBeanDefinition) &#123;</span><br><span class="line">                postProcessBeanDefinition((AbstractBeanDefinition) candidate, beanName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (candidate <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</span><br><span class="line">                AnnotationConfigUtils.processCommonDefinitionAnnotations((AnnotatedBeanDefinition) candidate);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (checkCandidate(beanName, candidate)) &#123;</span><br><span class="line">                <span class="type">BeanDefinitionHolder</span> <span class="variable">definitionHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(candidate, beanName);</span><br><span class="line">                definitionHolder =</span><br><span class="line">                        AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">                beanDefinitions.add(definitionHolder);</span><br><span class="line">                registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MyBatis è¦†ç›–äº†åŸæ¥çš„ <code>doScan</code> æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½æŠŠæ‰«æåˆ°çš„ <code>Mapper</code> æ¥å£äº¤ç»™ Spring å®¹å™¨ï¼Œå¦åˆ™åç»­çš„å®ä¾‹åŒ–å°†æ— æ³•è¿›è¡Œã€‚å› æ­¤ï¼ŒMyBatis åœ¨è°ƒç”¨ <code>super.doScan()</code> æ–¹æ³•å¾—åˆ°æ‰«æåˆ°çš„ <code>Set&lt;BeanDefinitionHolder&gt;</code> ä¹‹ååˆè¿›è¡Œåç½®å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ Spring å†…ç½®æä¾›çš„ doScan æ–¹æ³•</span></span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (beanDefinitions.isEmpty()) &#123;</span><br><span class="line">        LOGGER.warn(() -&gt; <span class="string">&quot;No MyBatis mapper was found in &#x27;&quot;</span> + Arrays.toString(basePackages)</span><br><span class="line">            + <span class="string">&quot;&#x27; package. Please check your configuration.&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// åç½®å¤„ç†</span></span><br><span class="line">        processBeanDefinitions(beanDefinitions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MyBatis çš„ <code>ClassPathMapperScanner</code> åç½®å¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processBeanDefinitions</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; beanDefinitions)</span> &#123; AbstractBeanDefinition definition;</span><br><span class="line">    <span class="type">BeanDefinitionRegistry</span> <span class="variable">registry</span> <span class="operator">=</span> getRegistry();</span><br><span class="line">    <span class="keyword">for</span> (BeanDefinitionHolder holder : beanDefinitions) &#123;</span><br><span class="line">        definition = (AbstractBeanDefinition) holder.getBeanDefinition();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">scopedProxy</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (ScopedProxyFactoryBean.class.getName().equals(definition.getBeanClassName())) &#123;</span><br><span class="line">            definition = (AbstractBeanDefinition) Optional</span><br><span class="line">                .ofNullable(((RootBeanDefinition) definition).getDecoratedDefinition())</span><br><span class="line">                .map(BeanDefinitionHolder::getBeanDefinition).orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">                    <span class="string">&quot;The target bean definition of scoped proxy bean not found. Root bean definition[&quot;</span> + holder + <span class="string">&quot;]&quot;</span>));</span><br><span class="line">            scopedProxy = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰«æåˆ°çš„ Mapper æ¥å£ï¼Œå› æ­¤è¿™é‡Œè·å–åˆ°çš„åº”è¯¥æ˜¯å½¢å¦‚ UserMapper ä¹‹ç±»çš„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">beanClassName</span> <span class="operator">=</span> definition.getBeanClassName();</span><br><span class="line">        LOGGER.debug(() -&gt; <span class="string">&quot;Creating MapperFactoryBean with name &#x27;&quot;</span> + holder.getBeanName() + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + beanClassName</span><br><span class="line">            + <span class="string">&quot;&#x27; mapperInterface&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Mapper æ¥å£æ˜¯ Bean åŸå§‹çš„ç±»å‹ï¼Œä½†æ˜¯å®é™…ç±»å‹æ˜¯ MapperFactoryBean</span></span><br><span class="line">        <span class="comment">// å°†åŸå§‹ç±»å‹ï¼ˆMapperï¼‰ä½œä¸ºæ„é€ å™¨å‚æ•°ä¼ å…¥</span></span><br><span class="line">        definition.getConstructorArgumentValues().addGenericArgumentValue(beanClassName); <span class="comment">// issue #59</span></span><br><span class="line">        <span class="comment">// å°† BeanClass å¼ºåˆ¶ä¿®æ”¹ä¸º MapperFactoryBean ç±»å‹</span></span><br><span class="line">        definition.setBeanClass(<span class="built_in">this</span>.mapperFactoryBeanClass);</span><br><span class="line"></span><br><span class="line">        definition.getPropertyValues().add(<span class="string">&quot;addToConfig&quot;</span>, <span class="built_in">this</span>.addToConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attribute for MockitoPostProcessor</span></span><br><span class="line">        <span class="comment">// https://github.com/mybatis/spring-boot-starter/issues/475</span></span><br><span class="line">        definition.setAttribute(FACTORY_BEAN_OBJECT_TYPE, beanClassName);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">explicitFactoryUsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.sqlSessionFactoryBeanName)) &#123;</span><br><span class="line">        definition.getPropertyValues().add(<span class="string">&quot;sqlSessionFactory&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RuntimeBeanReference</span>(<span class="built_in">this</span>.sqlSessionFactoryBeanName));</span><br><span class="line">        explicitFactoryUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.sqlSessionFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">        definition.getPropertyValues().add(<span class="string">&quot;sqlSessionFactory&quot;</span>, <span class="built_in">this</span>.sqlSessionFactory);</span><br><span class="line">        explicitFactoryUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.sqlSessionTemplateBeanName)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (explicitFactoryUsed) &#123;</span><br><span class="line">            LOGGER.warn(</span><br><span class="line">                () -&gt; <span class="string">&quot;Cannot use both: sqlSessionTemplate and sqlSessionFactory together. sqlSessionFactory is ignored.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        definition.getPropertyValues().add(<span class="string">&quot;sqlSessionTemplate&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RuntimeBeanReference</span>(<span class="built_in">this</span>.sqlSessionTemplateBeanName));</span><br><span class="line">        explicitFactoryUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.sqlSessionTemplate != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (explicitFactoryUsed) &#123;</span><br><span class="line">            LOGGER.warn(</span><br><span class="line">                () -&gt; <span class="string">&quot;Cannot use both: sqlSessionTemplate and sqlSessionFactory together. sqlSessionFactory is ignored.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        definition.getPropertyValues().add(<span class="string">&quot;sqlSessionTemplate&quot;</span>, <span class="built_in">this</span>.sqlSessionTemplate);</span><br><span class="line">        explicitFactoryUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!explicitFactoryUsed) &#123;</span><br><span class="line">        LOGGER.debug(() -&gt; <span class="string">&quot;Enabling autowire by type for MapperFactoryBean with name &#x27;&quot;</span> + holder.getBeanName() + <span class="string">&quot;&#x27;.&quot;</span>);</span><br><span class="line">        definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        definition.setLazyInit(lazyInitialization);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (scopedProxy) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ConfigurableBeanFactory.SCOPE_SINGLETON.equals(definition.getScope()) &amp;&amp; defaultScope != <span class="literal">null</span>) &#123;</span><br><span class="line">        definition.setScope(defaultScope);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!definition.isSingleton()) &#123;</span><br><span class="line">        <span class="type">BeanDefinitionHolder</span> <span class="variable">proxyHolder</span> <span class="operator">=</span> ScopedProxyUtils.createScopedProxy(holder, registry, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (registry.containsBeanDefinition(proxyHolder.getBeanName())) &#123;</span><br><span class="line">            registry.removeBeanDefinition(proxyHolder.getBeanName());</span><br><span class="line">        &#125;</span><br><span class="line">        registry.registerBeanDefinition(proxyHolder.getBeanName(), proxyHolder.getBeanDefinition());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Boot-æ•´åˆ-MyBatis-å¯åŠ¨åŸç†&quot;&gt;&lt;a href=&quot;#Spring-Boot-æ•´åˆ-MyBatis-å¯åŠ¨åŸç†&quot; class=&quot;headerlink&quot; title=&quot;Spring Boot æ•´åˆ MyBatis å¯åŠ¨åŸç†&quot;&gt;&lt;/a&gt;Sprin</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="MyBatis" scheme="http://example.com/tags/MyBatis/"/>
    
    <category term="Spring Boot" scheme="http://example.com/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud Gateway</title>
    <link href="http://example.com/2022/07/15/Spring-Cloud/Spring-Cloud-Gateway/"/>
    <id>http://example.com/2022/07/15/Spring-Cloud/Spring-Cloud-Gateway/</id>
    <published>2022-07-15T08:28:39.000Z</published>
    <updated>2022-07-15T08:46:32.518Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Cloud-Gateway"><a href="#Spring-Cloud-Gateway" class="headerlink" title="Spring Cloud Gateway"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/">Spring Cloud Gateway</a></h1><h2 id="1-How-to-Include-Spring-Cloud-Gateway"><a href="#1-How-to-Include-Spring-Cloud-Gateway" class="headerlink" title="1. How to Include Spring Cloud Gateway"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#gateway-starter">1. How to Include Spring Cloud Gateway</a></h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ åŒ…å«äº† starterï¼Œä½†æ˜¯ä½ ä¸æƒ³å¯ç”¨ç½‘å…³ï¼Œåˆ™å¯ä»¥è®¾ç½® <code>spring.cloud.gateway.enabled=false</code></p><h2 id="2-Glossary"><a href="#2-Glossary" class="headerlink" title="2. Glossary"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#glossary">2. Glossary</a></h2><ul><li><strong>Route</strong>: ç½‘å…³çš„åŸºæœ¬æ„å»ºã€‚å®ƒç”± IDï¼Œç›®æ ‡ URIï¼Œè°“è¯é›†åˆï¼Œä»¥åŠè¿‡æ»¤å™¨é›†åˆå®šä¹‰ã€‚å¦‚æœèšåˆè°“è¯ä¸º trueï¼Œåˆ™åŒ¹é…è·¯ç”±ã€‚</li><li><strong>Predicate</strong>: è¿™æ˜¯ Java 8 Function Predicateã€‚è¾“å…¥ç±»å‹æ˜¯ <code>Spring Framework ServerWebExchange</code>ã€‚è¿™ä½¿ä½ å¯ä»¥åŒ¹é…æ¥è‡ª HTTP è¯·æ±‚ä¸­çš„ä»»ä½•ä¸œè¥¿ï¼Œä¾‹å¦‚ Header æˆ–è€…å‚æ•°ã€‚</li><li><strong>Filter</strong>: è¿™äº›æ˜¯ä¸€äº› <code>GatewayFilter</code> å®ä¾‹ï¼Œå®ƒä»¬ç”±ç‰¹å®šçš„å·¥å‚æ„å»ºå‡ºæ¥ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥åœ¨å‘é€ä¸‹æ¸¸è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚</li></ul><h2 id="4-Configuring-Route-Predicate-Factories-and-Gateway-Filter-Factories"><a href="#4-Configuring-Route-Predicate-Factories-and-Gateway-Filter-Factories" class="headerlink" title="4. Configuring Route Predicate Factories and Gateway Filter Factories"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#configuring-route-predicate-factories-and-gateway-filter-factories">4. Configuring Route Predicate Factories and Gateway Filter Factories</a></h2><p>é…ç½®è°“è¯å’Œè¿‡æ»¤å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼šå¿«æ·æ–¹å¼å’Œå®Œå…¨æ‰©å±•å‚æ•°ã€‚ä¸‹é¢å¤§å¤šæ•°ç¤ºä¾‹éƒ½æ˜¯ç”¨å¿«æ·æ–¹å¼ã€‚</p><h3 id="4-1-Shortcut-Configuration"><a href="#4-1-Shortcut-Configuration" class="headerlink" title="4.1. Shortcut Configuration"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#shortcut-configuration">4.1. Shortcut Configuration</a></h3><p>å¿«æ·æ–¹å¼é…ç½®ç”±è¿‡æ»¤å™¨åç§°è¯†åˆ«ï¼Œè·Ÿç€ä¸€ä¸ªç­‰å·ï¼ˆ<code>=</code>ï¼‰ï¼Œåé¢è·Ÿç€ç”±é€—å·ï¼ˆ<code>,</code>ï¼‰åˆ†å‰²çš„å‚æ•°å€¼ã€‚</p><p><strong>application.yml</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">after_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Cookie=mycookie,mycookievalue</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ ·ä¾‹å®šä¹‰äº†å…·æœ‰ä¸¤ä¸ªå‚æ•°çš„ <code>Cookie</code> è·¯ç”±è°“è¯å·¥å‚ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼Œcookie name <code>mycookie</code>ï¼Œä»¥åŠè¦åŒ¹é… <code>mycookievalue</code> çš„å€¼ã€‚</p><h1 id="5-Route-Predicate-Factories"><a href="#5-Route-Predicate-Factories" class="headerlink" title="5. Route Predicate Factories"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#gateway-request-predicates-factories">5. Route Predicate Factories</a></h1><p>Spring Cloud Gateway åŒ…å«è®¸å¤šå†…ç½®çš„è·¯ç”±è°“è¯å·¥å‚ï¼Œæ‰€æœ‰è¿™äº›è°“è¯åŒ¹é…ä¸åŒçš„ HTTP è¯·æ±‚å±æ€§</p><h2 id="5-1-The-After-Route-Predicate-Factory"><a href="#5-1-The-After-Route-Predicate-Factory" class="headerlink" title="5.1. The After Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-after-route-predicate-factory">5.1. The After Route Predicate Factory</a></h2><p><code>After</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸€ä¸ªå‚æ•°ï¼Œå³ä¸€ä¸ª <code>datetime</code>ï¼ˆå…¶å®æ˜¯ Java çš„ <code>ZonedDateTime</code>ï¼‰ã€‚è¯¥è°“è¯åŒ¹é…å‘ç”Ÿåœ¨æŒ‡å®šæ—¶é—´ä¹‹åçš„è¯·æ±‚ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">after_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">After=2021-06-03T10:00:00.000+08:00</span></span><br></pre></td></tr></table></figure><h2 id="5-2-The-Before-Route-Predicate-Factory"><a href="#5-2-The-Before-Route-Predicate-Factory" class="headerlink" title="5.2. The Before Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-before-route-predicate-factory">5.2. The Before Route Predicate Factory</a></h2><p><code>Before</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸€ä¸ªå‚æ•°ï¼Œå³ä¸€ä¸ª <code>datetime</code>ï¼ˆå…¶å®æ˜¯ Java çš„ <code>ZonedDateTime</code>ï¼‰ã€‚è¯¥è°“è¯åŒ¹é…å‘ç”Ÿåœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰çš„è¯·æ±‚ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">before_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">Before=2021-06-03T10:00:00.000+08:00</span></span><br></pre></td></tr></table></figure><h2 id="5-3-The-Between-Route-Predicate-Factory"><a href="#5-3-The-Between-Route-Predicate-Factory" class="headerlink" title="5.3. The Between Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-between-route-predicate-factory">5.3. The Between Route Predicate Factory</a></h2><p><code>Between</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œ<code>datetime1</code> å’Œ <code>datetime2</code>ï¼Œä»–ä»¬éƒ½æ˜¯ Java çš„ <code>ZonedDateTime</code> å¯¹è±¡ã€‚è¯¥è°“è¯åŒ¹é…å‘ç”Ÿåœ¨ <code>datetime1</code> ä¹‹åï¼Œä»¥åŠ <code>datetime2</code> ä¹‹å‰çš„è¯·æ±‚ã€‚<code>datetime2</code> å‚æ•°å¿…é¡»åœ¨ <code>datetime1</code> ä¹‹åã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">Between=2017-01-20T17:42:47.789-07:00[America/Denver],</span> <span class="number">2017-01-21T17:42:47.789-07:00</span>[<span class="string">America/Denver</span>]</span><br></pre></td></tr></table></figure><h2 id="5-4-The-Cookie-Route-Predicate-Factory"><a href="#5-4-The-Cookie-Route-Predicate-Factory" class="headerlink" title="5.4. The Cookie Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-cookie-route-predicate-factory">5.4. The Cookie Route Predicate Factory</a></h2><p><code>Cookie</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œ<code>name</code> å’Œ <code>regexp</code>ï¼ˆæœ¬è´¨æ˜¯ Java çš„æ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚è¯¥è°“è¯åŒ¹é…å…·æœ‰ç»™å®šåç§°ï¼Œå¹¶ä¸”å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„ cookieã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Cookie=x-token,</span> <span class="string">\w+</span></span><br></pre></td></tr></table></figure><h2 id="5-5-The-Header-Route-Predicate-Factory"><a href="#5-5-The-Header-Route-Predicate-Factory" class="headerlink" title="5.5. The Header Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-header-route-predicate-factory">5.5. The Header Route Predicate Factory</a></h2><p><code>Header</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œ<code>name</code> å’Œ <code>regexp</code>ï¼ˆæœ¬è´¨æ˜¯ Java çš„æ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚è¯¥è°“è¯åŒ¹é…å…·æœ‰ç»™å®šåç§°ï¼Œå¹¶ä¸”å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„ headerã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><h2 id="5-6-The-Host-Route-Predicate-Factory"><a href="#5-6-The-Host-Route-Predicate-Factory" class="headerlink" title="5.6. The Host Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-host-route-predicate-factory">5.6. The Host Route Predicate Factory</a></h2><p><code>Header</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸€ä¸ªå‚æ•°ï¼šä¸»æœºå <code>patterns</code> åˆ—è¡¨ã€‚æ¨¡å¼æ˜¯ä¸€ç§ Ant é£æ ¼çš„å¸¦æœ‰ <code>.</code> ä½œä¸ºåˆ†éš”ç¬¦çš„æ¨¡å¼ã€‚è¯¥è°“è¯åŒ¹é…æ¨¡å¼ä¸­çš„çš„ <code>Host</code> å¤´éƒ¨ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><blockquote><p>æ¶ˆæ¯å¤´éƒ¨çš„å­—æ®µåæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œä¹Ÿå°±æ˜¯å¤´éƒ¨ X-Request-Idï¼Œä¹Ÿå¯ä»¥ä¼ é€’ x-request-id<br>RFC 2616 <a href="https://www.rfc-editor.org/rfc/inline-errata/rfc2616.html%EF%BC%8C%E6%9F%A5%E8%AF%A2">https://www.rfc-editor.org/rfc/inline-errata/rfc2616.htmlï¼ŒæŸ¥è¯¢</a> (â€œ:â€) å…³é”®å­—é™„è¿‘æ–‡å­—å¯ä»¥æ‰¾åˆ°ï¼šField names are case-insensitive.</p></blockquote><h2 id="5-7-The-Method-Route-Predicate-Factory"><a href="#5-7-The-Method-Route-Predicate-Factory" class="headerlink" title="5.7. The Method Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-method-route-predicate-factory">5.7. The Method Route Predicate Factory</a></h2><p><code>Method</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸€ä¸ªå‚æ•° <code>methods</code>ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ï¼šå¾…åŒ¹é…çš„ HTTP æ–¹æ³•ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">Method=GET,POST</span></span><br></pre></td></tr></table></figure><h2 id="5-8-The-Path-Route-Predicate-Factory"><a href="#5-8-The-Path-Route-Predicate-Factory" class="headerlink" title="5.8. The Path Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-path-route-predicate-factory">5.8. The Path Route Predicate Factory</a></h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8080</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/echo/&#123;segment&#125;</span></span><br></pre></td></tr></table></figure><h2 id="5-9-The-Query-Route-Predicate-Factory"><a href="#5-9-The-Query-Route-Predicate-Factory" class="headerlink" title="5.9. The Query Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-query-route-predicate-factory">5.9. The Query Route Predicate Factory</a></h2><p><code>Query</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå¿…éœ€çš„ <code>param</code> å’Œä¸€ä¸ªå¯é€‰çš„ <code>regexp</code>ï¼ˆæœ¬è´¨æ˜¯ Java çš„æ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">method_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=id</span></span><br></pre></td></tr></table></figure><h2 id="5-10-The-RemoteAddr-Route-Predicate-Factory"><a href="#5-10-The-RemoteAddr-Route-Predicate-Factory" class="headerlink" title="5.10. The RemoteAddr Route Predicate Factory"></a><a href="https://docs.spring.io/spring-cloud-gateway/docs/2.2.9.RELEASE/reference/html/#the-remoteaddr-route-predicate-factory">5.10. The RemoteAddr Route Predicate Factory</a></h2><p><code>RemoteAddr</code> è·¯ç”±è°“è¯å·¥å‚æºå¸¦ä¸€ä¸ª <code>sources</code> åˆ—è¡¨ï¼Œè¿™æ˜¯ CIDR ç¬¦å·å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ <code>192.168.0.1/16</code>ï¼Œæ­¤å¤„ <code>192.168.0.1</code> æ˜¯ IP åœ°å€ï¼Œ16 æ˜¯å­ç½‘æ©ç ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">remoteaddr_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://www.baidu.com</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">RemoteAddr=192.168.0.187/24</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Cloud-Gateway&quot;&gt;&lt;a href=&quot;#Spring-Cloud-Gateway&quot; class=&quot;headerlink&quot; title=&quot;Spring Cloud Gateway&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://docs.spri</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>Hystrix é…ç½®å®è·µ</title>
    <link href="http://example.com/2022/07/15/Hystrix-%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/"/>
    <id>http://example.com/2022/07/15/Hystrix-%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/</id>
    <published>2022-07-15T03:50:30.000Z</published>
    <updated>2022-07-15T03:50:37.080Z</updated>
    
    <content type="html"><![CDATA[<p>æ¶‰åŠåˆ°æ–­è·¯å™¨çš„å‚æ•°ï¼ˆHystrixCommandPropertiesï¼‰ï¼š</p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">æè¿°</th><th align="left">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="left">circuitBreaker.enabled</td><td align="left">æ˜¯å¦å¼€å¯æ–­è·¯å™¨</td><td align="left">true</td></tr><tr><td align="left">circuitBreaker.requestVolumeThreshold</td><td align="left">è¯·æ±‚æ€»æ•°é˜ˆå€¼ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœ hystrix å‘½ä»¤åœ¨ä¼‘çœ çª—å£æœŸé—´è°ƒç”¨æ¬¡æ•°ä¸è¶³ 20 æ¬¡ï¼Œå³ä½¿è¯·æ±‚éƒ½å¤±è´¥ï¼Œæ–­è·¯å™¨ä¹Ÿä¸ä¼šæ‰“å¼€</td><td align="left">20</td></tr><tr><td align="left">circuitBreaker.sleepWindowInMilliseconds</td><td align="left">ä¼‘çœ çª—å£</td><td align="left">5000</td></tr><tr><td align="left">circuitBreaker.errorThresholdPercentage</td><td align="left">é”™è¯¯é˜ˆå€¼ã€‚å½“è¯·æ±‚æ€»æ•°åœ¨ä¼‘çœ çª—å£å†…è¶…è¿‡äº†é˜ˆå€¼ï¼Œæ–­è·¯å™¨å°±ä¼šæ‰“å¼€ã€‚</td><td align="left">50</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ¶‰åŠåˆ°æ–­è·¯å™¨çš„å‚æ•°ï¼ˆHystrixCommandPropertiesï¼‰ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;å‚æ•°&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;æè¿°&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;é»˜è®¤å€¼&lt;/th&gt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Shiro Subject login æµç¨‹åˆ†æ</title>
    <link href="http://example.com/2022/07/14/Shiro/Shiro-Subject-login-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/"/>
    <id>http://example.com/2022/07/14/Shiro/Shiro-Subject-login-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/</id>
    <published>2022-07-14T07:23:58.000Z</published>
    <updated>2022-07-14T08:12:58.587Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Subject-login-æµç¨‹åˆ†æ"><a href="#Subject-login-æµç¨‹åˆ†æ" class="headerlink" title="Subject login æµç¨‹åˆ†æ"></a>Subject login æµç¨‹åˆ†æ</h1><p>é€šå¸¸ï¼Œåœ¨æ‰§è¡Œç™»å½•ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»æ‹¥æœ‰ä¸€ä¸ª <code>Subject</code> å¯¹è±¡ï¼Œå¯èƒ½æ˜¯ä» <code>SecurityUtils</code> ç±»ä¸­è·å–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br></pre></td></tr></table></figure><p>Shiro æ¡†æ¶ä¸­ <code>Subject</code> å®ç°ç±» <code>DelegatingSubject</code>ï¼Œé¡¾åæ€ä¹‰ï¼Œå§”æ‰˜ä¸­çš„ <code>Subject</code>ï¼Œè¯¥ç±»æœ¬èº«ä¸åš login æ“ä½œï¼Œè€Œæ˜¯å°† login æ“ä½œå§”æ‰˜ç»™ <code>SecurityManager</code></p><p>Subject.login() çš„æ–¹æ³•å£°æ˜å¦‚ä¸‹ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ª <code>AuthenticationToken</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">login</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException;</span><br></pre></td></tr></table></figure><p>å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    clearRunAsIdentitiesInternal();</span><br><span class="line">    <span class="comment">// å§”æ‰˜ç»™ SecurityManager æ‰§è¡Œ</span></span><br><span class="line">    <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> securityManager.login(<span class="built_in">this</span>, token);</span><br><span class="line"></span><br><span class="line">    PrincipalCollection principals;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (subject <span class="keyword">instanceof</span> DelegatingSubject) &#123;</span><br><span class="line">        <span class="type">DelegatingSubject</span> <span class="variable">delegating</span> <span class="operator">=</span> (DelegatingSubject) subject;</span><br><span class="line">        <span class="comment">//we have to do this in case there are assumed identities - we don&#x27;t want to lose the &#x27;real&#x27; principals:</span></span><br><span class="line">        principals = delegating.principals;</span><br><span class="line">        host = delegating.host;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        principals = subject.getPrincipals();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (principals == <span class="literal">null</span> || principals.isEmpty()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Principals returned from securityManager.login( token ) returned a null or &quot;</span> +</span><br><span class="line">                <span class="string">&quot;empty value.  This value must be non null and populated with one or more elements.&quot;</span>;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.principals = principals;</span><br><span class="line">    <span class="built_in">this</span>.authenticated = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (token <span class="keyword">instanceof</span> HostAuthenticationToken) &#123;</span><br><span class="line">        host = ((HostAuthenticationToken) token).getHost();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (host != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> subject.getSession(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (session != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.session = decorate(session);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.session = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>DefaultSecurityManager</code> çš„ login æ–¹æ³•å¦‚ä¸‹ï¼Œå…¶ä¸­ authenticate æ˜¯æ‰§è¡Œè®¤è¯çš„å…³é”®æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Subject <span class="title function_">login</span><span class="params">(Subject subject, AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    AuthenticationInfo info;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        info = authenticate(token);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AuthenticationException ae) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            onFailedLogin(token, ae, subject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (log.isInfoEnabled()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;onFailedLogin method threw an &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;exception.  Logging and propagating original AuthenticationException.&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> ae; <span class="comment">//propagate</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Subject</span> <span class="variable">loggedIn</span> <span class="operator">=</span> createSubject(token, info, subject);</span><br><span class="line"></span><br><span class="line">    onSuccessfulLogin(token, info, loggedIn);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> loggedIn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SecurityManager</code> å°†è®¤è¯çš„æ–¹æ³•å§”æ‰˜ç»™äº†å†…éƒ¨è®¤è¯å™¨ <code>Authenticator</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AuthenticationInfo <span class="title function_">authenticate</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.authenticator.authenticate(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AbstractAuthenticator</code> è®¤è¯æ–¹æ³• <code>authenticate()</code> ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­ <code>doAuthenticate()</code> æ˜¯è®¤è¯çš„å…³é”®æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> AuthenticationInfo <span class="title function_">authenticate</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (token == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Method argument (authentication token) cannot be null.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    log.trace(<span class="string">&quot;Authentication attempt received for token [&#123;&#125;]&quot;</span>, token);</span><br><span class="line"></span><br><span class="line">    AuthenticationInfo info;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        info = doAuthenticate(token);</span><br><span class="line">        <span class="keyword">if</span> (info == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;No account information found for authentication token [&quot;</span> + token + <span class="string">&quot;] by this &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;Authenticator instance.  Please check that it is configured correctly.&quot;</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthenticationException</span>(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="type">AuthenticationException</span> <span class="variable">ae</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (t <span class="keyword">instanceof</span> AuthenticationException) &#123;</span><br><span class="line">            ae = (AuthenticationException) t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ae == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//Exception thrown was not an expected AuthenticationException.  Therefore it is probably a little more</span></span><br><span class="line">            <span class="comment">//severe or unexpected.  So, wrap in an AuthenticationException, log to warn, and propagate:</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Authentication failed for token submission [&quot;</span> + token + <span class="string">&quot;].  Possible unexpected &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;error? (Typical or expected login exceptions should extend from AuthenticationException).&quot;</span>;</span><br><span class="line">            ae = <span class="keyword">new</span> <span class="title class_">AuthenticationException</span>(msg, t);</span><br><span class="line">            <span class="keyword">if</span> (log.isWarnEnabled())</span><br><span class="line">                log.warn(msg, t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            notifyFailure(token, ae);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t2) &#123;</span><br><span class="line">            <span class="keyword">if</span> (log.isWarnEnabled()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Unable to send notification for failed authentication attempt - listener error?.  &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Please check your AuthenticationListener implementation(s).  Logging sending exception &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;and propagating original AuthenticationException instead...&quot;</span>;</span><br><span class="line">                log.warn(msg, t2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> ae;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    log.debug(<span class="string">&quot;Authentication successful for token [&#123;&#125;].  Returned account [&#123;&#125;]&quot;</span>, token, info);</span><br><span class="line"></span><br><span class="line">    notifySuccess(token, info);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º Shiro æ¡†æ¶ä¸­çš„è®¤è¯å™¨å°±æ˜¯ <code>ModularRealmAuthenticator</code>ï¼Œå› ä¸ºæ²¡æœ‰å…¶ä»–å®ç°ç±»äº†ï¼Œå…¶ <code>doAuthenticate()</code> æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doAuthenticate</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    assertRealmsConfigured();</span><br><span class="line">    Collection&lt;Realm&gt; realms = getRealms();</span><br><span class="line">    <span class="keyword">if</span> (realms.size() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åªæœ‰ 1 ä¸ª Realm</span></span><br><span class="line">        <span class="keyword">return</span> doSingleRealmAuthentication(realms.iterator().next(), authenticationToken);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å…·æœ‰å¤šä¸ª Realm</span></span><br><span class="line">        <span class="keyword">return</span> doMultiRealmAuthentication(realms, authenticationToken);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœé…ç½®äº†å¤šä¸ª <code>Realm</code>ï¼Œä¼šä½¿ç”¨åˆ°è®¤è¯ç­–ç•¥ <code>AuthenticationStrategy</code>ï¼Œè®¤è¯ç­–ç•¥ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œå…¶ä¸­çš„ <code>AllSuccessfulStrategy</code> è¦æ±‚æ‰€æœ‰çš„ <code>Realm</code> éƒ½å¿…é¡»è®¤è¯æˆåŠŸï¼Œå¹¶ä¸”ä¼šåˆå¹¶æ‰€æœ‰çš„ <code>AuthenticationInfo</code> ä¸­çš„ <code>PrincipalCollection</code> å½¢æˆ <code>MutablePrincipalCollection</code>ï¼Œå‡­è¯ <code>credential</code> ä¹Ÿä¼šåˆå¹¶ä¸ºé›†åˆã€‚</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Subject-login-æµç¨‹åˆ†æ&quot;&gt;&lt;a href=&quot;#Subject-login-æµç¨‹åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;Subject login æµç¨‹åˆ†æ&quot;&gt;&lt;/a&gt;Subject login æµç¨‹åˆ†æ&lt;/h1&gt;&lt;p&gt;é€šå¸¸ï¼Œåœ¨æ‰§è¡Œ</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="Shiro" scheme="http://example.com/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>Shiro FilterChainDefinitionMap æ³¨å†ŒåŸç†</title>
    <link href="http://example.com/2022/07/14/Shiro/Shiro-FilterChainDefinitionMap-%E6%B3%A8%E5%86%8C%E5%8E%9F%E7%90%86/"/>
    <id>http://example.com/2022/07/14/Shiro/Shiro-FilterChainDefinitionMap-%E6%B3%A8%E5%86%8C%E5%8E%9F%E7%90%86/</id>
    <published>2022-07-14T06:28:34.000Z</published>
    <updated>2022-07-14T07:14:29.971Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Shiro-FilterChainDefinitionMap-æ³¨å†ŒåŸç†"><a href="#Shiro-FilterChainDefinitionMap-æ³¨å†ŒåŸç†" class="headerlink" title="Shiro FilterChainDefinitionMap æ³¨å†ŒåŸç†"></a>Shiro FilterChainDefinitionMap æ³¨å†ŒåŸç†</h1><p>åœ¨è¿›è¡Œ <code>FilterChainDefinitionMap</code> é…ç½®çš„æ—¶å€™ï¼Œéœ€è¦å‡†å¤‡ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ†åˆ«ç§°ä¹‹ä¸º <code>antPath</code> å’Œ <code>definition</code>ã€‚ä»¥å¦‚ä¸‹çš„é…ç½®ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DefaultShiroFilterChainDefinition</span> <span class="variable">chainDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShiroFilterChainDefinition</span>();</span><br><span class="line">chainDefinition.addPathDefinition(<span class="string">&quot;/url&quot;</span>, <span class="string">&quot;authc, roles[admin,user], perms[file:edit]&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥è®¤ä¸ºæ˜¯è·¯å¾„ï¼ˆå¯ä»¥åŒ…å«é€šé…ç¬¦ï¼‰ï¼Œç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ˜¯è¿‡æ»¤å™¨é“¾å®šä¹‰</p></blockquote><p>å¯¹äº <code>FilterChainDefinitionMap</code> ä¸­æ¯ä¸ª filter Chain Definition çš„å¤„ç†éƒ½æ˜¯åœ¨ <code>DefaultFilterChainManager</code> è¿›è¡Œçš„ï¼Œä¸»è¦å…³æ³¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤å¤„çš„ chainName å°±æ˜¯ antPath </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createChain</span><span class="params">(String chainName, String chainDefinition)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(chainName)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;chainName cannot be null or empty.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(chainDefinition)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;chainDefinition cannot be null or empty.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;Creating chain [&quot;</span> + chainName + <span class="string">&quot;] with global filters &quot;</span> + globalFilterNames + <span class="string">&quot; and from String definition [&quot;</span> + chainDefinition + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¦–å…ˆä»¥æ­¤æ·»åŠ å…¨å±€ filterï¼Œæ¯”å¦‚ InvalidRequestFilter</span></span><br><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(globalFilterNames)) &#123;</span><br><span class="line">        globalFilterNames.stream().forEach(filterName -&gt; addToChain(chainName, filterName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹å€¼è¿›è¡Œæ ‡è®°è§£æï¼Œä»¥è·å¾—æœ€åç‰¹å®šäºè¿‡æ»¤å™¨çš„é…ç½®é¡¹</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œä»¥åŠè§’é€—å·(,) ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå¿½ç•¥ä¸¤è¾¹ç©ºç™½ç¬¦</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚å¯¹äºå€¼ï¼š</span></span><br><span class="line">    <span class="comment">//     &quot;authc, roles[admin,user], perms[file:edit]&quot;</span></span><br><span class="line">    <span class="comment">// æœ€ç»ˆçš„æ ‡è®°æ•°ç»„ä¸ºï¼š</span></span><br><span class="line">    <span class="comment">//     &#123; &quot;authc&quot;, &quot;roles[admin,user]&quot;, &quot;perms[file:edit]&quot; &#125;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    String[] filterTokens = splitChainDefinition(chainDefinition);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯ä¸ªæ ‡è®°éƒ½æ˜¯ç‰¹å®šäºæ¯ä¸ªè¿‡æ»¤å™¨çš„</span></span><br><span class="line">    <span class="comment">// å³ï¼Œè¿™äº›é…ç½®å¯èƒ½æ˜¯è¿‡æ»¤å™¨çº¦å®šå¥½çš„ï¼Œä½ éœ€è¦ç†Ÿæ‚‰è¿™äº›ç”¨æ³•</span></span><br><span class="line">    <span class="comment">// è­¬å¦‚ roles[admin,user] æ‹¬å· [] ä¹‹é—´ä»£è¡¨ç€è§’è‰²</span></span><br><span class="line">    <span class="comment">//      perms[file:edit] æ‹¬å· [] ä¹‹é—´ä»£è¡¨æƒé™ï¼Œæƒé™åˆç”¨ : éš”å¼€ï¼Œå‰è€…è¡¨ç¤ºæ“ä½œå¯¹è±¡ï¼Œåè€…è¡¨ç¤ºæ“ä½œç±»å‹</span></span><br><span class="line">    <span class="comment">// å‰¥ç¦» nameï¼Œæå–æ‹¬å· [] ä¹‹é—´çš„ç‰¹å®šäºè¿‡æ»¤å™¨çš„é…ç½®</span></span><br><span class="line">    <span class="keyword">for</span> (String token : filterTokens) &#123;</span><br><span class="line">        <span class="comment">// ä¸€å®šæ˜¯ä¸€ä¸ªåŒ…å« 2 ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªæ˜¯ filter nameï¼Œç¬¬äºŒä¸ª config å¯èƒ½æ˜¯ null</span></span><br><span class="line">        <span class="comment">// [ &quot;authc&quot;, null ]</span></span><br><span class="line">        <span class="comment">// [ &quot;roles&quot;, &quot;admin,user&quot; ]</span></span><br><span class="line">        <span class="comment">// [ &quot;perms&quot;, &quot;file:edit&quot; ]</span></span><br><span class="line">        String[] nameConfigPair = toNameConfigPair(token);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç°åœ¨ï¼Œæˆ‘ä»¬æ‹¥æœ‰è¿‡æ»¤å™¨åç§°ï¼Œè·¯å¾„ï¼Œä»¥åŠç‰¹å®šäºè·¯å¾„çš„é…ç½®ï¼ˆå¯èƒ½æ˜¯ nullï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é…ç½®ï¼‰</span></span><br><span class="line">        addToChain(chainName, nameConfigPair[<span class="number">0</span>], nameConfigPair[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addToChain</span><span class="params">(String chainName, String filterName, String chainSpecificFilterConfig)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(chainName)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;chainName cannot be null or empty.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Filter</span> <span class="variable">filter</span> <span class="operator">=</span> getFilter(filterName);</span><br><span class="line">    <span class="keyword">if</span> (filter == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;There is no filter with name &#x27;&quot;</span> + filterName +</span><br><span class="line">                <span class="string">&quot;&#x27; to apply to chain [&quot;</span> + chainName + <span class="string">&quot;] in the pool of available Filters.  Ensure a &quot;</span> +</span><br><span class="line">                <span class="string">&quot;filter with that name/path has first been registered with the addFilter method(s).&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸»è¦å°±æ˜¯æŠŠé…ç½®å­—ç¬¦ä¸²ï¼Œå¦‚ï¼šadmin,user æŒ‰ç…§åŠè§’é€—å·ï¼ˆ,ï¼‰åˆ†å‰²</span></span><br><span class="line">    <span class="comment">// å°†å¾—åˆ°çš„ chainName å’Œ [admin, user] æ”¾å…¥è¿‡æ»¤å™¨ä¸­  Map&lt;String, Object&gt; appliedPaths ç»“æ„ä¸­</span></span><br><span class="line">    <span class="comment">// ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œæ˜¯å› ä¸ºå¯¹äºä¸åŒçš„è·¯å¾„ï¼Œå¯èƒ½ä¼šé…ç½®åŒä¸€ä¸ªè¿‡æ»¤å™¨çš„ä¸åŒè¿‡æ»¤è§„åˆ™</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚ï¼š å­¦æ ¡åˆ—è¡¨å­¦æ ¡ç®¡ç†å‘˜ä¸åŒºçº§ç®¡ç†å‘˜å¯è®¿é—®ï¼ŒåŒºåˆ—è¡¨ä»…åŒºçº§ç®¡ç†å‘˜è®¿é—®</span></span><br><span class="line">    <span class="comment">//      /school/list  roles[school_admin, area_admin]</span></span><br><span class="line">    <span class="comment">//      /area/list    roles[area_admin]</span></span><br><span class="line">    applyChainConfig(chainName, filter, chainSpecificFilterConfig);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ensureChain é¡¾åæ€ä¹‰ï¼Œè¡¨ç¤ºç¡®ä¿ chain å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ–°å»ºä¸€ä¸ª</span></span><br><span class="line">    <span class="type">NamedFilterList</span> <span class="variable">chain</span> <span class="operator">=</span> ensureChain(chainName);</span><br><span class="line">    chain.add(filter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Shiro-FilterChainDefinitionMap-æ³¨å†ŒåŸç†&quot;&gt;&lt;a href=&quot;#Shiro-FilterChainDefinitionMap-æ³¨å†ŒåŸç†&quot; class=&quot;headerlink&quot; title=&quot;Shiro FilterChainDefin</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="Shiro" scheme="http://example.com/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>Shiro DefaultFilter ä½¿ç”¨ç¬”è®°</title>
    <link href="http://example.com/2022/07/14/Shiro/Shiro-DefaultFilter-%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/"/>
    <id>http://example.com/2022/07/14/Shiro/Shiro-DefaultFilter-%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/</id>
    <published>2022-07-14T03:17:34.000Z</published>
    <updated>2022-07-14T09:30:23.522Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Shiro-DefaultFilter-ä½¿ç”¨ç¬”è®°"><a href="#Shiro-DefaultFilter-ä½¿ç”¨ç¬”è®°" class="headerlink" title="Shiro DefaultFilter ä½¿ç”¨ç¬”è®°"></a>Shiro DefaultFilter ä½¿ç”¨ç¬”è®°</h1><h2 id="anon"><a href="#anon" class="headerlink" title="anon"></a>anon</h2><p>AnonymousFilter</p><p>åŒ¿åè¿‡æ»¤å™¨ï¼Œè¯·æ±‚ <code>onPreHandle()</code> ç›´æ¥é€šè¿‡ã€‚</p><h2 id="authc"><a href="#authc" class="headerlink" title="authc"></a>authc</h2><p>FormAuthenticationFilter</p><p>onAccessDenied æ–¹æ³•åˆ† loginUrl å¤„ç†å’Œé loginUrl å¤„ç†ï¼š<br>(1) å½“è¯·æ±‚æ˜¯ loginUrl æ—¶ï¼Œå…¶ä¸­åˆæ ¹æ®æ˜¯å¦ä¸º POST è¯·æ±‚åˆ¤æ–­æ˜¯å¦æ˜¯ login é¡µé¢è¯·æ±‚è¿˜æ˜¯ï¼Œlogin æäº¤ã€‚<br>(2) å½“è¯·æ±‚æ˜¯é loginUrl æ—¶ï¼Œå‘ session å­˜å‚¨äº†ä¸€ä¸ªå±æ€§ shiroSavedRequestï¼Œ ç„¶åè·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚</p><h2 id="authcBasic"><a href="#authcBasic" class="headerlink" title="authcBasic"></a>authcBasic</h2><p>BasicHttpAuthenticationFilter</p><p>onAccessDenied é€»è¾‘ï¼š</p><ol><li>é€šè¿‡è¯·æ±‚å¤´ Authorization åˆ¤æ–­æ˜¯å¦ä¸º login è¯·æ±‚ï¼Œå¦‚æœæ˜¯ï¼Œæ‰§è¡Œ executeLogin é€»è¾‘ï¼Œè·å– username, password æ„é€  AuthenticationToken è¿›è¡Œ Realm è®¤è¯ã€‚</li><li>å¦‚æœä¸æ˜¯ login è¯·æ±‚ï¼Œæˆ–è€…ç™»å½•å¤±è´¥ï¼Œå‘é€è´¨è¯¢</li></ol><h2 id="invalidRequest"><a href="#invalidRequest" class="headerlink" title="invalidRequest"></a>invalidRequest</h2><p>InvalidRequestFilter</p><p>é»˜è®¤å…¨å±€è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤ä¸€äº›éæ³•è¯·æ±‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Shiro-DefaultFilter-ä½¿ç”¨ç¬”è®°&quot;&gt;&lt;a href=&quot;#Shiro-DefaultFilter-ä½¿ç”¨ç¬”è®°&quot; class=&quot;headerlink&quot; title=&quot;Shiro DefaultFilter ä½¿ç”¨ç¬”è®°&quot;&gt;&lt;/a&gt;Shiro DefaultF</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="Shiro" scheme="http://example.com/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>Spring Cloud OpenFeign</title>
    <link href="http://example.com/2022/07/13/Spring-Cloud/Spring-Cloud-OpenFeign/"/>
    <id>http://example.com/2022/07/13/Spring-Cloud/Spring-Cloud-OpenFeign/</id>
    <published>2022-07-12T16:35:38.000Z</published>
    <updated>2022-07-15T03:37:33.872Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Cloud-OpenFeign"><a href="#Spring-Cloud-OpenFeign" class="headerlink" title="Spring Cloud OpenFeign"></a>Spring Cloud OpenFeign</h1><h2 id="1-Declarative-REST-Client-Feign"><a href="#1-Declarative-REST-Client-Feign" class="headerlink" title="1. Declarative REST Client: Feign"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#spring-cloud-feign">1. Declarative REST Client: Feign</a></h2><p>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼ Web æœåŠ¡å®¢æˆ·ç«¯ã€‚å®ƒä½¿å¾—ç¼–å†™ Web æœåŠ¡å®¢æˆ·ç«¯æ›´å®¹æ˜“ã€‚ä½¿ç”¨ Feign åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶æ³¨è§£å®ƒã€‚å®ƒå…·æœ‰å¯æ’å…¥çš„æ³¨è§£æ”¯æŒï¼ŒåŒ…æ‹¬ Feign æ³¨è§£å’Œ JAX-RS æ³¨è§£ã€‚Feign è¿˜æ”¯æŒå¯æ’æ‹”çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Spring Cloud å¢åŠ äº†å¯¹ Spring MVC æ³¨è§£çš„æ”¯æŒï¼Œä»¥åŠæ”¯æŒä½¿ç”¨ Spring Web ä¸­é»˜è®¤é¡¹ç›¸åŒçš„ <code>HttpMessageConverters</code>ã€‚Spring Cloud é›†æˆäº† Ribbon ä»¥åŠ Eurekaï¼ŒSpring Cloud CiruitBreakerï¼Œä»¥åŠ Spring Cloud LoadBalancerï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨ Feign æ—¶æä¾›è´Ÿè½½å‡è¡¡çš„ HTTP å®¢æˆ·ç«¯ã€‚</p><h3 id="1-1-How-to-Include-Feign"><a href="#1-1-How-to-Include-Feign" class="headerlink" title="1.1. How to Include Feign"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#netflix-feign-starter">1.1. How to Include Feign</a></h3><p>è¦åœ¨é¡¹ç›®ä¸­åŒ…å« Feignï¼Œè¯·ä½¿ç”¨ group ä¸º <code>org.springframework.cloud</code>ï¼Œartifact id ä¸º <code>spring-cloud-starter-openfeign</code> çš„ starterã€‚æœ‰å…³ä½¿ç”¨å½“å‰ Spring Cloud Release Train è®¾ç½®ä½ çš„æ„å»ºç³»ç»Ÿçš„è¯¦æƒ…ï¼Œå‚è§ <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a></p><p>ç¤ºä¾‹ Spring Boot åº”ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>StoreClient.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;stores&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StoreClient</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(method = RequestMethod.GET, value = &quot;/stores&quot;)</span></span><br><span class="line">    List&lt;Store&gt; <span class="title function_">getStores</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(method = RequestMethod.GET, value = &quot;/stores&quot;)</span></span><br><span class="line">    Page&lt;Store&gt; <span class="title function_">getStores</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(method = RequestMethod.POST, value = &quot;/stores/&#123;storeId&#125;&quot;, consumes = &quot;application/json&quot;)</span></span><br><span class="line">    Store <span class="title function_">update</span><span class="params">(<span class="meta">@PathVariable(&quot;storeId&quot;)</span> Long storeId, Store store)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>@FeignClient</code> æ³¨è§£ä¸­ï¼Œå­—ç¬¦ä¸² valueï¼ˆå³ä¸Šé¢çš„ â€œstoresâ€ï¼‰æ˜¯ä¸€ä¸ªä»»æ„çš„ client nameï¼Œç”¨äºåˆ›å»ºä¸€ä¸ª Ribbon è´Ÿè½½å‡è¡¡æˆ–è€… Spring Cloud LoadBalancerã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>url</code> å±æ€§ï¼ˆç»å¯¹å€¼æˆ–è€…ä¸€ä¸ªä¸»æœºåï¼‰æŒ‡å®šä¸€ä¸ª URLã€‚åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ Bean çš„åç§°æ˜¯æ¥å£çš„å®Œå…¨é™å®šåã€‚ä¸ºäº†æŒ‡å®šä½ è‡ªå·±çš„åˆ«åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£çš„ <code>qualifiers</code> å€¼ã€‚</p><p>ä¸Šé¢çš„è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯å°†ä¼šå¸Œæœ›å‘ç° â€œstoresâ€ æœåŠ¡çš„ç‰©ç†åœ°å€ã€‚å¦‚æœä½ çš„åº”ç”¨æ˜¯ Eureka å®¢æˆ·ç«¯ï¼Œåˆ™å®ƒå°†åœ¨ Eureka æœåŠ¡æ³¨å†Œè¡¨ä¸­è§£æè¯¥æœåŠ¡ã€‚å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ Eurekaï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>SimpleDiscoveryClient</code> åœ¨å¤–éƒ¨é…ç½®ä¸­ç®€å•åœ°é…ç½®æœåŠ¡å™¨åˆ—è¡¨ã€‚</p><h3 id="1-2-Overriding-Feign-Defaults"><a href="#1-2-Overriding-Feign-Defaults" class="headerlink" title="1.2. Overriding Feign Defaults"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#spring-cloud-feign-overriding-defaults">1.2. Overriding Feign Defaults</a></h3><p>Spring Cloud çš„ Feign æ”¯æŒä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µå°±æ˜¯æœ‰åå®¢æˆ·ç«¯ã€‚æ¯ä¸ª Feign å®¢æˆ·ç«¯éƒ½æ˜¯ä¸€ç¾¤ç»„ä»¶çš„éƒ¨åˆ†ï¼Œå®ƒä»¬å…±åŒåä½œæŒ‰éœ€ä¸è¿œç¨‹æœåŠ¡è¿›è¡Œè¿æ¥ï¼Œå¹¶ä¸”è¿™ä¸ªæ•´ä½“æœ‰ä¸€ä¸ªä½ ä½œä¸ºå¼€å‘è€…ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£èµ‹äºˆçš„åå­—ã€‚Spring Cloud ä½¿ç”¨ <code>FeignClientsConfiguration</code> ä¸ºæ¯ä¸ªæœ‰åå®¢æˆ·ç«¯æŒ‰éœ€åœ°ï¼Œä»¥ <code>ApplicationContext</code> çš„å½¢å¼åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„æ•´ä½“ã€‚è¿™åŒ…å«ä¸€ä¸ª <code>feign.Decoder</code>ï¼Œä¸€ä¸ª <code>feign.Encoder</code>ï¼Œä»¥åŠä¸€ä¸ª <code>feign.Contract</code>ã€‚å¯ä»¥ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£çš„ <code>contextId</code> å±æ€§è¦†ç›–è¯¥æ•´ä½“çš„åç§°ã€‚</p><p>Spring Cloud ä½¿ä½ å¯ä»¥ä½¿ç”¨ <code>@FeignClient</code> å£°æ˜é¢å¤–çš„é…ç½®ï¼ˆè¦†ç›– <code>FeignClientsConfiguration</code>ï¼‰å®Œå…¨æ§åˆ¶ feign å®¢æˆ·ç«¯ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;stores&quot;, configuration = FooConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StoreClient</span> &#123;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ˜¯ç”±å·²ç»å­˜åœ¨äº <code>FeignClientsConfiguration</code> ä¸­çš„ç»„ä»¶ï¼Œä»¥åŠ <code>FooConfiguration</code> ï¼ˆåè€…è¦†ç›–å‰è€…ï¼‰ä¸­çš„ç§ç§ç»„æˆã€‚</p><blockquote><p><code>FooConfiguration</code> ä¸éœ€è¦ <code>@Configuration</code> æ³¨è§£ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™æ ·åšï¼Œè¯·å°†å…¶ä»ä»»ä½• <code>@ComponentScan</code> ä¸­æ’é™¤ï¼Œå¦åˆ™å°†åŒ…å«æ­¤é…ç½®ï¼Œå› ä¸ºå®ƒå°†å°†æˆä¸º <code>feign.Decoder</code>ï¼Œ<code>feign.Encoder</code>ï¼Œ<code>feign.Contract</code> ç­‰é»˜è®¤æºã€‚</p></blockquote><p><code>name</code> å’Œ <code>url</code> å±æ€§ä¹Ÿæ”¯æŒå ä½ç¬¦ã€‚</p><h4 id="1-2-1-SpringEncoder-configuration"><a href="#1-2-1-SpringEncoder-configuration" class="headerlink" title="1.2.1. SpringEncoder configuration"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#springencoder-configuration">1.2.1. SpringEncoder configuration</a></h4><p>åœ¨æˆ‘ä»¬æä¾›çš„ <code>SpringEncoder</code> ä¸­ï¼Œæˆ‘ä»¬ä¸ºäºŒè¿›åˆ¶å†…å®¹ç±»å‹è®¾ç½®äº† <code>null</code> å­—ç¬¦é›†ï¼Œå¹¶æœªæ‰€æœ‰å…¶ä»–çš„è®¾ç½®äº† <code>UTF-8</code>ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>feign.encoder.charset-from-content-type</code> çš„å€¼ä¸º <code>true</code>æ¥ä¿®æ”¹æ­¤è¡Œä¸ºï¼Œä»¥ä» <code>Content-Type</code> å¤´éƒ¨ charset è·å¾—å­—ç¬¦é›†ã€‚</p><h3 id="1-3-Timeout-Handling"><a href="#1-3-Timeout-Handling" class="headerlink" title="1.3. Timeout Handling"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#timeout-handling">1.3. Timeout Handling</a></h3><p>æˆ‘ä»¬å¯ä»¥åœ¨é»˜è®¤å’Œæœ‰åå®¢æˆ·ç«¯ä¸Šé…ç½®è¶…æ—¶ã€‚OpenFeign å¯ä¸ä¸¤ä¸ªè¶…æ—¶å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼š</p><ul><li><code>connectTime</code></li><li><code>readTimeout</code></li></ul><h3 id="1-5-Feign-Hystrix-Support"><a href="#1-5-Feign-Hystrix-Support" class="headerlink" title="1.5. Feign Hystrix Support"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#spring-cloud-feign-hystrix">1.5. Feign Hystrix Support</a></h3><p>å¦‚æœ Hystrix åœ¨ç±»è·¯å¾„ï¼Œå¹¶ä¸” <code>feign.hystrix.enabled=true</code>ï¼ŒFeign å°†ç”¨ç†”æ–­å™¨åŒ…è£…æ‰€æœ‰æ–¹æ³•ã€‚è¿˜æä¾›è¿”å›ä¸€ä¸ª <code>com.netflix.hystrix.HystrixCommand</code>ã€‚è¿™ä½¿ä½ å¯ä»¥ä½¿ç”¨å“åº”å¼æ¨¡å¼ã€‚</p><h3 id="1-6-Feign-Hystrix-Fallbacks"><a href="#1-6-Feign-Hystrix-Fallbacks" class="headerlink" title="1.6. Feign Hystrix Fallbacks"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#spring-cloud-feign-hystrix-fallback">1.6. Feign Hystrix Fallbacks</a></h3><h3 id="1-10-Feign-Inheritance-Support"><a href="#1-10-Feign-Inheritance-Support" class="headerlink" title="1.10. Feign Inheritance Support"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#spring-cloud-feign-inheritance">1.10. Feign Inheritance Support</a></h3><p>Feign é€šè¿‡å•ç»§æ‰¿æ¥å£æ”¯æŒæ ·æ¿ APIã€‚è¿™å…è®¸ä½ å°†é€šç”¨æ“ä½œåˆ†ç»„ä¸ºæ–¹ä¾¿çš„åŸºç¡€æ¥å£ã€‚</p><p><strong>UserService.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(method = RequestMethod.GET, value =&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">long</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserResource.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserResource</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserClient.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> project.user;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(&quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> <span class="keyword">extends</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-Timeout-Handling-1"><a href="#1-3-Timeout-Handling-1" class="headerlink" title="1.3. Timeout Handling"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#timeout-handling">1.3. Timeout Handling</a></h3><p>æˆ‘ä»¬å¯ä»¥åœ¨é»˜è®¤å’Œæœ‰åå®¢æˆ·ç«¯ä¸Šé…ç½® timeout å±æ€§ã€‚OpenFeign ç”¨è¿™ä¸¤ä¸ª timeout å‚æ•°è¿›è¡Œå·¥ä½œï¼š</p><ul><li><code>connectTimeout</code> é˜²æ­¢ç”±äºè¾ƒé•¿çš„æœåŠ¡ç«¯å¤„ç†æ—¶é—´å¯¼è‡´çš„é˜»å¡ã€‚</li><li><code>readTimeout</code> åœ¨è¿æ¥å»ºç«‹çš„æ—¶å€™ä½¿ç”¨ï¼Œå¹¶ä¸”å½“è¿”å›å“åº”èŠ±è´¹å¤ªä¹…çš„æ—¶å€™ä¼šè§¦å‘</li></ul><blockquote><p>å¦‚æœæœåŠ¡æ²¡æœ‰è¿è¡Œæˆ–è€…ä¸å¯ç”¨ï¼Œæ•°æ®åŒ…å¯èƒ½ä»¥è¿æ¥è¢«æ‹’ç»ç»“æŸã€‚é€šä¿¡ä»¥é”™è¯¯ä¿¡æ¯æˆ–è€…åèƒŒæ–¹å¼ç»“æŸã€‚å¦‚æœ <code>connectTimeout</code> è®¾ç½®éå¸¸ä½ï¼Œè¿™å°±æœ‰å¯èƒ½åœ¨ <code>connectTimeout</code> ä¹‹å‰å°±ç»“æŸé€šä¿¡ã€‚æ‰§è¡ŒæŸ¥æ‰¾ä»¥åŠæ¥æ”¶è¿™æ ·çš„æ•°æ®åŒ…çš„æ—¶é—´å¯èƒ½ä¼šäº§ç”Ÿè¾ƒå¤§ä¸€éƒ¨åˆ†å»¶è¿Ÿã€‚å¯ä»¥åŸºäºæ¶‰åŠåˆ° DNS æŸ¥æ‰¾çš„è¿œç¨‹ä¸»æœºä¿®æ”¹è¯¥å€¼ã€‚</p></blockquote><p>å½“å¯ç”¨ Hystrix åï¼Œè¶…æ—¶é…ç½®é»˜è®¤æ˜¯ 1000 æ¯«ç§’ã€‚å› æ­¤ï¼Œå®ƒå¯èƒ½å‘ç”Ÿåœ¨æˆ‘ä»¬å‰é¢é…ç½®çš„å®¢æˆ·ç«¯è¶…æ—¶ä¹‹å‰ã€‚å¢åŠ è¯¥è¶…æ—¶ï¼Œé˜²æ­¢å‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">connectTimeout:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">readTimeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">execution:</span></span><br><span class="line">        <span class="attr">timeout:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">isolation:</span></span><br><span class="line">          <span class="attr">thread:</span></span><br><span class="line">            <span class="attr">timeoutInMilliseconds:</span> <span class="number">60000</span></span><br></pre></td></tr></table></figure><blockquote><p>å½“å¯ç”¨ Hystrix çš„ timeout ä¸”å®ƒçš„ timeout è®¾ç½®å¾—æ¯” feign client æ›´é•¿æ—¶ï¼Œ<code>HystrixTimeoutException</code> ä¼šåŒ…è£…ä¸€ä¸ª feign å¼‚å¸¸ã€‚å¦åˆ™ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å¼‚å¸¸çš„åŸå› ã€‚<code>HystrixTimeoutException</code> çš„ç›®çš„æ˜¯åŒ…è£…å…ˆå‘ç”Ÿçš„ä»»ä½•è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¹¶æŠ›å‡ºè‡ªèº«å®ä¾‹ã€‚</p></blockquote><h3 id="1-5-Feign-Hystrix-Support-1"><a href="#1-5-Feign-Hystrix-Support-1" class="headerlink" title="1.5. Feign Hystrix Support"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#spring-cloud-feign-hystrix">1.5. Feign Hystrix Support</a></h3><p>å¦‚æœ Hystrix åœ¨ç±»è·¯å¾„ä¸­ï¼Œä¸” <code>feign.hystrix.enabled=true</code>ï¼ŒFeign å°†ä½¿ç”¨ç†”æ–­å™¨åŒ…è£…æ‰€æœ‰çš„æ–¹æ³•ã€‚è¿˜å¯ä»¥è¿”å›ä¸€ä¸ª <code>HystrixCommand</code>ã€‚</p><h3 id="1-12-Feign-logging"><a href="#1-12-Feign-logging" class="headerlink" title="1.12. Feign logging"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#feign-logging">1.12. Feign logging</a></h3><p>ä¸ºæ¯ä¸ª Feign å®¢æˆ·ç«¯åˆ›å»ºäº†ä¸€ä¸ª loggerã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œlogger çš„åå­—æ˜¯ç”¨äºåˆ›å»º Feign å®¢æˆ·ç«¯çš„æ¥å£çš„å®Œå…¨é™å®šç±»åã€‚Feign æ—¥å¿—ä»…ä»…å“åº” <code>DEBUG</code> çº§åˆ«ã€‚</p><p><strong>application.yml</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.level.project.user.UserClient</span>: <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯é…ç½®çš„ <code>Logger.Level</code> å¯¹è±¡ï¼Œå‘Šè¯‰ Feign å¤šå°‘è¦è®°å½•ã€‚é€‰é¡¹å¦‚ä¸‹ï¼š</p><ul><li><code>NONE</code>ï¼Œä¸è®°å½•æ—¥å¿—ï¼ˆDEFAULTï¼‰</li><li><code>BASIC</code>ï¼Œä»…ä»…è®°å½•è¯·æ±‚æ–¹æ³•ï¼ŒURLï¼Œå“åº”çŠ¶æ€ç ï¼Œä»¥åŠæ‰§è¡Œæ—¶é—´</li><li><code>HEADERS</code>ï¼Œè®°å½•åŸºæœ¬ä¿¡æ¯ï¼Œä»¥åŠè¯·æ±‚å¤´å’Œå“åº”å¤´</li><li><code>FULL</code>ï¼Œè®°å½•æ¥è‡ªè¯·æ±‚æˆ–å“åº”çš„å¤´éƒ¨</li></ul><h3 id="1-13-Feign-QueryMap-support"><a href="#1-13-Feign-QueryMap-support" class="headerlink" title="1.13. Feign @QueryMap support"></a><a href="https://docs.spring.io/spring-cloud-openfeign/docs/2.2.10.RELEASE/reference/html/#feign-querymap-support">1.13. Feign @QueryMap support</a></h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Cloud-OpenFeign&quot;&gt;&lt;a href=&quot;#Spring-Cloud-OpenFeign&quot; class=&quot;headerlink&quot; title=&quot;Spring Cloud OpenFeign&quot;&gt;&lt;/a&gt;Spring Cloud OpenFei</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
    <category term="OpenFeign" scheme="http://example.com/tags/OpenFeign/"/>
    
  </entry>
  
  <entry>
    <title>Eureka é…ç½®å®è·µ</title>
    <link href="http://example.com/2022/07/12/Eureka-%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/"/>
    <id>http://example.com/2022/07/12/Eureka-%E9%85%8D%E7%BD%AE%E5%AE%9E%E8%B7%B5/</id>
    <published>2022-07-12T08:28:41.000Z</published>
    <updated>2022-07-12T10:23:05.922Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Eureka-Server"><a href="#Eureka-Server" class="headerlink" title="Eureka Server"></a>Eureka Server</h1><h2 id="å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h2><p>ç¡®ä¿å¼•å…¥ maven ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><p>Eureka çš„ Server é…ç½®æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ–‡æ¡£ï¼Œå®˜ç½‘çš„æŒ‡å¼•ä¹Ÿåªæ˜¯è®©ä½ çœ‹æºä»£ç æ³¨é‡Šã€‚</p><h3 id="Eureka-Instance-Config"><a href="#Eureka-Instance-Config" class="headerlink" title="Eureka Instance Config"></a>Eureka Instance Config</h3><ul><li>Instance Id<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">getInstanceId</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li></ul><p>è·å¾—è¯¥å®ä¾‹æ³¨å†Œåˆ° eureka çš„å”¯ä¸€ IDï¼ˆåœ¨ appName èŒƒå›´å†…ï¼‰</p><ul><li>App Name<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">getAppname</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li></ul><p>è·å¾—æ³¨å†Œåˆ° eureka çš„åº”ç”¨åç§°</p><ul><li>lease renewal interval in seconds</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getLeaseRenewalIntervalInSeconds()</span><br></pre></td></tr></table></figure><p>å­—é¢æ„æ€ï¼šç§Ÿçº¦ç»­æœŸé—´éš”ã€‚</p><p>è¡¨ç¤º eureka å®¢æˆ·ç«¯å¤šä¹…å‘é€å¿ƒè·³ç»™ eureka serverï¼Œå‘Šè¯‰å®ƒè‡ªå·±è¿˜æ´»ç€ã€‚å¦‚æœå¿ƒè·³åœ¨ <code>getLeaseExpirationDurationInSeconds()</code> æŒ‡å®šçš„æœŸé—´è¿˜æœªæ”¶åˆ°ï¼Œeureka server å°±ä¼šä»å®ƒçš„è§†å›¾ä¸­ç§»é™¤è¯¥å®ä¾‹ï¼Œä»è€Œç¦ç”¨äº†è¯¥å®ä¾‹çš„æµé‡ã€‚</p><blockquote><p>è¯¥å‚æ•°åªæ˜¯ç”¨äº Eureka Client å‘é€å¿ƒè·³é—´éš”ã€‚éœ€è¦ç¡®ä¿ä¸ Eureka Server çš„ <code>getLeaseExpirationDurationInSeconds()</code> å‚æ•°å€¼ä¸€è‡´ï¼Œå¦åˆ™ Eureka Server æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p></blockquote><ul><li>lease expiration duration in seconds</li></ul><p>è¡¨ç¤º Eureka Server è‡ªæ”¶åˆ°æŸä¸ªå®ä¾‹æœ€åä¸€æ¬¡å¿ƒè·³ï¼Œåœ¨å¯ä»¥ä»å®ƒçš„è§†å›¾ä¸­ç§»é™¤è¯¥å®ä¾‹ä»è€Œç¦ç”¨è¯¥å®ä¾‹æµé‡ä¹‹å‰ï¼Œç­‰å¾…çš„æ—¶é—´ï¼Œå•ä½ï¼šç§’ã€‚</p><p>è®¾ç½®è¯¥å€¼å¤ªé•¿å¯èƒ½æ„å‘³ç€ï¼Œå³ä½¿è¯¥å®ä¾‹å¹¶ä¸å­˜æ´»ï¼Œä¹Ÿå¯ä»¥å°†æµé‡è·¯ç”±åˆ°è¯¥å®ä¾‹ã€‚è®¾ç½®è¯¥å€¼å¤ªå°å¯èƒ½æ„å‘³ç€ï¼Œç”±äºä¸´æ—¶çš„ç½‘ç»œæ•…éšœï¼Œè¯¥å®ä¾‹å¯èƒ½ä¼šä»æµé‡ä¸­å‰”é™¤ã€‚è¯¥å€¼è®¾ç½®è‡³å°‘é«˜äº <code>getLeaseRenewalIntervalInSeconds()</code> æŒ‡å®šçš„å€¼ã€‚</p><blockquote><p>å¦‚æœè¯¥å€¼æ¯” <code>getLeaseRenewalIntervalInSeconds()</code> å°ï¼Œé‚£ä¹ˆå®ä¾‹å°†æ— æ³•å­˜æ´»äºæ³¨å†Œè¡¨ï¼Œå³ä½¿æ³¨å†ŒæˆåŠŸï¼Œå¾ˆå¿«å°±è¢«å‰”é™¤ã€‚</p></blockquote><h3 id="Eureka-Server-Config"><a href="#Eureka-Server-Config" class="headerlink" title="Eureka Server Config"></a>Eureka Server Config</h3><ul><li>AWS Access Id</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">getAWSAccessId</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>AWS äº‘ Access ID</p><ul><li>AWS Secret Key</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">getAWSSecretKey</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>AWS äº‘ Secret Key</p><ul><li><p>EIPBindRebindRetries</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">getEIPBindRebindRetries</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li><li><p>EIPBindingRetryIntervalMsWhenUnbound</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">getEIPBindingRetryIntervalMsWhenUnbound</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></li><li><p>EIPBindingRetryIntervalMs</p></li><li><p>enable-self-preservation</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">shouldEnableSelfPreservation</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>æ˜¯å¦å¼€å¯è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ã€‚</p><p>å¯ç”¨åï¼ŒEureka Server å°†è·Ÿè¸ªå…¶åº”è¯¥ä»æœåŠ¡æ¥æ”¶åˆ°çš„ç»­çº¦æ¬¡æ•°ã€‚ä»»ä½•æ—¶å€™ï¼Œç»­çº¦æ•°é‡ä½äº <code>getRenewalPercentThreshold()</code> å®šä¹‰çš„é˜ˆå€¼ç™¾åˆ†æ¯”ï¼ŒEureka Server ä¼šå…³é—­è¿‡æœŸä»¥é¿å…å±é™©ã€‚è¿™æœ‰åŠ©äºåœ¨ Eureka Client ä¸ Eureka Server ä¹‹é—´å‘ç”Ÿç½‘ç»œé—®é¢˜æ—¶ç»´æŒæ³¨å†Œè¡¨ä¿¡æ¯ã€‚</p><blockquote><p>æ³¨æ„ï¼Œè‡ªæˆ‘ä¿æŠ¤æ˜¯é˜²æ­¢ä¸€äº›ç½‘ç»œé—®é¢˜è¯¯æ€ã€‚</p></blockquote><ul><li>eviction-interval-timer-in-ms</li></ul><p>æ¸…ç†æ— æ•ˆèŠ‚ç‚¹çš„æ—¶é—´é—´éš”ã€‚é»˜è®¤å€¼ 60000</p><blockquote><p>å¯ä»¥å°†è¿™ä¸ªæ—¶é—´è®¾ç½®çš„çŸ­ä¸€äº›ï¼Œè¿›è¡Œå¿«é€Ÿä¸‹çº¿ã€‚é˜²æ­¢ä½¿ç”¨ä¸å¯ç”¨çš„æœåŠ¡ã€‚</p></blockquote><ul><li>expected-client-renewalI-interval-seconds</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">getExpectedClientRenewalIntervalSeconds</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>æœŸæœ›å®¢æˆ·ç«¯ä»¥è¿™ä¸ªé—´éš”å‘é€å®ƒä»¬çš„å¿ƒè·³ã€‚</p><p>é»˜è®¤å€¼ï¼š30</p><p>å¦‚æœå®¢æˆ·ç«¯ä»¥ä¸åŒçš„é¢‘ç‡å‘é€å¿ƒè·³ï¼Œä¾‹å¦‚æ¯ 15 ç§’å‘é€ä¸€æ¬¡ï¼Œé‚£ä¹ˆåº”è¯¥ç›¸åº”åœ°è°ƒæ•´æ­¤å‚æ•°ï¼Œå¦åˆ™ï¼Œè‡ªæˆ‘ä¿æŠ¤å°†æ— æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚</p><blockquote><p>è¯¥å‚æ•°ç”¨äºè®¡ç®—å†…éƒ¨çš„é˜ˆå€¼ã€‚</p></blockquote><ul><li>Response Cache Update Interval Ms</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">getResponseCacheUpdateIntervalMs</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>è·å–æ›´æ–° Eureka Client è´Ÿè½½ç¼“å­˜çš„æ—¶é—´é—´éš”ã€‚</p><ul><li>Use Read Only Response Cache</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">shouldUseReadOnlyResponseCache</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><p>å­—é¢æ„æ€ï¼šæ˜¯å¦ä½¿ç”¨åªè¯»å“åº”ç¼“å­˜</p><p><code>com.netflix.eureka.registry.ResponseCache</code> å½“å‰ä½¿ç”¨ä¸¤çº§ç¼“å­˜ç­–ç•¥æ¥å“åº”ã€‚å¸¦æœ‰è¿‡æœŸç­–ç•¥çš„ç‹¬å†™ç¼“å­˜ï¼Œä»¥åŠä¸ä¼šè¿‡æœŸçš„åªè¯»ç¼“å­˜ã€‚</p><ul><li>Renewal Percent Threshold</li></ul><p>åœ¨ç”± <code>getRenewalThresholdUpdateIntervalMs()</code> æŒ‡å®šçš„æœŸé—´ï¼ŒæœŸæœ›ä»æœåŠ¡ç«¯ç»­æœŸæ¬¡æ•°çš„æœ€å°ç™¾åˆ†æ¯”ã€‚</p><p>å¦‚æœç»­çº¦é™ä½åˆ°é˜ˆå€¼ä»¥ä¸‹ï¼Œå¹¶ä¸”å¯ç”¨äº† <code>shouldEnableSelfPreservation()</code> åˆ™ä¼šç¦ç”¨è¿‡æœŸã€‚</p><ul><li>getRenewalThresholdUpdateIntervalMs</li></ul><p>ç”± <code>getRenewalPercentThreshold()</code> æŒ‡å®šçš„é˜ˆå€¼ï¼Œåº”è¯¥æ›´æ–°çš„é—´éš”ã€‚é˜ˆå€¼æ›´æ–°é—´éš”</p><ul><li>shouldEnableSelfPreservation</li></ul><p>æ£€æŸ¥ eureka server æ˜¯å¦å¯ç”¨äº†è‡ªæˆ‘ä¿æŠ¤ã€‚</p><p>å½“å¯ç”¨ï¼ŒæœåŠ¡ä¼šè·Ÿè¸ªå®ƒåº”è¯¥ä»å¾®æœåŠ¡æ¥å—åˆ°çš„ç»­çº¦æ¬¡æ•°ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œç»­è®¢æ¬¡æ•°çš„æ•°é‡ä½äº <code>getRenewalPercentThreshold()</code> å®šä¹‰çš„é˜ˆå€¼ç™¾åˆ†æ¯”ï¼ŒæœåŠ¡å™¨å°±ä¼šå…³é—­è¿‡æœŸä»¥é¿å…å±é™©ã€‚è¿™æœ‰åŠ©äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´äº§ç”Ÿç½‘ç»œé—®é¢˜æ—¶æœåŠ¡å™¨ç»´æŒæ³¨å†Œä¿¡æ¯ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Eureka-Server&quot;&gt;&lt;a href=&quot;#Eureka-Server&quot; class=&quot;headerlink&quot; title=&quot;Eureka Server&quot;&gt;&lt;/a&gt;Eureka Server&lt;/h1&gt;&lt;h2 id=&quot;å¦‚ä½•ä½¿ç”¨ï¼Ÿ&quot;&gt;&lt;a href=&quot;#å¦‚ä½•ä½¿ç”¨</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Spring Cloud Netflix</title>
    <link href="http://example.com/2022/07/12/Spring-Cloud/Spring-Cloud-Netflix/"/>
    <id>http://example.com/2022/07/12/Spring-Cloud/Spring-Cloud-Netflix/</id>
    <published>2022-07-12T08:26:07.000Z</published>
    <updated>2022-07-17T02:50:07.997Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Cloud-Netflix"><a href="#Spring-Cloud-Netflix" class="headerlink" title="Spring Cloud Netflix"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/">Spring Cloud Netflix</a></h1><h2 id="1-Service-Discovery-Eureka-Clients"><a href="#1-Service-Discovery-Eureka-Clients" class="headerlink" title="1. Service Discovery: Eureka Clients"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#service-discovery-eureka-clients">1. Service Discovery: Eureka Clients</a></h2><p>æœåŠ¡å‘ç°æ˜¯å¾®æœåŠ¡æ¶æ„çš„å…³é”®åŸåˆ™ä¹‹ä¸€ã€‚æ‰‹å·¥é…ç½®æ¯ä¸ªå®¢æˆ·ç«¯æˆ–åŸºäºæŸç§çº¦å®šæ˜¯éå¸¸è„†å¼±çš„ã€‚Eureka æ˜¯ Netflix æœåŠ¡å‘ç°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚æœåŠ¡å¯ä»¥è¢«é…ç½®å’Œéƒ¨ç½²ï¼Œå˜å¾—é«˜å¯ç”¨ï¼Œæ¯ä¸ªæœåŠ¡éƒ½ä¼šå¤åˆ¶å…¶ä»–å·²ç»æ³¨å†ŒæœåŠ¡çš„çŠ¶æ€ã€‚</p><h3 id="1-1-How-to-Include-Eureka-Client"><a href="#1-1-How-to-Include-Eureka-Client" class="headerlink" title="1.1. How to Include Eureka Client"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-eureka-client-starter">1.1. How to Include Eureka Client</a></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-Registering-with-Eureka"><a href="#1-2-Registering-with-Eureka" class="headerlink" title="1.2. Registering with Eureka"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#registering-with-eureka">1.2. Registering with Eureka</a></h3><p>å½“ Eureka Client æ³¨å†Œ Eureka Server æ—¶ï¼Œå®ƒä¼šæä¾›è‡ªå·±çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ï¼šä¸»æœºï¼Œç«¯å£ï¼Œå¥åº·æŒ‡ç¤ºå™¨ URLï¼Œä¸»é¡µç­‰è¯¦ç»†ä¿¡æ¯ã€‚Eureka Server æ¥æ”¶å±äºæŸä¸ªæœåŠ¡çš„æ¯ä¸ªå®ä¾‹çš„å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœå¿ƒè·³åœ¨å¯é…ç½®çš„æ—¶é—´è¡¨ä¸Šå¤±è´¥ï¼Œåˆ™é€šå¸¸ä»æ³¨å†Œè¡¨ä¸­åˆ é™¤å®ä¾‹ã€‚</p><p>ä»¥ä¸‹å®ä¾‹å±•ç¤ºäº†æœ€å°çš„ Eureka Client åº”ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(Application.class).web(<span class="literal">true</span>).run(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œå‰é¢çš„ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªæ™®é€šçš„ Spring Boot åº”ç”¨ã€‚é€šè¿‡åŒ…å« <code>spring-cloud-starter-netflix-eureka-client</code> äºç±»è·¯å¾„ï¼Œä½ çš„åº”ç”¨ä¼šè‡ªåŠ¨æ³¨å†Œåˆ° Eureka Serverã€‚éœ€è¦é…ç½®çš„å°±æ˜¯å®šä½ Eureka Serverï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">serviceUrl:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>defaultZone</code> æ˜¯ä¸€ä¸ªé­”æœ¯å­—ç¬¦ä¸²å¤‡ç”¨å€¼ï¼Œå®ƒä¸ºä»»ä½•æ²¡æœ‰è¡¨ç¤ºé¦–é€‰é¡¹çš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ URLï¼ˆæ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„é»˜è®¤å€¼ï¼‰ã€‚</p><blockquote><p><code>defaultZone</code> å±æ€§æ˜¯å¤§å°å†™æ•æ„Ÿï¼Œå¹¶ä¸”éœ€è¦é©¼å³°æ ¼å¼ï¼Œå› ä¸º <code>serviceUrl</code> å±æ€§æ˜¯ä¸€ä¸ª <code>Map&lt;String, String&gt;</code>ã€‚å› æ­¤ï¼Œ<code>defaultZone</code> å±æ€§ä¸éµå¾ªé€šå¸¸çš„ Spring Boot è›‡å½¢çº¦å®š <code>default-zone</code>ã€‚</p></blockquote><p>é»˜è®¤çš„åº”ç”¨åï¼ˆå³ï¼ŒæœåŠ¡ IDï¼‰ï¼Œè™šæ‹Ÿæœºä¸»æœºåï¼Œä»¥åŠéå®‰å…¨ç«¯å£ï¼ˆä» <code>Environment</code> ä¸­è·å–ï¼‰åˆ†åˆ«æ˜¯ <code>$&#123;spring.application.name&#125;</code>ï¼Œ<code>$&#123;spring.application.name&#125;</code>ï¼Œä»¥åŠ <code>$&#123;server.port&#125;</code>ã€‚</p><h3 id="1-3-Authenticating-with-the-Eureka-Server"><a href="#1-3-Authenticating-with-the-Eureka-Server" class="headerlink" title="1.3. Authenticating with the Eureka Server"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#authenticating-with-the-eureka-server">1.3. Authenticating with the Eureka Server</a></h3><p>å¦‚æœ eureka.client.serviceUrl.defaultZone ä¹‹ä¸€æœ‰å‡­è¯åµŒå…¥å…¶ä¸­ï¼Œåˆ™ä¼šè‡ªåŠ¨æŠŠ HTTP basic è®¤è¯æ·»åŠ åˆ° eureka å®¢æˆ·ç«¯ã€‚</p><p><strong>æ³¨æ„</strong> è¿™é‡Œå¹¶ä¸æ˜¯ç»™ URL æ·»åŠ å‡­è¯ï¼Œåªæ˜¯æ¿€æ´» HTTP basic ç”¨äºè¯·æ±‚çš„è®¤è¯ã€‚</p><h3 id="1-4-Status-Page-and-Health-Indicator"><a href="#1-4-Status-Page-and-Health-Indicator" class="headerlink" title="1.4. Status Page and Health Indicator"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#status-page-and-health-indicator">1.4. Status Page and Health Indicator</a></h3><h3 id="1-5-Registering-a-Secure-Application"><a href="#1-5-Registering-a-Secure-Application" class="headerlink" title="1.5. Registering a Secure Application"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#registering-a-secure-application">1.5. Registering a Secure Application</a></h3><p>å¦‚æœä½ çš„åº”ç”¨å¸Œæœ›é€šè¿‡ HTTPS è¿æ¥ï¼Œä½ å¯ä»¥åœ¨ <code>EurekaInstanceConfig</code> è®¾ç½®ä¸¤ä¸ªæ ‡è®°ï¼š</p><ul><li><code>eureka.instance.[nonSecurePortEnabled]=[false]</code></li><li><code>eureka.instance.[securePortEnabled]=[true]</code></li></ul><h3 id="1-6-Eurekaâ€™s-Health-Checks"><a href="#1-6-Eurekaâ€™s-Health-Checks" class="headerlink" title="1.6. Eurekaâ€™s Health Checks"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#eurekas-health-checks">1.6. Eurekaâ€™s Health Checks</a></h3><h3 id="1-7-Eureka-Metadata-for-Instances-and-Clients"><a href="#1-7-Eureka-Metadata-for-Instances-and-Clients" class="headerlink" title="1.7. Eureka Metadata for Instances and Clients"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#eureka-metadata-for-instances-and-clients">1.7. Eureka Metadata for Instances and Clients</a></h3><h4 id="1-7-1-Using-Eureka-on-Cloud-Foundry"><a href="#1-7-1-Using-Eureka-on-Cloud-Foundry" class="headerlink" title="1.7.1. Using Eureka on Cloud Foundry"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-eureka-on-cloud-foundry">1.7.1. Using Eureka on Cloud Foundry</a></h4><h4 id="1-7-2-Using-Eureka-on-AWS"><a href="#1-7-2-Using-Eureka-on-AWS" class="headerlink" title="1.7.2. Using Eureka on AWS"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-eureka-on-aws">1.7.2. Using Eureka on AWS</a></h4><p>å¦‚æœä½ è®¡åˆ’å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° AWS äº‘ä¸Šï¼Œåˆ™å¿…é¡»å°† Eureka å®ä¾‹é…ç½®ä¸º AWS-awareã€‚ä½ å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ <code>EurekaInstanceConfigBean</code> æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&quot;!default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> EurekaInstanceConfigBean <span class="title function_">eurekaInstanceConfig</span><span class="params">(InetUtils inetUtils)</span> &#123;</span><br><span class="line">  <span class="type">EurekaInstanceConfigBean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EurekaInstanceConfigBean</span>(inetUtils);</span><br><span class="line">  <span class="type">AmazonInfo</span> <span class="variable">info</span> <span class="operator">=</span> AmazonInfo.Builder.newBuilder().autoBuild(<span class="string">&quot;eureka&quot;</span>);</span><br><span class="line">  b.setDataCenterInfo(info);</span><br><span class="line">  <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-7-3-Changing-the-Eureka-Instance-ID"><a href="#1-7-3-Changing-the-Eureka-Instance-ID" class="headerlink" title="1.7.3. Changing the Eureka Instance ID"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#changing-the-eureka-instance-id">1.7.3. Changing the Eureka Instance ID</a></h3><p>ä¸€èˆ¬åœ°ï¼ŒNetFlix Eureka å®ä¾‹ä»¥ host name æ³¨å†Œä¸ºå…¶ä¸»æœºåã€‚Spring Cloud Eureka æä¾›äº†ä¸€ä¸ªæ˜ç¡®çš„é»˜è®¤å€¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;spring.cloud.client.hostname&#125;:$&#123;spring.application.name&#125;:$&#123;spring.application.instance_id:$&#123;server.port&#125;&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š<code>myhost:myappname:8080</code></p><p>åœ¨ Spring Cloud ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡æä¾›å”¯ä¸€æ ‡è¯†ç¬¦ <code>eureka.instance.instanceId</code> æ¥è¦†ç›–è¯¥å€¼ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instanceId:</span> <span class="string">$&#123;spring.application.name&#125;:$&#123;vcap.application.instance_id:$&#123;spring.application.instance_id:$&#123;random.value&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-8-Using-the-EurekaClient"><a href="#1-8-Using-the-EurekaClient" class="headerlink" title="1.8. Using the EurekaClient"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-the-eurekaclient">1.8. Using the EurekaClient</a></h3><p>ä¸€æ—¦ä½ æ‹¥æœ‰ä¸€ä¸ªå‘ç°å®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä» Eureka Server å‘ç°æœåŠ¡å®ä¾‹ã€‚è¿™æ ·åšçš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æœ¬åœ° <code>com.netflix.discovery.EurekaClient</code></p><h2 id="1-9-Alternatives-to-the-Native-Netflix-EurekaClient"><a href="#1-9-Alternatives-to-the-Native-Netflix-EurekaClient" class="headerlink" title="1.9. Alternatives to the Native Netflix EurekaClient"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#alternatives-to-the-native-netflix-eurekaclient">1.9. Alternatives to the Native Netflix EurekaClient</a></h2><p>ä½ æ— éœ€ä½¿ç”¨åŸç”Ÿçš„ NetFlix çš„ <code>EurekaClient</code>ã€‚è€Œä¸”ï¼Œåœ¨æŸç§å½¢å¼çš„åŒ…è£…ä¹‹åé€šå¸¸ä¼šæ›´å®¹æ˜“ä½¿ç”¨å®ƒã€‚é€šè¿‡é€»è¾‘ eureka æœåŠ¡æ ‡è¯†ç¬¦ï¼ˆVIPsï¼‰è€Œä¸æ˜¯ç‰©ç† URLï¼ŒSpring Cloud æ”¯æŒ Feignï¼ˆä¸€ä¸ª REST å®¢æˆ·ç«¯æ„å»ºå™¨ï¼‰ä»¥åŠ Spring RestTemplateã€‚</p><h2 id="1-10-Why-Is-It-so-Slow-to-Register-a-Service"><a href="#1-10-Why-Is-It-so-Slow-to-Register-a-Service" class="headerlink" title="1.10. Why Is It so Slow to Register a Service?"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#why-is-it-so-slow-to-register-a-service">1.10. Why Is It so Slow to Register a Service?</a></h2><p>ä½œä¸ºä¸€ä¸ªå®ä¾‹ï¼Œè¿˜æ¶‰åŠåˆ°å‘æ³¨å†Œä¸­å¿ƒï¼ˆé€šè¿‡ client çš„ serviceUrlï¼‰çš„å®šæœŸå¿ƒè·³ï¼Œé»˜è®¤æ—¶é—´ä¸º 30 ç§’ã€‚ä¸€ä¸ªæœåŠ¡ï¼Œç›´åˆ°è¯¥å®ä¾‹ï¼Œæ³¨å†Œä¸­å¿ƒï¼Œå®¢æˆ·ç«¯ç¼“å­˜ä¸­éƒ½æœ‰ç›¸åŒçš„å…ƒæ•°æ®ï¼ˆå› æ­¤éœ€è¦ 3 ä¸ªå¿ƒè·³ï¼‰ï¼Œå®¢æˆ·ç«¯æ‰èƒ½å‘ç°å…¶ä¸å¯ç”¨ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>eureka.instance.leaseRenewalIntervalInSeconds</code> æ¥æ›´æ”¹å‘¨æœŸã€‚å°†å…¶è®¾ç½®ä¸ºå°äº 30 çš„å€¼ï¼Œå¯ä»¥åŠ å¿«å®¢æˆ·ç«¯è¿æ¥åˆ°å…¶ä»–æœåŠ¡çš„è¿›ç¨‹ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œç”±äºæ³¨å†Œä¸­å¿ƒçš„å†…éƒ¨è®¡ç®—å¯¹ç§Ÿèµç»­æœŸåšäº†å‡è®¾ï¼Œå› æ­¤æœ€å¥½åšæŒä½¿ç”¨é»˜è®¤å€¼ã€‚</p><h1 id="2-Service-Discovery-Eureka-Server"><a href="#2-Service-Discovery-Eureka-Server" class="headerlink" title="2. Service Discovery: Eureka Server"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server">2. Service Discovery: Eureka Server</a></h1><p><a href="https://gitee.com/jiang_chun_bo/cannedbread-parent/tree/master/cannedbread-eureka-server">å‚è€ƒé…ç½®</a></p><h2 id="2-1-How-to-Include-Eureka-Server"><a href="#2-1-How-to-Include-Eureka-Server" class="headerlink" title="2.1. How to Include Eureka Server"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-eureka-server-starter">2.1. How to Include Eureka Server</a></h2><p>è¦åœ¨ä½ çš„é¡¹ç›®ä¸­åŒ…å« Eureka Serverï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code> ä»¥åŠ artifact ID ä¸º <code>spring-cloud-starter-netflix-eureka-server</code> çš„ starterã€‚å‚è§ <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a></p><h2 id="2-2-How-to-Run-a-Eureka-Server"><a href="#2-2-How-to-Run-a-Eureka-Server" class="headerlink" title="2.2. How to Run a Eureka Server"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-running-eureka-server">2.2. How to Run a Eureka Server</a></h2><p>æœåŠ¡ç«¯æœ‰ä¸€ä¸ªä¸»é¡µå’Œ HTTP API ï¼ˆåœ¨ &#x2F;eureka&#x2F;* ä¸‹ï¼‰ã€‚</p><p>&amp;nbsp;</p><h2 id="2-3-High-Availability-Zones-and-Regions"><a href="#2-3-High-Availability-Zones-and-Regions" class="headerlink" title="2.3. High Availability, Zones and Regions"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-zones-and-regions">2.3. High Availability, Zones and Regions</a></h2><p>Eureka æœåŠ¡ç«¯å¹¶æ²¡æœ‰åç«¯å­˜å‚¨ï¼Œä½†æ˜¯æ³¨å†Œè¡¨ä¸­çš„æœåŠ¡å®ä¾‹éƒ½å¿…é¡»å‘é€å¿ƒè·³ï¼Œæ¥ä¿æŒå®ƒä»¬çš„æ³¨å†Œæœ€æ–°ï¼ˆè¿™å¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆï¼‰ã€‚å®¢æˆ·ç«¯è¿˜æœ‰ä¸€ä¸ªå†…å­˜ä¸­çš„ Eureka æ³¨å†Œç¼“å­˜ï¼Œå› æ­¤å¯¹äºæ¯ä¸ªæœåŠ¡çš„è¯·æ±‚ï¼Œä¸å¿…è·³è½¬åˆ°æ³¨å†Œè¡¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Eureka æœåŠ¡ç«¯ä¹Ÿæ˜¯ Eureka å®¢æˆ·ç«¯ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªæœåŠ¡ URL æ¥å®šä½å¯¹ç­‰ä½“ã€‚å¦‚æœæ²¡æœ‰æä¾›æœåŠ¡ URLï¼ŒæœåŠ¡è·‘èµ·æ¥å¹¶å¼€å§‹å·¥ä½œï¼Œå°±ä¼šå¡«å……å¤§é‡çš„å™ªéŸ³åˆ°æ—¥å¿—ä¸­ï¼ˆæ— æ³•ä¸å¯¹ç­‰ä½“æ³¨å†Œçš„å¼‚å¸¸ï¼‰ã€‚</p><p>&amp;nbsp;</p><h2 id="2-4-Standalone-Mode"><a href="#2-4-Standalone-Mode" class="headerlink" title="2.4. Standalone Mode"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-standalone-mode">2.4. Standalone Mode</a></h2><p>åŒç¼“å­˜å’Œå¿ƒè·³æœºåˆ¶ï¼Œä¸¤è€…ç»„åˆå¯ä»¥è®©ç‹¬ç«‹ Eureka Server å¯¹äºå¤±è´¥å…·æœ‰ç›¸å½“çš„å¼¹æ€§ï¼Œåªè¦æœ‰æŸç§ç›‘è§†å™¨æˆ–è€…å¼¹æ€§çš„è¿è¡Œæ—¶é—´ä¿æŒå­˜æ´»ã€‚åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½æ›´å¸Œæœ›å…³é—­å®¢æˆ·ç«¯è¡Œä¸ºï¼Œé¿å…ä¸æ–­å°è¯•å¹¶æ— æ³•è¾¾åˆ°å¯¹ç­‰ä½“çš„é”™è¯¯ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">registerWithEureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">fetchRegistry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">serviceUrl:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong> serviceUrl éœ€è¦æŒ‡å‘æœ¬åœ°å®ä¾‹ç›¸åŒçš„ä¸»æœºã€‚</p><h2 id="2-5-Peer-Awareness"><a href="#2-5-Peer-Awareness" class="headerlink" title="2.5. Peer Awareness"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-peer-awareness">2.5. Peer Awareness</a></h2><p>é€šè¿‡è¿è¡Œå¤šä¸ªå®ä¾‹ï¼Œå¹¶è®©ä»–ä»¬äº’ç›¸æ³¨å†Œï¼Œeureka å¯ä»¥å˜å¾—æ›´å…·æœ‰å¼¹æ€§å’Œå¯ç”¨æ€§ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯é»˜è®¤çš„è¡Œä¸ºï¼Œæ‰€ä»¥ä½ åªéœ€è¦å‘å¯¹ç­‰ä½“æ·»åŠ æœ‰æ•ˆçš„ serviceUrl å³å¯ã€‚</p><p>ä¸ºäº†åœ¨å•ä¸ªä¸»æœºä¸Šä½“éªŒå¯¹ç­‰æ„ŸçŸ¥ï¼Œå¯ä»¥æ“ä½œ <code>/etc/hosts</code> æ–‡ä»¶æ¥è§£æä¸»æœºåã€‚å®é™…ä¸Šï¼Œå¦‚æœè¿è¡Œåœ¨ä¸€å°å·²çŸ¥ä¸»æœºåçš„æœºå™¨ä¸Šæ—¶ï¼Œæ²¡æœ‰å¿…è¦é…ç½® <code>eureka.instance.hostname</code>ã€‚é»˜è®¤åœ°ï¼Œä¼šä½¿ç”¨ <code>java.net.InetAddress</code> å¯»æ‰¾ã€‚</p><p>ä½ å¯ä»¥å‘ä¸€ä¸ªç³»ç»Ÿæ·»åŠ å¤šä¸ªå¯¹ç­‰ä½“ï¼Œåªè¦å®ƒä»¬é€šè¿‡è‡³å°‘è¾¹ç¼˜å½¼æ­¤è¿æ¥ï¼Œå®ƒä»¬ä¹‹é—´å°±ä¼šåŒæ­¥æ³¨å†Œä¿¡æ¯ã€‚å¦‚æœå¯¹ç­‰ä½“ç‰©ç†åˆ†ç¦»ï¼Œé‚£ä¹ˆç³»ç»ŸåŸåˆ™ä¸Šå­˜åœ¨è„‘è£‚çš„é—®é¢˜ã€‚</p><h2 id="2-6-When-to-Prefer-IP-Address"><a href="#2-6-When-to-Prefer-IP-Address" class="headerlink" title="2.6. When to Prefer IP Address"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-eureka-server-prefer-ip-address">2.6. When to Prefer IP Address</a></h2><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œeureka æ›´åå‘äºå»ºè®®ä½¿ç”¨æœåŠ¡çš„ IP è€Œä¸æ˜¯ä¸»æœºåã€‚è®¾ç½® <code>eureka.instance.preferIpAddress</code> ä¸º trueï¼Œé‚£ä¹ˆå½“åº”ç”¨æ³¨å†Œåˆ° eureka æ—¶ï¼Œå°†ä¼šä½¿ç”¨ IP åœ°å€è€Œä¸æ˜¯ä¸»æœºåã€‚</p><blockquote><p>å¦‚æœ Java æ— æ³•ç¡®å®š hostnameï¼Œé‚£ä¹ˆå°±ä¼šå‘é€ IP åœ°å€ç»™ eurekaã€‚</p></blockquote><h2 id="2-8-Disabling-Ribbon-with-Eureka-Server-and-Client-starters"><a href="#2-8-Disabling-Ribbon-with-Eureka-Server-and-Client-starters" class="headerlink" title="2.8. Disabling Ribbon with Eureka Server and Client starters"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#disabling-ribbon-with-eureka-server-and-client-starters">2.8. Disabling Ribbon with Eureka Server and Client starters</a></h2><p><code>spring-cloud-starter-netflix-eureka-server</code> å’Œ <code>spring-cloud-starter-netflix-eureka-client</code> yä¸ <code>spring-cloud-starter-netflix-ribbon</code> ä¸€èµ·å‡ºç°ã€‚ç”±äº Ribbon è´Ÿè½½å‡è¡¡å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®åˆ‡æ¢ä½¿ç”¨ Spring Cloud LoadBalancerï¼Œä¹ŸåŒ…å«åœ¨ Eureka starter ä¸­ã€‚</p><p>ä¸ºæ­¤ï¼Œä½ å¯ä»¥å°† <code>spring.cloud.loadbalancer.ribbon.enabled</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ã€‚</p><p>ç„¶åï¼Œä½ è¿˜å¯ä»¥ä»æ„å»ºæ–‡ä»¶ä¸­åœ° Eureka starter ä¸­æ’é™¤ ribbon ç›¸å…³çš„ä¾èµ–ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.netflix.ribbon<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ribbon-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-Circuit-Breaker-Spring-Cloud-Circuit-Breaker-With-Hystrix"><a href="#3-Circuit-Breaker-Spring-Cloud-Circuit-Breaker-With-Hystrix" class="headerlink" title="3. Circuit Breaker: Spring Cloud Circuit Breaker With Hystrix"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#circuit-breaker-spring-cloud-circuit-breaker-with-hystrix">3. Circuit Breaker: Spring Cloud Circuit Breaker With Hystrix</a></h2><h3 id="3-1-Disabling-Spring-Cloud-Circuit-Breaker-Hystrix"><a href="#3-1-Disabling-Spring-Cloud-Circuit-Breaker-Hystrix" class="headerlink" title="3.1. Disabling Spring Cloud Circuit Breaker Hystrix"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#disabling-spring-cloud-circuit-breaker-hystrix">3.1. Disabling Spring Cloud Circuit Breaker Hystrix</a></h3><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cloud.circuitbreaker.hystrix.enabled</code> ä¸º <code>false</code> æ¥ç¦ç”¨è‡ªåŠ¨é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.circuitbreaker.hystrix.enabled=<span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="3-2-Configuring-Hystrix-Circuit-Breakers"><a href="#3-2-Configuring-Hystrix-Circuit-Breakers" class="headerlink" title="3.2. Configuring Hystrix Circuit Breakers"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#configuring-hystrix-circuit-breakers">3.2. Configuring Hystrix Circuit Breakers</a></h3><h4 id="3-2-1-Default-Configuration"><a href="#3-2-1-Default-Configuration" class="headerlink" title="3.2.1. Default Configuration"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#default-configuration">3.2.1. Default Configuration</a></h4><p>ä¸ºäº†ç»™æ‚¨æ‰€æœ‰çš„æ–­è·¯å™¨æä¾›é»˜è®¤é…ç½®ï¼Œè¯·åˆ›å»ºä¼ é€’ä¸€ä¸ª <code>HystrixCircuitBreakerFactory</code> æˆ–è€… <code>ReactiveHystrixCircuitBreakerFactory</code> çš„ <code>Customize</code> Beanã€‚<code>configureDefault</code> æ–¹æ³•å¯ç”¨äºæä¾›é»˜è®¤é…ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;HystrixCircuitBreakerFactory&gt; <span class="title function_">defaultConfig</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; HystrixCommand.Setter</span><br><span class="line">            .withGroupKey(HystrixCommandGroupKey.Factory.asKey(id))</span><br><span class="line">            .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()</span><br><span class="line">            .withExecutionTimeoutInMilliseconds(<span class="number">4000</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Reactive-Example"><a href="#Reactive-Example" class="headerlink" title="Reactive Example"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#reactive-example">Reactive Example</a></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;ReactiveHystrixCircuitBreakerFactory&gt; <span class="title function_">defaultConfig</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configureDefault(id -&gt; HystrixObservableCommand.Setter</span><br><span class="line">            .withGroupKey(HystrixCommandGroupKey.Factory.asKey(id))</span><br><span class="line">            .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()</span><br><span class="line">                    .withExecutionTimeoutInMilliseconds(<span class="number">4000</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-2-Specific-Circuit-Breaker-Configuration"><a href="#3-2-2-Specific-Circuit-Breaker-Configuration" class="headerlink" title="3.2.2. Specific Circuit Breaker Configuration"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#specific-circuit-breaker-configuration">3.2.2. Specific Circuit Breaker Configuration</a></h4><p>ç±»ä¼¼äºæä¾›é»˜è®¤é…ç½®ï¼Œæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ª <code>HystrixCircuitBreakerFactory</code> åˆ›å»ºä¸€ä¸ª <code>Customize</code> Beanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;HystrixCircuitBreakerFactory&gt; <span class="title function_">customizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.commandProperties(</span><br><span class="line">                    HystrixCommandProperties.Setter().withExecutionTimeoutInMilliseconds(<span class="number">2000</span>)), <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Reactive-Example-1"><a href="#Reactive-Example-1" class="headerlink" title="Reactive Example"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#reactive-example-2">Reactive Example</a></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Customizer&lt;ReactiveHystrixCircuitBreakerFactory&gt; <span class="title function_">customizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> factory -&gt; factory.configure(builder -&gt; builder.commandProperties(</span><br><span class="line">                    HystrixCommandProperties.Setter().withExecutionTimeoutInMilliseconds(<span class="number">2000</span>)), <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Circuit-Breaker-Hystrix-Clients"><a href="#4-Circuit-Breaker-Hystrix-Clients" class="headerlink" title="4. Circuit Breaker: Hystrix Clients"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#circuit-breaker-hystrix-clients">4. Circuit Breaker: Hystrix Clients</a></h2><p>Netflix å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåä¸º Hystrix çš„åº“ï¼Œè¯¥åº“å®ç°äº† <a href="https://martinfowler.com/bliki/CircuitBreaker.html">circuit breaker pattern</a>ï¼ˆç†”æ–­å™¨æ¨¡å¼ï¼‰ã€‚åœ¨å¾®æœåŠ¡ä½“ç³»ç»“æ„ä¸­ï¼Œé€šå¸¸å…·æœ‰å¤šå±‚æœåŠ¡è°ƒç”¨ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-netflix/main/docs/src/main/asciidoc/images/Hystrix.png"><p><strong>Figure 1. Microservice Graph</strong></p><p>è¾ƒä½çº§åˆ«çš„æœåŠ¡å¤±è´¥å¯èƒ½å¯¼è‡´çº§è”å¤±è´¥ï¼Œç›´è‡³ç”¨æˆ·ã€‚å½“å¯¹ç‰¹å®šæœåŠ¡è°ƒç”¨è¶…è¿‡ <code>circuitBreaker.requestVolumeThreshold</code>ï¼ˆé»˜è®¤æ˜¯ 20 æ¬¡è¯·æ±‚ï¼‰ï¼Œå¹¶ä¸”ï¼Œåœ¨ä¸€ä¸ªç”± <code>metrics.rollingStats.timeInMilliseconds</code> å®šä¹‰æ»‘åŠ¨çª—å£ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰å†…ï¼Œå¤±è´¥ç™¾åˆ†æ¯”å¤§äº <code>circuitBreaker.errorThresholdPercentage</code>ï¼ˆé»˜è®¤ &gt;50%ï¼‰ï¼Œ ç†”æ–­å™¨ä¼šæ‰“å¼€ï¼Œå¹¶ä¸”ä¸è¿›è¡Œè°ƒç”¨ã€‚åœ¨å‡ºé”™å¹¶ä¸”ç†”æ–­å™¨æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯ä»¥æä¾›ä¸€ä¸ª fallbackã€‚</p><img src="https://raw.githubusercontent.com/spring-cloud/spring-cloud-netflix/main/docs/src/main/asciidoc/images/HystrixFallback.png"><p><strong>Figure 2. Hystrix fallback prevents cascading failures</strong></p><h2 id="4-1-How-to-Include-Hystrix"><a href="#4-1-How-to-Include-Hystrix" class="headerlink" title="4.1. How to Include Hystrix"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#how-to-include-hystrix">4.1. How to Include Hystrix</a></h2><p>è‹¥è¦åœ¨ä½ çš„é¡¹ç›®ä¸­åŒ…å« Hystrixï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code>ï¼Œartifact ID ä¸º <code>spring-cloud-starter-netflix-hystrix</code> çš„ starterã€‚</p><p>ä¸‹é¢ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªæç®€çš„å¸¦æœ‰ Hystrix ç†”æ–­å™¨çš„ Eureka æœåŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(Application.class).web(<span class="literal">true</span>).run(args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StoreIntegration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;defaultStores&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getStores</span><span class="params">(Map&lt;String, Object&gt; parameters)</span> &#123;</span><br><span class="line">        <span class="comment">//do stuff that might fail</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">defaultStores</span><span class="params">(Map&lt;String, Object&gt; parameters)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="comment">/* something useful */</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@HystrixCommand</code> ç”±åä¸º <a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica">â€œjavanicaâ€</a> çš„ Netflix contrib åº“æä¾›ã€‚Spring Cloud ä»¥ä»£ç†çš„æ–¹å¼åŒ…è£…å…·æœ‰è¯¥æ³¨è§£çš„ Spring Beanï¼Œç”¨äºè¿æ¥åˆ° Hystrix ç†”æ–­å™¨ã€‚ç†”æ–­å™¨è®¡ç®—ä½•æ—¶æ‰“å¼€å’Œå…³é—­å›è·¯ï¼Œä»¥åŠåœ¨å¤±è´¥çš„æƒ…å†µä¸‹åšä»€ä¹ˆã€‚</p><p>è¦é…ç½® <code>@HystrixCommand</code>ï¼Œä½ å¯ä»¥ä»¥ <code>@HystrixProperty</code> æ³¨è§£åˆ—è¡¨çš„å½¢å¼ä½¿ç”¨ <code>commandProperties</code> å±æ€§ã€‚æœ‰å…³æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚è§<a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica#configuration">æ­¤å¤„</a>ã€‚æœ‰å…³å¯ç”¨å±æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œå‚è§ <a href="https://github.com/Netflix/Hystrix/wiki/Configuration">Hystrix wiki</a></p><h2 id="4-2-Propagating-the-Security-Context-or-Using-Spring-Scopes"><a href="#4-2-Propagating-the-Security-Context-or-Using-Spring-Scopes" class="headerlink" title="4.2. Propagating the Security Context or Using Spring Scopes"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-hystrix-starter">4.2. Propagating the Security Context or Using Spring Scopes</a></h2><p>å¦‚æœä½ å¸Œæœ›ä¸€äº›çº¿ç¨‹çš„æœ¬åœ°ä¸Šä¸‹æ–‡ä¼ æ’­åˆ° <code>@HystrixCommand</code>ï¼Œé»˜è®¤å£°æ˜å¹¶ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œå‘½ä»¤ï¼ˆåœ¨è¶…æ—¶æƒ…å†µä¸‹ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡é…ç½®æˆ–è€…ç›´æ¥åœ¨æ³¨è§£ä¸Šï¼Œè¯·æ±‚ Hystrix ä½¿ç”¨ä¸åŒçš„ â€œIsolation Strategyâ€ï¼Œåˆ‡æ¢ Hystrix ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹ä½œä¸ºè°ƒç”¨è€…ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†åœ¨æ³¨è§£ä¸­è®¾ç½®çº¿ç¨‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;stubMyService&quot;,</span></span><br><span class="line"><span class="meta">    commandProperties = &#123;</span></span><br><span class="line"><span class="meta">      @HystrixProperty(name=&quot;execution.isolation.strategy&quot;, value=&quot;SEMAPHORE&quot;)</span></span><br><span class="line"><span class="meta">    &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="4-3-Health-Indicator"><a href="#4-3-Health-Indicator" class="headerlink" title="4.3. Health Indicator"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#health-indicator">4.3. Health Indicator</a></h3><p>è¿æ¥ç†”æ–­å™¨çš„çŠ¶æ€ä¹Ÿå¯ä»¥æš´éœ²åœ¨è°ƒç”¨åº”ç”¨çš„ <code>/health</code> ç«¯ç‚¹ä¸Šï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hystrix&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;openCircuitBreakers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;StoreIntegration::getStoresByLocationLink&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CIRCUIT_OPEN&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UP&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-4-Hystrix-Metrics-Stream"><a href="#4-4-Hystrix-Metrics-Stream" class="headerlink" title="4.4. Hystrix Metrics Stream"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#hystrix-metrics-stream">4.4. Hystrix Metrics Stream</a></h3><p>è‹¥è¦å¯åŠ¨ Hystrix metrics streamï¼Œè¯·åŒ…å«å…³äº <code>spring-boot-starter-actuator</code> çš„ä¾èµ–ï¼Œå¹¶è®¾ç½® <code>management.endpoints.web.exposure.include=hystrix.stream</code>ã€‚è¿™æ ·åšä¼šæš´éœ² <code>/actuator/hystrix.stream</code> ä½œä¸ºç®¡ç†ç«¯ç‚¹ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-Circuit-Breaker-Hystrix-Dashboard"><a href="#5-Circuit-Breaker-Hystrix-Dashboard" class="headerlink" title="5. Circuit Breaker: Hystrix Dashboard"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#circuit-breaker-hystrix-dashboard">5. Circuit Breaker: Hystrix Dashboard</a></h2><p>åªéœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–å³å¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®ç±»æ·»åŠ ä»¥ä¸‹æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br></pre></td></tr></table></figure><h2 id="6-Hystrix-Timeouts-And-Ribbon-Clients"><a href="#6-Hystrix-Timeouts-And-Ribbon-Clients" class="headerlink" title="6. Hystrix Timeouts And Ribbon Clients"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#hystrix-timeouts-and-ribbon-clients">6. Hystrix Timeouts And Ribbon Clients</a></h2><p>å½“ä½¿ç”¨ Hystrix command åŒ…è£…ä½ å¸Œæœ›çš„ Ribbon å®¢æˆ·ç«¯æ—¶ï¼Œç¡®ä¿ä½ çš„ Hystrix é…ç½®çš„ timeout æ¯” Ribbon é…ç½®çš„ timeout æ›´é•¿ï¼ŒåŒ…æ‹¬ä»»ä½•å¯èƒ½çš„é‡è¯•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ Ribbon è¿æ¥ timeout æ˜¯ 1 ç§’ï¼Œå¹¶ä¸” Ribbon å®¢æˆ·ç«¯å¯èƒ½é‡è¯•è¯·æ±‚ 3 æ¬¡ï¼Œé‚£ä¹ˆä½ çš„ Hystrix è¶…æ—¶æ—¶é—´åº”è¯¥ç•¥é«˜äº 3 ç§’ã€‚</p><blockquote><p><strong>ä½œè€…çš„è¯</strong> å¦‚æœä¸Šè¿°ç¤ºä¾‹é…ç½®ä½äº 3 ç§’ï¼Œé‚£ä¹ˆ Ribbon å¯èƒ½è¿˜æœªå®Œæˆ 3 æ¬¡é‡è¯•å°±å·²ç»ç»“æŸï¼Œå¹¶ä¸æ»¡è¶³é…ç½®é¢„æœŸã€‚</p></blockquote><h3 id="6-1-How-to-Include-the-Hystrix-Dashboard"><a href="#6-1-How-to-Include-the-Hystrix-Dashboard" class="headerlink" title="6.1. How to Include the Hystrix Dashboard"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.10.RELEASE/reference/html/#netflix-hystrix-dashboard-starter">6.1. How to Include the Hystrix Dashboard</a></h3><p>è‹¥è¦åœ¨ä½ çš„é¡¹ç›®åŒ…å« Hystrix Dashboardï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code>ï¼Œartifact ID ä¸º <code>spring-cloud-starter-netflix-hystrix-dashboard</code> çš„ starterã€‚</p><p>è‹¥è¦è¿è¡Œ Hystrix Dashboardï¼Œè¯·ä½¿ç”¨ <code>@EnableHystrixDashboard</code> æ³¨è§£ä½ çš„ Spring Boot ä¸»ç±»ã€‚ç„¶åè®¿é—® <code>/hystrix</code>ï¼Œå¹¶å°† dashboard æŒ‡å‘ä¸€ä¸ªå®ä¾‹åœ¨ Hystrix å®¢æˆ·ç«¯åº”ç”¨ä¸­çš„ <code>/hystrix.stream</code> ç«¯ç‚¹ã€‚</p><h2 id="7-Client-Side-Load-Balancer-Ribbon"><a href="#7-Client-Side-Load-Balancer-Ribbon" class="headerlink" title="7. Client Side Load Balancer: Ribbon"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-ribbon">7. Client Side Load Balancer: Ribbon</a></h2><p>Ribbon æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥å¯¹ HTTP å’Œ TCP å®¢æˆ·ç«¯è¡Œä¸ºè¿›è¡Œå¤§é‡æ§åˆ¶ã€‚Feign å·²ç»ä½¿ç”¨äº† Ribbonï¼Œå› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>@FeignClient</code>ï¼Œè¿™éƒ¨åˆ†ä¹Ÿä¼šä½¿ç”¨ã€‚</p><blockquote><p>Ribbon æ˜¯ä¸€ä¸ªè¿›ç¨‹å†… LB</p></blockquote><p>Ribbon çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯æœ‰åå®¢æˆ·ç«¯ã€‚æ¯ä¸ªè´Ÿè½½å‡è¡¡å™¨éƒ½æ˜¯ç»„ä»¶é›†åˆçš„ä¸€éƒ¨åˆ†ï¼Œç»„ä»¶ä»¬åœ¨ä¸€èµ·å·¥ä½œï¼ŒæŒ‰éœ€è¦è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ•´ä½“æœ‰ä¸€ä¸ªåå­—ï¼Œè¿™æ˜¯ä½ ä½œä¸ºå¼€å‘è€…èµ‹äºˆçš„åå­—ã€‚æ ¹æ®éœ€è¦ï¼ŒSpring Cloud é€šè¿‡ä½¿ç”¨ <code>RibbonClientConfiguration</code> ä»¥ <code>ApplicationContext</code> ä¸ºæ¯ä¸ªæœ‰åå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•´ä½“ã€‚è¿™åŒ…å«ä¸€ä¸ª <code>ILoadBalancer</code>ï¼Œä¸€ä¸ª <code>RestClient</code>ï¼Œä»¥åŠä¸€ä¸ª <code>ServerListFiter</code>ã€‚</p><h3 id="7-1-How-to-Include-Ribbon"><a href="#7-1-How-to-Include-Ribbon" class="headerlink" title="7.1. How to Include Ribbon"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#netflix-ribbon-starter">7.1. How to Include Ribbon</a></h3><p>è¦åœ¨ä½ çš„é¡¹ç›®ä½¿ç”¨ ribbonï¼Œè¯·ä½¿ç”¨ group ID ä¸º <code>org.springframework.cloud</code>ï¼Œartifact ID ä¸º <code>spring-cloud-starter-netflix-ribbon</code> çš„ starterã€‚æœ‰å…³ä½¿ç”¨å½“å‰ Spring Cloud Release Train è®¾ç½®ä½ çš„æ„å»ºç³»ç»Ÿè¯¦æƒ…è§ <a href="https://projects.spring.io/spring-cloud/">Spring Cloud Project page</a></p><blockquote><p>å¦‚æœä½ ä¾èµ–äº† eurekaï¼Œåˆ™ ribbon ä¹Ÿä¼šåŒæ—¶å¼•å…¥ï¼Œæ— éœ€æ˜¾å¼å¼•å…¥</p></blockquote><h3 id="7-2-Customizing-the-Ribbon-Client"><a href="#7-2-Customizing-the-Ribbon-Client" class="headerlink" title="7.2. Customizing the Ribbon Client"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#customizing-the-ribbon-client">7.2. Customizing the Ribbon Client</a></h3><p>ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>&lt;client&gt;.ribbon.*</code> ä¹‹ä¸­çš„å¤–éƒ¨å±æ€§é…ç½® Ribbon å®¢æˆ·ç«¯çš„ä¸€äº›éƒ¨åˆ†ï¼Œè¿™ç±»ä¼¼äºä½¿ç”¨åŸç”Ÿçš„ Netflix APIï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ Spring Boot é…ç½®æ–‡ä»¶ã€‚åŸç”Ÿé€‰é¡¹å¯ä»¥åœ¨ <a href="https://github.com/Netflix/ribbon/blob/master/ribbon-core/src/main/java/com/netflix/client/config/CommonClientConfigKey.java"><code>CommonClientConfigKey</code></a>  ï¼ˆribbon-core çš„ä¸€éƒ¨åˆ†ï¼‰ä»¥é™æ€å­—æ®µæŸ¥çœ‹ã€‚</p><p>Spring Cloud è¿˜è®©ä½ é€šè¿‡ä½¿ç”¨ <code>@RibbonClient</code> å£°æ˜é¢å¤–é…ç½®ï¼ˆé™¤äº† <code>RibbonClientConfiguration</code>ï¼‰æ¥å®Œå…¨æ§åˆ¶å®¢æˆ·ç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;custom&quot;, configuration = CustomConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå®¢æˆ·ç«¯ç”±å·²ç»å­˜åœ¨äº <code>RibbonClientConfiguration</code> çš„ç»„ä»¶ï¼Œä»¥åŠåœ¨ <code>CustomConfiguration</code> ï¼ˆåè€…é€šå¸¸è¦†ç›–å‰è€…ï¼‰ä¸­çš„ä¸€äº›ç»„æˆã€‚</p><blockquote><p><code>CustomConfiguration</code> ç±»å¿…é¡»æ˜¯ <code>@Configuration</code> ç±»ï¼Œä½†æ˜¯æ³¨æ„ï¼Œä¸è¦æ”¾åœ¨ä¸»åº”ç”¨ä¸Šä¸‹æ–‡çš„ <code>@ComponentScan</code> ä¸­ã€‚å¦åˆ™ï¼Œå®ƒå°†è¢«æ‰€æœ‰çš„ <code>@RibbonClients</code> å…±äº«ã€‚å¦‚æœä½ ä½¿ç”¨ <code>@ComponentScan</code>ï¼ˆæˆ–è€… <code>@SpringBootApplication</code>ï¼‰ï¼Œä½ éœ€è¦é‡‡å–ä¸€äº›æ–¹æ³•ä»¥é¿å…å°†å…¶åŒ…æ‹¬åœ¨å†…ï¼ˆä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†å…¶æ”¾å…¥åˆ†å¼€çš„ï¼Œä¸é‡å çš„åŒ…ä¸­ï¼Œæˆ–è€…åœ¨ <code>@ComponentScan</code> ä¸­æŒ‡å®šè¦æ˜ç¡®æ‰«æçš„åŒ…ï¼‰ã€‚</p></blockquote><h3 id="7-3-Customizing-the-Default-for-All-Ribbon-Clients"><a href="#7-3-Customizing-the-Default-for-All-Ribbon-Clients" class="headerlink" title="7.3. Customizing the Default for All Ribbon Clients"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#customizing-the-default-for-all-ribbon-clients">7.3. Customizing the Default for All Ribbon Clients</a></h3><p>å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@RibbonClients</code> æ³¨è§£ï¼Œæ³¨å†Œä¸€ä¸ªé»˜è®¤çš„é…ç½®ï¼Œä¸ºæ‰€æœ‰çš„ Ribbon å®¢æˆ·ç«¯æä¾›é»˜è®¤é…ç½®ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RibbonClients(defaultConfiguration = DefaultRibbonConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RibbonClientDefaultConfigurationTestsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BazServiceList</span> <span class="keyword">extends</span> <span class="title class_">ConfigurationBasedServerList</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">BazServiceList</span><span class="params">(IClientConfig config)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.initWithNiwsConfig(config);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultRibbonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">ribbonRule</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BestAvailableRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IPing <span class="title function_">ribbonPing</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PingUrl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerList&lt;Server&gt; <span class="title function_">ribbonServerList</span><span class="params">(IClientConfig config)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RibbonClientDefaultConfigurationTestsConfig</span>.BazServiceList(config);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerListSubsetFilter <span class="title function_">serverListFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServerListSubsetFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerListSubsetFilter</span>();</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-4-Customizing-the-Ribbon-Client-by-Setting-Properties"><a href="#7-4-Customizing-the-Ribbon-Client-by-Setting-Properties" class="headerlink" title="7.4. Customizing the Ribbon Client by Setting Properties"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#customizing-the-ribbon-client-by-setting-properties">7.4. Customizing the Ribbon Client by Setting Properties</a></h3><p>ä» 1.2.0 å¼€å§‹ï¼ŒSpring Cloud Netflix ç°åœ¨æ”¯æŒé€šè¿‡è®¾ç½®å…¼å®¹ <a href="https://github.com/Netflix/ribbon/wiki/Working-with-load-balancers#components-of-load-balancer">Ribbon documentation</a> å±æ€§æ¥å®šåˆ¶åŒ– Ribbon å®¢æˆ·ç«¯ã€‚</p><p>è¿™ä½¿ä½ å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­æ›´æ”¹å¯åŠ¨æ—¶è¡Œä¸ºã€‚</p><p>ä¸‹é¢çš„åˆ—è¡¨å±•ç¤ºäº†æ”¯æŒçš„å±æ€§ï¼š</p><ul><li><code>&lt;clientName&gt;.ribbon.NFLoadBalancerClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>ILoadBalancer</code></li><li><code>&lt;clientName&gt;.ribbon.NFLoadBalancerRuleClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>IRule</code></li><li><code>&lt;clientName&gt;.ribbon.NFLoadBalancerPingClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>IPing</code></li><li><code>&lt;clientName&gt;.ribbon.NIWSServerListClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>ServerList</code></li><li><code>&lt;clientName&gt;.ribbon.NIWSServerListFilterClassName</code>ï¼šåº”è¯¥å®ç°äº† <code>ServerListFilter</code></li></ul><blockquote><p>è¿™äº›å±æ€§ä¸­å®šä¹‰çš„ç±»ï¼Œç›¸è¾ƒäºä½¿ç”¨ <code>@RibbonClient(configuration=MyRibbonConfig.class)</code> å®šä¹‰çš„ Beanï¼Œä»¥åŠç”± Spring Cloud Netflix æä¾›çš„é»˜è®¤å€¼ï¼Œå…·æœ‰æ›´é«˜ä¼˜å…ˆçº§</p></blockquote><p>è¦è®¾ç½®åä¸º <code>users</code> çš„æœåŠ¡åçš„ <code>IRule</code></p><h3 id="7-6-Example-How-to-Use-Ribbon-Without-Eureka"><a href="#7-6-Example-How-to-Use-Ribbon-Without-Eureka" class="headerlink" title="7.6. Example: How to Use Ribbon Without Eureka"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#spring-cloud-ribbon-without-eureka">7.6. Example: How to Use Ribbon Without Eureka</a></h3><p>Eureka æ˜¯ä¸€ç§ä¾¿æ·çš„æ–¹å¼ï¼Œå®ƒæŠ½è±¡åŒ–è¿œç¨‹æœåŠ¡çš„å‘ç°ï¼Œå› æ­¤ä½ ä¸å¿…åœ¨å®¢æˆ·ç«¯ä¸­è¿›è¡Œç¡¬ç¼–ç ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨ Eurekaï¼ŒRibbon å’Œ Feign ä¹Ÿå¯ä»¥å·¥ä½œã€‚å‡è®¾ä½ å·²ç»å£°æ˜äº† â€œstoresâ€ çš„ <code>@RibbonClient</code>ï¼Œå¹¶ä¸” Eureka æ²¡æœ‰ä½¿ç”¨ï¼ˆç”šè‡³ä¸åœ¨ç±»è·¯å¾„ï¼‰ã€‚Ribbon å®¢æˆ·ç«¯é»˜è®¤åˆ°é…ç½®å¥½çš„æœåŠ¡åˆ—è¡¨ã€‚ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æä¾›é…ç½®ï¼š</p><p><strong>application.yml</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stores:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">listOfServers:</span> <span class="string">example.com,google.com</span></span><br></pre></td></tr></table></figure><h3 id="7-7-Example-Disable-Eureka-Use-in-Ribbon"><a href="#7-7-Example-Disable-Eureka-Use-in-Ribbon" class="headerlink" title="7.7. Example: Disable Eureka Use in Ribbon"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#example-disable-eureka-use-in-ribbon">7.7. Example: Disable Eureka Use in Ribbon</a></h3><p>å°† <code>ribbon.eureka.enabled</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ï¼Œæ˜¾å¼åœ°ç¦ç”¨ Ribbon ä¸­ Eureka çš„ä½¿ç”¨ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p><strong>application.yml</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eureka:</span></span><br><span class="line">   <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="7-8-Using-the-Ribbon-API-Directly"><a href="#7-8-Using-the-Ribbon-API-Directly" class="headerlink" title="7.8. Using the Ribbon API Directly"></a><a href="https://docs.spring.io/spring-cloud-netflix/docs/2.2.9.RELEASE/reference/html/#using-the-ribbon-api-directly">7.8. Using the Ribbon API Directly</a></h3><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>LoadBalanceClient</code>ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancerClient loadBalancer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doStuff</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> loadBalancer.choose(<span class="string">&quot;stores&quot;</span>);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">storesUri</span> <span class="operator">=</span> URI.create(String.format(<span class="string">&quot;https://%s:%s&quot;</span>, instance.getHost(), instance.getPort()));</span><br><span class="line">        <span class="comment">// ... do something with the URI</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Cloud-Netflix&quot;&gt;&lt;a href=&quot;#Spring-Cloud-Netflix&quot; class=&quot;headerlink&quot; title=&quot;Spring Cloud Netflix&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://docs.spri</summary>
      
    
    
    
    <category term="æ¡†æ¶" scheme="http://example.com/categories/%E6%A1%86%E6%9E%B6/"/>
    
    
    <category term="Spring Cloud" scheme="http://example.com/tags/Spring-Cloud/"/>
    
    <category term="Netflix" scheme="http://example.com/tags/Netflix/"/>
    
  </entry>
  
</feed>
